<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    <title>Area II Cartagena</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Source+Sans+3:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js"></script>
    <style>
        :root{--primary:#1a6b4a;--primary-light:#238c62;--primary-dark:#0f4a33;--accent:#d4a853;--accent-light:#f0d68a;--bg-dark:#1a1f2e;--bg-card:#fff;--bg-main:#f4f6f8;--bg-subtle:#e9edf2;--text:#2d3748;--text-light:#64748b;--text-muted:#94a3b8;--border:#e2e8f0;--border-light:#f1f5f9;--shadow-sm:0 1px 3px rgba(0,0,0,.06);--shadow-md:0 4px 12px rgba(0,0,0,.08);--shadow-lg:0 8px 30px rgba(0,0,0,.15);--radius:12px;--radius-sm:8px;--font-display:'Playfair Display',Georgia,serif;--font-body:'Source Sans 3',-apple-system,sans-serif}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-body);background:var(--bg-main);color:var(--text)}

        /* â•â•â• LANDING PAGE â•â•â• */
        .landing{min-height:100vh;display:flex;flex-direction:column}
        .landing-nav{background:var(--bg-dark);padding:0 40px;height:60px;display:flex;align-items:center;justify-content:space-between;z-index:10}
        .landing-nav .brand{display:flex;align-items:center;gap:12px;color:#fff}
        .landing-nav .brand .logo{width:36px;height:36px;background:linear-gradient(135deg,var(--primary),var(--primary-light));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
        .landing-nav .brand h1{font-family:var(--font-display);font-size:1.15rem;font-weight:600}
        .landing-nav .brand h1 span{color:var(--accent)}
        .landing-nav .nav-links{display:flex;gap:8px}
        .landing-nav .nav-links a{color:rgba(255,255,255,.7);text-decoration:none;font-size:.85rem;font-weight:500;padding:8px 16px;border-radius:6px;transition:.2s}
        .landing-nav .nav-links a:hover{color:#fff;background:rgba(255,255,255,.08)}
        .hero{flex:1;position:relative;display:flex;align-items:center;justify-content:center;min-height:calc(100vh - 60px);overflow:hidden}
        .hero-bg{position:absolute;inset:0;background:url('https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?w=1600&q=80') center/cover;filter:brightness(.35)}
        .hero-overlay{position:absolute;inset:0;background:linear-gradient(135deg,rgba(26,31,46,.85),rgba(15,74,51,.7))}
        .hero-content{position:relative;z-index:2;text-align:center;max-width:800px;padding:40px 20px}
        .hero-badge{display:inline-block;background:rgba(212,168,83,.15);border:1px solid rgba(212,168,83,.3);color:var(--accent-light);padding:6px 20px;border-radius:30px;font-size:.82rem;font-weight:600;letter-spacing:.05em;margin-bottom:24px;text-transform:uppercase}
        .hero-content h2{font-family:var(--font-display);font-size:3.2rem;font-weight:800;color:#fff;line-height:1.15;margin-bottom:16px;letter-spacing:-.02em}
        .hero-content p{font-size:1.15rem;color:rgba(255,255,255,.75);line-height:1.6;margin-bottom:40px;font-weight:300;max-width:600px;margin-left:auto;margin-right:auto}
        .hero-buttons{display:flex;gap:20px;justify-content:center;flex-wrap:wrap}
        .hero-btn{display:flex;align-items:center;gap:12px;padding:20px 40px;border-radius:var(--radius);font-family:var(--font-body);font-size:1.05rem;font-weight:600;cursor:pointer;transition:all .3s;border:2px solid transparent;text-decoration:none;min-width:240px;justify-content:center}
        .hero-btn-patients{background:#fff;color:var(--primary-dark)}
        .hero-btn-patients:hover{transform:translateY(-3px);box-shadow:0 12px 40px rgba(255,255,255,.2)}
        .hero-btn-professionals{background:transparent;border-color:rgba(255,255,255,.4);color:#fff}
        .hero-btn-professionals:hover{background:rgba(255,255,255,.1);border-color:#fff;transform:translateY(-3px)}
        .hero-btn-icon{font-size:1.4rem}
        .hero-footer{position:absolute;bottom:20px;left:0;right:0;text-align:center;z-index:2;color:rgba(255,255,255,.4);font-size:.78rem}
        .hero-footer a{color:rgba(255,255,255,.5);text-decoration:none}

        /* â•â•â• PAGE VIEWS â•â•â• */
        .page{display:none;min-height:100vh}
        .page.active{display:flex;flex-direction:column}
        .page-back{display:inline-flex;align-items:center;gap:6px;color:rgba(255,255,255,.7);text-decoration:none;font-size:.88rem;font-weight:500;padding:8px 16px;border-radius:6px;transition:.2s;cursor:pointer;border:none;background:none;font-family:var(--font-body)}
        .page-back:hover{color:#fff;background:rgba(255,255,255,.08)}

        /* â•â•â• PATIENTS DASHBOARD â•â•â• */
        .patients-header{background:linear-gradient(135deg,var(--bg-dark),#243347);padding:30px 40px 20px;color:#fff}
        .patients-header h2{font-family:var(--font-display);font-size:1.8rem;margin-bottom:6px}
        .patients-header p{font-size:.9rem;opacity:.7;font-weight:300}
        .patients-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;padding:30px 40px;max-width:1200px;margin:0 auto}
        .patient-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:22px;cursor:pointer;transition:all .25s;position:relative;overflow:hidden;text-decoration:none;color:var(--text)}
        .patient-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--primary),var(--accent));transform:scaleX(0);transform-origin:left;transition:transform .3s}
        .patient-card:hover::before{transform:scaleX(1)}
        .patient-card:hover{border-color:var(--primary-light);box-shadow:var(--shadow-md);transform:translateY(-2px)}
        .patient-card-icon{font-size:2rem;margin-bottom:12px}
        .patient-card-title{font-family:var(--font-display);font-weight:600;font-size:1.05rem;color:var(--primary-dark);margin-bottom:4px}
        .patient-card-desc{font-size:.82rem;color:var(--text-muted);font-weight:300}

        /* â•â•â• PROFESSIONALS (existing dashboard) â•â•â• */
        .prof-layout{display:grid;grid-template-columns:280px 1fr 300px;flex:1;overflow:hidden}
        .prof-layout .top-nav{display:none}
        .sidebar-left{background:var(--bg-card);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
        .sidebar-hero{padding:24px 22px 20px;background:linear-gradient(135deg,var(--bg-dark),#243347);color:#fff;position:relative;overflow:hidden}
        .sidebar-hero::before{content:'';position:absolute;top:-30px;right:-30px;width:100px;height:100px;background:var(--primary);opacity:.15;border-radius:50%}
        .sidebar-hero h2{font-family:var(--font-display);font-size:1.15rem;font-weight:600;margin-bottom:4px}
        .sidebar-hero p{font-size:.78rem;opacity:.7;font-weight:300}
        .categories-list{flex:1;overflow-y:auto;padding:8px 0}
        .category-btn{display:flex;align-items:center;gap:10px;width:100%;padding:12px 22px;text-align:left;border:none;background:0 0;cursor:pointer;font-size:.88rem;color:var(--text);font-family:var(--font-body);transition:.2s;border-left:3px solid transparent}
        .category-btn:hover{background:var(--border-light);border-left-color:var(--primary-light)}
        .category-btn.active{background:linear-gradient(90deg,rgba(26,107,74,.06),transparent);border-left-color:var(--primary);color:var(--primary);font-weight:600}
        .cat-emoji{font-size:1.05rem;width:24px;text-align:center}
        .main-content{display:flex;flex-direction:column;background:var(--bg-main);overflow:hidden}
        .content-header{padding:20px 28px;background:var(--bg-card);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .content-header h3{font-family:var(--font-display);font-size:1.5rem;font-weight:700;color:var(--primary-dark)}
        .content-area{flex:1;overflow-y:auto;padding:24px 28px}
        .tab-buttons{display:flex;gap:2px;margin-bottom:24px;background:var(--bg-card);border-radius:var(--radius);padding:4px;box-shadow:var(--shadow-sm);border:1px solid var(--border)}
        .tab-btn{flex:1;padding:10px 12px;border:none;background:0 0;cursor:pointer;color:var(--text-light);font-weight:500;font-size:.84rem;border-radius:var(--radius-sm);transition:.2s;font-family:var(--font-body);white-space:nowrap}
        .tab-btn.active{background:var(--primary);color:#fff;box-shadow:0 2px 8px rgba(26,107,74,.25)}
        .tab-btn:hover:not(.active){background:var(--bg-subtle);color:var(--text)}
        .tab-content{display:none}.tab-content.active{display:block;animation:fadeUp .3s ease}
        @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .question-input{display:flex;gap:10px;margin-bottom:20px}
        .question-input input{flex:1;padding:13px 18px;border:2px solid var(--border);border-radius:var(--radius);font-size:.92rem;font-family:var(--font-body);background:var(--bg-card);transition:.2s}
        .question-input input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(26,107,74,.1)}
        .btn{padding:11px 22px;border:none;border-radius:var(--radius-sm);cursor:pointer;font-weight:600;font-size:.88rem;transition:.2s;font-family:var(--font-body)}
        .btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff}
        .btn-primary:hover:not(:disabled){box-shadow:0 4px 16px rgba(26,107,74,.35);transform:translateY(-1px)}
        .btn-primary:disabled{opacity:.5;cursor:not-allowed;transform:none}
        .btn-secondary{background:var(--bg-subtle);color:var(--text)}.btn-secondary:hover{background:var(--border)}
        .btn-small{padding:8px 16px;font-size:.82rem}
        .question-box{background:var(--bg-card);padding:18px 20px;border-radius:var(--radius);margin-bottom:14px;border-left:4px solid var(--primary);box-shadow:var(--shadow-sm);animation:fadeUp .3s;transition:box-shadow .2s;position:relative}
        .question-box:hover{box-shadow:var(--shadow-md)}
        .question-text{font-family:var(--font-display);color:var(--primary-dark);font-weight:600;margin-bottom:10px;font-size:1rem}
        .answer-text{color:var(--text);line-height:1.7;font-size:.92rem;white-space:pre-wrap;word-wrap:break-word;font-weight:300}
        .note-time{font-size:.76rem;color:var(--text-muted);margin-top:10px;font-weight:500}
        .doc-item{background:var(--bg-card);padding:14px 18px;border-radius:var(--radius-sm);margin-bottom:8px;border:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;transition:.2s}
        .doc-item:hover{border-color:var(--primary-light);box-shadow:var(--shadow-sm)}
        .doc-name{font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:2px}.doc-size{font-size:.78rem;color:var(--text-muted)}
        .doc-btn{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;padding:7px 16px;border:none;border-radius:6px;cursor:pointer;font-size:.82rem;text-decoration:none;font-weight:600;transition:.2s}
        .empty-state{text-align:center;padding:48px 24px;color:var(--text-muted)}.empty-state-icon{font-size:2.8rem;margin-bottom:12px;opacity:.6}.empty-state p{font-size:.92rem;font-weight:300}
        .studio-intro{background:linear-gradient(135deg,var(--bg-dark),#243347);border-radius:var(--radius);padding:22px 24px;margin-bottom:20px;color:#fff;position:relative;overflow:hidden}
        .studio-intro::after{content:'âœ¨';position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:2.5rem;opacity:.15}
        .studio-intro h4{font-family:var(--font-display);font-size:1.15rem;margin-bottom:6px}
        .studio-intro p{font-size:.86rem;opacity:.8;font-weight:300}
        .studio-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
        .studio-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:18px;cursor:pointer;transition:.25s;text-align:left;font-family:var(--font-body);position:relative;overflow:hidden}
        .studio-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--primary),var(--accent));transform:scaleX(0);transform-origin:left;transition:transform .3s}
        .studio-card:hover:not(:disabled)::before{transform:scaleX(1)}
        .studio-card:hover:not(:disabled){border-color:var(--primary-light);box-shadow:var(--shadow-md);transform:translateY(-2px)}
        .studio-card:disabled{opacity:.4;cursor:not-allowed}
        .studio-card-icon{font-size:1.5rem;margin-bottom:8px}.studio-card-title{font-weight:600;font-size:.9rem;color:var(--text)}.studio-card-desc{font-size:.78rem;color:var(--text-muted);font-weight:300}
        .config-box{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:22px;margin-bottom:16px}
        .config-box h4{font-family:var(--font-display);color:var(--primary-dark);margin-bottom:12px;font-size:1rem}
        .config-row{display:flex;gap:8px;margin-bottom:10px;align-items:center}
        .config-row input,.config-row select{flex:1;padding:10px 14px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:.86rem;font-family:var(--font-body);background:var(--bg-main)}
        .config-row input:focus,.config-row select:focus{outline:none;border-color:var(--primary)}
        .config-hint{font-size:.8rem;color:var(--text-light);margin-top:4px;line-height:1.6}
        .config-hint a{color:var(--primary);font-weight:600}
        .sidebar-right{background:var(--bg-card);border-left:1px solid var(--border);padding:24px 20px;overflow-y:auto}
        .sidebar-section-title{font-family:var(--font-display);font-weight:600;margin:0 0 14px;color:var(--primary-dark);font-size:1rem}
        .stat-card{background:var(--bg-main);padding:14px 16px;border-radius:var(--radius-sm);margin-bottom:8px;border:1px solid var(--border-light)}
        .stat-label{font-size:.76rem;color:var(--text-muted);margin-bottom:4px;text-transform:uppercase;letter-spacing:.05em;font-weight:600}
        .stat-value{font-family:var(--font-display);font-size:1.6rem;font-weight:700;color:var(--primary)}
        .model-badge{display:inline-block;background:linear-gradient(135deg,rgba(26,107,74,.08),rgba(26,107,74,.04));color:var(--primary);padding:4px 12px;border-radius:20px;font-size:.76rem;font-weight:600;font-family:Consolas,monospace;border:1px solid rgba(26,107,74,.15)}
        .info-box{background:linear-gradient(135deg,var(--bg-dark),#243347);padding:18px;border-radius:var(--radius);font-size:.84rem;line-height:1.6;color:rgba(255,255,255,.85)}
        .info-box strong{color:#fff}
        .sidebar-footer{padding:14px 22px;border-top:1px solid var(--border);font-size:.72rem;color:var(--text-muted);text-align:center}
        .sidebar-footer a{color:var(--primary);text-decoration:none}
        .nav-status{padding:5px 14px;border-radius:20px;font-size:.78rem;font-weight:600}
        .nav-status.ok{background:rgba(34,197,94,.15);color:#4ade80}.nav-status.wait{background:rgba(234,179,8,.15);color:#fbbf24}
        .scrollbar::-webkit-scrollbar{width:6px}.scrollbar::-webkit-scrollbar-track{background:0 0}.scrollbar::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
        @media(max-width:1024px){.prof-layout{grid-template-columns:1fr}.sidebar-left,.sidebar-right{display:none}.landing-nav .nav-links{display:none}.hero-content h2{font-size:2rem}.hero-buttons{flex-direction:column;align-items:center}.patients-grid{padding:20px}}
    </style>
</head>
<body>

<!-- â•â•â•â•â•â•â• LANDING PAGE â•â•â•â•â•â•â• -->
<div class="page active" id="pageLanding">
    <div class="landing">
        <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" id="loginBtnLanding" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button></div></nav>
        <div class="hero">
            <div class="hero-bg"></div>
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <div class="hero-badge">Centro de Salud Virgen de la Caridad</div>
                <h2>Tu salud, nuestra prioridad</h2>
                <p>Salud y formaciÃ³n para tu comunidad. Accede a recursos para pacientes o herramientas de docencia clÃ­nica para profesionales.</p>
                <div class="hero-buttons">
                    <a class="hero-btn hero-btn-patients" onclick="showPage('pagePatients')"><span class="hero-btn-icon">ğŸ‘¤</span> Pacientes</a>
                    <a class="hero-btn hero-btn-professionals" onclick="showPage('pageProfessionals')"><span class="hero-btn-icon">ğŸ©º</span> Profesionales</a>
                </div>
                <div class="hero-buttons" style="margin-top:20px;">
                    <a class="hero-btn hero-btn-patients" onclick="showPage('pageProtocolosAP')" style="background:#fff;color:var(--primary-dark);"><span class="hero-btn-icon">ğŸ“‹</span> Protocolos Atencion Primaria</a>
                    <a class="hero-btn hero-btn-professionals" onclick="showPage('pageProtocolosUrgencias')" style="background:transparent;border-color:rgba(255,255,255,.4);color:#fff;"><span class="hero-btn-icon">ğŸš¨</span> Protocolos Urgencias</a>
                </div>
            </div>
            <div class="hero-footer">Â© 2026 <a href="https://cartagenaeste.es" target="_blank">cartagenaeste.es</a> Â· Creado con â¤ï¸</div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• PATIENTS PAGE â•â•â•â•â•â•â• -->
<div class="page" id="pagePatients">
    <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" onclick="showPage('pageLanding')">â† Inicio</button><button class="page-back" id="loginBtnPatients" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button></div></nav>
    <div class="patients-header"><h2>ğŸ‘¤ Pacientes</h2><p>Recursos e informaciÃ³n para pacientes del Area II Cartagena</p></div>
    <div class="patients-grid" id="patientsGrid"></div>
</div>

<!-- â•â•â•â•â•â•â• PROFESSIONALS PAGE â•â•â•â•â•â•â• -->
<div class="page" id="pageProfessionals">
    <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" onclick="showPage('pageLanding')">â† Inicio</button><button class="page-back" id="loginBtnProf" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button><span id="statusBadge" class="nav-status wait">âš™ï¸ Config</span></div></nav>
    <div class="prof-layout">
        <div class="sidebar-left"><div class="sidebar-hero"><h2>Especialidades</h2><p>Cuaderno AI Â· Docencia ClÃ­nica</p></div><div class="categories-list scrollbar" id="categoriesList"></div><div class="sidebar-footer">Â© 2026 <a href="https://cartagenaeste.es" target="_blank">cartagenaeste.es</a></div></div>
        <div class="main-content"><div class="content-header"><h3 id="categoryTitle">CardiologÃ­a</h3></div>
            <div class="content-area scrollbar">
                <div class="tab-buttons"><button class="tab-btn active" onclick="switchTab('preguntas',this)">ğŸ¤– Preguntas IA</button><button class="tab-btn" onclick="switchTab('documentos',this)">ğŸ“š Documentos</button><button class="tab-btn" onclick="switchTab('notas',this)">ğŸ“ Notas</button><button class="tab-btn" onclick="switchTab('studio',this)">âœ¨ Studio</button><button class="tab-btn" onclick="switchTab('recursos',this)">ğŸ“‹ Recursos</button><button class="tab-btn" onclick="switchTab('config',this)">âš™ï¸ Config</button></div>
                <div id="preguntas" class="tab-content active"><div class="question-input"><input type="text" id="preguntaInput" placeholder="Haz una pregunta clÃ­nica..." spellcheck="false"><button class="btn btn-primary" onclick="hacerPregunta()" id="btnPreguntar">Preguntar</button></div><div id="preguntasList"><div class="empty-state"><div class="empty-state-icon">ğŸ©º</div><p>Haz tu primera pregunta clÃ­nica</p></div></div></div>
                <div id="documentos" class="tab-content"><div id="documentosList" style="margin-top:8px"></div></div>
                <div id="notas" class="tab-content"><div style="margin-bottom:20px"><textarea id="noteInput" placeholder="Escribe tus notas clÃ­nicas..." style="width:100%;padding:14px;border:2px solid var(--border);border-radius:var(--radius);min-height:90px;font-family:var(--font-body);resize:vertical;font-size:.92rem;background:var(--bg-card)"></textarea><div style="margin-top:10px;display:flex;gap:10px"><button class="btn btn-primary btn-small" onclick="agregarNota()">âœ“ Guardar</button><button class="btn btn-secondary btn-small" onclick="document.getElementById('noteInput').value=''">Limpiar</button></div></div><div id="notasList"></div></div>
                <div id="studio" class="tab-content"><div class="studio-intro"><h4>AI Studio Â· Generador ClÃ­nico</h4><p>Genera contenido mÃ©dico sobre <strong id="studioCategory">CardiologÃ­a</strong> con IA.</p></div><div class="studio-grid"><button class="studio-card" onclick="studioAction('resumen')"><div class="studio-card-icon">ğŸ“‹</div><div class="studio-card-title">Resumen ejecutivo</div><div class="studio-card-desc">Puntos clave</div></button><button class="studio-card" onclick="studioAction('faq')"><div class="studio-card-icon">â“</div><div class="studio-card-title">FAQ ClÃ­nico</div><div class="studio-card-desc">Preguntas frecuentes</div></button><button class="studio-card" onclick="studioAction('guia')"><div class="studio-card-icon">ğŸ“–</div><div class="studio-card-title">GuÃ­a de estudio</div><div class="studio-card-desc">Conceptos y repaso</div></button><button class="studio-card" onclick="studioAction('diagnostico')"><div class="studio-card-icon">ğŸ©º</div><div class="studio-card-title">DiagnÃ³stico diferencial</div><div class="studio-card-desc">PatologÃ­as principales</div></button><button class="studio-card" onclick="studioAction('farmacologia')"><div class="studio-card-icon">ğŸ’Š</div><div class="studio-card-title">FarmacologÃ­a</div><div class="studio-card-desc">FÃ¡rmacos y dosis</div></button><button class="studio-card" onclick="studioAction('emergencia')"><div class="studio-card-icon">ğŸš¨</div><div class="studio-card-title">Protocolo emergencia</div><div class="studio-card-desc">ActuaciÃ³n urgente</div></button></div><div id="studioResult" style="display:none"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><h4 style="font-family:var(--font-display);color:var(--primary-dark)" id="studioResultTitle"></h4><button class="btn btn-primary btn-small" onclick="guardarStudioComoNota()">ğŸ’¾ Guardar</button></div><div id="studioResultContent" class="scrollbar" style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:20px;line-height:1.7;font-size:.92rem;white-space:pre-wrap;max-height:400px;overflow-y:auto;font-weight:300"></div></div></div>
                <div id="recursos" class="tab-content"><div style="padding:16px 0;"><h3 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:20px;font-size:1.2rem">ğŸ“‹ Recursos Sociales</h3><p style="color:var(--text-light);margin-bottom:20px;font-size:.9rem">Formularios y documentos oficiales para prestaciones sociales, pensiones y servicios de dependencia.</p><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;"><a href="recursos-sociales-grado-dependencia.pdf" target="_blank" style="text-decoration:none;"><div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s;text-align:center;hover:border-color:var(--primary)"><div style="font-size:1.8rem;margin-bottom:8px">ğŸ“‹</div><div style="font-weight:600;color:var(--primary-dark);font-size:.95rem;margin-bottom:4px">Grado de Dependencia</div><div style="font-size:.78rem;color:var(--text-muted)">2.0 MB Â· PDF</div></div></a><a href="recursos-sociales-ayuda-domicilio.pdf" target="_blank" style="text-decoration:none;"><div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s;text-align:center"><div style="font-size:1.8rem;margin-bottom:8px">ğŸ </div><div style="font-weight:600;color:var(--primary-dark);font-size:.95rem;margin-bottom:4px">Ayuda a Domicilio</div><div style="font-size:.78rem;color:var(--text-muted)">825 KB Â· PDF</div></div></a><a href="recursos-sociales-servicios-domiciliarios.pdf" target="_blank" style="text-decoration:none;"><div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s;text-align:center"><div style="font-size:1.8rem;margin-bottom:8px">ğŸ‘¨â€âš•ï¸</div><div style="font-weight:600;color:var(--primary-dark);font-size:.95rem;margin-bottom:4px">Servicios Domiciliarios</div><div style="font-size:.78rem;color:var(--text-muted)">213 KB Â· PDF</div></div></a><a href="recursos-sociales-pension-jubilacion.pdf" target="_blank" style="text-decoration:none;"><div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s;text-align:center"><div style="font-size:1.8rem;margin-bottom:8px">ğŸ’°</div><div style="font-weight:600;color:var(--primary-dark);font-size:.95rem;margin-bottom:4px">PensiÃ³n JubilaciÃ³n</div><div style="font-size:.78rem;color:var(--text-muted)">1.9 MB Â· PDF</div></div></a><a href="recursos-sociales-punto-acceso.pdf" target="_blank" style="text-decoration:none;"><div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s;text-align:center"><div style="font-size:1.8rem;margin-bottom:8px">ğŸ“</div><div style="font-weight:600;color:var(--primary-dark);font-size:.95rem;margin-bottom:4px">PASS</div><div style="font-size:.78rem;color:var(--text-muted)">29 KB Â· PDF</div></div></a></div><div style="margin-top:24px;background:linear-gradient(135deg,var(--bg-dark),#243347);border-radius:var(--radius);padding:18px;color:#fff;font-size:.88rem;line-height:1.6;"><strong>â˜ï¸ Contacto Servicios Sociales</strong><br>ğŸ“ C/ Sor Francisca ArmendÃ¡riz, s/n Â· Cartagena<br>ğŸ“ 900 923 491<br>â° L-V 9:00-12:30 (presencial) / 9:00-13:00 (telÃ©fono)<br><br><strong style="margin-top:10px;display:block">ğŸŒ Sedes ElectrÃ³nicas</strong><br><a href="https://www.cartagena.es" target="_blank" style="color:rgba(255,255,255,.8)">cartagena.es</a> Â· <a href="https://sede.carm.es" target="_blank" style="color:rgba(255,255,255,.8)">sede.carm.es</a></div></div></div>
                <div id="config" class="tab-content"><div class="config-box"><h4>Proveedor de IA</h4><div class="config-row"><select id="cfgProvider" onchange="cambiarProvider()"><option value="groq">Groq (recomendado Â· ultra rÃ¡pido)</option><option value="qwen">Qwen API directa (Alibaba Cloud)</option></select></div><div id="groqConfig"><p class="config-hint" style="margin-bottom:10px"><strong>Groq</strong> â€” Gratis, ultra rÃ¡pido<br>1. <a href="https://console.groq.com" target="_blank">console.groq.com</a><br>2. Crea cuenta gratis<br>3. API Keys â†’ Create<br>4. Pega key (<code>gsk_</code>)</p><div class="config-row"><input type="password" id="cfgGroqKey" placeholder="gsk_xxxxxxxxxxxx"></div><h4 style="margin-top:12px">Modelo</h4><div class="config-row"><select id="cfgGroqModel"><option value="qwen/qwen3-32b">Qwen3 32B</option><option value="llama-3.3-70b-versatile">Llama 3.3 70B</option><option value="deepseek-r1-distill-llama-70b">DeepSeek R1 70B</option><option value="gemma2-9b-it">Gemma 2 9B</option></select></div></div><div id="qwenConfig" style="display:none"><p class="config-hint" style="margin-bottom:10px"><strong>Qwen API</strong><br>1. <a href="https://www.alibabacloud.com/help/en/model-studio/get-api-key" target="_blank">Alibaba Cloud</a><br>2. Crea API Key (<code>sk-</code>)</p><div class="config-row"><input type="password" id="cfgQwenKey" placeholder="sk-xxxxxxxxxxxx"></div><h4 style="margin-top:12px">Modelo</h4><div class="config-row"><select id="cfgQwenModel"><option value="qwen-turbo">Qwen Turbo</option><option value="qwen-plus">Qwen Plus</option><option value="qwen3-32b">Qwen3 32B</option><option value="qwen-max">Qwen Max</option></select></div></div><div style="margin-top:16px;display:flex;gap:8px"><button class="btn btn-primary btn-small" onclick="guardarConfig()">ğŸ’¾ Guardar</button><button class="btn btn-secondary btn-small" onclick="testApiKey()">ğŸ§ª Probar</button></div><div id="cfgStatus" style="margin-top:12px"></div></div></div>
            </div>
        </div>
        <div class="sidebar-right scrollbar"><div class="sidebar-section-title">EstadÃ­sticas</div><div class="stat-card"><div class="stat-label">Documentos</div><div class="stat-value" id="docsCount">0</div></div><div class="stat-card"><div class="stat-label">Preguntas</div><div class="stat-value" id="preguntasCount">0</div></div><div class="stat-card"><div class="stat-label">Notas</div><div class="stat-value" id="notasCount">0</div></div><div style="margin-top:18px"><div class="sidebar-section-title">Modelo Activo</div><div class="stat-card"><span class="model-badge" id="modelBadge">--</span><div style="font-size:.78rem;color:var(--text-muted);margin-top:8px" id="modelInfo">Config</div></div></div><div class="info-box" style="margin-top:18px"><strong>ğŸ¥ Cuaderno AI</strong><br>Docencia clÃ­nica con IA para Cartagena Este.<br><br>â€¢ IA gratuita<br>â€¢ ResÃºmenes automÃ¡ticos<br>â€¢ Estudio por especialidades</div></div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• PROTOCOLOS ATENCION PRIMARIA PAGE â•â•â•â•â•â•â• -->
<div class="page" id="pageProtocolosAP">
    <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" onclick="showPage('pageLanding')">â† Inicio</button><button class="page-back" id="loginBtnAP" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button></div></nav>
    <div style="padding:40px;max-width:1200px;margin:0 auto;">
        <h2 style="font-family:var(--font-display);font-size:2rem;color:var(--text);margin-bottom:20px;">ğŸ“‹ Protocolos de Atencion Primaria</h2>
        <p style="font-size:.95rem;color:var(--text-light);margin-bottom:30px;max-width:600px;">Accede a los protocolos y guÃ­as de atenciÃ³n primaria para profesionales mÃ©dicos.</p>
        
        <div style="background:var(--bg-card);border-radius:var(--radius);padding:24px;margin-bottom:30px;">
            <div class="tab-buttons"><button class="tab-btn tab-protocols active" onclick="switchProtocolTab('generales',this)" style="cursor:pointer;">ğŸ“‹ Protocolos</button><button class="tab-btn tab-protocols" onclick="switchProtocolTab('configuracion',this)" style="cursor:pointer;">âš™ï¸ Config IA</button><button class="tab-btn tab-protocols" onclick="window.open('protocolos-atencion.html','_blank')" style="cursor:pointer;">ğŸ“‘ Ver Todo</button></div>
            
            <div id="generales-content" class="protocol-content" style="display:block;margin-top:20px;">
                <div id="generalesProtocols" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;">
                    <!-- Protocolo 1 -->
                    <a href="protocolos-1.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">Protocolo 1</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">5.2 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 2 -->
                    <a href="protocolos-2.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">Protocolo 2</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">5.6 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 3 -->
                    <a href="protocolos-3.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">Protocolo 3</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">5.4 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 4 -->
                    <a href="protocolos-4.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">Protocolo 4</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">5.7 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 5 -->
                    <a href="protocolos-5.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">Protocolo 5</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">6.4 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 6 -->
                    <a href="protocolos-6.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">Protocolo 6</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">5.9 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 7 -->
                    <a href="protocolos-7.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">Protocolo 7</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">7.7 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 8 -->
                    <a href="protocolos-8.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">Protocolo 8</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">6.4 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 9 -->
                    <a href="protocolos-9.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">Protocolo 9</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">6.4 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 10 -->
                    <a href="protocolos-10.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">Protocolo 10</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">6.7 KB</div>
                        </div>
                    </a>
                </div>
            </div>
            
            <!-- TAB CONFIGURACIÃ“N IA -->
            <div id="configuracion-content" class="protocol-content" style="display:none;margin-top:20px;">
                <div style="max-width:600px;">
                    <h3 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:20px;font-size:1.2rem">âš™ï¸ ConfiguraciÃ³n IA</h3>
                    
                    <div class="config-box"><h4>Proveedor de IA</h4><div class="config-row"><select id="cfgProvider2" onchange="cambiarProvider()"><option value="groq">Groq (recomendado Â· ultra rÃ¡pido)</option><option value="qwen">Qwen API directa (Alibaba Cloud)</option></select></div><div id="groqConfig2"><p class="config-hint" style="margin-bottom:10px"><strong>Groq</strong> â€” Gratis, ultra rÃ¡pido<br>1. <a href="https://console.groq.com" target="_blank">console.groq.com</a><br>2. Crea cuenta gratis<br>3. API Keys â†’ Create<br>4. Pega key (<code>gsk_</code>)</p><div class="config-row"><input type="password" id="cfgGroqKey2" placeholder="gsk_xxxxxxxxxxxx"></div><h4 style="margin-top:12px">Modelo</h4><div class="config-row"><select id="cfgGroqModel2"><option value="qwen/qwen3-32b">Qwen3 32B</option><option value="llama-3.3-70b-versatile">Llama 3.3 70B</option><option value="deepseek-r1-distill-llama-70b">DeepSeek R1 70B</option><option value="gemma2-9b-it">Gemma 2 9B</option></select></div></div><div id="qwenConfig2" style="display:none"><p class="config-hint" style="margin-bottom:10px"><strong>Qwen API</strong><br>1. <a href="https://www.alibabacloud.com/help/en/model-studio/get-api-key" target="_blank">Alibaba Cloud</a><br>2. Crea API Key (<code>sk-</code>)</p><div class="config-row"><input type="password" id="cfgQwenKey2" placeholder="sk-xxxxxxxxxxxx"></div><h4 style="margin-top:12px">Modelo</h4><div class="config-row"><select id="cfgQwenModel2"><option value="qwen-turbo">Qwen Turbo</option><option value="qwen-plus">Qwen Plus</option><option value="qwen3-32b">Qwen3 32B</option><option value="qwen-max">Qwen Max</option></select></div></div><div style="margin-top:16px;display:flex;gap:8px"><button class="btn btn-primary btn-small" onclick="guardarConfig()">ğŸ’¾ Guardar</button><button class="btn btn-secondary btn-small" onclick="testApiKey()">ğŸ§ª Probar</button></div><div id="cfgStatus2" style="margin-top:12px"></div></div>
                </div>
            </div>
            
            <div id="cardiovasculares-content" class="protocol-content" style="display:none;margin-top:20px;">
                <div id="cardiovascularesProtocols" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;">
                    <div style="background:var(--bg-main);padding:16px;border-radius:8px;border-left:4px solid #d32f2f;text-align:center;"><div style="font-size:1.5rem;margin-bottom:8px;">â¤ï¸</div><div style="font-weight:600;color:var(--text);margin-bottom:4px;">AÃºn sin documentos</div><div style="font-size:.88rem;color:var(--text-muted);">Los protocolos estarÃ¡n disponibles pronto</div></div>
                </div>
            </div>
            
            <div id="respiratorios-content" class="protocol-content" style="display:none;margin-top:20px;">
                <div id="respiratoriosProtocols" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;">
                    <div style="background:var(--bg-main);padding:16px;border-radius:8px;border-left:4px solid #1976d2;text-align:center;"><div style="font-size:1.5rem;margin-bottom:8px;">ğŸ«</div><div style="font-weight:600;color:var(--text);margin-bottom:4px;">AÃºn sin documentos</div><div style="font-size:.88rem;color:var(--text-muted);">Los protocolos estarÃ¡n disponibles pronto</div></div>
                </div>
            </div>
            
            <div id="digestivos-content" class="protocol-content" style="display:none;margin-top:20px;">
                <div id="digestivosProtocols" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;">
                    <div style="background:var(--bg-main);padding:16px;border-radius:8px;border-left:4px solid #f57c00;text-align:center;"><div style="font-size:1.5rem;margin-bottom:8px;">ğŸ«€</div><div style="font-weight:600;color:var(--text);margin-bottom:4px;">AÃºn sin documentos</div><div style="font-size:.88rem;color:var(--text-muted);">Los protocolos estarÃ¡n disponibles pronto</div></div>
                </div>
            </div>
            
            <div id="otros-content" class="protocol-content" style="display:none;margin-top:20px;">
                <div id="otrosProtocols" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;">
                    <div style="background:var(--bg-main);padding:16px;border-radius:8px;border-left:4px solid #7b1fa2;text-align:center;"><div style="font-size:1.5rem;margin-bottom:8px;">â•</div><div style="font-weight:600;color:var(--text);margin-bottom:4px;">AÃºn sin documentos</div><div style="font-size:.88rem;color:var(--text-muted);">Los protocolos estarÃ¡n disponibles pronto</div></div>
                </div>
            </div>
            
            <div style="margin-top:20px;padding:16px;background:#e3f2fd;border-radius:8px;font-size:.88rem;color:#1565c0;"><strong>ğŸ’¡ Tip:</strong> Accede al Panel Admin para subir protocolos de Atencion Primaria.</div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• PROTOCOLOS URGENCIAS PAGE â•â•â•â•â•â•â• -->
<div class="page" id="pageProtocolosUrgencias">
    <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" onclick="showPage('pageLanding')">â† Inicio</button><button class="page-back" id="loginBtnUrgencias" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button></div></nav>
    <div style="background:linear-gradient(135deg,var(--bg-dark),#243347);padding:30px 40px 20px;color:#fff;min-height:100vh;">
        <h2 style="font-family:var(--font-display);font-size:1.8rem;margin-bottom:20px;">ğŸš¨ Protocolos de Urgencias</h2>
        <p style="font-size:.95rem;opacity:.85;margin-bottom:30px;max-width:600px;">Accede a los protocolos y guÃ­as de emergencias para profesionales mÃ©dicos.</p>
        <div style="background:var(--bg-card);border-radius:var(--radius);padding:30px;max-width:600px;"><h3 style="color:var(--primary-dark);font-family:var(--font-display);margin-bottom:20px;">Documentos Disponibles</h3><div id="protocolosUrgenciasList" style="display:grid;grid-template-columns:1fr;gap:12px;"><div style="background:var(--bg-main);padding:16px;border-radius:8px;border-left:4px solid #d32f2f;text-align:center;"><div style="font-size:1.5rem;margin-bottom:8px;">ğŸš¨</div><div style="font-weight:600;color:var(--text);margin-bottom:4px;">AÃºn sin documentos</div><div style="font-size:.88rem;color:var(--text-muted);">Los documentos estarÃ¡n disponibles pronto</div></div></div><div style="margin-top:20px;padding:16px;background:#ffebee;border-radius:8px;font-size:.88rem;color:#c62828;"><strong>âš ï¸ Importante:</strong> Accede al Panel Admin para subir protocolos de Urgencias.</div></div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• IMPROVED LOGIN MODAL â•â•â•â•â•â•â• -->
<div id="loginModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:1000;align-items:center;justify-content:center;backdrop-filter:blur(2px);">
    <div style="background:#fff;border-radius:16px;padding:0;max-width:420px;width:90%;box-shadow:0 25px 80px rgba(0,0,0,.4);overflow:hidden;animation:slideInUp .3s ease;">
        <!-- Header -->
        <div style="background:linear-gradient(135deg,var(--primary),var(--primary-light));padding:32px 24px;color:#fff;text-align:center;position:relative;">
            <div style="position:absolute;top:12px;right:12px;cursor:pointer;font-size:1.5rem;opacity:.7;hover:opacity:1;transition:.2s;" onclick="closeLoginModal()">âœ•</div>
            <div style="font-size:2.5rem;margin-bottom:12px;">ğŸ”</div>
            <h2 style="font-family:var(--font-display);font-size:1.8rem;font-weight:700;margin:0;letter-spacing:-.5px;">Panel Admin</h2>
            <p style="margin:6px 0 0;opacity:.9;font-size:.92rem;">Area II Cartagena</p>
        </div>
        
        <!-- Form -->
        <div style="padding:32px 24px;">
            <div style="margin-bottom:18px;">
                <label style="display:block;margin-bottom:8px;font-weight:600;color:var(--primary-dark);font-size:.9rem;text-transform:uppercase;letter-spacing:.05em;">ğŸ“§ Usuario</label>
                <input type="email" id="loginUsername" placeholder="admin@cartagena.es" spellcheck="false" style="width:100%;padding:14px 16px;border:2px solid var(--border);border-radius:10px;font-size:.95rem;font-family:var(--font-body);transition:.2s;background:var(--bg-main);" onfocus="this.style.borderColor='var(--primary)';this.style.boxShadow='0 0 0 4px rgba(26,107,74,.08)'" onblur="this.style.borderColor='var(--border)';this.style.boxShadow='none'">
            </div>
            
            <div style="margin-bottom:8px;">
                <label style="display:block;margin-bottom:8px;font-weight:600;color:var(--primary-dark);font-size:.9rem;text-transform:uppercase;letter-spacing:.05em;">ğŸ”‘ ContraseÃ±a</label>
                <div style="position:relative;">
                    <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width:100%;padding:14px 16px;padding-right:44px;border:2px solid var(--border);border-radius:10px;font-size:.95rem;font-family:var(--font-body);transition:.2s;background:var(--bg-main);" onfocus="this.style.borderColor='var(--primary)';this.style.boxShadow='0 0 0 4px rgba(26,107,74,.08)'" onblur="this.style.borderColor='var(--border)';this.style.boxShadow='none'">
                    <button onclick="togglePasswordVisibility()" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:1.2rem;padding:0;">ğŸ‘ï¸</button>
                </div>
            </div>
            
            <div style="margin-bottom:24px;display:flex;gap:8px;align-items:center;">
                <input type="checkbox" id="rememberMe" style="width:16px;height:16px;cursor:pointer;">
                <label for="rememberMe" style="cursor:pointer;font-size:.88rem;color:var(--text-light);">RecuÃ©rdame en este dispositivo</label>
            </div>
            
            <button onclick="loginAdmin()" style="width:100%;background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;padding:14px;border:none;border-radius:10px;cursor:pointer;font-weight:700;font-size:.95rem;font-family:var(--font-body);transition:.2s;box-shadow:0 4px 12px rgba(26,107,74,.25);" onmouseover="this.style.boxShadow='0 6px 20px rgba(26,107,74,.35)';this.style.transform='translateY(-1px)'" onmouseout="this.style.boxShadow='0 4px 12px rgba(26,107,74,.25)';this.style.transform='translateY(0)'">
                <span id="loginBtnText">ğŸš€ Acceder</span>
            </button>
            
            <div id="loginError" style="margin-top:16px;padding:14px;background:#fee8e8;color:#c00;border:1px solid #f0b0b0;border-radius:10px;font-size:.88rem;display:none;font-weight:500;">
                <div style="display:flex;align-items:center;gap:8px;">
                    <span style="font-size:1rem;">âš ï¸</span>
                    <span id="loginErrorText">Credenciales incorrectas</span>
                </div>
            </div>
            
            <div id="loginSuccess" style="margin-top:16px;padding:14px;background:#e8f5e9;color:#2e7d32;border:1px solid #a5d6a7;border-radius:10px;font-size:.88rem;display:none;font-weight:500;">
                <div style="display:flex;align-items:center;gap:8px;animation:fadeIn .3s ease;">
                    <span style="font-size:1rem;">âœ…</span>
                    <span>Â¡Acceso concedido! Redirigiendo...</span>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div style="padding:16px 24px;background:var(--bg-main);border-top:1px solid var(--border);text-align:center;font-size:.78rem;color:var(--text-muted);">
            Credenciales seguras â€¢ SesiÃ³n encriptada
        </div>
    </div>
</div>

<style>
@keyframes slideInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
</style>

<!-- â•â•â•â•â•â•â• ADMIN PANEL MODAL â•â•â•â•â•â•â• -->
<div id="adminPanel" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1001;overflow:auto;padding:20px;">
    <div style="background:#fff;border-radius:12px;padding:40px;max-width:600px;margin:40px auto;box-shadow:0 20px 60px rgba(0,0,0,.3);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;">
            <h2 style="font-family:var(--font-display);color:var(--primary-dark);font-size:1.5rem;">ğŸ‘¨â€ğŸ’¼ Panel Administrativo</h2>
            <button onclick="logoutAdmin()" style="background:#c00;color:#fff;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:.85rem;font-family:var(--font-body);">Cerrar SesiÃ³n</button>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:30px;">
            <button onclick="showUploadForm()" style="background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;padding:20px;border:none;border-radius:12px;cursor:pointer;font-weight:600;font-size:.95rem;font-family:var(--font-body);text-align:left;">
                <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“¤</div>
                <div>Subir Archivos</div>
                <div style="font-size:.8rem;opacity:.8;margin-top:4px;">PDF, DOCX, PPTX...</div>
            </button>
            <button onclick="showCategoryForm()" style="background:linear-gradient(135deg,#238c62,#1a6b4a);color:#fff;padding:20px;border:none;border-radius:12px;cursor:pointer;font-weight:600;font-size:.95rem;font-family:var(--font-body);text-align:left;">
                <div style="font-size:1.8rem;margin-bottom:8px;">â•</div>
                <div>Crear CategorÃ­a</div>
                <div style="font-size:.8rem;opacity:.8;margin-top:4px;">Nueva especialidad</div>
            </button>
        </div>

        <!-- Upload Form -->
        <div id="uploadForm" style="display:none;background:var(--bg-main);border:2px dashed var(--primary);border-radius:12px;padding:24px;margin-bottom:24px;">
            <h3 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:16px;">ğŸ“¤ Subir Archivo</h3>
            <div style="margin-bottom:16px;">
                <label style="display:block;margin-bottom:6px;font-weight:600;color:var(--text);font-size:.92rem;">Archivo:</label>
                <input type="file" id="fileInput" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;font-size:.88rem;">
            </div>
            <div style="margin-bottom:16px;">
                <label style="display:block;margin-bottom:6px;font-weight:600;color:var(--text);font-size:.92rem;">CategorÃ­a:</label>
                <select id="fileCategory" style="width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:.92rem;font-family:var(--font-body);">
                    <option value="">-- Selecciona categorÃ­a --</option>
                    <option value="CardiologÃ­a">â¤ï¸ CardiologÃ­a</option>
                    <option value="DermatologÃ­a">ğŸ©¹ DermatologÃ­a</option>
                    <option value="Digestivo">ğŸ« Digestivo</option>
                    <option value="EndocrinologÃ­a">ğŸ§¬ EndocrinologÃ­a</option>
                    <option value="GeriatrÃ­a">ğŸ‘´ GeriatrÃ­a</option>
                    <option value="GinecologÃ­a">ğŸ¤° GinecologÃ­a</option>
                    <option value="NeurologÃ­a">ğŸ§  NeurologÃ­a</option>
                    <option value="NeumologÃ­a">ğŸ’¨ NeumologÃ­a</option>
                    <option value="PediatrÃ­a">ğŸ‘¶ PediatrÃ­a</option>
                    <option value="TraumatologÃ­a">ğŸ¦´ TraumatologÃ­a</option>
                    <option value="Protocolos MÃ©dicos">ğŸ“‹ Protocolos MÃ©dicos</option>
                </select>
            </div>
            <div style="display:flex;gap:10px;">
                <button onclick="uploadFile()" style="flex:1;background:var(--primary);color:#fff;padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.92rem;font-family:var(--font-body);">Subir</button>
                <button onclick="hideUploadForm()" style="flex:1;background:var(--border);color:var(--text);padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.92rem;font-family:var(--font-body);">Cancelar</button>
            </div>
            <div id="uploadStatus" style="margin-top:12px;display:none;padding:12px;background:#efe;color:#2a2;border-radius:6px;font-size:.88rem;"></div>
        </div>

        <!-- Category Form -->
        <div id="categoryForm" style="display:none;background:var(--bg-main);border:2px solid var(--primary);border-radius:12px;padding:24px;margin-bottom:24px;">
            <h3 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:16px;">â• Nueva CategorÃ­a</h3>
            <div style="margin-bottom:16px;">
                <label style="display:block;margin-bottom:6px;font-weight:600;color:var(--text);font-size:.92rem;">Nombre:</label>
                <input type="text" id="catName" placeholder="Ej: OncologÃ­a" style="width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;font-size:.92rem;font-family:var(--font-body);">
            </div>
            <div style="margin-bottom:16px;">
                <label style="display:block;margin-bottom:6px;font-weight:600;color:var(--text);font-size:.92rem;">Emoji:</label>
                <input type="text" id="catEmoji" placeholder="ğŸ—ï¸" maxlength="2" style="width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;font-size:.92rem;font-family:var(--font-body);">
            </div>
            <div style="display:flex;gap:10px;">
                <button onclick="addCategory()" style="flex:1;background:var(--primary);color:#fff;padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.92rem;font-family:var(--font-body);">Crear</button>
                <button onclick="hideCategoryForm()" style="flex:1;background:var(--border);color:var(--text);padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.92rem;font-family:var(--font-body);">Cancelar</button>
            </div>
            <div id="categoryStatus" style="margin-top:12px;display:none;padding:12px;background:#efe;color:#2a2;border-radius:6px;font-size:.88rem;"></div>
        </div>
    </div>
</div>

<script>
// â•â•â• PATIENTS DATA â•â•â•
var patientSections=[
    {icon:"ğŸ¥—",title:"Dietas",desc:"Planes nutricionales",url:"dietas.html"},
    {icon:"ğŸ’œ",title:"Violencia de gÃ©nero",desc:"Recursos y apoyo",url:"violencia-genero.html"},
    {icon:"ğŸ¤",title:"Recursos sociales",desc:"Servicios comunitarios",url:"recursos-sociales.html"},
    {icon:"â„¹ï¸",title:"InformaciÃ³n",desc:"Info general del centro",url:"informacion.html"},
    {icon:"âš ï¸",title:"Factores de riesgo",desc:"PrevenciÃ³n y salud",url:"factores-riesgo.html"},
    {icon:"ğŸƒ",title:"Ejercicios",desc:"GuÃ­as de actividad fÃ­sica",url:"ejercicios.html"},
    {icon:"ğŸ¦·",title:"Dentista",desc:"Salud bucodental",url:"dentista.html"},
    {icon:"ğŸ”—",title:"Enlaces de interÃ©s",desc:"Webs y recursos Ãºtiles",url:"enlaces-interes.html"},
    {icon:"ğŸ’‰",title:"Vacunas",desc:"Calendario y campaÃ±as",url:"vacunas.html"},
    {icon:"ğŸ“…",title:"ProgramaciÃ³n del Centro",desc:"Horarios y agenda",url:"programacion.html"},
    {icon:"ğŸš­",title:"Dejar de fumar",desc:"Programas y ayuda",url:"dejar-fumar.html"},
    {icon:"ğŸ™ï¸",title:"Podcast",desc:"Audio salud comunitaria",url:"podcast.html"}
];

function renderPatients(){
    var g=document.getElementById("patientsGrid");
    g.innerHTML=patientSections.map(function(s){return'<a class="patient-card" href="'+s.url+'" target="_blank"><div class="patient-card-icon">'+s.icon+'</div><div class="patient-card-title">'+s.title+'</div><div class="patient-card-desc">'+s.desc+'</div></a>'}).join("");
}

// â•â•â• ADMIN LOGIN - MEJORADO â•â•â•
var adminCredentials={username:"admin@cartagena.es",password:"Cartagena2026!"};
var isAdminLoggedIn=false;
var loginAttempts=0;
var lockoutTime=0;

function initLoginSession(){
    var savedSession=localStorage.getItem("adminSession");
    if(savedSession){
        try{
            var session=JSON.parse(savedSession);
            if(session.timestamp && Date.now()-session.timestamp<86400000){
                isAdminLoggedIn=true;
                document.getElementById("adminPanel").style.display="block";
            }else{
                localStorage.removeItem("adminSession");
            }
        }catch(e){
            localStorage.removeItem("adminSession");
        }
    }
}

function showLoginModal(){
    if(!isAdminLoggedIn){
        document.getElementById("loginModal").style.display="flex";
        document.getElementById("loginUsername").focus();
        clearLoginForm();
    }
}

function closeLoginModal(){
    document.getElementById("loginModal").style.display="none";
    clearLoginForm();
}

function clearLoginForm(){
    document.getElementById("loginUsername").value="";
    document.getElementById("loginPassword").value="";
    document.getElementById("loginError").style.display="none";
    document.getElementById("loginSuccess").style.display="none";
}

function togglePasswordVisibility(){
    var input=document.getElementById("loginPassword");
    input.type=input.type==="password"?"text":"password";
}

function loginAdmin(){
    if(Date.now()<lockoutTime){
        showLoginError("Demasiados intentos. Intenta de nuevo en 5 minutos.");
        return;
    }
    
    var user=document.getElementById("loginUsername").value.trim();
    var pass=document.getElementById("loginPassword").value;
    
    if(!user||!pass){
        showLoginError("Por favor completa todos los campos");
        return;
    }
    
    document.getElementById("loginBtnText").textContent="â³ Verificando...";
    
    setTimeout(function(){
        if(user===adminCredentials.username&&pass===adminCredentials.password){
            loginAttempts=0;
            isAdminLoggedIn=true;
            
            if(document.getElementById("rememberMe").checked){
                localStorage.setItem("adminSession",JSON.stringify({
                    timestamp:Date.now(),
                    user:user
                }));
            }
            
            document.getElementById("loginSuccess").style.display="block";
            document.getElementById("loginError").style.display="none";
            
            setTimeout(function(){
                closeLoginModal();
                document.getElementById("adminPanel").style.display="block";
                document.getElementById("loginBtnText").textContent="ğŸš€ Acceder";
            },800);
        }else{
            loginAttempts++;
            if(loginAttempts>=3){
                lockoutTime=Date.now()+300000;
                showLoginError("MÃ¡ximo de intentos excedido. Intenta en 5 minutos.");
            }else{
                showLoginError("Credenciales incorrectas (Intento "+(4-loginAttempts)+")");
            }
            document.getElementById("loginPassword").value="";
            document.getElementById("loginPassword").focus();
            document.getElementById("loginBtnText").textContent="ğŸš€ Acceder";
        }
    },600);
}

function showLoginError(msg){
    document.getElementById("loginErrorText").textContent=msg;
    document.getElementById("loginError").style.display="block";
    document.getElementById("loginSuccess").style.display="none";
}

function logoutAdmin(){
    isAdminLoggedIn=false;
    localStorage.removeItem("adminSession");
    document.getElementById("adminPanel").style.display="none";
}

function showUploadForm(){document.getElementById("uploadForm").style.display="block";document.getElementById("categoryForm").style.display="none"}
function hideUploadForm(){document.getElementById("uploadForm").style.display="none"}
function showCategoryForm(){document.getElementById("categoryForm").style.display="block";document.getElementById("uploadForm").style.display="none"}
function hideCategoryForm(){document.getElementById("categoryForm").style.display="none"}
var uploadInProgress=false;
function uploadFile(){
    if(uploadInProgress)return;
    var file=document.getElementById("fileInput").files[0];
    var cat=document.getElementById("fileCategory").value;
    
    if(!file){
        showUploadError("Selecciona un archivo");
        return;
    }
    if(!cat){
        showUploadError("Selecciona una categorÃ­a");
        return;
    }
    
    var validTypes=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","image/jpeg","image/png"];
    if(!validTypes.includes(file.type)){
        showUploadError("Tipo de archivo no permitido. Usa: PDF, DOCX, XLS, PPTX, TXT, JPG, PNG");
        return;
    }
    
    if(file.size>52428800){
        showUploadError("El archivo es demasiado grande (mÃ¡ximo 50 MB)");
        return;
    }
    
    uploadInProgress=true;
    var statusDiv=document.getElementById("uploadStatus");
    statusDiv.innerHTML="ğŸ“¤ Subiendo "+file.name+" (0%)...";
    statusDiv.style.display="block";
    statusDiv.style.background="#e3f2fd";
    statusDiv.style.color="#1565c0";
    statusDiv.style.border="1px solid #90caf9";
    
    var fileName=cat+"/"+Date.now()+"_"+file.name;
    var storageRef=firebase.storage().ref(fileName);
    var uploadTask=storageRef.put(file);
    
    uploadTask.on('state_changed',
        function(snapshot){
            var progress=(snapshot.bytesTransferred/snapshot.totalBytes)*100;
            statusDiv.innerHTML="ğŸ“¤ Subiendo "+file.name+" ("+Math.round(progress)+"%)...";
        },
        function(error){
            uploadInProgress=false;
            showUploadError("Error al subir: "+error.message);
        },
        function(){
            uploadInProgress=false;
            uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL){
                saveDocumentMetadata(cat,file.name,downloadURL,file.size);
                statusDiv.innerHTML="âœ… Archivo subido correctamente: "+file.name;
                statusDiv.style.background="#e8f5e9";
                statusDiv.style.color="#2e7d32";
                statusDiv.style.border="1px solid #a5d6a7";
                document.getElementById("fileInput").value="";
                document.getElementById("fileCategory").value="";
                setTimeout(function(){statusDiv.style.display="none"},3000);
            });
        }
    );
}

function showUploadError(msg){
    var statusDiv=document.getElementById("uploadStatus");
    statusDiv.innerHTML="âŒ "+msg;
    statusDiv.style.display="block";
    statusDiv.style.background="#ffebee";
    statusDiv.style.color="#c62828";
    statusDiv.style.border="1px solid #ef9a9a";
}

function saveDocumentMetadata(category,fileName,downloadURL,fileSize){
    db.collection("documentos").add({
        categoria:category,
        nombre:fileName,
        url:downloadURL,
        tamaÃ±o:fileSize,
        uploadedAt:new Date(),
        uploadedBy:"admin"
    }).catch(function(error){
        console.error("Error guardando metadata: "+error.message);
    });
}
function addCategory(){var name=document.getElementById("catName").value;var emoji=document.getElementById("catEmoji").value;if(!name||!emoji){alert("Completa todos los campos");return}if(categories[name]){alert("Esa categorÃ­a ya existe");return}categories[name]=emoji;document.getElementById("catName").value="";document.getElementById("catEmoji").value="";var statusDiv=document.getElementById("categoryStatus");statusDiv.textContent="âœ… CategorÃ­a '"+name+"' creada correctamente";statusDiv.style.display="block";setTimeout(function(){statusDiv.style.display="none"},3000);actualizarUI()}

function switchProtocolTab(tabName,btnElement){
    var contents=document.querySelectorAll(".protocol-content");
    contents.forEach(function(content){content.style.display="none"});
    document.getElementById(tabName+"-content").style.display="block";
    
    var buttons=document.querySelectorAll(".tab-protocols");
    buttons.forEach(function(btn){btn.classList.remove("active")});
    btnElement.classList.add("active");
}

// â•â•â• PAGE NAVIGATION â•â•â•
function showPage(id){
    document.querySelectorAll(".page").forEach(function(p){p.classList.remove("active")});
    document.getElementById(id).classList.add("active");
    if(id==="pageProfessionals")initProfessionals();
}

// â•â•â• PROFESSIONALS LOGIC (all existing code) â•â•â•
var categories={"CardiologÃ­a":"â¤ï¸","DermatologÃ­a":"ğŸ©¹","Digestivo":"ğŸ«","EndocrinologÃ­a":"ğŸ§¬","GeriatrÃ­a":"ğŸ‘´","GinecologÃ­a":"ğŸ¤°","NeurologÃ­a":"ğŸ§ ","NeumologÃ­a":"ğŸ’¨","PediatrÃ­a":"ğŸ‘¶","TraumatologÃ­a":"ğŸ¦´","Protocolos MÃ©dicos":"ğŸ“‹"};
var currentCategory="CardiologÃ­a",documents={},preguntas={},notas={},isProcessing=false,profInitialized=false;
var CONFIG={provider:"groq",groqKey:"",groqModel:"qwen/qwen3-32b",qwenKey:"",qwenModel:"qwen-turbo"};
try{var s=localStorage.getItem("notebook_ai_cfg_v3");if(s)Object.assign(CONFIG,JSON.parse(s));}catch(e){}
var ENDPOINTS={groq:{url:"https://api.groq.com/openai/v1/chat/completions",getKey:function(){return CONFIG.groqKey},getModel:function(){return CONFIG.groqModel},prefix:"gsk_"},qwen:{url:"https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions",getKey:function(){return CONFIG.qwenKey},getModel:function(){return CONFIG.qwenModel},prefix:"sk-"}};
function ep(){return ENDPOINTS[CONFIG.provider]||ENDPOINTS.groq}
function isReady(){var e=ep();var k=e.getKey();return k&&k.startsWith(e.prefix)}
function updateStatus(){var el=document.getElementById("statusBadge"),b=document.getElementById("modelBadge"),i=document.getElementById("modelInfo");if(!el)return;if(isReady()){el.className="nav-status ok";el.textContent="âœ… IA Conectada";b.textContent=ep().getModel().split("/").pop();i.textContent=CONFIG.provider==="groq"?"Groq Â· Gratuito":"Qwen Â· Alibaba";}else{el.className="nav-status wait";el.textContent="âš™ï¸ Config";b.textContent="--";i.textContent="Configura API Key";}}
function cambiarProvider(){var v=document.getElementById("cfgProvider").value;document.getElementById("groqConfig").style.display=v==="groq"?"block":"none";document.getElementById("qwenConfig").style.display=v==="qwen"?"block":"none";}
async function fetchWithCorsProxy(url,options){try{var r=await fetch(url,options);return r;}catch(e){console.log("Direct failed, trying proxy...");} var proxies=["https://corsproxy.io/?url=","https://api.allorigins.win/raw?url="];for(var i=0;i<proxies.length;i++){try{return await fetch(proxies[i]+encodeURIComponent(url),options);}catch(e){}}throw new Error("No se pudo conectar.");}
async function llamarIA(up,sp){if(!isReady())return"âš ï¸ Configura API Key en âš™ï¸ Config";var e=ep();try{var r=await fetchWithCorsProxy(e.url,{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+e.getKey()},body:JSON.stringify({model:e.getModel(),messages:[{role:"system",content:sp||"Eres un asistente mÃ©dico. Responde en espaÃ±ol."},{role:"user",content:up}],temperature:.7,max_tokens:2048})});if(!r.ok){var err=await r.json().catch(function(){return{}});if(r.status===401)return"âŒ API Key invÃ¡lida";if(r.status===429)return"â³ LÃ­mite. Espera.";return"âŒ Error "+r.status+": "+(err.error&&err.error.message?err.error.message:"");}var d=await r.json();var c=(d.choices&&d.choices[0]&&d.choices[0].message)?d.choices[0].message.content:"Sin respuesta";return c.replace(/<think>[\s\S]*?<\/think>/g,"").trim()||"Sin respuesta";}catch(e){return"âŒ "+e.message}}
async function hacerPregunta(){var input=document.getElementById("preguntaInput"),q=input.value.trim();if(!q||isProcessing)return;if(!isReady()){switchTab("config",document.querySelectorAll(".tab-btn")[4]);return;}isProcessing=true;document.getElementById("btnPreguntar").disabled=true;if(!preguntas[currentCategory])preguntas[currentCategory]=[];var idx=preguntas[currentCategory].length;preguntas[currentCategory].push({pregunta:q,respuesta:"â³ Consultando...",fecha:new Date().toLocaleString("es-ES")});input.value="";actualizarUI();var docs=documents[currentCategory]||[];var dc=docs.map(function(d){return"- "+d.name}).join("\n");var sys="Eres un asistente mÃ©dico especializado en "+currentCategory+". Responde en espaÃ±ol."+(dc?"\nDocs:\n"+dc:"");var r=await llamarIA(q,sys);preguntas[currentCategory][idx].respuesta=r;guardarDatos();actualizarUI();isProcessing=false;document.getElementById("btnPreguntar").disabled=false;}
var studioPrompts={resumen:{title:"ğŸ“‹ Resumen â€” ",prompt:"Resumen ejecutivo sobre {cat}: patologÃ­as, diagnÃ³sticos, tratamientos."},faq:{title:"â“ FAQ â€” ",prompt:"8 preguntas frecuentes sobre {cat} con respuestas."},guia:{title:"ğŸ“– GuÃ­a â€” ",prompt:"GuÃ­a de estudio {cat}: conceptos, clasificaciones, fÃ¡rmacos, dosis."},diagnostico:{title:"ğŸ©º Dx â€” ",prompt:"DiagnÃ³stico diferencial de {cat}: sÃ­ntomas, pruebas, red flags."},farmacologia:{title:"ğŸ’Š Farma â€” ",prompt:"FarmacologÃ­a {cat}: grupos, mecanismo, dosis, efectos adversos."},emergencia:{title:"ğŸš¨ Urgencia â€” ",prompt:"Protocolos emergencia {cat}: reconocimiento, tratamiento, dosis."}};
var lastSC="",lastST="";
async function studioAction(t){if(!isReady()||isProcessing)return;var c=studioPrompts[t];if(!c)return;isProcessing=true;document.querySelectorAll(".studio-card").forEach(function(x){x.disabled=true});var rd=document.getElementById("studioResult"),cd=document.getElementById("studioResultContent");lastST=c.title+currentCategory;document.getElementById("studioResultTitle").textContent=lastST;cd.textContent="â³ Generando...";rd.style.display="block";lastSC=await llamarIA(c.prompt.replace(/\{cat\}/g,currentCategory),"Experto mÃ©dico. Responde en espaÃ±ol.");cd.textContent=lastSC;isProcessing=false;document.querySelectorAll(".studio-card").forEach(function(x){x.disabled=false});}
function guardarStudioComoNota(){if(!lastSC)return;if(!notas[currentCategory])notas[currentCategory]=[];notas[currentCategory].push({texto:lastST+"\n\n"+lastSC,fecha:new Date().toLocaleString("es-ES")});guardarDatos();actualizarUI();alert("âœ… Guardado")}
function agregarNota(){var t=document.getElementById("noteInput").value.trim();if(!t)return;if(!notas[currentCategory])notas[currentCategory]=[];notas[currentCategory].push({texto:t,fecha:new Date().toLocaleString("es-ES")});document.getElementById("noteInput").value="";guardarDatos();actualizarUI();}
function eliminarNota(i){if(!confirm("Â¿Eliminar?"))return;notas[currentCategory].splice(i,1);guardarDatos();actualizarUI();}
function switchTab(n,b){document.querySelectorAll(".tab-content").forEach(function(t){t.classList.remove("active")});document.querySelectorAll(".tab-btn").forEach(function(x){x.classList.remove("active")});document.getElementById(n).classList.add("active");if(b)b.classList.add("active");}
function cambiarCategoria(c,b){currentCategory=c;document.querySelectorAll(".category-btn").forEach(function(x){x.classList.remove("active")});if(b)b.classList.add("active");document.getElementById("categoryTitle").textContent=c;var sc=document.getElementById("studioCategory");if(sc)sc.textContent=c;switchTab("preguntas",document.querySelector(".tab-btn"));actualizarUI();}
function esc(t){if(!t)return"";return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}
function actualizarUI(){var docs=documents[currentCategory]||[];document.getElementById("documentosList").innerHTML=docs.length===0?'<div class="empty-state"><div class="empty-state-icon">ğŸ“„</div><p>No hay documentos</p></div>':docs.map(function(d){return'<div class="doc-item"><div><div class="doc-name">'+d.name+'</div><div class="doc-size">'+d.size_mb+' MB Â· '+d.type+'</div></div><a href="'+d.url+'" target="_blank" class="doc-btn">Abrir</a></div>'}).join("");document.getElementById("docsCount").textContent=docs.length;document.getElementById("preguntasCount").textContent=(preguntas[currentCategory]||[]).length;document.getElementById("notasCount").textContent=(notas[currentCategory]||[]).length;var pa=preguntas[currentCategory]||[],pl=document.getElementById("preguntasList");pl.innerHTML=pa.length===0?'<div class="empty-state"><div class="empty-state-icon">ğŸ©º</div><p>Haz tu primera pregunta</p></div>':pa.map(function(p){return'<div class="question-box"><div class="question-text">'+esc(p.pregunta)+'</div><div class="answer-text">'+esc(p.respuesta)+'</div><div class="note-time">'+p.fecha+'</div></div>'}).join("");var na=notas[currentCategory]||[],nl=document.getElementById("notasList");nl.innerHTML=na.length===0?'<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><p>Sin notas</p></div>':na.map(function(n,i){return'<div class="question-box" style="border-left-color:var(--accent)"><div style="font-size:.92rem;white-space:pre-wrap;padding-right:30px;font-weight:300;line-height:1.6">'+esc(n.texto)+'</div><div class="note-time">'+n.fecha+'</div><button onclick="eliminarNota('+i+')" style="position:absolute;top:12px;right:12px;background:none;border:none;cursor:pointer;opacity:.35">ğŸ—‘ï¸</button></div>'}).join("");}
function guardarConfig(){CONFIG.provider=document.getElementById("cfgProvider").value;CONFIG.groqKey=document.getElementById("cfgGroqKey").value.trim();CONFIG.groqModel=document.getElementById("cfgGroqModel").value;CONFIG.qwenKey=document.getElementById("cfgQwenKey").value.trim();CONFIG.qwenModel=document.getElementById("cfgQwenModel").value;localStorage.setItem("notebook_ai_cfg_v3",JSON.stringify(CONFIG));updateStatus();document.getElementById("cfgStatus").innerHTML='<span style="color:var(--primary)">âœ… Guardado</span>';}
async function testApiKey(){guardarConfig();if(!isReady()){document.getElementById("cfgStatus").innerHTML='<span style="color:#dc2626">âŒ Key invÃ¡lida</span>';return;}var st=document.getElementById("cfgStatus");st.innerHTML='<span style="color:var(--accent)">â³ Probando...</span>';var e=ep();try{var r=await fetchWithCorsProxy(e.url,{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+e.getKey()},body:JSON.stringify({model:e.getModel(),messages:[{role:"user",content:"Di: OK"}],max_tokens:10})});if(r.ok)st.innerHTML='<span style="color:var(--primary)">âœ… Â¡ConexiÃ³n exitosa!</span>';else if(r.status===401)st.innerHTML='<span style="color:#dc2626">âŒ Key invÃ¡lida</span>';else{var err=await r.json().catch(function(){return{}});st.innerHTML='<span style="color:#dc2626">âŒ Error '+r.status+"</span>";}}catch(err){st.innerHTML='<span style="color:#dc2626">âŒ '+err.message+"</span>";}}
function guardarDatos(){localStorage.setItem("cartagena_preguntas",JSON.stringify(preguntas));localStorage.setItem("cartagena_notas",JSON.stringify(notas));}
function cargarDatos(){try{preguntas=JSON.parse(localStorage.getItem("cartagena_preguntas"))||{};}catch(e){preguntas={};}try{notas=JSON.parse(localStorage.getItem("cartagena_notas"))||{};}catch(e){notas={};}}

function initProfessionals(){
    if(profInitialized)return;profInitialized=true;
    var p=new URLSearchParams(window.location.search),c=p.get("category");if(c&&categories[c])currentCategory=c;
    var list=document.getElementById("categoriesList");
    Object.keys(categories).forEach(function(cat){var btn=document.createElement("button");btn.className="category-btn"+(cat===currentCategory?" active":"");btn.innerHTML='<span class="cat-emoji">'+categories[cat]+'</span>'+cat;btn.onclick=function(){cambiarCategoria(cat,btn)};list.appendChild(btn);});
    document.getElementById("categoryTitle").textContent=currentCategory;
    document.getElementById("cfgProvider").value=CONFIG.provider;cambiarProvider();
    document.getElementById("cfgGroqKey").value=CONFIG.groqKey||"";document.getElementById("cfgGroqModel").value=CONFIG.groqModel;
    document.getElementById("cfgQwenKey").value=CONFIG.qwenKey||"";document.getElementById("cfgQwenModel").value=CONFIG.qwenModel;
    cargarDatos();updateStatus();actualizarUI();
    fetch("documents.json").then(function(r){return r.json()}).then(function(d){documents=d.categories;actualizarUI();}).catch(function(){});
    document.getElementById("preguntaInput").addEventListener("keypress",function(e){if(e.key==="Enter")hacerPregunta()});
    if(!isReady())setTimeout(function(){switchTab("config",document.querySelectorAll(".tab-btn")[4])},500);
}

// â•â•â• FIREBASE INITIALIZATION â•â•â•
const firebaseConfig={
    apiKey:"AIzaSyAvdYi6BVdltgeFH4KLHD_5iFZrSRgoykc",
    authDomain:"docenciacartagenaeste.firebaseapp.com",
    projectId:"docenciacartagenaeste",
    storageBucket:"docenciacartagenaeste.firebasestorage.app",
    messagingSenderId:"1056320755107",
    appId:"1:1056320755107:web:126637bf63c13bbb297616"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

// â•â•â• INIT â•â•â•
document.addEventListener("DOMContentLoaded",function(){
    initLoginSession();
    renderPatients();
    var p=new URLSearchParams(window.location.search);
    if(p.get("view")==="professionals"||p.get("category"))showPage("pageProfessionals");
    else if(p.get("view")==="patients")showPage("pagePatients");
    
    // Enter key en login
    document.getElementById("loginPassword").addEventListener("keypress",function(e){
        if(e.key==="Enter")loginAdmin();
    });
    document.getElementById("loginUsername").addEventListener("keypress",function(e){
        if(e.key==="Enter")document.getElementById("loginPassword").focus();
    });
});
</script>
</body>
</html>
