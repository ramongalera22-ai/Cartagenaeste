<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="expires" content="0">
    <title>Area II Cartagena</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Source+Sans+3:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK (compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    <style>
        :root{--primary:#1a6b4a;--primary-light:#238c62;--primary-dark:#0f4a33;--accent:#d4a853;--accent-light:#f0d68a;--bg-dark:#1a1f2e;--bg-card:#fff;--bg-main:#f4f6f8;--bg-subtle:#e9edf2;--text:#2d3748;--text-light:#64748b;--text-muted:#94a3b8;--border:#e2e8f0;--border-light:#f1f5f9;--shadow-sm:0 1px 3px rgba(0,0,0,.06);--shadow-md:0 4px 12px rgba(0,0,0,.08);--shadow-lg:0 8px 30px rgba(0,0,0,.15);--radius:12px;--radius-sm:8px;--font-display:'Playfair Display',Georgia,serif;--font-body:'Source Sans 3',-apple-system,sans-serif}
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:var(--font-body);background:var(--bg-main);color:var(--text)}

        /* â•â•â• LANDING PAGE â•â•â• */
        .landing{min-height:100vh;display:flex;flex-direction:column}
        .landing-nav{background:var(--bg-dark);padding:0 40px;height:60px;display:flex;align-items:center;justify-content:space-between;z-index:10}
        .landing-nav .brand{display:flex;align-items:center;gap:12px;color:#fff}
        .landing-nav .brand .logo{width:36px;height:36px;background:linear-gradient(135deg,var(--primary),var(--primary-light));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
        .landing-nav .brand h1{font-family:var(--font-display);font-size:1.15rem;font-weight:600}
        .landing-nav .brand h1 span{color:var(--accent)}
        .landing-nav .nav-links{display:flex;gap:8px}
        .landing-nav .nav-links a{color:rgba(255,255,255,.7);text-decoration:none;font-size:.85rem;font-weight:500;padding:8px 16px;border-radius:6px;transition:.2s}
        .landing-nav .nav-links a:hover{color:#fff;background:rgba(255,255,255,.08)}
        .hero{flex:1;position:relative;display:flex;align-items:center;justify-content:center;min-height:calc(100vh - 60px);overflow:hidden}
        .hero-bg{position:absolute;inset:0;background:url('https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?w=1600&q=80') center/cover;filter:brightness(.35)}
        .hero-overlay{position:absolute;inset:0;background:linear-gradient(135deg,rgba(26,31,46,.85),rgba(15,74,51,.7))}
        .hero-content{position:relative;z-index:2;text-align:center;max-width:800px;padding:40px 20px}
        .hero-badge{display:inline-block;background:rgba(212,168,83,.15);border:1px solid rgba(212,168,83,.3);color:var(--accent-light);padding:6px 20px;border-radius:30px;font-size:.82rem;font-weight:600;letter-spacing:.05em;margin-bottom:24px;text-transform:uppercase}
        .hero-content h2{font-family:var(--font-display);font-size:3.2rem;font-weight:800;color:#fff;line-height:1.15;margin-bottom:16px;letter-spacing:-.02em}
        .hero-content p{font-size:1.15rem;color:rgba(255,255,255,.75);line-height:1.6;margin-bottom:40px;font-weight:300;max-width:600px;margin-left:auto;margin-right:auto}
        .hero-buttons{display:flex;gap:20px;justify-content:center;flex-wrap:wrap}
        .hero-btn{display:flex;align-items:center;gap:12px;padding:20px 40px;border-radius:var(--radius);font-family:var(--font-body);font-size:1.05rem;font-weight:600;cursor:pointer;transition:all .3s;border:2px solid transparent;text-decoration:none;min-width:240px;justify-content:center}
        .hero-btn-patients{background:#fff;color:var(--primary-dark)}
        .hero-btn-patients:hover{transform:translateY(-3px);box-shadow:0 12px 40px rgba(255,255,255,.2)}
        .hero-btn-professionals{background:transparent;border-color:rgba(255,255,255,.4);color:#fff}
        .hero-btn-professionals:hover{background:rgba(255,255,255,.1);border-color:#fff;transform:translateY(-3px)}
        .hero-btn-icon{font-size:1.4rem}
        .hero-footer{position:absolute;bottom:20px;left:0;right:0;text-align:center;z-index:2;color:rgba(255,255,255,.4);font-size:.78rem}
        .hero-footer a{color:rgba(255,255,255,.5);text-decoration:none}

        /* â•â•â• PAGE VIEWS â•â•â• */
        .page{display:none;min-height:100vh}
        .page.active{display:flex;flex-direction:column}
        .page-back{display:inline-flex;align-items:center;gap:6px;color:rgba(255,255,255,.7);text-decoration:none;font-size:.88rem;font-weight:500;padding:8px 16px;border-radius:6px;transition:.2s;cursor:pointer;border:none;background:none;font-family:var(--font-body)}
        .page-back:hover{color:#fff;background:rgba(255,255,255,.08)}

        /* â•â•â• PATIENTS DASHBOARD â•â•â• */
        .patients-header{background:linear-gradient(135deg,var(--bg-dark),#243347);padding:30px 40px 20px;color:#fff}
        .patients-header h2{font-family:var(--font-display);font-size:1.8rem;margin-bottom:6px}
        .patients-header p{font-size:.9rem;opacity:.7;font-weight:300}
        .patients-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;padding:30px 40px;max-width:1200px;margin:0 auto}
        .patient-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:22px;cursor:pointer;transition:all .25s;position:relative;overflow:hidden;text-decoration:none;color:var(--text)}
        .patient-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--primary),var(--accent));transform:scaleX(0);transform-origin:left;transition:transform .3s}
        .patient-card:hover::before{transform:scaleX(1)}
        .patient-card:hover{border-color:var(--primary-light);box-shadow:var(--shadow-md);transform:translateY(-2px)}
        .patient-card-icon{font-size:2rem;margin-bottom:12px}
        .patient-card-title{font-family:var(--font-display);font-weight:600;font-size:1.05rem;color:var(--primary-dark);margin-bottom:4px}
        .patient-card-desc{font-size:.82rem;color:var(--text-muted);font-weight:300}

        /* â•â•â• PROFESSIONALS (existing dashboard) â•â•â• */
        .prof-layout{display:grid;grid-template-columns:280px 1fr 300px;flex:1;overflow:hidden}
        .prof-layout .top-nav{display:none}
        .sidebar-left{background:var(--bg-card);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
        .sidebar-hero{padding:24px 22px 20px;background:linear-gradient(135deg,var(--bg-dark),#243347);color:#fff;position:relative;overflow:hidden}
        .sidebar-hero::before{content:'';position:absolute;top:-30px;right:-30px;width:100px;height:100px;background:var(--primary);opacity:.15;border-radius:50%}
        .sidebar-hero h2{font-family:var(--font-display);font-size:1.15rem;font-weight:600;margin-bottom:4px}
        .sidebar-hero p{font-size:.78rem;opacity:.7;font-weight:300}
        .categories-list{flex:1;overflow-y:auto;padding:8px 0}
        .category-btn{display:flex;align-items:center;gap:10px;width:100%;padding:12px 22px;text-align:left;border:none;background:0 0;cursor:pointer;font-size:.88rem;color:var(--text);font-family:var(--font-body);transition:.2s;border-left:3px solid transparent}
        .category-btn:hover{background:var(--border-light);border-left-color:var(--primary-light)}
        .category-btn.active{background:linear-gradient(90deg,rgba(26,107,74,.06),transparent);border-left-color:var(--primary);color:var(--primary);font-weight:600}
        .cat-emoji{font-size:1.05rem;width:24px;text-align:center}
        .main-content{display:flex;flex-direction:column;background:var(--bg-main);overflow:hidden}
        .content-header{padding:20px 28px;background:var(--bg-card);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .content-header h3{font-family:var(--font-display);font-size:1.5rem;font-weight:700;color:var(--primary-dark)}
        .content-area{flex:1;overflow-y:auto;padding:24px 28px}
        .tab-buttons{display:flex;gap:2px;margin-bottom:24px;background:var(--bg-card);border-radius:var(--radius);padding:4px;box-shadow:var(--shadow-sm);border:1px solid var(--border)}
        .tab-btn{flex:1;padding:10px 12px;border:none;background:0 0;cursor:pointer;color:var(--text-light);font-weight:500;font-size:.84rem;border-radius:var(--radius-sm);transition:.2s;font-family:var(--font-body);white-space:nowrap}
        .tab-btn.active{background:var(--primary);color:#fff;box-shadow:0 2px 8px rgba(26,107,74,.25)}
        .tab-btn:hover:not(.active){background:var(--bg-subtle);color:var(--text)}
        .tab-content{display:none}.tab-content.active{display:block;animation:fadeUp .3s ease}
        @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        @keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
        .question-input{display:flex;gap:10px;margin-bottom:20px}
        .question-input input{flex:1;padding:13px 18px;border:2px solid var(--border);border-radius:var(--radius);font-size:.92rem;font-family:var(--font-body);background:var(--bg-card);transition:.2s}
        .question-input input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(26,107,74,.1)}
        .btn{padding:11px 22px;border:none;border-radius:var(--radius-sm);cursor:pointer;font-weight:600;font-size:.88rem;transition:.2s;font-family:var(--font-body)}
        .btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff}
        .btn-primary:hover:not(:disabled){box-shadow:0 4px 16px rgba(26,107,74,.35);transform:translateY(-1px)}
        .btn-primary:disabled{opacity:.5;cursor:not-allowed;transform:none}
        .btn-secondary{background:var(--bg-subtle);color:var(--text)}.btn-secondary:hover{background:var(--border)}
        .btn-small{padding:8px 16px;font-size:.82rem}
        .question-box{background:var(--bg-card);padding:18px 20px;border-radius:var(--radius);margin-bottom:14px;border-left:4px solid var(--primary);box-shadow:var(--shadow-sm);animation:fadeUp .3s;transition:box-shadow .2s;position:relative}
        .question-box:hover{box-shadow:var(--shadow-md)}
        .question-text{font-family:var(--font-display);color:var(--primary-dark);font-weight:600;margin-bottom:10px;font-size:1rem}
        .answer-text{color:var(--text);line-height:1.7;font-size:.92rem;white-space:pre-wrap;word-wrap:break-word;font-weight:300}
        .note-time{font-size:.76rem;color:var(--text-muted);margin-top:10px;font-weight:500}
        .doc-item{background:var(--bg-card);padding:14px 18px;border-radius:var(--radius-sm);margin-bottom:8px;border:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;transition:.2s}
        .doc-item:hover{border-color:var(--primary-light);box-shadow:var(--shadow-sm)}
        .doc-name{font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:2px}.doc-size{font-size:.78rem;color:var(--text-muted)}
        .doc-btn{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;padding:7px 16px;border:none;border-radius:6px;cursor:pointer;font-size:.82rem;text-decoration:none;font-weight:600;transition:.2s}
        .empty-state{text-align:center;padding:48px 24px;color:var(--text-muted)}.empty-state-icon{font-size:2.8rem;margin-bottom:12px;opacity:.6}.empty-state p{font-size:.92rem;font-weight:300}
        .studio-intro{background:linear-gradient(135deg,var(--bg-dark),#243347);border-radius:var(--radius);padding:22px 24px;margin-bottom:20px;color:#fff;position:relative;overflow:hidden}
        .studio-intro::after{content:'âœ¨';position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:2.5rem;opacity:.15}
        .studio-intro h4{font-family:var(--font-display);font-size:1.15rem;margin-bottom:6px}
        .studio-intro p{font-size:.86rem;opacity:.8;font-weight:300}
        .studio-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
        .studio-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:18px;cursor:pointer;transition:.25s;text-align:left;font-family:var(--font-body);position:relative;overflow:hidden}
        .studio-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--primary),var(--accent));transform:scaleX(0);transform-origin:left;transition:transform .3s}
        .studio-card:hover:not(:disabled)::before{transform:scaleX(1)}
        .studio-card:hover:not(:disabled){border-color:var(--primary-light);box-shadow:var(--shadow-md);transform:translateY(-2px)}
        .studio-card:disabled{opacity:.4;cursor:not-allowed}
        .studio-card-icon{font-size:1.5rem;margin-bottom:8px}.studio-card-title{font-weight:600;font-size:.9rem;color:var(--text)}.studio-card-desc{font-size:.78rem;color:var(--text-muted);font-weight:300}
        .config-box{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:22px;margin-bottom:16px}
        .config-box h4{font-family:var(--font-display);color:var(--primary-dark);margin-bottom:12px;font-size:1rem}
        .config-row{display:flex;gap:8px;margin-bottom:10px;align-items:center}
        .config-row input,.config-row select{flex:1;padding:10px 14px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:.86rem;font-family:var(--font-body);background:var(--bg-main)}
        .config-row input:focus,.config-row select:focus{outline:none;border-color:var(--primary)}
        .config-hint{font-size:.8rem;color:var(--text-light);margin-top:4px;line-height:1.6}
        .config-hint a{color:var(--primary);font-weight:600}
        .sidebar-right{background:var(--bg-card);border-left:1px solid var(--border);padding:24px 20px;overflow-y:auto}
        .sidebar-section-title{font-family:var(--font-display);font-weight:600;margin:0 0 14px;color:var(--primary-dark);font-size:1rem}
        .stat-card{background:var(--bg-main);padding:14px 16px;border-radius:var(--radius-sm);margin-bottom:8px;border:1px solid var(--border-light)}
        .stat-label{font-size:.76rem;color:var(--text-muted);margin-bottom:4px;text-transform:uppercase;letter-spacing:.05em;font-weight:600}
        .stat-value{font-family:var(--font-display);font-size:1.6rem;font-weight:700;color:var(--primary)}
        .model-badge{display:inline-block;background:linear-gradient(135deg,rgba(26,107,74,.08),rgba(26,107,74,.04));color:var(--primary);padding:4px 12px;border-radius:20px;font-size:.76rem;font-weight:600;font-family:Consolas,monospace;border:1px solid rgba(26,107,74,.15)}
        .info-box{background:linear-gradient(135deg,var(--bg-dark),#243347);padding:18px;border-radius:var(--radius);font-size:.84rem;line-height:1.6;color:rgba(255,255,255,.85)}
        .info-box strong{color:#fff}
        .sidebar-footer{padding:14px 22px;border-top:1px solid var(--border);font-size:.72rem;color:var(--text-muted);text-align:center}
        .sidebar-footer a{color:var(--primary);text-decoration:none}
        .nav-status{padding:5px 14px;border-radius:20px;font-size:.78rem;font-weight:600}
        .nav-status.ok{background:rgba(34,197,94,.15);color:#4ade80}.nav-status.wait{background:rgba(234,179,8,.15);color:#fbbf24}
        .scrollbar::-webkit-scrollbar{width:6px}.scrollbar::-webkit-scrollbar-track{background:0 0}.scrollbar::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
        @media(max-width:1024px){.prof-layout{grid-template-columns:1fr}.sidebar-left,.sidebar-right{display:none}.landing-nav .nav-links{display:none}.hero-content h2{font-size:2rem}.hero-buttons{flex-direction:column;align-items:center}.patients-grid{padding:20px}}
        .scan-mode-btn.active,.scan-mode-btn[style*="border-color: rgb(0, 102, 204)"]{border-color:#0066cc!important;background:linear-gradient(135deg,#0066cc,#004499)!important;color:#fff!important;}
    </style>
</head>
<body>

<!-- â•â•â•â•â•â•â• LANDING PAGE â•â•â•â•â•â•â• -->
<div class="page active" id="pageLanding">
    <div class="landing">
        <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" id="loginBtnLanding" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button></div></nav>
        <div class="hero">
            <div class="hero-bg"></div>
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <div class="hero-badge">Centro de Salud Virgen de la Caridad</div>
                <h2>Tu salud, nuestra prioridad</h2>
                <p>Salud y formaciÃ³n para tu comunidad. Accede a recursos para pacientes o herramientas de docencia clÃ­nica para profesionales.</p>
                <div class="hero-buttons">
                    <a class="hero-btn hero-btn-patients" onclick="showPage('pagePatients')"><span class="hero-btn-icon">ğŸ‘¤</span> Pacientes</a>
                    <a class="hero-btn hero-btn-professionals" onclick="showPage('pageProfessionals')"><span class="hero-btn-icon">ğŸ©º</span> Profesionales</a>
                </div>
                <div class="hero-buttons" style="margin-top:20px;">
                    <a class="hero-btn hero-btn-patients" onclick="showPage('pageProtocolosAP')" style="background:#fff;color:var(--primary-dark);"><span class="hero-btn-icon">ğŸ“‹</span> Protocolos Atencion Primaria</a>
                    <a class="hero-btn hero-btn-professionals" onclick="showPage('pageProtocolosUrgencias')" style="background:transparent;border-color:rgba(255,255,255,.4);color:#fff;"><span class="hero-btn-icon">ğŸš¨</span> Protocolos Urgencias</a>
                </div>
                <div class="hero-buttons" style="margin-top:20px;">
                    <a class="hero-btn" href="javascript:void(0)" onclick="showScanLogin()" style="background:linear-gradient(135deg,#0066cc,#004499);color:#fff;border:2px solid rgba(255,255,255,.3);cursor:pointer;"><span class="hero-btn-icon">ğŸ› ï¸</span> Herramientas</a>
                    <a class="hero-btn" href="javascript:void(0)" onclick="showPage('pageTelefonos')" style="background:linear-gradient(135deg,#d4a853,#b8912e);color:#fff;border:2px solid rgba(255,255,255,.3);cursor:pointer;"><span class="hero-btn-icon">ğŸ“</span> TelÃ©fonos Buscas</a>
                </div>
            </div>
            <div class="hero-footer">Â© 2026 <a href="https://cartagenaeste.es" target="_blank">cartagenaeste.es</a> Â· Creado con â¤ï¸</div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• PATIENTS PAGE â•â•â•â•â•â•â• -->
<div class="page" id="pagePatients">
    <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" onclick="showPage('pageLanding')">â† Inicio</button><button class="page-back" id="loginBtnPatients" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button></div></nav>
    <div class="patients-header"><h2>ğŸ‘¤ Pacientes</h2><p>Recursos e informaciÃ³n para pacientes del Area II Cartagena</p></div>
    <div class="patients-grid" id="patientsGrid"></div>
</div>

<!-- â•â•â•â•â•â•â• PROFESSIONALS PAGE â•â•â•â•â•â•â• -->
<div class="page" id="pageProfessionals">
    <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" onclick="showPage('pageLanding')">â† Inicio</button><button class="page-back" id="loginBtnProf" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button><span id="statusBadge" class="nav-status wait">âš™ï¸ Config</span></div></nav>
    <div class="prof-layout">
        <div class="sidebar-left"><div class="sidebar-hero"><h2>Especialidades</h2><p>Cuaderno AI Â· Docencia ClÃ­nica</p></div><div class="categories-list scrollbar" id="categoriesList"></div><div class="sidebar-footer">Â© 2026 <a href="https://cartagenaeste.es" target="_blank">cartagenaeste.es</a></div></div>
        <div class="main-content"><div class="content-header"><h3 id="categoryTitle">CardiologÃ­a</h3></div>
            <div class="content-area scrollbar">
                <div class="tab-buttons"><button class="tab-btn active" onclick="switchTab('preguntas',this)">ğŸ¤– Preguntas IA</button><button class="tab-btn" onclick="switchTab('documentos',this)">ğŸ“š Documentos</button><button class="tab-btn" onclick="switchTab('notas',this)">ğŸ“ Notas</button><button class="tab-btn" onclick="switchTab('guardiaPacientes',this)">ğŸ›ï¸ Pacientes</button><button class="tab-btn" onclick="switchTab('studio',this)">âœ¨ Studio</button><button class="tab-btn" onclick="switchTab('recursos',this)">ğŸ“‹ Recursos</button><button class="tab-btn" onclick="switchTab('config',this)">âš™ï¸ Config</button></div>
                <div id="preguntas" class="tab-content active"><div class="question-input"><input type="text" id="preguntaInput" placeholder="Haz una pregunta clÃ­nica..." spellcheck="false"><button class="btn btn-primary" onclick="hacerPregunta()" id="btnPreguntar">Preguntar</button></div><div id="preguntasList"><div class="empty-state"><div class="empty-state-icon">ğŸ©º</div><p>Haz tu primera pregunta clÃ­nica</p></div></div></div>
                <div id="documentos" class="tab-content"><div id="documentosList" style="margin-top:8px"></div></div>
                <div id="notas" class="tab-content"><div style="margin-bottom:20px"><textarea id="noteInput" placeholder="Escribe tus notas clÃ­nicas..." style="width:100%;padding:14px;border:2px solid var(--border);border-radius:var(--radius);min-height:90px;font-family:var(--font-body);resize:vertical;font-size:.92rem;background:var(--bg-card)"></textarea><div style="margin-top:10px;display:flex;gap:10px"><button class="btn btn-primary btn-small" onclick="agregarNota()">âœ“ Guardar</button><button class="btn btn-secondary btn-small" onclick="document.getElementById('noteInput').value=''">Limpiar</button></div></div><div id="notasList"></div></div>
                <div id="guardiaPacientes" class="tab-content">
                    <div style="background:#fff3cd;border:1px solid #ffc107;border-radius:var(--radius);padding:14px 18px;font-size:.84rem;color:#856404;margin-bottom:20px;line-height:1.6;">
                        ğŸ”’ <strong>Datos anonimizados.</strong> No incluyas nombre, DNI, NHC ni datos identificativos. Usa solo iniciales o nÃºmero de cama. Los datos se guardan localmente en tu dispositivo y se borran al limpiar el navegador.
                    </div>
                    <div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:20px;">
                        <h4 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:14px;">â• Nuevo paciente de guardia</h4>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
                            <input type="text" id="gpCama" placeholder="Cama / UbicaciÃ³n (ej: C12, Box3)" style="padding:10px;border:2px solid var(--border);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;">
                            <input type="text" id="gpId" placeholder="ID anÃ³nimo (ej: JM, Pac.3)" style="padding:10px;border:2px solid var(--border);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;">
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
                            <input type="text" id="gpEdad" placeholder="Edad / Sexo (ej: 72M, 45F)" style="padding:10px;border:2px solid var(--border);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;">
                            <select id="gpPrioridad" style="padding:10px;border:2px solid var(--border);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;">
                                <option value="normal">ğŸŸ¢ Normal</option>
                                <option value="atento">ğŸŸ¡ Atento</option>
                                <option value="urgente">ğŸ”´ Urgente</option>
                            </select>
                        </div>
                        <input type="text" id="gpMotivo" placeholder="Motivo ingreso / consulta" style="width:100%;padding:10px;border:2px solid var(--border);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;margin-bottom:10px;">
                        <textarea id="gpNotas" placeholder="Notas / pendientes / recordatorios de guardia..." style="width:100%;padding:10px;border:2px solid var(--border);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;min-height:70px;resize:vertical;margin-bottom:10px;"></textarea>
                        <div style="display:flex;gap:10px;">
                            <button class="btn btn-primary btn-small" onclick="gpAdd()">ğŸ›ï¸ AÃ±adir paciente</button>
                            <button class="btn btn-secondary btn-small" onclick="gpClearForm()">Limpiar</button>
                        </div>
                    </div>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
                        <h4 style="font-family:var(--font-display);color:var(--primary-dark);">ğŸ›ï¸ Lista de pacientes en guardia</h4>
                        <div style="display:flex;gap:8px;">
                            <button onclick="gpExport()" style="padding:6px 12px;background:var(--bg-subtle);border:1px solid var(--border);border-radius:var(--radius-sm);cursor:pointer;font-size:.8rem;font-family:var(--font-body);font-weight:600;">ğŸ“‹ Copiar</button>
                            <button onclick="if(confirm('Â¿Borrar todos los pacientes de guardia?'))gpClearAll()" style="padding:6px 12px;background:#fef2f2;border:1px solid #fca5a5;border-radius:var(--radius-sm);cursor:pointer;font-size:.8rem;font-family:var(--font-body);font-weight:600;color:#dc2626;">ğŸ—‘ï¸ Borrar todo</button>
                        </div>
                    </div>
                    <div id="gpList"><div style="text-align:center;padding:30px;color:var(--text-muted);"><div style="font-size:2rem;margin-bottom:8px;opacity:.4;">ğŸ›ï¸</div><p style="font-size:.9rem;">No hay pacientes registrados en esta guardia</p></div></div>
                </div>
                <div id="studio" class="tab-content"><div class="studio-intro"><h4>AI Studio Â· Generador ClÃ­nico</h4><p>Genera contenido mÃ©dico sobre <strong id="studioCategory">CardiologÃ­a</strong> con IA.</p></div><div class="studio-grid"><button class="studio-card" onclick="studioAction('resumen')"><div class="studio-card-icon">ğŸ“‹</div><div class="studio-card-title">Resumen ejecutivo</div><div class="studio-card-desc">Puntos clave</div></button><button class="studio-card" onclick="studioAction('faq')"><div class="studio-card-icon">â“</div><div class="studio-card-title">FAQ ClÃ­nico</div><div class="studio-card-desc">Preguntas frecuentes</div></button><button class="studio-card" onclick="studioAction('guia')"><div class="studio-card-icon">ğŸ“–</div><div class="studio-card-title">GuÃ­a de estudio</div><div class="studio-card-desc">Conceptos y repaso</div></button><button class="studio-card" onclick="studioAction('diagnostico')"><div class="studio-card-icon">ğŸ©º</div><div class="studio-card-title">DiagnÃ³stico diferencial</div><div class="studio-card-desc">PatologÃ­as principales</div></button><button class="studio-card" onclick="studioAction('farmacologia')"><div class="studio-card-icon">ğŸ’Š</div><div class="studio-card-title">FarmacologÃ­a</div><div class="studio-card-desc">FÃ¡rmacos y dosis</div></button><button class="studio-card" onclick="studioAction('emergencia')"><div class="studio-card-icon">ğŸš¨</div><div class="studio-card-title">Protocolo emergencia</div><div class="studio-card-desc">ActuaciÃ³n urgente</div></button></div><div id="studioResult" style="display:none"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><h4 style="font-family:var(--font-display);color:var(--primary-dark)" id="studioResultTitle"></h4><button class="btn btn-primary btn-small" onclick="guardarStudioComoNota()">ğŸ’¾ Guardar</button></div><div id="studioResultContent" class="scrollbar" style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);padding:20px;line-height:1.7;font-size:.92rem;white-space:pre-wrap;max-height:400px;overflow-y:auto;font-weight:300"></div></div></div>
                <div id="recursos" class="tab-content"><div style="padding:16px 0;"><h3 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:20px;font-size:1.2rem">ğŸ“‹ Recursos Sociales</h3><p style="color:var(--text-light);margin-bottom:20px;font-size:.9rem">Formularios y documentos oficiales para prestaciones sociales, pensiones y servicios de dependencia.</p><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;"><a href="recursos-sociales-grado-dependencia.pdf" target="_blank" style="text-decoration:none;"><div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s;text-align:center;hover:border-color:var(--primary)"><div style="font-size:1.8rem;margin-bottom:8px">ğŸ“‹</div><div style="font-weight:600;color:var(--primary-dark);font-size:.95rem;margin-bottom:4px">Grado de Dependencia</div><div style="font-size:.78rem;color:var(--text-muted)">2.0 MB Â· PDF</div></div></a><a href="recursos-sociales-ayuda-domicilio.pdf" target="_blank" style="text-decoration:none;"><div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s;text-align:center"><div style="font-size:1.8rem;margin-bottom:8px">ğŸ </div><div style="font-weight:600;color:var(--primary-dark);font-size:.95rem;margin-bottom:4px">Ayuda a Domicilio</div><div style="font-size:.78rem;color:var(--text-muted)">825 KB Â· PDF</div></div></a><a href="recursos-sociales-servicios-domiciliarios.pdf" target="_blank" style="text-decoration:none;"><div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s;text-align:center"><div style="font-size:1.8rem;margin-bottom:8px">ğŸ‘¨â€âš•ï¸</div><div style="font-weight:600;color:var(--primary-dark);font-size:.95rem;margin-bottom:4px">Servicios Domiciliarios</div><div style="font-size:.78rem;color:var(--text-muted)">213 KB Â· PDF</div></div></a><a href="recursos-sociales-pension-jubilacion.pdf" target="_blank" style="text-decoration:none;"><div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s;text-align:center"><div style="font-size:1.8rem;margin-bottom:8px">ğŸ’°</div><div style="font-weight:600;color:var(--primary-dark);font-size:.95rem;margin-bottom:4px">PensiÃ³n JubilaciÃ³n</div><div style="font-size:.78rem;color:var(--text-muted)">1.9 MB Â· PDF</div></div></a><a href="recursos-sociales-punto-acceso.pdf" target="_blank" style="text-decoration:none;"><div style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:16px;cursor:pointer;transition:all .2s;text-align:center"><div style="font-size:1.8rem;margin-bottom:8px">ğŸ“</div><div style="font-weight:600;color:var(--primary-dark);font-size:.95rem;margin-bottom:4px">PASS</div><div style="font-size:.78rem;color:var(--text-muted)">29 KB Â· PDF</div></div></a></div><div style="margin-top:24px;background:linear-gradient(135deg,var(--bg-dark),#243347);border-radius:var(--radius);padding:18px;color:#fff;font-size:.88rem;line-height:1.6;"><strong>â˜ï¸ Contacto Servicios Sociales</strong><br>ğŸ“ C/ Sor Francisca ArmendÃ¡riz, s/n Â· Cartagena<br>ğŸ“ 900 923 491<br>â° L-V 9:00-12:30 (presencial) / 9:00-13:00 (telÃ©fono)<br><br><strong style="margin-top:10px;display:block">ğŸŒ Sedes ElectrÃ³nicas</strong><br><a href="https://www.cartagena.es" target="_blank" style="color:rgba(255,255,255,.8)">cartagena.es</a> Â· <a href="https://sede.carm.es" target="_blank" style="color:rgba(255,255,255,.8)">sede.carm.es</a></div></div></div>
                <div id="config" class="tab-content"><div class="config-box"><h4>Proveedor de IA</h4><div class="config-row"><select id="cfgProvider" onchange="cambiarProvider()"><option value="groq">Groq (recomendado Â· ultra rÃ¡pido)</option><option value="qwen">Qwen API directa (Alibaba Cloud)</option></select></div><div id="groqConfig"><p class="config-hint" style="margin-bottom:10px"><strong>Groq</strong> â€” Gratis, ultra rÃ¡pido<br>1. <a href="https://console.groq.com" target="_blank">console.groq.com</a><br>2. Crea cuenta gratis<br>3. API Keys â†’ Create<br>4. Pega key (<code>gsk_</code>)</p><div class="config-row"><input type="password" id="cfgGroqKey" placeholder="gsk_xxxxxxxxxxxx"></div><h4 style="margin-top:12px">Modelo</h4><div class="config-row"><select id="cfgGroqModel"><option value="qwen/qwen3-32b">Qwen3 32B</option><option value="llama-3.3-70b-versatile">Llama 3.3 70B</option><option value="deepseek-r1-distill-llama-70b">DeepSeek R1 70B</option><option value="gemma2-9b-it">Gemma 2 9B</option></select></div></div><div id="qwenConfig" style="display:none"><p class="config-hint" style="margin-bottom:10px"><strong>Qwen API</strong><br>1. <a href="https://www.alibabacloud.com/help/en/model-studio/get-api-key" target="_blank">Alibaba Cloud</a><br>2. Crea API Key (<code>sk-</code>)</p><div class="config-row"><input type="password" id="cfgQwenKey" placeholder="sk-xxxxxxxxxxxx"></div><h4 style="margin-top:12px">Modelo</h4><div class="config-row"><select id="cfgQwenModel"><option value="qwen-turbo">Qwen Turbo</option><option value="qwen-plus">Qwen Plus</option><option value="qwen3-32b">Qwen3 32B</option><option value="qwen-max">Qwen Max</option></select></div></div><div style="margin-top:16px;display:flex;gap:8px"><button class="btn btn-primary btn-small" onclick="guardarConfig()">ğŸ’¾ Guardar</button><button class="btn btn-secondary btn-small" onclick="testApiKey()">ğŸ§ª Probar</button></div><div id="cfgStatus" style="margin-top:12px"></div></div></div>
            </div>
        </div>
        <div class="sidebar-right scrollbar"><div class="sidebar-section-title">EstadÃ­sticas</div><div class="stat-card"><div class="stat-label">Documentos</div><div class="stat-value" id="docsCount">0</div></div><div class="stat-card"><div class="stat-label">Preguntas</div><div class="stat-value" id="preguntasCount">0</div></div><div class="stat-card"><div class="stat-label">Notas</div><div class="stat-value" id="notasCount">0</div></div><div style="margin-top:18px"><div class="sidebar-section-title">Modelo Activo</div><div class="stat-card"><span class="model-badge" id="modelBadge">--</span><div style="font-size:.78rem;color:var(--text-muted);margin-top:8px" id="modelInfo">Config</div></div></div><div class="info-box" style="margin-top:18px"><strong>ğŸ¥ Cuaderno AI</strong><br>Docencia clÃ­nica con IA para Cartagena Este.<br><br>â€¢ IA gratuita<br>â€¢ ResÃºmenes automÃ¡ticos<br>â€¢ Estudio por especialidades</div></div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• PROTOCOLOS ATENCION PRIMARIA PAGE â•â•â•â•â•â•â• -->
<div class="page" id="pageProtocolosAP">
    <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" onclick="showPage('pageLanding')">â† Inicio</button><button class="page-back" id="loginBtnAP" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button></div></nav>
    <div style="padding:40px;max-width:1200px;margin:0 auto;">
        <h2 style="font-family:var(--font-display);font-size:2rem;color:var(--text);margin-bottom:20px;">ğŸ“‹ Protocolos de Atencion Primaria</h2>
        <p style="font-size:.95rem;color:var(--text-light);margin-bottom:30px;max-width:600px;">Accede a los protocolos y guÃ­as de atenciÃ³n primaria para profesionales mÃ©dicos.</p>
        
        <div style="background:var(--bg-card);border-radius:var(--radius);padding:24px;margin-bottom:30px;">
            <div class="tab-buttons"><button class="tab-btn tab-protocols active" onclick="switchProtocolTab('generales',this)" style="cursor:pointer;">ğŸ“‹ Protocolos</button><button class="tab-btn tab-protocols" onclick="switchProtocolTab('preguntas-proto',this)" style="cursor:pointer;">ğŸ¤– Preguntas IA</button><button class="tab-btn tab-protocols" onclick="switchProtocolTab('config-protocolos',this)" style="cursor:pointer;">âš™ï¸ Config IA</button><button class="tab-btn tab-protocols" id="apAdminTabBtn" onclick="switchProtocolTab('admin-protocolos',this)" style="cursor:pointer;display:none;">ğŸ”’ Admin</button><button class="tab-btn tab-protocols" onclick="window.open('protocolos-atencion.html','_blank')" style="cursor:pointer;">ğŸ“‘ Ver Todo</button></div>
            
            <div id="generales-content" class="protocol-content" style="display:block;margin-top:20px;">
                <div id="generalesProtocols" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;">
                    <!-- Protocolo 1 -->
                    <a href="protocolos-1.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">ğŸ‘‚ ORL en AtenciÃ³n Primaria</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">5.2 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 2 -->
                    <a href="protocolos-2.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">ğŸ«˜ RiÃ±Ã³n y VÃ­as Urinarias</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">5.6 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 3 -->
                    <a href="protocolos-3.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">ğŸ©¹ DermatologÃ­a en AP</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">5.4 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 4 -->
                    <a href="protocolos-4.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">ğŸ¦´ MusculoesquelÃ©tico</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">5.7 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 5 -->
                    <a href="protocolos-5.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">ğŸ’Š Enfermedades CrÃ³nicas</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">6.4 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 6 -->
                    <a href="protocolos-6.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">ğŸ§  Salud Mental</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">5.9 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 7 -->
                    <a href="protocolos-7.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">ğŸ§  Sistema Nervioso</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">7.7 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 8 -->
                    <a href="protocolos-8.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">ğŸ«€ Problemas Digestivos (I)</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">6.4 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 9 -->
                    <a href="protocolos-9.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">ğŸ«€ Problemas Digestivos (II)</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">6.4 KB</div>
                        </div>
                    </a>
                    <!-- Protocolo 10 -->
                    <a href="protocolos-10.pdf" target="_blank" style="text-decoration:none;">
                        <div style="background:var(--bg-card);padding:16px;border-radius:8px;border:2px solid #1a6b4a;border-left:4px solid #1a6b4a;text-align:center;transition:all .2s;cursor:pointer;" onmouseover="this.style.boxShadow='0 4px 12px rgba(26,107,74,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
                            <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“„</div>
                            <div style="font-weight:600;color:var(--primary-dark);margin-bottom:2px;font-size:.9rem;">â¤ï¸ Respiratorio y Cardiovascular</div>
                            <div style="font-size:.75rem;color:var(--text-muted);">6.7 KB</div>
                        </div>
                    </a>
                </div>
            </div>
            
            <div id="config-protocolos-content" class="protocol-content" style="display:none;margin-top:20px;">
                <div class="config-box">
                    <h4>Proveedor de IA</h4>
                    <div class="config-row">
                        <select id="apCfgProvider" onchange="apCambiarProvider()">
                            <option value="groq">Groq (recomendado Â· ultra rÃ¡pido)</option>
                            <option value="qwen">Qwen API directa (Alibaba Cloud)</option>
                        </select>
                    </div>
                    <div id="apGroqConfig">
                        <p class="config-hint" style="margin-bottom:10px"><strong>Groq</strong> â€” Gratis, ultra rÃ¡pido<br>1. <a href="https://console.groq.com" target="_blank">console.groq.com</a><br>2. Crea cuenta gratis<br>3. API Keys â†’ Create<br>4. Pega key (<code>gsk_</code>)</p>
                        <div class="config-row"><input type="password" id="apCfgGroqKey" placeholder="gsk_xxxxxxxxxxxx"></div>
                        <h4 style="margin-top:12px">Modelo</h4>
                        <div class="config-row">
                            <select id="apCfgGroqModel">
                                <option value="qwen/qwen3-32b">Qwen3 32B</option>
                                <option value="llama-3.3-70b-versatile">Llama 3.3 70B</option>
                                <option value="deepseek-r1-distill-llama-70b">DeepSeek R1 70B</option>
                                <option value="gemma2-9b-it">Gemma 2 9B</option>
                            </select>
                        </div>
                    </div>
                    <div id="apQwenConfig" style="display:none">
                        <p class="config-hint" style="margin-bottom:10px"><strong>Qwen API</strong><br>1. <a href="https://www.alibabacloud.com/help/en/model-studio/get-api-key" target="_blank">Alibaba Cloud</a><br>2. Crea API Key (<code>sk-</code>)</p>
                        <div class="config-row"><input type="password" id="apCfgQwenKey" placeholder="sk-xxxxxxxxxxxx"></div>
                        <h4 style="margin-top:12px">Modelo</h4>
                        <div class="config-row">
                            <select id="apCfgQwenModel">
                                <option value="qwen-turbo">Qwen Turbo</option>
                                <option value="qwen-plus">Qwen Plus</option>
                                <option value="qwen3-32b">Qwen3 32B</option>
                                <option value="qwen-max">Qwen Max</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top:16px;display:flex;gap:8px">
                        <button class="btn btn-primary btn-small" onclick="apGuardarConfig()">ğŸ’¾ Guardar</button>
                        <button class="btn btn-secondary btn-small" onclick="apTestApiKey()">ğŸ§ª Probar</button>
                    </div>
                    <div id="apCfgStatus" style="margin-top:12px"></div>
                </div>
            </div>
            
            <!-- PREGUNTAS IA SOBRE PROTOCOLOS -->
            <div id="preguntas-proto-content" class="protocol-content" style="display:none;margin-top:20px;">
                <div style="background:linear-gradient(135deg,var(--bg-dark),#243347);border-radius:var(--radius);padding:20px 24px;margin-bottom:20px;color:#fff;position:relative;overflow:hidden;">
                    <div style="position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:2.5rem;opacity:.12;">ğŸ§ </div>
                    <h4 style="font-family:var(--font-display);font-size:1.15rem;margin-bottom:6px;">ğŸ¤– Pregunta sobre los Protocolos</h4>
                    <p style="font-size:.86rem;opacity:.8;font-weight:300;">La IA tiene acceso al contenido completo de los 10 protocolos de AtenciÃ³n Primaria.</p>
                </div>
                
                <!-- Selector de protocolo -->
                <div style="margin-bottom:16px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                    <label style="font-weight:600;font-size:.88rem;color:var(--text);white-space:nowrap;">ğŸ“„ Contexto:</label>
                    <select id="apProtoSelect" style="flex:1;min-width:200px;padding:10px 14px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:.86rem;font-family:var(--font-body);background:var(--bg-main);">
                        <option value="all">ğŸ“š Todos los protocolos</option>
                        <option value="1">1 Â· ORL en AtenciÃ³n Primaria</option>
                        <option value="2">2 Â· RiÃ±Ã³n y VÃ­as Urinarias</option>
                        <option value="3">3 Â· DermatologÃ­a en AP</option>
                        <option value="4">4 Â· MusculoesquelÃ©tico</option>
                        <option value="5">5 Â· Enfermedades CrÃ³nicas (HTA, DM, EPOC)</option>
                        <option value="6">6 Â· Salud Mental</option>
                        <option value="7">7 Â· Sistema Nervioso</option>
                        <option value="8">8 Â· Problemas Digestivos</option>
                        <option value="9">9 Â· Problemas Digestivos (cont.)</option>
                        <option value="10">10 Â· Respiratorio y Cardiovascular</option>
                    </select>
                </div>
                
                <!-- Input pregunta -->
                <div class="question-input" style="margin-bottom:16px;">
                    <input type="text" id="apPreguntaInput" placeholder="Ej: Â¿CuÃ¡les son los red flags en lumbalgia?" spellcheck="false" style="flex:1;padding:13px 18px;border:2px solid var(--border);border-radius:var(--radius);font-size:.92rem;font-family:var(--font-body);background:var(--bg-card);transition:.2s;" onfocus="this.style.borderColor='var(--primary)'" onblur="this.style.borderColor='var(--border)'">
                    <button class="btn btn-primary" onclick="apHacerPregunta()" id="apBtnPreguntar">Preguntar</button>
                </div>
                
                <!-- Acciones rÃ¡pidas -->
                <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:20px;">
                    <button onclick="apQuickAsk('Resume los puntos clave de este protocolo')" style="padding:6px 14px;background:var(--bg-main);border:1px solid var(--border);border-radius:20px;font-size:.82rem;cursor:pointer;color:var(--text-light);font-family:var(--font-body);transition:.2s;" onmouseover="this.style.borderColor='var(--primary)';this.style.color='var(--primary)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-light)'">ğŸ“‹ Resumen clave</button>
                    <button onclick="apQuickAsk('Â¿CuÃ¡les son los criterios de derivaciÃ³n urgente?')" style="padding:6px 14px;background:var(--bg-main);border:1px solid var(--border);border-radius:20px;font-size:.82rem;cursor:pointer;color:var(--text-light);font-family:var(--font-body);transition:.2s;" onmouseover="this.style.borderColor='var(--primary)';this.style.color='var(--primary)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-light)'">ğŸš¨ Criterios derivaciÃ³n</button>
                    <button onclick="apQuickAsk('Â¿QuÃ© tratamiento farmacolÃ³gico recomienda?')" style="padding:6px 14px;background:var(--bg-main);border:1px solid var(--border);border-radius:20px;font-size:.82rem;cursor:pointer;color:var(--text-light);font-family:var(--font-body);transition:.2s;" onmouseover="this.style.borderColor='var(--primary)';this.style.color='var(--primary)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-light)'">ğŸ’Š Tratamiento</button>
                    <button onclick="apQuickAsk('Haz un esquema de diagnÃ³stico diferencial')" style="padding:6px 14px;background:var(--bg-main);border:1px solid var(--border);border-radius:20px;font-size:.82rem;cursor:pointer;color:var(--text-light);font-family:var(--font-body);transition:.2s;" onmouseover="this.style.borderColor='var(--primary)';this.style.color='var(--primary)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-light)'">ğŸ” Dx diferencial</button>
                </div>
                
                <!-- Respuestas -->
                <div id="apPreguntasList">
                    <div class="empty-state"><div class="empty-state-icon">ğŸ©º</div><p>Haz tu primera pregunta sobre los protocolos</p></div>
                </div>
            </div>
            
            <!-- ADMIN PROTOCOLOS (solo visible con login) -->
            <div id="admin-protocolos-content" class="protocol-content" style="display:none;margin-top:20px;">
                <div style="background:linear-gradient(135deg,#dc2626,#b91c1c);border-radius:var(--radius);padding:20px 24px;margin-bottom:20px;color:#fff;position:relative;overflow:hidden;">
                    <div style="position:absolute;right:20px;top:50%;transform:translateY(-50%);font-size:2.5rem;opacity:.12;">ğŸ”’</div>
                    <h4 style="font-family:var(--font-display);font-size:1.15rem;margin-bottom:6px;">ğŸ”’ GestiÃ³n de Protocolos â€” Admin</h4>
                    <p style="font-size:.86rem;opacity:.9;font-weight:300;">AÃ±ade o elimina protocolos personalizados. El contenido se guarda localmente y estarÃ¡ disponible para consultas con IA.</p>
                </div>

                <!-- Formulario aÃ±adir protocolo -->
                <div class="config-box" style="margin-bottom:20px;">
                    <h4 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:16px;">â• AÃ±adir Nuevo Protocolo</h4>
                    <div style="margin-bottom:12px;">
                        <label style="display:block;font-weight:600;font-size:.85rem;color:var(--text);margin-bottom:6px;">Nombre del protocolo</label>
                        <input type="text" id="apNewProtoName" placeholder="Ej: Protocolo de Urgencias PediÃ¡tricas" style="width:100%;padding:11px 14px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:.9rem;font-family:var(--font-body);background:var(--bg-main);" onfocus="this.style.borderColor='var(--primary)'" onblur="this.style.borderColor='var(--border)'">
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="display:block;font-weight:600;font-size:.85rem;color:var(--text);margin-bottom:6px;">Contenido del protocolo <span style="font-weight:300;color:var(--text-muted);">(pega el texto completo)</span></label>
                        <textarea id="apNewProtoContent" placeholder="Pega aquÃ­ el contenido completo del protocolo..." style="width:100%;padding:12px 14px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:.88rem;font-family:var(--font-body);background:var(--bg-main);min-height:180px;resize:vertical;line-height:1.6;" onfocus="this.style.borderColor='var(--primary)'" onblur="this.style.borderColor='var(--border)'"></textarea>
                    </div>
                    <div style="margin-bottom:12px;">
                        <label style="display:block;font-weight:600;font-size:.85rem;color:var(--text);margin-bottom:6px;">O sube un archivo de texto <span style="font-weight:300;color:var(--text-muted);">(.txt)</span></label>
                        <input type="file" id="apProtoFile" accept=".txt" onchange="apLoadFileContent()" style="font-size:.88rem;font-family:var(--font-body);">
                    </div>
                    <button class="btn btn-primary" onclick="apAddProtocol()" style="width:100%;">ğŸ“¥ AÃ±adir Protocolo</button>
                    <div id="apAddStatus" style="margin-top:10px;"></div>
                </div>

                <!-- Lista de protocolos personalizados -->
                <div class="config-box">
                    <h4 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:16px;">ğŸ“‹ Protocolos Personalizados</h4>
                    <div id="apCustomProtosList">
                        <div class="empty-state" style="padding:24px;"><div class="empty-state-icon">ğŸ“­</div><p>No hay protocolos personalizados aÃºn</p></div>
                    </div>
                </div>
            </div>
            
            <div style="margin-top:20px;padding:16px;background:#e3f2fd;border-radius:8px;font-size:.88rem;color:#1565c0;"><strong>ğŸ’¡ Tip:</strong> Accede al Panel Admin para subir protocolos de Atencion Primaria.</div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• PROTOCOLOS URGENCIAS PAGE â•â•â•â•â•â•â• -->
<div class="page" id="pageProtocolosUrgencias">
    <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" onclick="showPage('pageLanding')">â† Inicio</button><button class="page-back" id="loginBtnUrgencias" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button></div></nav>
    <div style="background:linear-gradient(135deg,var(--bg-dark),#1a1a2e);padding:30px 40px 20px;color:#fff;min-height:100vh;">
        <div style="max-width:1200px;margin:0 auto;">
        <h2 style="font-family:var(--font-display);font-size:1.8rem;margin-bottom:4px;">ğŸš¨ Protocolos de Urgencias</h2>
        <p style="font-size:.88rem;opacity:.65;margin-bottom:24px;">23 trÃ­pticos + 16 SEMFyC + 38 hospitalarios Â· 77 en total Â· Fuente: ARDITI + SMS Murcia + Toledo + SEUP + HUSL</p>
        
        <div style="background:rgba(255,255,255,.04);border-radius:var(--radius);padding:20px;margin-bottom:20px;">
            <div class="tab-buttons" style="border-bottom-color:rgba(255,255,255,.12);">
                <button class="tab-btn tab-urg active" onclick="switchUrgTab('urg-trip',this)" style="cursor:pointer;color:#fff;">ğŸ“„ TrÃ­pticos</button>
                <button class="tab-btn tab-urg" onclick="switchUrgTab('urg-list',this)" style="cursor:pointer;color:rgba(255,255,255,.6);">ğŸ“‹ Protocolos</button>
                <button class="tab-btn tab-urg" onclick="switchUrgTab('urg-ia',this)" style="cursor:pointer;color:rgba(255,255,255,.6);">ğŸ¤– Preguntas IA</button>
                <button class="tab-btn tab-urg" onclick="switchUrgTab('urg-pacientes',this)" style="cursor:pointer;color:rgba(255,255,255,.6);">ğŸ›ï¸ Pacientes</button>
            </div>
            
            <!-- TRÃPTICOS VISUALES -->
            <div id="urg-trip-content" class="urg-tab-content" style="margin-top:20px;">
                <div style="background:rgba(211,47,47,.15);border:1px solid rgba(211,47,47,.3);border-radius:var(--radius);padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;gap:12px;">
                    <span style="font-size:1.5rem;">ğŸ“„</span>
                    <div><strong style="font-size:.92rem;">TrÃ­pticos de Urgencias</strong><br><span style="font-size:.82rem;opacity:.8;">Cada trÃ­ptico contiene un PDF con el protocolo visual completo. Haz clic en "Ver PDF" para abrirlo.</span></div>
                </div>
                <div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#f57c0033;border-radius:8px;border-left:4px solid #f57c00;">ğŸ«€ Digestivo <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">4 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#f57c00';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#f57c00,#f57c00cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Diverticulitis Aguda</div>
<div style="font-size:.78rem;opacity:.85;">InflamaciÃ³n de los divertÃ­culos del colon. Consulta el trÃ­ptico para detalles.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Dolor en FII, fiebre, alteraciÃ³n del hÃ¡bito intestinal.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1sHBEehuuCilWmm-V9cL8jW_G4WxlMr7K/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#f57c00;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-diverticulitis')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#f57c00';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#f57c00,#f57c00cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Hemorragia Digestiva</div>
<div style="font-size:.78rem;opacity:.85;">Protocolo de manejo de hemorragia digestiva alta y baja.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Hematemesis, melenas o rectorragia.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1ps0HHuQYWlsd3ES2nNyeTzBRybGtaEM2/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#f57c00;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-hemorragia-digestiva')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#f57c00';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#f57c00,#f57c00cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">PatologÃ­a Biliar (CÃ³lico/Colecistitis)</div>
<div style="font-size:.78rem;opacity:.85;">Manejo del cÃ³lico biliar, colecistitis y colangitis.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Dolor en hipocondrio derecho, fiebre, ictericia.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1gWo3J2GloEENIoO3GpLUFOCdp8GX5-JN/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#f57c00;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-patologia-biliar')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#f57c00';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#f57c00,#f57c00cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Pancreatitis Aguda</div>
<div style="font-size:.78rem;opacity:.85;">InflamaciÃ³n aguda del pÃ¡ncreas. DiagnÃ³stico y manejo inicial.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Dolor epigÃ¡strico en cinturÃ³n, elevaciÃ³n amilasa/lipasa.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1gTbT_nvv1Q5CPAXaBpKe9MmOrQGl367f/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#f57c00;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-pancreatitis')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div><div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#d32f2f33;border-radius:8px;border-left:4px solid #d32f2f;">â¤ï¸â€ğŸ”¥ CardiologÃ­a <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">3 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#d32f2f';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#d32f2f,#d32f2fcc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">SÃ­ncope</div>
<div style="font-size:.78rem;opacity:.85;">PÃ©rdida transitoria de conciencia. EvaluaciÃ³n de riesgo en urgencias.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> PÃ©rdida de conciencia con recuperaciÃ³n espontÃ¡nea completa.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/159RUw8bx2aAAQisTRcjl5fOGAt79544W/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#d32f2f;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-sincope')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#d32f2f';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#d32f2f,#d32f2fcc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Insuficiencia CardÃ­aca Aguda</div>
<div style="font-size:.78rem;opacity:.85;">Manejo de la descompensaciÃ³n de IC y EAP.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Disnea, ortopnea, edemas, crepitantes.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1HPv8FG4IRbvQrBtYCjfwuF6e0wp-GSTW/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#d32f2f;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-insuficiencia-cardiaca')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#d32f2f';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#d32f2f,#d32f2fcc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">FibrilaciÃ³n Auricular</div>
<div style="font-size:.78rem;opacity:.85;">Manejo de la FA aguda y crÃ³nica en urgencias.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Palpitaciones, ritmo irregular, disnea.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1edF_YZy1C-9TjCdc9UOKbxXcbNHWiCCN/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#d32f2f;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-fibrilacion-auricular')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div><div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#7b1fa233;border-radius:8px;border-left:4px solid #7b1fa2;">ğŸ§¬ EndocrinologÃ­a <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">2 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#7b1fa2';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#7b1fa2,#7b1fa2cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Emergencias HiperglucÃ©micas</div>
<div style="font-size:.78rem;opacity:.85;">Cetoacidosis diabÃ©tica y estado hiperosmolar.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Hiperglucemia severa, deshidrataciÃ³n, alteraciÃ³n del estado mental.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1IV5hjBoJwitJp8WGsPb3SJpvgDLTQs5a/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#7b1fa2;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-emergencias-hiperglucemicas')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#7b1fa2';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#7b1fa2,#7b1fa2cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">InsulinizaciÃ³n en Urgencias</div>
<div style="font-size:.78rem;opacity:.85;">Pautas de insulinizaciÃ³n basal y correcciÃ³n en el paciente agudo.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Hiperglucemia no controlada en medio hospitalario.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1dManw-ahn89mmmwBGqv8KmxAZ_i8OzlU/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#7b1fa2;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-insulinizacion')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div><div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#1565c033;border-radius:8px;border-left:4px solid #1565c0;">ğŸ«˜ NefrologÃ­a <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">3 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#1565c0';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#1565c0,#1565c0cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Hiperpotasemia (Hiperkalemia)</div>
<div style="font-size:.78rem;opacity:.85;">Manejo urgente de la hiperpotasemia grave.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> K > 5.5 mEq/L, cambios ECG.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1TRokzomeGn62tHafbLL9dS0up64hTbzl/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#1565c0;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-hiperpotasemia')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#1565c0';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#1565c0,#1565c0cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Hipopotasemia (Hipokalemia)</div>
<div style="font-size:.78rem;opacity:.85;">ReposiciÃ³n de potasio en urgencias.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> K < 3.5 mEq/L, debilidad muscular, arritmias.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1Bc7PNzezC1zrTKzc6PyCl-R41vKwjXMp/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#1565c0;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-hipopotasemia')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#1565c0';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#1565c0,#1565c0cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Insuficiencia Renal Aguda</div>
<div style="font-size:.78rem;opacity:.85;">Abordaje del fracaso renal agudo (prerrenal, renal, postrenal).</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> ElevaciÃ³n de creatinina, oliguria.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1cyIZiZEuEhqqk9php_9KVceOXD-TKnMd/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#1565c0;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-insuficiencia-renal')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div><div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#0288d133;border-radius:8px;border-left:4px solid #0288d1;">ğŸ’§ UrologÃ­a <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">2 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#0288d1';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#0288d1,#0288d1cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">CÃ³lico NefrÃ­tico</div>
<div style="font-size:.78rem;opacity:.85;">Manejo del dolor y criterios de derivaciÃ³n/ingreso en litiasis renal.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Dolor en fosa renal irradiado a genitales, nÃ¡useas, cortejo vegetativo.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1b1oCYwB2kmR7kIOfucRK5UvsSN0hrU3-/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#0288d1;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-colico-nefritico')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#0288d1';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#0288d1,#0288d1cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">RetenciÃ³n Aguda de Orina (RAO)</div>
<div style="font-size:.78rem;opacity:.85;">Manejo de la retenciÃ³n urinaria y sondaje vesical.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Imposibilidad para orinar, dolor suprapÃºbico, globo vesical.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1yAkV_aRKgJ3vsvFkeB9VhjuNwzc4q84E/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#0288d1;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-rao')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div><div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#00838f33;border-radius:8px;border-left:4px solid #00838f;">ğŸ’¨ NeumologÃ­a <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">3 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#00838f';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#00838f,#00838fcc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Tromboembolismo Pulmonar (TEP)</div>
<div style="font-size:.78rem;opacity:.85;">Sospecha diagnÃ³stica (Wells/Ginebra) y tratamiento inicial del TEP.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Disnea sÃºbita, dolor torÃ¡cico pleurÃ­tico, taquicardia.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1xlgOWMF_4ECl-yjwi_8f7ZVox4cj0JeC/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#00838f;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-tep')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#00838f';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#00838f,#00838fcc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">NeumonÃ­a Adquirida en la Comunidad</div>
<div style="font-size:.78rem;opacity:.85;">Escalas de gravedad (CURB-65) y antibioterapia empÃ­rica.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Fiebre, tos, expectoraciÃ³n, disnea, infiltrado radiolÃ³gico.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1CCTy53dKEmvucnWTObPtmbf4Ex3VBPC9/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#00838f;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-neumonia')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#00838f';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#00838f,#00838fcc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">EPOC Agudizado</div>
<div style="font-size:.78rem;opacity:.85;">Manejo de la exacerbaciÃ³n de EPOC (Criterios Anthonisen).</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Aumento de disnea, esputo o purulencia en paciente EPOC.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1HlTfk4_kIfpwtklCTynDHdbeRlhAi_Mx/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#00838f;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-epoc')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div><div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#5e35b133;border-radius:8px;border-left:4px solid #5e35b1;">ğŸ§  Urgencias Neuro <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">1 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#5e35b1';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#5e35b1,#5e35b1cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Cefalea en Urgencias</div>
<div style="font-size:.78rem;opacity:.85;">Criterios de alarma y manejo sintomÃ¡tico de cefaleas primarias.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Cefalea intensa o con signos de alarma.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1dyt23QPIRHouWH2Wjh9ttBy6Tqoz71X9/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#5e35b1;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-cefalea')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div><div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#c6282833;border-radius:8px;border-left:4px solid #c62828;">ğŸ©¸ CirugÃ­a Vascular <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">2 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#c62828';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#c62828,#c62828cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Trombosis Venosa Profunda (TVP)</div>
<div style="font-size:.78rem;opacity:.85;">DiagnÃ³stico y tratamiento anticoagulante de la TVP.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Edema unilateral, dolor en pantorrilla, signo de Homans.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1SgRJoYfjSYoffcNmKKNnmPMbDyYykl85/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#c62828;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-tvp')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#c62828';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#c62828,#c62828cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Ãšlceras Vasculares y Pie DiabÃ©tico</div>
<div style="font-size:.78rem;opacity:.85;">Manejo de heridas crÃ³nicas y pie diabÃ©tico.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Ãšlceras en miembros inferiores, pie de riesgo.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1ZdlfC5hH5JC-yjaTOk7-GU1XUFVRyu8W/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#c62828;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-ulceras')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div><div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#4e342e33;border-radius:8px;border-left:4px solid #4e342e;">ğŸ¦´ ReumatologÃ­a <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">1 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#4e342e';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#4e342e,#4e342ecc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Artritis (Monoartritis Aguda)</div>
<div style="font-size:.78rem;opacity:.85;">Abordaje de la articulaciÃ³n caliente e inflamada (Gota, SÃ©ptica).</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Dolor, rubor, calor y tumefacciÃ³n articular aguda.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/16r1Ot9_6SbA3D9eodPG-5vRBatjRJFqi/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#4e342e;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-artritis')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div><div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#2e7d3233;border-radius:8px;border-left:4px solid #2e7d32;">ğŸ¦  Infecciosas <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">1 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#2e7d32';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#2e7d32,#2e7d32cc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">Neutropenia Febril</div>
<div style="font-size:.78rem;opacity:.85;">Urgencia oncolÃ³gica. Manejo antibiÃ³tico precoz.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> Fiebre en paciente con neutropenia (<500/mm3) o quimioterapia reciente.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1dawYFPhOqhnD-0pZI0FDy5dsOS9ZCage/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#2e7d32;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-neutropenia')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div><div style="margin-bottom:24px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1.05rem;margin-bottom:12px;padding:8px 14px;background:#546e7a33;border-radius:8px;border-left:4px solid #546e7a;">ğŸ•Šï¸ Paliativos <span style="font-size:.78rem;opacity:.6;font-weight:300;margin-left:8px;">1 trÃ­pticos</span></h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;"><div style="background:var(--bg-card);border-radius:12px;overflow:hidden;transition:all .25s;cursor:pointer;border:2px solid transparent;" onmouseover="this.style.borderColor='#546e7a';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.2)'" onmouseout="this.style.borderColor='transparent';this.style.transform='translateY(0)';this.style.boxShadow='none'">
<div style="background:linear-gradient(135deg,#546e7a,#546e7acc);padding:14px 16px;color:#fff;position:relative;">
<span style="position:absolute;top:8px;right:10px;background:rgba(255,255,255,.25);padding:2px 8px;border-radius:10px;font-size:.68rem;font-weight:700;">ğŸ“„ TRÃPTICO</span>
<div style="font-weight:700;font-size:.95rem;margin-bottom:4px;padding-right:70px;">SedaciÃ³n Paliativa</div>
<div style="font-size:.78rem;opacity:.85;">Protocolo de sedaciÃ³n en agonÃ­a y sÃ­ntomas refractarios.</div>
</div>
<div style="padding:12px 16px;">
<div style="font-size:.82rem;color:var(--text-muted);margin-bottom:10px;"><strong>Indicaciones:</strong> SÃ­ntomas refractarios en situaciÃ³n de Ãºltimos dÃ­as.</div>
<div style="display:flex;gap:8px;">
<a href="https://drive.google.com/file/d/1g_3dRWgBP3gmpdXnYY-4DqpbgoPaimTI/view" target="_blank" onclick="event.stopPropagation()" style="flex:1;display:block;text-align:center;padding:8px;background:#546e7a;color:#fff;border-radius:6px;text-decoration:none;font-size:.82rem;font-weight:600;transition:.2s;" onmouseover="this.style.opacity='.85'" onmouseout="this.style.opacity='1'">ğŸ“„ Ver PDF</a>
<button onclick="urgViewProtocol('trip-sedacion')" style="flex:1;padding:8px;background:var(--bg-main);color:var(--text);border:1px solid var(--border);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">â„¹ï¸ Detalle</button>
</div>
</div>
</div></div></div>
            </div>
            
            <!-- PROTOCOLOS SEMFyC -->
            <div id="urg-list-content" class="urg-tab-content" style="display:none;margin-top:20px;">
                <div style="background:rgba(26,107,74,.15);border:1px solid rgba(26,107,74,.3);border-radius:var(--radius);padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;gap:12px;">
                    <span style="font-size:1.5rem;">ğŸ“‹</span>
                    <div><strong style="font-size:.92rem;">Protocolos SEMFyC</strong><br><span style="font-size:.82rem;opacity:.8;">Protocolos de actuaciÃ³n con pasos, tratamiento y alertas. Haz clic para ver detalles.</span></div>
                </div>
                <div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ¥ AtenciÃ³n Primaria</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;"><div onclick="urgViewProtocol('semfyc-fiebre-sin-foco')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #1a6b4a;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Fiebre sin Focalidad Aparente</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">Abordaje de fiebre sin foco evidente tras anamnesis y exploraciÃ³n....</div>
</div></div></div><div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ‘‚ OtorrinolaringologÃ­a</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;"><div onclick="urgViewProtocol('semfyc-epistaxis')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #ef6c00;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Epistaxis (Hemorragia Nasal)</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">Sangrado nasal. Manejo inicial y criterios de derivaciÃ³n....</div>
</div></div></div><div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ« Urgencias Respiratorio</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;"><div onclick="urgViewProtocol('semfyc-disnea-aguda')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #00695c;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Disnea Aguda</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">Dificultad respiratoria de inicio sÃºbito....</div>
</div><div onclick="urgViewProtocol('semfyc-hemoptisis')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #00695c;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Hemoptisis</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">ExpectoraciÃ³n de sangre procedente del tracto respiratorio....</div>
</div></div></div><div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ†˜ Urgencias General</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;"><div onclick="urgViewProtocol('semfyc-dolor-abdominal-agudo')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #e65100;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Dolor Abdominal Agudo</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">Abdomen agudo. Identificar causa quirÃºrgica....</div>
</div></div></div><div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ§  Urgencias Neuro</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;"><div onclick="urgViewProtocol('semfyc-paralisis-facial')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #5e35b1;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">ParÃ¡lisis Facial</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">ParÃ¡lisis facial perifÃ©rica (Bell) vs central (ACV)....</div>
</div><div onclick="urgViewProtocol('semfyc-convulsiones')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #5e35b1;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Convulsiones en el Adulto</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">Crisis epilÃ©ptica. Primera crisis vs epilepsia conocida....</div>
</div><div onclick="urgViewProtocol('semfyc-perdida-fuerza')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #5e35b1;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">PÃ©rdida de Fuerza</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">Debilidad muscular. Descartar ACV....</div>
</div></div></div><div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ‘ï¸ OftalmologÃ­a</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;"><div onclick="urgViewProtocol('semfyc-ojo-rojo')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #1976d2;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Ojo Rojo</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">Hiperemia conjuntival. Descartar glaucoma agudo....</div>
</div><div onclick="urgViewProtocol('semfyc-perdida-vision')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #1976d2;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">DisminuciÃ³n de la Agudeza Visual</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">PÃ©rdida de visiÃ³n. Descartar causa urgente....</div>
</div></div></div><div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ‘¶ PediatrÃ­a</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;"><div onclick="urgViewProtocol('semfyc-fiebre-pediatrica')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #ec407a;cursor:pointer;transition:all .2s;position:relative;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'">
<div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Fiebre en el NiÃ±o</div>
<div style="font-size:.78rem;color:var(--text-muted);line-height:1.4;">Manejo de la fiebre pediÃ¡trica....</div>
</div></div></div>

<!-- PROTOCOLOS HOSPITALARIOS (NUEVOS desde Drive) -->
<div style="margin-top:30px;background:rgba(211,47,47,.08);border:1px solid rgba(211,47,47,.2);border-radius:var(--radius);padding:14px 18px;margin-bottom:20px;display:flex;align-items:center;gap:12px;">
    <span style="font-size:1.5rem;">ğŸ¨</span>
    <div><strong style="font-size:.92rem;">Protocolos Hospitalarios</strong><br><span style="font-size:.82rem;opacity:.8;">38 protocolos extraÃ­dos de los manuales de urgencias del SMS, Toledo, SEUP y HUSL.</span></div>
</div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ”´ ReanimaciÃ³n / CrÃ­ticos</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-sva')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #dc2626;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">SVA / RCP</div><div style="font-size:.78rem;color:var(--text-muted);">Algoritmo universal de SVA</div></div>
<div onclick="urgViewProtocol('hosp-via-aerea')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #dc2626;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">VÃ­a AÃ©rea DifÃ­cil / SRI</div><div style="font-size:.78rem;color:var(--text-muted);">Secuencia RÃ¡pida de IntubaciÃ³n</div></div>
<div onclick="urgViewProtocol('hosp-shock')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #dc2626;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Shock</div><div style="font-size:.78rem;color:var(--text-muted);">SÃ©ptico, hipovolÃ©mico, cardiogÃ©nico</div></div>
<div onclick="urgViewProtocol('hosp-anafilaxia')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #dc2626;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Anafilaxia</div><div style="font-size:.78rem;color:var(--text-muted);">Adrenalina IM precoz</div></div>
<div onclick="urgViewProtocol('hosp-sepsis')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #dc2626;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Sepsis / CÃ³digo Sepsis</div><div style="font-size:.78rem;color:var(--text-muted);">ATB en &lt;1h, fluidos, vasopresores</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">â¤ï¸ CardiologÃ­a</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-sca')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #e91e63;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">SCA / CÃ³digo Infarto</div><div style="font-size:.78rem;color:var(--text-muted);">ECG &lt;10 min, doble antiagregaciÃ³n</div></div>
<div onclick="urgViewProtocol('hosp-crisis-hta')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #e91e63;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Crisis Hipertensiva</div><div style="font-size:.78rem;color:var(--text-muted);">Urgencia vs emergencia HTA</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ§  NeurologÃ­a</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-ictus')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #9c27b0;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Ictus / CÃ³digo Ictus</div><div style="font-size:.78rem;color:var(--text-muted);">Fibrinolisis &lt;4.5h</div></div>
<div onclick="urgViewProtocol('hosp-hemorragia-cerebral')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #9c27b0;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Hemorragia Cerebral / HSA</div><div style="font-size:.78rem;color:var(--text-muted);">Control TA, reversiÃ³n ACO</div></div>
<div onclick="urgViewProtocol('hosp-status-epileptico')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #9c27b0;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Status EpilÃ©ptico</div><div style="font-size:.78rem;color:var(--text-muted);">BZD, FAE IV, sedaciÃ³n</div></div>
<div onclick="urgViewProtocol('hosp-meningoencefalitis')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #9c27b0;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Meningoencefalitis Aguda</div><div style="font-size:.78rem;color:var(--text-muted);">ATB inmediato sin esperar TAC</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ’¨ NeumologÃ­a</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-crisis-asmatica')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #0277bd;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Crisis AsmÃ¡tica</div><div style="font-size:.78rem;color:var(--text-muted);">Broncodilatadores + corticoides</div></div>
<div onclick="urgViewProtocol('hosp-disnea')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #0277bd;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Disnea Aguda / Insuf. Respiratoria</div><div style="font-size:.78rem;color:var(--text-muted);">VMNI, O2, tratar causa</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ«€ Digestivo</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-hepatica-aguda')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #ef6c00;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Insuficiencia HepÃ¡tica Aguda</div><div style="font-size:.78rem;color:var(--text-muted);">NAC si paracetamol</div></div>
<div onclick="urgViewProtocol('hosp-eii')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #ef6c00;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Enfermedad Inflamatoria Intestinal</div><div style="font-size:.78rem;color:var(--text-muted);">Brote Crohn/CU en urgencias</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ§¬ EndocrinologÃ­a</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-hipoglucemia')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #ff9800;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Hipoglucemia</div><div style="font-size:.78rem;color:var(--text-muted);">Glucosa IV si inconsciente</div></div>
<div onclick="urgViewProtocol('hosp-suprarrenal')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #ff9800;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Crisis Addisoniana</div><div style="font-size:.78rem;color:var(--text-muted);">Hidrocortisona IV inmediata</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ’§ UrologÃ­a</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-escroto-agudo')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #00838f;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Escroto Agudo</div><div style="font-size:.78rem;color:var(--text-muted);">TorsiÃ³n testicular &lt;6h</div></div>
<div onclick="urgViewProtocol('hosp-hematuria')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #00838f;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Hematuria</div><div style="font-size:.78rem;color:var(--text-muted);">Sonda 3 vÃ­as si coÃ¡gulos</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸš‘ Trauma</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-politrauma')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #d32f2f;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Politrauma</div><div style="font-size:.78rem;color:var(--text-muted);">XABCDE, Ãc. TranexÃ¡mico</div></div>
<div onclick="urgViewProtocol('hosp-tce')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #d32f2f;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">TCE Adulto</div><div style="font-size:.78rem;color:var(--text-muted);">Canadian CT Rule</div></div>
<div onclick="urgViewProtocol('hosp-quemaduras')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #d32f2f;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Quemaduras</div><div style="font-size:.78rem;color:var(--text-muted);">Regla de los 9, Parkland</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ©¸ CirugÃ­a Vascular</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-isquemia-arterial')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #c62828;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Isquemia Arterial Aguda</div><div style="font-size:.78rem;color:var(--text-muted);">Regla 6P, heparinizaciÃ³n</div></div>
<div onclick="urgViewProtocol('hosp-aorta')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #c62828;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">DisecciÃ³n AÃ³rtica</div><div style="font-size:.78rem;color:var(--text-muted);">Tipo A = cirugÃ­a urgente</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸŒ¸ Alergia / â˜ ï¸ ToxicologÃ­a / ğŸ§  PsiquiatrÃ­a</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-urticaria-angioedema')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #7b1fa2;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Urticaria y Angioedema</div><div style="font-size:.78rem;color:var(--text-muted);">Valorar vÃ­a aÃ©rea</div></div>
<div onclick="urgViewProtocol('hosp-piel-blandas')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #7b1fa2;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">InfecciÃ³n Piel / Fascitis</div><div style="font-size:.78rem;color:var(--text-muted);">CrepitaciÃ³n = cirugÃ­a urgente</div></div>
<div onclick="urgViewProtocol('hosp-intoxicacion-etilica')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #5d4037;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">IntoxicaciÃ³n EtÃ­lica</div><div style="font-size:.78rem;color:var(--text-muted);">Tiamina antes de glucosa</div></div>
<div onclick="urgViewProtocol('hosp-intoxicacion-farmacos')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #5d4037;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">IntoxicaciÃ³n FÃ¡rmacos/Drogas</div><div style="font-size:.78rem;color:var(--text-muted);">CarbÃ³n, antÃ­dotos, psiquiatrÃ­a</div></div>
<div onclick="urgViewProtocol('hosp-agitacion')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #455a64;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">AgitaciÃ³n Psicomotriz</div><div style="font-size:.78rem;color:var(--text-muted);">Desescalada, sedaciÃ³n</div></div>
<div onclick="urgViewProtocol('hosp-suicida')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #455a64;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Conducta Suicida</div><div style="font-size:.78rem;color:var(--text-muted);">ValoraciÃ³n riesgo autolÃ­tico</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ‘¶ PediatrÃ­a</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-ped-meningitis')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #00897b;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Meningitis PediÃ¡trica</div><div style="font-size:.78rem;color:var(--text-muted);">ATB segÃºn edad</div></div>
<div onclick="urgViewProtocol('hosp-ped-convulsion-febril')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #00897b;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">ConvulsiÃ³n Febril</div><div style="font-size:.78rem;color:var(--text-muted);">BZD si &gt;5 min</div></div>
<div onclick="urgViewProtocol('hosp-ped-bronquiolitis')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #00897b;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Bronquiolitis</div><div style="font-size:.78rem;color:var(--text-muted);">VRS, soporte, no salbutamol</div></div>
<div onclick="urgViewProtocol('hosp-ped-laringitis')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #00897b;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Laringitis / Crup</div><div style="font-size:.78rem;color:var(--text-muted);">Dexametasona + adrenalina neb</div></div>
<div onclick="urgViewProtocol('hosp-ped-sepsis')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #00897b;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Sepsis PediÃ¡trica</div><div style="font-size:.78rem;color:var(--text-muted);">VÃ­a &lt;5min, fluidos &lt;15min</div></div>
</div></div>

<div style="margin-bottom:20px;">
<h4 style="color:#fff;font-family:var(--font-display);font-size:1rem;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,.15);">ğŸ¤° Obstetricia</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;">
<div onclick="urgViewProtocol('hosp-obs-gripe')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #ad1457;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Gripe y GestaciÃ³n</div><div style="font-size:.78rem;color:var(--text-muted);">Oseltamivir precoz</div></div>
<div onclick="urgViewProtocol('hosp-obs-migrana')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #ad1457;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">MigraÃ±a y GestaciÃ³n</div><div style="font-size:.78rem;color:var(--text-muted);">Descartar preeclampsia</div></div>
<div onclick="urgViewProtocol('hosp-obs-parto')" style="background:var(--bg-card);padding:14px;border-radius:8px;border-left:4px solid #ad1457;cursor:pointer;transition:all .2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.boxShadow='none';this.style.transform='translateY(0)'"><div style="font-weight:600;color:var(--text);font-size:.88rem;margin-bottom:4px;">Parto Prematuro / Inminente</div><div style="font-size:.78rem;color:var(--text-muted);">Corticoides, profilaxis EGB</div></div>
</div></div>

            </div>
            <div id="urg-ia-content" class="urg-tab-content" style="display:none;margin-top:20px;">
                <div style="background:rgba(255,255,255,.08);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
                    <h4 style="font-size:1rem;margin-bottom:6px;">ğŸ¤– Pregunta sobre Protocolos de Urgencias</h4>
                    <p style="font-size:.82rem;opacity:.7;">La IA tiene acceso al contenido de los 39 protocolos (trÃ­pticos + SEMFyC).</p>
                </div>
                <div style="margin-bottom:14px;">
                    <select id="urgProtoSelect" style="width:100%;padding:10px 14px;border:2px solid rgba(255,255,255,.2);border-radius:var(--radius-sm);font-size:.86rem;font-family:var(--font-body);background:rgba(255,255,255,.1);color:#fff;"><option value="all">ğŸ“š Todos los protocolos de urgencias</option><optgroup label="ğŸ“„ TrÃ­pticos"><option value="trip-fibrilacion-auricular">â¤ï¸â€ğŸ”¥ FibrilaciÃ³n Auricular</option><option value="trip-insuficiencia-cardiaca">â¤ï¸â€ğŸ”¥ Insuficiencia CardÃ­aca Aguda</option><option value="trip-sincope">â¤ï¸â€ğŸ”¥ SÃ­ncope</option><option value="trip-tvp">ğŸ©¸ Trombosis Venosa Profunda (TVP)</option><option value="trip-ulceras">ğŸ©¸ Ãšlceras Vasculares y Pie DiabÃ©tico</option><option value="trip-diverticulitis">ğŸ«€ Diverticulitis Aguda</option><option value="trip-hemorragia-digestiva">ğŸ«€ Hemorragia Digestiva</option><option value="trip-pancreatitis">ğŸ«€ Pancreatitis Aguda</option><option value="trip-patologia-biliar">ğŸ«€ PatologÃ­a Biliar (CÃ³lico/Colecistitis)</option><option value="trip-emergencias-hiperglucemicas">ğŸ§¬ Emergencias HiperglucÃ©micas</option><option value="trip-insulinizacion">ğŸ§¬ InsulinizaciÃ³n en Urgencias</option><option value="trip-neutropenia">ğŸ¦  Neutropenia Febril</option><option value="trip-hiperpotasemia">ğŸ«˜ Hiperpotasemia (Hiperkalemia)</option><option value="trip-hipopotasemia">ğŸ«˜ Hipopotasemia (Hipokalemia)</option><option value="trip-insuficiencia-renal">ğŸ«˜ Insuficiencia Renal Aguda</option><option value="trip-epoc">ğŸ’¨ EPOC Agudizado</option><option value="trip-neumonia">ğŸ’¨ NeumonÃ­a Adquirida en la Comunidad</option><option value="trip-tep">ğŸ’¨ Tromboembolismo Pulmonar (TEP)</option><option value="trip-sedacion">ğŸ•Šï¸ SedaciÃ³n Paliativa</option><option value="trip-artritis">ğŸ¦´ Artritis (Monoartritis Aguda)</option><option value="trip-cefalea">ğŸ§  Cefalea en Urgencias</option><option value="trip-colico-nefritico">ğŸ’§ CÃ³lico NefrÃ­tico</option><option value="trip-rao">ğŸ’§ RetenciÃ³n Aguda de Orina (RAO)</option></optgroup><optgroup label="ğŸ“‹ Protocolos SEMFyC"><option value="semfyc-convulsiones">ğŸ¥ Convulsiones en el Adulto</option><option value="semfyc-colico-renal">ğŸ¥ CÃ³lico Renal</option><option value="semfyc-perdida-vision">ğŸ¥ DisminuciÃ³n de la Agudeza Visual</option><option value="semfyc-disnea-aguda">ğŸ¥ Disnea Aguda</option><option value="semfyc-dolor-abdominal-agudo">ğŸ¥ Dolor Abdominal Agudo</option><option value="semfyc-dolor-toracico-anginoso">ğŸ¥ Dolor TorÃ¡cico Anginoso</option><option value="semfyc-cefalea">ğŸ¥ Dolor de Cabeza (Cefalea)</option><option value="semfyc-epistaxis">ğŸ¥ Epistaxis (Hemorragia Nasal)</option><option value="semfyc-fiebre-pediatrica">ğŸ¥ Fiebre en el NiÃ±o</option><option value="semfyc-fiebre-sin-foco">ğŸ¥ Fiebre sin Focalidad Aparente</option><option value="semfyc-hemoptisis">ğŸ¥ Hemoptisis</option><option value="semfyc-monoartritis">ğŸ¥ Monoartritis Aguda</option><option value="semfyc-ojo-rojo">ğŸ¥ Ojo Rojo</option><option value="semfyc-paralisis-facial">ğŸ¥ ParÃ¡lisis Facial</option><option value="semfyc-perdida-fuerza">ğŸ¥ PÃ©rdida de Fuerza</option><option value="semfyc-sincope">ğŸ¥ SÃ­ncope</option></optgroup><optgroup label="ğŸ¨ Protocolos Hospitalarios"><option value="hosp-crisis-hta">â¤ï¸ Crisis Hipertensiva</option><option value="hosp-sca">â¤ï¸ SÃ­ndrome Coronario Agudo (CÃ³digo Infarto)</option><option value="hosp-isquemia-arterial">ğŸ©¸ Isquemia Arterial Aguda</option><option value="hosp-aorta">ğŸ©¸ PatologÃ­a AÃ³rtica Aguda (DisecciÃ³n)</option><option value="hosp-shock">âš¡ Shock (SÃ©ptico, HipovolÃ©mico, CardiogÃ©nico)</option><option value="hosp-eii">ğŸ«€ Enfermedad Inflamatoria Intestinal (EII)</option><option value="hosp-hepatica-aguda">ğŸ«€ Insuficiencia HepÃ¡tica Aguda</option><option value="hosp-hipoglucemia">ğŸ§¬ Hipoglucemia</option><option value="hosp-suprarrenal">ğŸ§¬ Insuficiencia Suprarrenal Aguda (Crisis Addisoniana)</option><option value="hosp-piel-blandas">ğŸ¦  InfecciÃ³n Piel y Partes Blandas</option><option value="hosp-meningoencefalitis">ğŸ¦  Meningoencefalitis Aguda</option><option value="hosp-sepsis">ğŸ¦  Sepsis y Shock SÃ©ptico (CÃ³digo Sepsis)</option><option value="hosp-crisis-asmatica">ğŸ’¨ Crisis AsmÃ¡tica</option><option value="hosp-disnea">ğŸ’¨ Disnea Aguda / Insuficiencia Respiratoria</option><option value="hosp-obs-parto">ğŸ¤° Amenaza de Parto Prematuro / Parto Inminente</option><option value="hosp-obs-gripe">ğŸ¤° Gripe y GestaciÃ³n</option><option value="hosp-obs-migrana">ğŸ¤° MigraÃ±a y GestaciÃ³n</option><option value="hosp-ped-bronquiolitis">ğŸ‘¶ Bronquiolitis PediÃ¡trica</option><option value="hosp-ped-convulsion-febril">ğŸ‘¶ ConvulsiÃ³n Febril PediÃ¡trica</option><option value="hosp-ped-laringitis">ğŸ‘¶ Laringitis / Crup PediÃ¡trico</option><option value="hosp-ped-meningitis">ğŸ‘¶ Meningitis PediÃ¡trica</option><option value="hosp-ped-sepsis">ğŸ‘¶ Sepsis PediÃ¡trica</option><option value="hosp-agitacion">ğŸ§  AgitaciÃ³n Psicomotriz</option><option value="hosp-suicida">ğŸ§  Paciente con Conducta Suicida</option><option value="hosp-via-aerea">ğŸ”´ Manejo VÃ­a AÃ©rea DifÃ­cil / SRI</option><option value="hosp-sva">ğŸ”´ Soporte Vital Avanzado (SVA)</option><option value="hosp-intoxicacion-etilica">â˜ ï¸ IntoxicaciÃ³n EtÃ­lica</option><option value="hosp-intoxicacion-farmacos">â˜ ï¸ IntoxicaciÃ³n por FÃ¡rmacos/Drogas</option><option value="hosp-politrauma">ğŸš‘ Politrauma / Trauma Grave</option><option value="hosp-quemaduras">ğŸš‘ Quemaduras</option><option value="hosp-tce">ğŸš‘ TCE (Traumatismo CraneoencefÃ¡lico)</option><option value="hosp-anafilaxia">ğŸŒ¸ Anafilaxia</option><option value="hosp-urticaria-angioedema">ğŸŒ¸ Urticaria y Angioedema</option><option value="hosp-hemorragia-cerebral">ğŸ§  Hemorragia Cerebral / HSA</option><option value="hosp-ictus">ğŸ§  Ictus IsquÃ©mico (CÃ³digo Ictus)</option><option value="hosp-status-epileptico">ğŸ§  Status EpilÃ©ptico</option><option value="hosp-escroto-agudo">ğŸ’§ Escroto Agudo</option><option value="hosp-hematuria">ğŸ’§ Hematuria</option></optgroup></select>
                </div>
                <div style="display:flex;gap:10px;margin-bottom:14px;">
                    <input type="text" id="urgPreguntaInput" placeholder="Ej: Â¿CÃ³mo manejar un TEP en urgencias?" spellcheck="false" style="flex:1;padding:12px 16px;border:2px solid rgba(255,255,255,.2);border-radius:var(--radius);font-size:.9rem;font-family:var(--font-body);background:rgba(255,255,255,.1);color:#fff;" onfocus="this.style.borderColor='var(--primary-light)'" onblur="this.style.borderColor='rgba(255,255,255,.2)'">
                    <button class="btn btn-primary" onclick="urgHacerPregunta()" id="urgBtnPreguntar">Preguntar</button>
                </div>
                <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px;">
                    <button onclick="urgQuickAsk('Resume los pasos clave de este protocolo')" style="padding:5px 12px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:18px;font-size:.8rem;cursor:pointer;color:rgba(255,255,255,.8);font-family:var(--font-body);">ğŸ“‹ Resumen</button>
                    <button onclick="urgQuickAsk('Â¿CuÃ¡les son las seÃ±ales de alarma y red flags?')" style="padding:5px 12px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:18px;font-size:.8rem;cursor:pointer;color:rgba(255,255,255,.8);font-family:var(--font-body);">ğŸš¨ Red Flags</button>
                    <button onclick="urgQuickAsk('Â¿QuÃ© tratamiento urgente recomienda?')" style="padding:5px 12px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:18px;font-size:.8rem;cursor:pointer;color:rgba(255,255,255,.8);font-family:var(--font-body);">ğŸ’Š Tratamiento</button>
                    <button onclick="urgQuickAsk('Â¿CuÃ¡ndo derivar al hospital?')" style="padding:5px 12px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:18px;font-size:.8rem;cursor:pointer;color:rgba(255,255,255,.8);font-family:var(--font-body);">ğŸ¥ DerivaciÃ³n</button>
                    <button onclick="urgQuickAsk('Compara los diagnÃ³sticos diferenciales')" style="padding:5px 12px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:18px;font-size:.8rem;cursor:pointer;color:rgba(255,255,255,.8);font-family:var(--font-body);">ğŸ” Dx Diferencial</button>
                </div>
                <div id="urgPreguntasList"><div style="text-align:center;padding:30px;opacity:.5;"><div style="font-size:2rem;margin-bottom:8px;">ğŸ©º</div><p>Haz tu primera pregunta sobre urgencias</p></div></div>
            </div>

            <!-- PACIENTES GUARDIA (Urgencias) -->
            <div id="urg-pacientes-content" class="urg-tab-content" style="display:none;margin-top:20px;">
                <div style="background:rgba(255,193,7,.12);border:1px solid rgba(255,193,7,.35);border-radius:var(--radius);padding:14px 18px;font-size:.84rem;color:#ffc107;margin-bottom:20px;line-height:1.6;">
                    ğŸ”’ <strong>Datos anonimizados.</strong> No incluyas nombre, DNI, NHC ni datos identificativos. Usa solo iniciales o nÃºmero de cama. Los datos se guardan localmente en tu dispositivo.
                </div>
                <div style="background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:var(--radius);padding:20px;margin-bottom:20px;">
                    <h4 style="font-family:var(--font-display);margin-bottom:14px;">â• Nuevo paciente de guardia</h4>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
                        <input type="text" id="gpCamaUrg" placeholder="Cama / Box (ej: Box3, C12)" style="padding:10px;border:2px solid rgba(255,255,255,.15);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;background:rgba(255,255,255,.08);color:#fff;">
                        <input type="text" id="gpIdUrg" placeholder="ID anÃ³nimo (ej: JM, Pac.3)" style="padding:10px;border:2px solid rgba(255,255,255,.15);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;background:rgba(255,255,255,.08);color:#fff;">
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
                        <input type="text" id="gpEdadUrg" placeholder="Edad / Sexo (ej: 72M)" style="padding:10px;border:2px solid rgba(255,255,255,.15);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;background:rgba(255,255,255,.08);color:#fff;">
                        <select id="gpPrioridadUrg" style="padding:10px;border:2px solid rgba(255,255,255,.15);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;background:rgba(255,255,255,.08);color:#fff;">
                            <option value="normal">ğŸŸ¢ Normal</option>
                            <option value="atento">ğŸŸ¡ Atento</option>
                            <option value="urgente">ğŸ”´ Urgente</option>
                        </select>
                    </div>
                    <input type="text" id="gpMotivoUrg" placeholder="Motivo ingreso / consulta" style="width:100%;padding:10px;border:2px solid rgba(255,255,255,.15);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;background:rgba(255,255,255,.08);color:#fff;margin-bottom:10px;">
                    <textarea id="gpNotasUrg" placeholder="Notas / pendientes / recordatorios..." style="width:100%;padding:10px;border:2px solid rgba(255,255,255,.15);border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.9rem;min-height:70px;resize:vertical;background:rgba(255,255,255,.08);color:#fff;margin-bottom:10px;"></textarea>
                    <div style="display:flex;gap:10px;">
                        <button class="btn btn-primary btn-small" onclick="gpAdd('Urg')">ğŸ›ï¸ AÃ±adir paciente</button>
                        <button class="btn btn-secondary btn-small" onclick="gpClearForm('Urg')">Limpiar</button>
                    </div>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
                    <h4 style="font-family:var(--font-display);">ğŸ›ï¸ Lista de pacientes en guardia</h4>
                    <div style="display:flex;gap:8px;">
                        <button onclick="gpExport('Urg')" style="padding:6px 12px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.2);border-radius:var(--radius-sm);cursor:pointer;font-size:.8rem;font-family:var(--font-body);font-weight:600;color:#fff;">ğŸ“‹ Copiar</button>
                        <button onclick="if(confirm('Â¿Borrar todos los pacientes?'))gpClearAll('Urg')" style="padding:6px 12px;background:rgba(220,38,38,.15);border:1px solid rgba(220,38,38,.4);border-radius:var(--radius-sm);cursor:pointer;font-size:.8rem;font-family:var(--font-body);font-weight:600;color:#fca5a5;">ğŸ—‘ï¸ Borrar todo</button>
                    </div>
                </div>
                <div id="gpListUrg"><div style="text-align:center;padding:30px;opacity:.5;"><div style="font-size:2rem;margin-bottom:8px;">ğŸ›ï¸</div><p>No hay pacientes registrados en esta guardia</p></div></div>
            </div>
        </div>
        </div>
    </div>
</div>

<!-- MODAL DETALLE PROTOCOLO URGENCIAS -->
<div id="urgProtoModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:1002;overflow:auto;padding:20px;backdrop-filter:blur(3px);">
    <div style="background:#fff;border-radius:16px;max-width:750px;margin:30px auto;overflow:hidden;box-shadow:0 25px 80px rgba(0,0,0,.5);">
        <div id="urgProtoModalHeader" style="background:linear-gradient(135deg,#d32f2f,#b71c1c);padding:24px;color:#fff;position:relative;">
            <div style="position:absolute;top:12px;right:16px;cursor:pointer;font-size:1.5rem;opacity:.7;" onclick="urgCloseModal()">âœ•</div>
            <div id="urgProtoModalCat" style="font-size:.82rem;opacity:.8;margin-bottom:4px;"></div>
            <h3 id="urgProtoModalTitle" style="font-family:var(--font-display);font-size:1.4rem;"></h3>
            <div id="urgProtoModalSummary" style="font-size:.88rem;opacity:.85;margin-top:6px;"></div>
        </div>
        <div id="urgProtoModalBody" style="padding:24px;color:#333;font-size:.92rem;line-height:1.7;max-height:55vh;overflow-y:auto;"></div>
        <div id="urgProtoModalPdf" style="display:none;padding:0 24px 24px;">
            <div style="display:flex;gap:10px;align-items:center;">
                <a id="urgProtoModalPdfLink" href="" target="_blank" style="display:inline-flex;align-items:center;gap:6px;padding:12px 24px;background:linear-gradient(135deg,#d32f2f,#b71c1c);color:#fff;border-radius:8px;text-decoration:none;font-weight:700;font-size:.9rem;transition:.2s;" onmouseover="this.style.transform='translateY(-1px)';this.style.boxShadow='0 4px 12px rgba(211,47,47,.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='none'">ğŸ“„ Abrir TrÃ­ptico PDF Completo</a>
                <span style="font-size:.8rem;color:#999;">Se abre en nueva pestaÃ±a</span>
            </div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• TELÃ‰FONOS BUSCAS PAGE â•â•â•â•â•â•â• -->
<div class="page" id="pageTelefonos">
    <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" onclick="showPage('pageLanding')">â† Inicio</button><button class="page-back" id="loginBtnTelefonos" onclick="showLoginModal()" style="background: linear-gradient(135deg, #1a6b4a, #238c62); color: #fff; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: .85rem; font-family: var(--font-body);">ğŸ” Admin Login</button></div></nav>
    <div style="flex:1;overflow-y:auto;background:var(--bg-main);padding:40px 20px;">
        <div style="max-width:800px;margin:0 auto;">
            <div style="background:linear-gradient(135deg,#d4a853,#b8912e);border-radius:var(--radius);padding:28px;color:#fff;margin-bottom:28px;position:relative;overflow:hidden;">
                <div style="position:absolute;right:24px;top:50%;transform:translateY(-50%);font-size:3rem;opacity:.15;">ğŸ“</div>
                <h2 style="font-family:var(--font-display);font-size:1.8rem;margin-bottom:8px;">ğŸ“ TelÃ©fonos Buscas</h2>
                <p style="opacity:.85;font-size:.95rem;font-weight:300;">Directorio de buscas del Hospital Santa LucÃ­a de Cartagena</p>
            </div>

            <!-- Search bar -->
            <div style="margin-bottom:20px;position:relative;">
                <input type="text" id="telSearch" oninput="filterTelefonos()" placeholder="ğŸ” Buscar servicio, especialidad o nombre..." style="width:100%;padding:14px 18px;border:2px solid var(--border);border-radius:var(--radius);font-size:.95rem;font-family:var(--font-body);background:var(--bg-card);">
            </div>

            <!-- Phone directory -->
            <div id="telDirectory">
                <div style="text-align:center;padding:50px 20px;color:var(--text-muted);">
                    <div style="font-size:3rem;margin-bottom:16px;opacity:.4;">ğŸ“‹</div>
                    <p style="font-size:1rem;font-weight:600;margin-bottom:8px;">Directorio en preparaciÃ³n</p>
                    <p style="font-size:.9rem;">Los nÃºmeros de buscas del Hospital Santa LucÃ­a se aÃ±adirÃ¡n prÃ³ximamente.</p>
                    <p style="font-size:.85rem;margin-top:12px;color:var(--text-light);">El administrador puede subir el listado desde el Panel Admin.</p>
                </div>
            </div>

            <!-- Info footer -->
            <div style="margin-top:24px;padding:14px;background:var(--bg-subtle);border-radius:var(--radius-sm);font-size:.82rem;color:var(--text-muted);line-height:1.6;">
                ğŸ¥ <strong>Hospital General Universitario Santa LucÃ­a</strong> Â· C/ Mezquita, s/n Â· 30202 Cartagena Â· Centralita: 968 12 86 00
            </div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• SCAN IA PAGE (protegido con contraseÃ±a) â•â•â•â•â•â•â• -->
<div class="page" id="pageScanIA">
    <nav class="landing-nav"><div class="brand"><div class="logo">ğŸ¥</div><h1>Area II <span>Cartagena</span></h1></div><div class="nav-links"><button class="page-back" onclick="showPage('pageLanding')">â† Inicio</button></div></nav>
    <div style="flex:1;overflow-y:auto;background:var(--bg-main);padding:40px 20px;">
        <div style="max-width:800px;margin:0 auto;">
            <div style="background:linear-gradient(135deg,#0066cc,#004499);border-radius:var(--radius);padding:28px;color:#fff;margin-bottom:28px;position:relative;overflow:hidden;">
                <div style="position:absolute;right:24px;top:50%;transform:translateY(-50%);font-size:3rem;opacity:.15;">ğŸ”¬</div>
                <h2 style="font-family:var(--font-display);font-size:1.8rem;margin-bottom:8px;">ğŸ”¬ Herramientas</h2>
                <p style="opacity:.85;font-size:.95rem;font-weight:300;">AnÃ¡lisis de imÃ¡genes mÃ©dicas con IA y casos clÃ­nicos NIH para formaciÃ³n.</p>
            </div>

            <!-- TABS: Scan IA / Quiz NIH -->
            <div style="display:flex;gap:0;margin-bottom:24px;border-bottom:3px solid var(--border);">
                <button id="tabScanIA" onclick="switchScanTab('scanIA')" style="flex:1;padding:14px;border:none;background:linear-gradient(135deg,#0066cc,#004499);color:#fff;font-family:var(--font-body);font-size:.95rem;font-weight:700;cursor:pointer;border-radius:var(--radius) var(--radius) 0 0;transition:.25s;">ğŸ”¬ Analizar imagen</button>
                <button id="tabNIHQuiz" onclick="switchScanTab('nihQuiz')" style="flex:1;padding:14px;border:none;background:var(--bg-subtle);color:var(--text);font-family:var(--font-body);font-size:.95rem;font-weight:700;cursor:pointer;border-radius:var(--radius) var(--radius) 0 0;transition:.25s;">ğŸ§  Quiz NIH Chest X-Ray</button>
            </div>

            <!-- TAB 1: SCAN IA (existing) -->
            <div id="panelScanIA">
            <div style="background:#fff3cd;border:1px solid #ffc107;border-radius:var(--radius);padding:14px 18px;font-size:.84rem;color:#856404;margin-bottom:24px;line-height:1.6;">
                âš ï¸ <strong>Uso exclusivamente docente.</strong> No sustituye el juicio clÃ­nico profesional. Las interpretaciones pueden contener errores y nunca deben usarse como diagnÃ³stico definitivo.
            </div>
            <div style="display:flex;gap:10px;margin-bottom:24px;flex-wrap:wrap;">
                <button class="scan-mode-btn active" onclick="scanSetType('derma',this)" style="flex:1;min-width:100px;padding:12px 8px;border-radius:var(--radius);border:2px solid var(--border);background:var(--bg-card);cursor:pointer;font-family:var(--font-body);font-size:.85rem;font-weight:600;transition:.25s;text-align:center;">ğŸ©¹ DermatologÃ­a</button>
                <button class="scan-mode-btn" onclick="scanSetType('torax',this)" style="flex:1;min-width:100px;padding:12px 8px;border-radius:var(--radius);border:2px solid var(--border);background:var(--bg-card);cursor:pointer;font-family:var(--font-body);font-size:.85rem;font-weight:600;transition:.25s;text-align:center;">ğŸ« Rx TÃ³rax</button>
                <button class="scan-mode-btn" onclick="scanSetType('osea',this)" style="flex:1;min-width:100px;padding:12px 8px;border-radius:var(--radius);border:2px solid var(--border);background:var(--bg-card);cursor:pointer;font-family:var(--font-body);font-size:.85rem;font-weight:600;transition:.25s;text-align:center;">ğŸ¦´ Rx Ã“sea</button>
                <button class="scan-mode-btn" onclick="scanSetType('abdomen',this)" style="flex:1;min-width:100px;padding:12px 8px;border-radius:var(--radius);border:2px solid var(--border);background:var(--bg-card);cursor:pointer;font-family:var(--font-body);font-size:.85rem;font-weight:600;transition:.25s;text-align:center;">ğŸ”¬ Rx Abdomen</button>
                <button class="scan-mode-btn" onclick="scanSetType('ecg',this)" style="flex:1;min-width:100px;padding:12px 8px;border-radius:var(--radius);border:2px solid var(--border);background:var(--bg-card);cursor:pointer;font-family:var(--font-body);font-size:.85rem;font-weight:600;transition:.25s;text-align:center;">ğŸ’“ ECG</button>
                <button class="scan-mode-btn" onclick="scanSetType('eco',this)" style="flex:1;min-width:100px;padding:12px 8px;border-radius:var(--radius);border:2px solid var(--border);background:var(--bg-card);cursor:pointer;font-family:var(--font-body);font-size:.85rem;font-weight:600;transition:.25s;text-align:center;">ğŸ«€ EcografÃ­a</button>
            </div>
            <!-- AI Models Reference -->
            <div id="scanModelInfo" style="background:var(--bg-subtle);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 16px;font-size:.8rem;color:var(--text-light);margin-bottom:20px;line-height:1.5;display:flex;align-items:center;gap:10px;">
                <span style="font-size:1.2rem;">ğŸ¤–</span>
                <span id="scanModelRef">Modelo: <strong>Vision Transformers (ViT)</strong> Â· Dataset: <strong>ISIC Archive</strong> Â· Arquitectura sugerida: ViT Â· AnÃ¡lisis por Llama 4 Scout (Groq)</span>
            </div>
            <div id="scanDropZone" onclick="document.getElementById('scanFileIn').click()" style="border:2px dashed var(--border);border-radius:var(--radius);padding:48px 20px;text-align:center;cursor:pointer;background:var(--bg-card);margin-bottom:20px;transition:.3s;">
                <input type="file" id="scanFileIn" accept="image/*" style="display:none" onchange="scanHandleFile(event)">
                <div id="scanDropContent"><div style="font-size:3rem;margin-bottom:12px;opacity:.5;">ğŸ“·</div><div style="color:var(--text-light);font-size:.95rem;margin-bottom:4px;">Arrastra una imagen o haz clic para seleccionar</div><div style="color:var(--text-muted);font-size:.82rem;">JPG, PNG Â· Fotos clÃ­nicas, radiografÃ­as o ECGs</div></div>
                <img id="scanImgPreview" style="display:none;max-width:100%;max-height:380px;border-radius:8px;object-fit:contain;margin:0 auto;" alt="Preview">
            </div>
            <input type="text" id="scanCtx" placeholder="Contexto clÃ­nico (opcional): edad, sexo, sÃ­ntomas, localizaciÃ³n..." style="width:100%;padding:13px 18px;border:2px solid var(--border);border-radius:var(--radius);font-size:.92rem;font-family:var(--font-body);margin-bottom:16px;background:var(--bg-card);">
            <div style="display:flex;gap:12px;margin-bottom:24px;">
                <button id="scanBtnGo" onclick="scanAnalyze()" disabled style="padding:14px 32px;background:linear-gradient(135deg,#0066cc,#004499);color:#fff;border:none;border-radius:var(--radius);font-size:.98rem;font-weight:700;cursor:pointer;font-family:var(--font-body);transition:.3s;display:flex;align-items:center;gap:8px;">ğŸ”¬ Analizar con IA</button>
                <button onclick="scanClear()" style="padding:14px 24px;background:var(--bg-subtle);color:var(--text);border:none;border-radius:var(--radius);font-size:.92rem;font-weight:600;cursor:pointer;font-family:var(--font-body);">ğŸ—‘ï¸ Limpiar</button>
            </div>
            <div id="scanResult"></div>
            <div style="margin-top:30px;"><h4 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:14px;">ğŸ“‹ Historial de anÃ¡lisis</h4><div id="scanHistList"><div style="text-align:center;padding:30px;color:var(--text-muted);"><div style="font-size:2.5rem;margin-bottom:10px;opacity:.5;">ğŸ”¬</div><p style="font-size:.92rem;">AÃºn no hay anÃ¡lisis realizados</p></div></div></div>
            </div><!-- end panelScanIA -->

            <!-- TAB 2: NIH QUIZ + COMPARACIÃ“N IA -->
            <div id="panelNIHQuiz" style="display:none;">
                <div style="background:#e8f5e9;border:1px solid #4caf50;border-radius:var(--radius);padding:14px 18px;font-size:.84rem;color:#2e7d32;margin-bottom:20px;line-height:1.6;">
                    ğŸ¥ <strong>Dataset NIH Chest X-Ray.</strong> Casos reales desidentificados del NIH Clinical Center. Practica tu diagnÃ³stico y compÃ¡ralo con la IA.
                </div>

                <!-- Quiz Mode Selector -->
                <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
                    <button id="nihModeQuiz" onclick="nihSetMode('quiz')" style="flex:1;min-width:180px;padding:14px;border-radius:var(--radius);border:2px solid #4caf50;background:#e8f5e9;color:#2e7d32;cursor:pointer;font-family:var(--font-body);font-size:.92rem;font-weight:700;transition:.25s;text-align:center;">ğŸ§  Modo Quiz</button>
                    <button id="nihModeCompare" onclick="nihSetMode('compare')" style="flex:1;min-width:180px;padding:14px;border-radius:var(--radius);border:2px solid var(--border);background:var(--bg-card);color:var(--text);cursor:pointer;font-family:var(--font-body);font-size:.92rem;font-weight:700;transition:.25s;text-align:center;">ğŸ¤– Modo IA vs DiagnÃ³stico</button>
                </div>

                <!-- Filter by pathology -->
                <div style="margin-bottom:20px;">
                    <label style="font-size:.85rem;font-weight:600;color:var(--text-light);margin-bottom:6px;display:block;">Filtrar por patologÃ­a:</label>
                    <select id="nihFilterPath" onchange="nihFilterCases()" style="width:100%;padding:12px;border:2px solid var(--border);border-radius:var(--radius);font-family:var(--font-body);font-size:.92rem;background:var(--bg-card);">
                        <option value="all">ğŸ“‹ Todas las patologÃ­as</option>
                        <option value="No Finding">âœ… Normal (No Finding)</option>
                        <option value="Atelectasis">Atelectasia</option>
                        <option value="Cardiomegaly">Cardiomegalia</option>
                        <option value="Consolidation">ConsolidaciÃ³n</option>
                        <option value="Edema">Edema pulmonar</option>
                        <option value="Effusion">Derrame pleural</option>
                        <option value="Emphysema">Enfisema</option>
                        <option value="Fibrosis">Fibrosis</option>
                        <option value="Hernia">Hernia</option>
                        <option value="Infiltration">Infiltrado</option>
                        <option value="Mass">Masa</option>
                        <option value="Nodule">NÃ³dulo</option>
                        <option value="Pleural_Thickening">Engrosamiento pleural</option>
                        <option value="Pneumonia">NeumonÃ­a</option>
                        <option value="Pneumothorax">NeumotÃ³rax</option>
                    </select>
                </div>

                <!-- Score display -->
                <div id="nihScoreBar" style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);padding:14px 20px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
                    <div style="font-weight:700;font-family:var(--font-display);color:var(--primary-dark);">ğŸ“Š PuntuaciÃ³n</div>
                    <div style="display:flex;gap:20px;font-size:.92rem;">
                        <span>âœ… Aciertos: <strong id="nihCorrect">0</strong></span>
                        <span>âŒ Fallos: <strong id="nihWrong">0</strong></span>
                        <span>ğŸ“ Total: <strong id="nihTotal">0</strong>/<span id="nihTotalCases">30</span></span>
                    </div>
                    <button onclick="nihReset()" style="padding:8px 16px;background:var(--bg-subtle);border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:.82rem;font-weight:600;font-family:var(--font-body);">ğŸ”„ Reiniciar</button>
                </div>

                <!-- Case display area -->
                <div id="nihCaseArea" style="background:var(--bg-card);border:2px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-bottom:20px;">
                    <div id="nihCaseImage" style="background:#000;text-align:center;padding:20px;min-height:350px;display:flex;align-items:center;justify-content:center;">
                        <div style="color:#fff;opacity:.5;font-size:1.1rem;">Pulsa "Siguiente caso" para empezar</div>
                    </div>
                    <div style="padding:20px;">
                        <div id="nihCaseInfo" style="font-size:.85rem;color:var(--text-muted);margin-bottom:14px;"></div>

                        <!-- Quiz mode: multiple choice -->
                        <div id="nihQuizOptions" style="display:none;">
                            <p style="font-weight:700;font-size:.95rem;margin-bottom:12px;">Â¿CuÃ¡l es tu diagnÃ³stico?</p>
                            <div id="nihOptions" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;"></div>
                        </div>

                        <!-- Compare mode: IA analysis -->
                        <div id="nihCompareArea" style="display:none;">
                            <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                                <div>
                                    <div style="font-weight:700;font-size:.92rem;color:#2e7d32;margin-bottom:8px;">âœ… DiagnÃ³stico NIH (Ground Truth)</div>
                                    <div id="nihGroundTruth" style="background:#e8f5e9;border-radius:var(--radius-sm);padding:14px;font-size:.9rem;min-height:60px;"></div>
                                </div>
                                <div>
                                    <div style="font-weight:700;font-size:.92rem;color:#0066cc;margin-bottom:8px;">ğŸ¤– DiagnÃ³stico IA (Llama 4 Scout)</div>
                                    <div id="nihAIDiagnosis" style="background:#e3f2fd;border-radius:var(--radius-sm);padding:14px;font-size:.9rem;min-height:60px;">
                                        <button id="nihRunIA" onclick="nihAnalyzeWithIA()" style="padding:10px 20px;background:linear-gradient(135deg,#0066cc,#004499);color:#fff;border:none;border-radius:var(--radius-sm);cursor:pointer;font-weight:700;font-family:var(--font-body);font-size:.88rem;">ğŸ”¬ Analizar con IA</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Feedback area -->
                        <div id="nihFeedback" style="display:none;margin-top:16px;padding:16px;border-radius:var(--radius-sm);font-size:.92rem;line-height:1.6;"></div>
                    </div>
                </div>

                <!-- Navigation -->
                <div style="display:flex;gap:12px;justify-content:center;">
                    <button onclick="nihNextCase()" style="padding:14px 32px;background:linear-gradient(135deg,#4caf50,#2e7d32);color:#fff;border:none;border-radius:var(--radius);font-size:.98rem;font-weight:700;cursor:pointer;font-family:var(--font-body);">â–¶ Siguiente caso</button>
                </div>

                <!-- Attribution -->
                <div style="margin-top:24px;padding:14px;background:var(--bg-subtle);border-radius:var(--radius-sm);font-size:.78rem;color:var(--text-muted);line-height:1.6;">
                    ğŸ“– <strong>Fuente:</strong> NIH Chest X-ray Dataset â€” Wang et al., "ChestX-ray8: Hospital-scale Chest X-ray Database and Benchmarks", IEEE CVPR 2017. Datos proporcionados por el NIH Clinical Center. <a href="https://nihcc.app.box.com/v/ChestXray-NIHCC" target="_blank" style="color:#0066cc;">nihcc.app.box.com</a>
                </div>
            </div><!-- end panelNIHQuiz -->
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• SCAN LOGIN MODAL (Google Auth) â•â•â•â•â•â•â• -->
<div id="scanLoginModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:1001;align-items:center;justify-content:center;backdrop-filter:blur(2px);">
    <div style="background:#fff;border-radius:16px;max-width:400px;width:90%;box-shadow:0 25px 80px rgba(0,0,0,.4);overflow:hidden;animation:slideInUp .3s ease;">
        <div style="background:linear-gradient(135deg,#0066cc,#004499);padding:28px 24px;color:#fff;text-align:center;position:relative;">
            <div style="position:absolute;top:12px;right:12px;cursor:pointer;font-size:1.5rem;opacity:.7;" onclick="document.getElementById('scanLoginModal').style.display='none'">âœ•</div>
            <div style="font-size:2.2rem;margin-bottom:10px;">ğŸ”¬</div>
            <h2 style="font-family:var(--font-display);font-size:1.5rem;font-weight:700;">Herramientas</h2>
            <p style="margin:6px 0 0;opacity:.85;font-size:.88rem;">Acceso con cuenta de Google</p>
        </div>
        <div style="padding:28px;">
            <p style="font-size:.88rem;color:var(--text-light);margin-bottom:18px;text-align:center;">Inicia sesiÃ³n con tu cuenta de Google para acceder al mÃ³dulo de Herramientas.</p>
            <button onclick="scanGoogleLogin()" style="width:100%;padding:14px;background:#fff;color:#333;border:2px solid #ddd;border-radius:var(--radius);font-size:1rem;font-weight:600;cursor:pointer;font-family:var(--font-body);transition:.3s;display:flex;align-items:center;justify-content:center;gap:12px;" onmouseover="this.style.borderColor='#4285f4';this.style.background='#f8f9ff'" onmouseout="this.style.borderColor='#ddd';this.style.background='#fff'">
                <svg width="20" height="20" viewBox="0 0 48 48"><path fill="#4285F4" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#34A853" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#EA4335" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
                Iniciar sesiÃ³n con Google
            </button>
            <div id="scanLoginError" style="display:none;color:#dc2626;font-size:.85rem;text-align:center;margin-top:12px;">âŒ Error al iniciar sesiÃ³n</div>
            <p style="font-size:.78rem;color:var(--text-muted);text-align:center;margin-top:16px;">Solo cuentas autorizadas pueden acceder.</p>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â• IMPROVED LOGIN MODAL â•â•â•â•â•â•â• -->
<div id="loginModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:1000;align-items:center;justify-content:center;backdrop-filter:blur(2px);">
    <div style="background:#fff;border-radius:16px;padding:0;max-width:420px;width:90%;box-shadow:0 25px 80px rgba(0,0,0,.4);overflow:hidden;animation:slideInUp .3s ease;">
        <!-- Header -->
        <div style="background:linear-gradient(135deg,var(--primary),var(--primary-light));padding:32px 24px;color:#fff;text-align:center;position:relative;">
            <div style="position:absolute;top:12px;right:12px;cursor:pointer;font-size:1.5rem;opacity:.7;hover:opacity:1;transition:.2s;" onclick="closeLoginModal()">âœ•</div>
            <div style="font-size:2.5rem;margin-bottom:12px;">ğŸ”</div>
            <h2 style="font-family:var(--font-display);font-size:1.8rem;font-weight:700;margin:0;letter-spacing:-.5px;">Panel Admin</h2>
            <p style="margin:6px 0 0;opacity:.9;font-size:.92rem;">Area II Cartagena</p>
        </div>
        
        <!-- Form -->
        <div style="padding:32px 24px;">
            <div style="margin-bottom:18px;">
                <label style="display:block;margin-bottom:8px;font-weight:600;color:var(--primary-dark);font-size:.9rem;text-transform:uppercase;letter-spacing:.05em;">ğŸ“§ Usuario</label>
                <input type="email" id="loginUsername" placeholder="admin@cartagena.es" spellcheck="false" style="width:100%;padding:14px 16px;border:2px solid var(--border);border-radius:10px;font-size:.95rem;font-family:var(--font-body);transition:.2s;background:var(--bg-main);" onfocus="this.style.borderColor='var(--primary)';this.style.boxShadow='0 0 0 4px rgba(26,107,74,.08)'" onblur="this.style.borderColor='var(--border)';this.style.boxShadow='none'">
            </div>
            
            <div style="margin-bottom:8px;">
                <label style="display:block;margin-bottom:8px;font-weight:600;color:var(--primary-dark);font-size:.9rem;text-transform:uppercase;letter-spacing:.05em;">ğŸ”‘ ContraseÃ±a</label>
                <div style="position:relative;">
                    <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width:100%;padding:14px 16px;padding-right:44px;border:2px solid var(--border);border-radius:10px;font-size:.95rem;font-family:var(--font-body);transition:.2s;background:var(--bg-main);" onfocus="this.style.borderColor='var(--primary)';this.style.boxShadow='0 0 0 4px rgba(26,107,74,.08)'" onblur="this.style.borderColor='var(--border)';this.style.boxShadow='none'">
                    <button onclick="togglePasswordVisibility()" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--text-muted);font-size:1.2rem;padding:0;">ğŸ‘ï¸</button>
                </div>
            </div>
            
            <div style="margin-bottom:24px;display:flex;gap:8px;align-items:center;">
                <input type="checkbox" id="rememberMe" style="width:16px;height:16px;cursor:pointer;">
                <label for="rememberMe" style="cursor:pointer;font-size:.88rem;color:var(--text-light);">RecuÃ©rdame en este dispositivo</label>
            </div>
            
            <button onclick="loginAdmin()" style="width:100%;background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;padding:14px;border:none;border-radius:10px;cursor:pointer;font-weight:700;font-size:.95rem;font-family:var(--font-body);transition:.2s;box-shadow:0 4px 12px rgba(26,107,74,.25);" onmouseover="this.style.boxShadow='0 6px 20px rgba(26,107,74,.35)';this.style.transform='translateY(-1px)'" onmouseout="this.style.boxShadow='0 4px 12px rgba(26,107,74,.25)';this.style.transform='translateY(0)'">
                <span id="loginBtnText">ğŸš€ Acceder</span>
            </button>
            
            <div id="loginError" style="margin-top:16px;padding:14px;background:#fee8e8;color:#c00;border:1px solid #f0b0b0;border-radius:10px;font-size:.88rem;display:none;font-weight:500;">
                <div style="display:flex;align-items:center;gap:8px;">
                    <span style="font-size:1rem;">âš ï¸</span>
                    <span id="loginErrorText">Credenciales incorrectas</span>
                </div>
            </div>
            
            <div id="loginSuccess" style="margin-top:16px;padding:14px;background:#e8f5e9;color:#2e7d32;border:1px solid #a5d6a7;border-radius:10px;font-size:.88rem;display:none;font-weight:500;">
                <div style="display:flex;align-items:center;gap:8px;animation:fadeIn .3s ease;">
                    <span style="font-size:1rem;">âœ…</span>
                    <span>Â¡Acceso concedido! Redirigiendo...</span>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div style="padding:16px 24px;background:var(--bg-main);border-top:1px solid var(--border);text-align:center;font-size:.78rem;color:var(--text-muted);">
            Credenciales seguras â€¢ SesiÃ³n encriptada
        </div>
    </div>
</div>

<style>
@keyframes slideInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
</style>

<!-- â•â•â•â•â•â•â• ADMIN PANEL MODAL â•â•â•â•â•â•â• -->
<div id="adminPanel" onclick="if(event.target===this)this.style.display='none'" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1001;overflow:auto;padding:20px;">
    <div style="background:#fff;border-radius:12px;padding:40px;max-width:600px;margin:40px auto;box-shadow:0 20px 60px rgba(0,0,0,.3);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;">
            <h2 style="font-family:var(--font-display);color:var(--primary-dark);font-size:1.5rem;">ğŸ‘¨â€ğŸ’¼ Panel Administrativo</h2>
            <div style="display:flex;gap:10px;align-items:center;">
                <button onclick="document.getElementById('adminPanel').style.display='none'" style="background:var(--bg-subtle);color:var(--text);padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:.85rem;font-family:var(--font-body);transition:.2s;" onmouseover="this.style.background='var(--border)'" onmouseout="this.style.background='var(--bg-subtle)'">âœ• Cerrar</button>
                <button onclick="logoutAdmin()" style="background:#c00;color:#fff;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:.85rem;font-family:var(--font-body);">Cerrar SesiÃ³n</button>
            </div>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:30px;">
            <button onclick="showUploadForm()" style="background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff;padding:20px;border:none;border-radius:12px;cursor:pointer;font-weight:600;font-size:.95rem;font-family:var(--font-body);text-align:left;">
                <div style="font-size:1.8rem;margin-bottom:8px;">ğŸ“¤</div>
                <div>Subir Archivos</div>
                <div style="font-size:.8rem;opacity:.8;margin-top:4px;">PDF, DOCX, PPTX...</div>
            </button>
            <button onclick="showCategoryForm()" style="background:linear-gradient(135deg,#238c62,#1a6b4a);color:#fff;padding:20px;border:none;border-radius:12px;cursor:pointer;font-weight:600;font-size:.95rem;font-family:var(--font-body);text-align:left;">
                <div style="font-size:1.8rem;margin-bottom:8px;">â•</div>
                <div>Crear CategorÃ­a</div>
                <div style="font-size:.8rem;opacity:.8;margin-top:4px;">Nueva especialidad</div>
            </button>
        </div>

        <!-- Upload Form -->
        <div id="uploadForm" style="display:none;background:var(--bg-main);border:2px dashed var(--primary);border-radius:12px;padding:24px;margin-bottom:24px;">
            <h3 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:16px;">ğŸ“¤ Subir Archivo</h3>
            <div style="margin-bottom:16px;">
                <label style="display:block;margin-bottom:6px;font-weight:600;color:var(--text);font-size:.92rem;">Archivo:</label>
                <input type="file" id="fileInput" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;font-size:.88rem;">
            </div>
            <div style="margin-bottom:16px;">
                <label style="display:block;margin-bottom:6px;font-weight:600;color:var(--text);font-size:.92rem;">CategorÃ­a:</label>
                <select id="fileCategory" style="width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:.92rem;font-family:var(--font-body);">
                    <option value="">-- Selecciona categorÃ­a --</option>
                    <option value="CardiologÃ­a">â¤ï¸ CardiologÃ­a</option>
                    <option value="DermatologÃ­a">ğŸ©¹ DermatologÃ­a</option>
                    <option value="Digestivo">ğŸ« Digestivo</option>
                    <option value="EndocrinologÃ­a">ğŸ§¬ EndocrinologÃ­a</option>
                    <option value="GeriatrÃ­a">ğŸ‘´ GeriatrÃ­a</option>
                    <option value="GinecologÃ­a">ğŸ¤° GinecologÃ­a</option>
                    <option value="NeurologÃ­a">ğŸ§  NeurologÃ­a</option>
                    <option value="NeumologÃ­a">ğŸ’¨ NeumologÃ­a</option>
                    <option value="PediatrÃ­a">ğŸ‘¶ PediatrÃ­a</option>
                    <option value="TraumatologÃ­a">ğŸ¦´ TraumatologÃ­a</option>
                    <option value="Protocolos MÃ©dicos">ğŸ“‹ Protocolos MÃ©dicos</option>
                </select>
            </div>
            <div style="display:flex;gap:10px;">
                <button onclick="uploadFile()" style="flex:1;background:var(--primary);color:#fff;padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.92rem;font-family:var(--font-body);">Subir</button>
                <button onclick="hideUploadForm()" style="flex:1;background:var(--border);color:var(--text);padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.92rem;font-family:var(--font-body);">Cancelar</button>
            </div>
            <div id="uploadStatus" style="margin-top:12px;display:none;padding:12px;background:#efe;color:#2a2;border-radius:6px;font-size:.88rem;"></div>
        </div>

        <!-- Category Form -->
        <div id="categoryForm" style="display:none;background:var(--bg-main);border:2px solid var(--primary);border-radius:12px;padding:24px;margin-bottom:24px;">
            <h3 style="font-family:var(--font-display);color:var(--primary-dark);margin-bottom:16px;">â• Nueva CategorÃ­a</h3>
            <div style="margin-bottom:16px;">
                <label style="display:block;margin-bottom:6px;font-weight:600;color:var(--text);font-size:.92rem;">Nombre:</label>
                <input type="text" id="catName" placeholder="Ej: OncologÃ­a" style="width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;font-size:.92rem;font-family:var(--font-body);">
            </div>
            <div style="margin-bottom:16px;">
                <label style="display:block;margin-bottom:6px;font-weight:600;color:var(--text);font-size:.92rem;">Emoji:</label>
                <input type="text" id="catEmoji" placeholder="ğŸ—ï¸" maxlength="2" style="width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;font-size:.92rem;font-family:var(--font-body);">
            </div>
            <div style="display:flex;gap:10px;">
                <button onclick="addCategory()" style="flex:1;background:var(--primary);color:#fff;padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.92rem;font-family:var(--font-body);">Crear</button>
                <button onclick="hideCategoryForm()" style="flex:1;background:var(--border);color:var(--text);padding:12px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:.92rem;font-family:var(--font-body);">Cancelar</button>
            </div>
            <div id="categoryStatus" style="margin-top:12px;display:none;padding:12px;background:#efe;color:#2a2;border-radius:6px;font-size:.88rem;"></div>
        </div>
    </div>
</div>

<script>
// â•â•â• PATIENTS DATA â•â•â•
var patientSections=[
    {icon:"ğŸ¥—",title:"Dietas",desc:"Planes nutricionales",url:"dietas.html"},
    {icon:"ğŸ’œ",title:"Violencia de gÃ©nero",desc:"Recursos y apoyo",url:"violencia-genero.html"},
    {icon:"ğŸ¤",title:"Recursos sociales",desc:"Servicios comunitarios",url:"recursos-sociales.html"},
    {icon:"â„¹ï¸",title:"InformaciÃ³n",desc:"Info general del centro",url:"informacion.html"},
    {icon:"âš ï¸",title:"Factores de riesgo",desc:"PrevenciÃ³n y salud",url:"factores-riesgo.html"},
    {icon:"ğŸƒ",title:"Ejercicios",desc:"GuÃ­as de actividad fÃ­sica",url:"ejercicios.html"},
    {icon:"ğŸ¦·",title:"Dentista",desc:"Salud bucodental",url:"dentista.html"},
    {icon:"ğŸ”—",title:"Enlaces de interÃ©s",desc:"Webs y recursos Ãºtiles",url:"enlaces-interes.html"},
    {icon:"ğŸ’‰",title:"Vacunas",desc:"Calendario y campaÃ±as",url:"vacunas.html"},
    {icon:"ğŸ“…",title:"ProgramaciÃ³n del Centro",desc:"Horarios y agenda",url:"programacion.html"},
    {icon:"ğŸš­",title:"Dejar de fumar",desc:"Programas y ayuda",url:"dejar-fumar.html"},
    {icon:"ğŸ™ï¸",title:"Podcast",desc:"Audio salud comunitaria",url:"podcast.html"}
];

function renderPatients(){
    var g=document.getElementById("patientsGrid");
    g.innerHTML=patientSections.map(function(s){return'<a class="patient-card" href="'+s.url+'" target="_blank"><div class="patient-card-icon">'+s.icon+'</div><div class="patient-card-title">'+s.title+'</div><div class="patient-card-desc">'+s.desc+'</div></a>'}).join("");
}

// â•â•â• ADMIN LOGIN - MEJORADO â•â•â•
var adminCredentials={username:"admin@cartagena.es",password:"Cartagena2026!"};
var isAdminLoggedIn=false;
var loginAttempts=0;
var lockoutTime=0;

function initLoginSession(){
    var savedSession=localStorage.getItem("adminSession");
    if(savedSession){
        try{
            var session=JSON.parse(savedSession);
            if(session.timestamp && Date.now()-session.timestamp<86400000){
                isAdminLoggedIn=true;
                document.getElementById("adminPanel").style.display="block";
                apShowAdminTab(true);
            }else{
                localStorage.removeItem("adminSession");
            }
        }catch(e){
            localStorage.removeItem("adminSession");
        }
    }
}

function showLoginModal(){
    if(!isAdminLoggedIn){
        document.getElementById("loginModal").style.display="flex";
        document.getElementById("loginUsername").focus();
        clearLoginForm();
    }
}

function closeLoginModal(){
    document.getElementById("loginModal").style.display="none";
    clearLoginForm();
}

function clearLoginForm(){
    document.getElementById("loginUsername").value="";
    document.getElementById("loginPassword").value="";
    document.getElementById("loginError").style.display="none";
    document.getElementById("loginSuccess").style.display="none";
}

function togglePasswordVisibility(){
    var input=document.getElementById("loginPassword");
    input.type=input.type==="password"?"text":"password";
}

function loginAdmin(){
    if(Date.now()<lockoutTime){
        showLoginError("Demasiados intentos. Intenta de nuevo en 5 minutos.");
        return;
    }
    
    var user=document.getElementById("loginUsername").value.trim();
    var pass=document.getElementById("loginPassword").value;
    
    if(!user||!pass){
        showLoginError("Por favor completa todos los campos");
        return;
    }
    
    document.getElementById("loginBtnText").textContent="â³ Verificando...";
    
    setTimeout(function(){
        if(user===adminCredentials.username&&pass===adminCredentials.password){
            loginAttempts=0;
            isAdminLoggedIn=true;
            
            if(document.getElementById("rememberMe").checked){
                localStorage.setItem("adminSession",JSON.stringify({
                    timestamp:Date.now(),
                    user:user
                }));
            }
            
            document.getElementById("loginSuccess").style.display="block";
            document.getElementById("loginError").style.display="none";
            
            setTimeout(function(){
                closeLoginModal();
                document.getElementById("adminPanel").style.display="block";
                document.getElementById("loginBtnText").textContent="ğŸš€ Acceder";
                apShowAdminTab(true);
            },800);
        }else{
            loginAttempts++;
            if(loginAttempts>=3){
                lockoutTime=Date.now()+300000;
                showLoginError("MÃ¡ximo de intentos excedido. Intenta en 5 minutos.");
            }else{
                showLoginError("Credenciales incorrectas (Intento "+(4-loginAttempts)+")");
            }
            document.getElementById("loginPassword").value="";
            document.getElementById("loginPassword").focus();
            document.getElementById("loginBtnText").textContent="ğŸš€ Acceder";
        }
    },600);
}

function showLoginError(msg){
    document.getElementById("loginErrorText").textContent=msg;
    document.getElementById("loginError").style.display="block";
    document.getElementById("loginSuccess").style.display="none";
}

function logoutAdmin(){
    isAdminLoggedIn=false;
    localStorage.removeItem("adminSession");
    document.getElementById("adminPanel").style.display="none";
    apShowAdminTab(false);
}

function showUploadForm(){document.getElementById("uploadForm").style.display="block";document.getElementById("categoryForm").style.display="none"}
function hideUploadForm(){document.getElementById("uploadForm").style.display="none"}
function showCategoryForm(){document.getElementById("categoryForm").style.display="block";document.getElementById("uploadForm").style.display="none"}
function hideCategoryForm(){document.getElementById("categoryForm").style.display="none"}
var uploadInProgress=false;
function uploadFile(){
    if(uploadInProgress)return;
    var file=document.getElementById("fileInput").files[0];
    var cat=document.getElementById("fileCategory").value;
    
    if(!file){
        showUploadError("Selecciona un archivo");
        return;
    }
    if(!cat){
        showUploadError("Selecciona una categorÃ­a");
        return;
    }
    
    var validTypes=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","image/jpeg","image/png"];
    if(!validTypes.includes(file.type)){
        showUploadError("Tipo de archivo no permitido. Usa: PDF, DOCX, XLS, PPTX, TXT, JPG, PNG");
        return;
    }
    
    if(file.size>52428800){
        showUploadError("El archivo es demasiado grande (mÃ¡ximo 50 MB)");
        return;
    }
    
    uploadInProgress=true;
    var statusDiv=document.getElementById("uploadStatus");
    statusDiv.innerHTML="ğŸ“¤ Subiendo "+file.name+" (0%)...";
    statusDiv.style.display="block";
    statusDiv.style.background="#e3f2fd";
    statusDiv.style.color="#1565c0";
    statusDiv.style.border="1px solid #90caf9";
    
    var fileName=cat+"/"+Date.now()+"_"+file.name;
    var storageRef=firebase.storage().ref(fileName);
    var uploadTask=storageRef.put(file);
    
    uploadTask.on('state_changed',
        function(snapshot){
            var progress=(snapshot.bytesTransferred/snapshot.totalBytes)*100;
            statusDiv.innerHTML="ğŸ“¤ Subiendo "+file.name+" ("+Math.round(progress)+"%)...";
        },
        function(error){
            uploadInProgress=false;
            showUploadError("Error al subir: "+error.message);
        },
        function(){
            uploadInProgress=false;
            uploadTask.snapshot.ref.getDownloadURL().then(function(downloadURL){
                saveDocumentMetadata(cat,file.name,downloadURL,file.size);
                statusDiv.innerHTML="âœ… Archivo subido correctamente: "+file.name;
                statusDiv.style.background="#e8f5e9";
                statusDiv.style.color="#2e7d32";
                statusDiv.style.border="1px solid #a5d6a7";
                document.getElementById("fileInput").value="";
                document.getElementById("fileCategory").value="";
                setTimeout(function(){statusDiv.style.display="none"},3000);
            });
        }
    );
}

function showUploadError(msg){
    var statusDiv=document.getElementById("uploadStatus");
    statusDiv.innerHTML="âŒ "+msg;
    statusDiv.style.display="block";
    statusDiv.style.background="#ffebee";
    statusDiv.style.color="#c62828";
    statusDiv.style.border="1px solid #ef9a9a";
}

function saveDocumentMetadata(category,fileName,downloadURL,fileSize){
    db.collection("documentos").add({
        categoria:category,
        nombre:fileName,
        url:downloadURL,
        tamaÃ±o:fileSize,
        uploadedAt:new Date(),
        uploadedBy:"admin"
    }).catch(function(error){
        console.error("Error guardando metadata: "+error.message);
    });
}
function addCategory(){var name=document.getElementById("catName").value;var emoji=document.getElementById("catEmoji").value;if(!name||!emoji){alert("Completa todos los campos");return}if(categories[name]){alert("Esa categorÃ­a ya existe");return}categories[name]=emoji;document.getElementById("catName").value="";document.getElementById("catEmoji").value="";var statusDiv=document.getElementById("categoryStatus");statusDiv.textContent="âœ… CategorÃ­a '"+name+"' creada correctamente";statusDiv.style.display="block";setTimeout(function(){statusDiv.style.display="none"},3000);actualizarUI()}

function switchProtocolTab(tabName,btnElement){
    var contents=document.querySelectorAll(".protocol-content");
    contents.forEach(function(content){content.style.display="none"});
    document.getElementById(tabName+"-content").style.display="block";
    
    var buttons=document.querySelectorAll(".tab-protocols");
    buttons.forEach(function(btn){btn.classList.remove("active")});
    btnElement.classList.add("active");
    
    // Sync AP config fields from shared CONFIG when opening config tab
    if(tabName==="config-protocolos"){apSyncFromConfig();}
}

// â•â•â• PROTOCOLOS AP CONFIG (uses shared CONFIG, unique IDs) â•â•â•
function apCambiarProvider(){
    var v=document.getElementById("apCfgProvider").value;
    document.getElementById("apGroqConfig").style.display=v==="groq"?"block":"none";
    document.getElementById("apQwenConfig").style.display=v==="qwen"?"block":"none";
}

function apSyncFromConfig(){
    try{
        document.getElementById("apCfgProvider").value=CONFIG.provider;
        apCambiarProvider();
        document.getElementById("apCfgGroqKey").value=CONFIG.groqKey||"";
        document.getElementById("apCfgGroqModel").value=CONFIG.groqModel;
        document.getElementById("apCfgQwenKey").value=CONFIG.qwenKey||"";
        document.getElementById("apCfgQwenModel").value=CONFIG.qwenModel;
    }catch(e){}
}

function apGuardarConfig(){
    CONFIG.provider=document.getElementById("apCfgProvider").value;
    CONFIG.groqKey=document.getElementById("apCfgGroqKey").value.trim();
    CONFIG.groqModel=document.getElementById("apCfgGroqModel").value;
    CONFIG.qwenKey=document.getElementById("apCfgQwenKey").value.trim();
    CONFIG.qwenModel=document.getElementById("apCfgQwenModel").value;
    localStorage.setItem("notebook_ai_cfg_v3",JSON.stringify(CONFIG));
    updateStatus();
    // Also sync the professionals config fields if they exist
    try{
        document.getElementById("cfgProvider").value=CONFIG.provider;
        cambiarProvider();
        document.getElementById("cfgGroqKey").value=CONFIG.groqKey;
        document.getElementById("cfgGroqModel").value=CONFIG.groqModel;
        document.getElementById("cfgQwenKey").value=CONFIG.qwenKey;
        document.getElementById("cfgQwenModel").value=CONFIG.qwenModel;
    }catch(e){}
    document.getElementById("apCfgStatus").innerHTML='<span style="color:var(--primary)">âœ… Guardado</span>';
    setTimeout(function(){document.getElementById("apCfgStatus").innerHTML=""},3000);
}

async function apTestApiKey(){
    apGuardarConfig();
    if(!isReady()){document.getElementById("apCfgStatus").innerHTML='<span style="color:#dc2626">âŒ Key invÃ¡lida</span>';return;}
    var st=document.getElementById("apCfgStatus");
    st.innerHTML='<span style="color:var(--accent)">â³ Probando...</span>';
    var e=ep();
    try{
        var r=await fetch(e.url,{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+e.getKey()},body:JSON.stringify({model:e.getModel(),messages:[{role:"user",content:"Di: OK"}],max_tokens:10})});
        if(r.ok)st.innerHTML='<span style="color:var(--primary)">âœ… Â¡ConexiÃ³n exitosa!</span>';
        else if(r.status===401)st.innerHTML='<span style="color:#dc2626">âŒ Key invÃ¡lida</span>';
        else st.innerHTML='<span style="color:#dc2626">âŒ Error '+r.status+'</span>';
    }catch(err){st.innerHTML='<span style="color:#dc2626">âŒ '+err.message+'</span>';}
}


// â•â•â• PROTOCOLOS AP - PREGUNTAS IA â•â•â•
var AP_PROTOCOL_TEXTS = {"1": "ORL en AtenciÃ³n Primaria\nUnidad 2 Â· OÃ­do, nariz, garganta, boca\nDolor de garganta (faringoamigdalitis)\n1\nCriterios Centor/McIsaac\nFiebre > 38Â°C, exudado amigdalar, adenopatÃ­a cervical anterior, ausencia de tos\n2\n0-1 criterios\nViral â†’ tratamiento sintomÃ¡tico (paracetamol/ibuprofeno)\n3\n2-3 criterios\nTest rÃ¡pido estreptococo (si disponible). Si positivo: antibiÃ³tico\n4\n4 criterios\nAlta probabilidad estreptococo â†’ penicilina V 500mg/8h x 10 dÃ­as o amoxicilina 500mg/8h x 10 dÃ­as\nII En alÃ©rgicos a penicilina: azitromicina 500mg/d x 3 dÃ­as o josamicina\nOtitis media aguda\nII Derivar urgente si: mastoiditis (dolor retroauricular, pabellÃ³n desplazado), parÃ¡lisis facial,\nmeningismo\n1\nDiagnÃ³stico\nOtalgia + otoscopia: tÃ­mpano abombado, eritematoso, con derrame\n2\nAdultos\nAmoxicilina 500mg/8h x 7 dÃ­as + analgesia\n3\nNiÃ±os > 2 aÃ±os\nSi leve y unilateral: observaciÃ³n 48-72h con analgesia. Si empeora: amoxicilina 80mg/kg/d\n4\nSi fallo\nAmoxicilina-clavulÃ¡nico. Derivar ORL si: otitis recurrente, perforaciÃ³n, mastoiditis\nEpistaxis â€” Manejo inicial\n1\nAnterior (90%)\nCompresiÃ³n digital alar 10-15 min con cabeza inclinada hacia delante\n2\nSi no cede\nTaponamiento anterior con gasa/esponja hemostÃ¡tica + vasoconstrictor tÃ³pico\n3\nPosterior\nNo cede con taponamiento anterior â†’ derivar urgencias ORL para taponamiento posterior\n4\nRecurrente\nDescartar HTA, coagulopatÃ­a, fÃ¡rmacos (anticoagulantes, AAS). Valorar cauterizaciÃ³n\nCentro de Salud Cartagena Este Â· Ficha de consulta rÃ¡pida Â· No sustituye juicio clÃ­nico", "2": "RiÃ±Ã³n y VÃ­as Urinarias\nUnidad 9 Â· Hematuria, ITU, cÃ³lico renal, incontinencia\nInfecciÃ³n urinaria en la mujer\n1\nCistitis no complicada\nDisuria + polaquiuria + urgencia sin fiebre â†’ fosfomicina 3g dosis Ãºnica o nitrofurantoÃ­na 5 dÃ­as\n2\nPielonefritis\nFiebre + dolor lumbar + MEG â†’ analÃ­tica + urocultivo + ECO. Cefuroxima vo o derivar si grave\n3\nRecurrente (>= 3/aÃ±o)\nProfilaxis: arÃ¡ndano rojo, profilaxis antibiÃ³tica postcoital, estrÃ³genos vaginales en postmenopÃ¡usicas\n4\nEn embarazo\nBacteriuria asintomÃ¡tica SIEMPRE tratar. Urocultivo obligatorio en 1er trimestre\nII En mujer joven con clÃ­nica tÃ­pica no es necesario urocultivo previo. SÃ­ en: recurrentes, embarazo, fallo\ntratamiento\nCÃ³lico renal\n1\nDiagnÃ³stico\nDolor lumbar cÃ³lico irradiado a genitales + agitaciÃ³n + nÃ¡useas. Tira reactiva: microhematuria\n2\nTratamiento\nDiclofenaco 75mg im (1Âª elecciÃ³n) o metamizol 2g iv. Evitar espasmolÃ­ticos solos\n3\nImagen\nECO renal (dilataciÃ³n) â†’ si duda: TC sin contraste (gold standard)\n4\nDerivar\nFiebre (pionefrosis), anuria, riÃ±Ã³n Ãºnico, litiasis > 10mm, dolor refractario\nII Litiasis < 5mm: 90% expulsiÃ³n espontÃ¡nea. Tamsulosina 0.4mg puede facilitar expulsiÃ³n (terapia expulsiva)\nHematuria â€” Estudio diagnÃ³stico\nII Hematuria macroscÃ³pica indolora en > 40 aÃ±os: descartar neoplasia vesical/renal hasta demostrar lo\ncontrario\n1\nConfirmar\nSedimento urinario (>3 hematÃ­es/campo). Descartar falsos positivos: menstruaciÃ³n, ejercicio intenso\n2\nAnalÃ­tica\nFunciÃ³n renal, hemograma, coagulaciÃ³n\n3\nImagen\nECO renal + vesical. Si > 40 aÃ±os: derivar UrologÃ­a para cistoscopia\n4\nGlomerular\nHematÃ­es dismÃ³rficos + cilindros + proteinuria â†’ derivar NefrologÃ­a\nCentro de Salud Cartagena Este Â· Ficha de consulta rÃ¡pida Â· No sustituye juicio clÃ­nico", "3": "DermatologÃ­a en AP\nUnidad 10 Â· Lesiones cutÃ¡neas, acnÃ©, prurito, Ãºlceras\nLunares â€” Regla ABCDE\nII Derivar urgente si cumple criterios ABCDE o \"patito feo\" (lesiÃ³n diferente a las demÃ¡s del paciente)\n1\nA - AsimetrÃ­a\nMitad no es espejo de la otra\n2\nB - Bordes\nIrregulares, mal definidos, dentados\n3\nC - Color\nHeterogÃ©neo: marrÃ³n, negro, rojo, blanco, azul\n4\nD - DiÃ¡metro\n> 6mm (aunque melanomas pequeÃ±os existen)\n5\nE - EvoluciÃ³n\nCambio reciente en tamaÃ±o, forma, color, sÃ­ntomas\nII Dermatoscopia en AP mejora sensibilidad al 90%. Ante duda: derivar, NUNCA cauterizar sin biopsia previa\nAcnÃ© â€” Tratamiento escalonado\n1\nLeve comedonal\nRetinoides tÃ³picos (adapaleno 0.1%) por la noche\n2\nLeve inflamatorio\nPerÃ³xido de benzoilo 5% + adapaleno (combinaciÃ³n fija)\n3\nModerado\nAÃ±adir antibiÃ³tico tÃ³pico (clindamicina 1%) o doxiciclina oral 100mg/d x 3 meses\n4\nGrave/nodular\nDerivar DermatologÃ­a â†’ isotretinoÃ­na oral (requiere anticoncepciÃ³n en mujeres)\nII No usar antibiÃ³tico tÃ³pico en monoterapia (resistencias). Siempre combinar con perÃ³xido de benzoilo\nPrurito generalizado sin lesiones\n1\nDescartar\nHepatopatÃ­a (colestasis), IRC, hipo/hipertiroidismo, diabetes, linfoma, policitemia, ferropenia\n2\nAnalÃ­tica\nHemograma, funciÃ³n hepÃ¡tica, renal, TSH, glucosa, hierro, ferritina, Rx tÃ³rax\n3\nTratamiento\nHidrataciÃ³n cutÃ¡nea intensa + antihistamÃ­nicos (cetirizina, loratadina)\n4\nSi normal\nPrurito psicÃ³geno o senil â†’ emolientes + antiH1 sedante nocturno (hidroxicina)\nCentro de Salud Cartagena Este Â· Ficha de consulta rÃ¡pida Â· No sustituye juicio clÃ­nico", "4": "MusculoesquelÃ©tico\nUnidad 11 Â· Cervicalgia, lumbalgia, hombro, rodilla\nLumbalgia â€” Algoritmo de manejo\nII Red flags: < 20 o > 55 aÃ±os, traumatismo, pÃ©rdida peso, fiebre, dÃ©ficit neurolÃ³gico progresivo,\nsÃ­ndrome cauda equina\n1\nValoraciÃ³n\nAnamnesis + exploraciÃ³n: LasÃ¨gue, fuerza, sensibilidad, reflejos. Sin red flags â†’ inespecÃ­fica\n2\nInespecÃ­fica\nNo Rx. Paracetamol/AINE + mantener actividad + evitar reposo > 48h\n3\n> 6 semanas\nRx lumbar + analÃ­tica (VSG, hemograma). Valorar fisioterapia\n4\nCon ciÃ¡tica\nSi dÃ©ficit motor progresivo o cauda equina â†’ RM urgente y derivaciÃ³n\nII El 90% de lumbalgias se resuelven en 4-6 semanas. Ejercicio y actividad son el mejor tratamiento\nCervicalgia\n1\nSin alarma\nContractura cervical mecÃ¡nica â†’ calor local, analgesia, movilizaciÃ³n precoz\n2\nCon radiculopatÃ­a\nDolor irradiado + parestesias en dermatoma â†’ RM si dÃ©ficit motor o sin mejorÃ­a en 6 sem\n3\nRed flags\nMielopatÃ­a cervical (torpeza manos, marcha espÃ¡stica) â†’ RM urgente\nII No indicada Rx de rutina. Solo si: traumatismo, sospecha de fractura, criterios de Ottawa/Canadian C-Spine\nDolor de hombro\n1\nLo mÃ¡s frecuente\nTendinopatÃ­a del manguito rotador (supraespinoso): dolor lateral, arco doloroso 60-120Â°\n2\nExploraciÃ³n\nArco doloroso, maniobras de Neer, Hawkins, Jobe, Speed. Movilidad pasiva conservada\n3\nTratamiento\nAINE + ejercicios de rehabilitaciÃ³n. No infiltrar antes de 3-4 semanas de fisioterapia\n4\nDerivar\nSi rotura completa, hombro congelado refractario, inestabilidad â†’ ECO/RM + TraumatologÃ­a\nCausa articular\nâ€¢ Movilidad pasiva limitada\nâ€¢ Capsulitis adhesiva\nâ€¢ Artritis acromioclavicular\nâ€¢ Artrosis glenohumeral\nCausa periarticular\nâ€¢ Movilidad pasiva conservada\nâ€¢ TendinopatÃ­a manguito\nâ€¢ Bursitis subacromial\nâ€¢ Tendinitis bicipital\nCentro de Salud Cartagena Este Â· Ficha de consulta rÃ¡pida Â· No sustituye juicio clÃ­nico", "5": "Enfermedades CrÃ³nicas\nUnidad 15 Â· HTA, diabetes, dislipemia, EPOC, asma\nHipertensiÃ³n arterial\n1\nDiagnÃ³stico\nMedia de 2-3 mediciones en 2-3 visitas. Confirmar con AMPA/MAPA (descarta bata blanca)\n2\nObjetivos\nGeneral: < 140/90. DiabÃ©ticos: < 130/80. Ancianos frÃ¡giles: < 150/90\n3\nTratamiento\nMedidas higiÃ©nico-dietÃ©ticas 3-6 meses â†’ si no control: monoterapia â†’ combinaciÃ³n\n4\nFÃ¡rmacos\nIECA/ARA II + tiazida o calcioantagonista como combinaciones preferidas\nPrimera lÃ­nea\nâ€¢ IECA (enalapril, ramipril)\nâ€¢ ARA II (losartÃ¡n, valsartÃ¡n)\nâ€¢ Calcioantagonistas (amlodipino)\nâ€¢ Tiazidas (hidroclorotiazida)\nSeguimiento\nâ€¢ Control 1-3 meses hasta objetivo\nâ€¢ AnalÃ­tica anual (creatinina, K, perfil lipÃ­dico)\nâ€¢ ECG bianual\nâ€¢ Valorar LOD\nDiabetes mellitus tipo 2\n1\nDiagnÃ³stico\nGlucemia ayunas >= 126 (x2) o HbA1c >= 6.5% (x2) o glucemia al azar >= 200 + sÃ­ntomas\n2\nObjetivo HbA1c\nGeneral: < 7%. Ancianos/frÃ¡giles: < 8%. JÃ³venes sin complicaciones: < 6.5%\n3\nInicio\nMetformina + dieta + ejercicio. Titular hasta 2g/dÃ­a\n4\nSi no control\nAÃ±adir iSGLT2 (si IC/ERC) o arGLP1 (si obesidad/RCV alto) o iDPP4 o SU\nII Control mÃ­nimo: HbA1c cada 3-6 meses, funciÃ³n renal anual, fondo de ojo anual, exploraciÃ³n pies anual\nEPOC â€” Manejo estable\n1\nDiagnÃ³stico\nEspirometrÃ­a: FEV1/FVC < 0.7 postbroncodilataciÃ³n en fumador/exfumador con sÃ­ntomas\n2\nClasificaciÃ³n\nGOLD: FEV1 > 80% leve, 50-80% moderado, 30-50% grave, < 30% muy grave\n3\nTratamiento base\nAbandono tabaco (lo mÃ¡s importante) + vacunaciÃ³n gripe/neumococo + actividad fÃ­sica\n4\nBroncodilatadores\nLAMA (tiotropio) y/o LABA (indacaterol, olodaterol). Si exacerbaciones: aÃ±adir CI\nGrupo A (bajo riesgo)\nâ€¢ SABA a demanda\nâ€¢ o LAMA/LABA si sÃ­ntomas persistentes\nGrupo E (exacerbador)\nâ€¢ LAMA + LABA\nâ€¢ Si eosinÃ³filos > 300: aÃ±adir CI\nâ€¢ Si infecciones: valorar azitromicina\nAsma â€” Control y tratamiento\nII Crisis asmÃ¡tica: SABA 4-10 puffs cada 20 min x 1h + corticoides orales. Si no mejora: urgencias\n1\nDiagnÃ³stico\nClÃ­nica compatible + espirometrÃ­a con prueba broncodilatadora positiva (aumento FEV1 > 12% y >\n200ml)\n2\nControl\nACT (Asthma Control Test) >= 20 = bien controlado. < 20 = subir escalÃ³n\n3\nEscalÃ³n 1\nSABA a demanda (o CI + formoterol a demanda - GINA 2024)\n4\nEscalÃ³n 2-3\nCI dosis baja + LABA (budesonida/formoterol, fluticasona/salmeterol)\n5\nEscalÃ³n 4-5\nCI dosis media-alta + LABA. Valorar anticolinÃ©rgico, biolÃ³gicos â†’ derivar\nCentro de Salud Cartagena Este Â· Ficha de consulta rÃ¡pida Â· No sustituye juicio clÃ­nico", "6": "Salud Mental\nUnidad 6 Â· Ansiedad, depresiÃ³n, insomnio\nAnsiedad â€” Manejo en AP\n1\nDiagnÃ³stico\nSÃ­ntomas > 6 meses: preocupaciÃ³n excesiva, tensiÃ³n, irritabilidad, insomnio, somatizaciones\n2\nDescartar\nHipertiroidismo, feocromocitoma, arritmias, EPOC, fÃ¡rmacos/drogas, abstinencia\n3\nTratamiento inicial\nPsicoeducaciÃ³n + tÃ©cnicas de relajaciÃ³n + ejercicio fÃ­sico regular\n4\nFarmacolÃ³gico\nISRS (sertralina, escitalopram) como primera lÃ­nea. BZD solo puntual y corto plazo (< 4 sem)\nII Escalas: GAD-7 (cribado y seguimiento). Derivar a Salud Mental si: resistencia a tratamiento, comorbilidad\ngrave\nDepresiÃ³n â€” DiagnÃ³stico y tratamiento\nII Preguntar SIEMPRE por ideaciÃ³n suicida. No aumenta el riesgo preguntar, sÃ­ disminuye\n1\nCribado\nPHQ-2: Ã¡nimo bajo + anhedonia > 2 semanas. Si positivo â†’ PHQ-9 completo\n2\nAnalÃ­tica\nDescartar hipotiroidismo, anemia, dÃ©ficit B12, hepatopatÃ­a\n3\nLeve\nPsicoeducaciÃ³n + activaciÃ³n conductual + ejercicio + seguimiento estrecho\n4\nModerada-grave\nISRS (sertralina 50-200mg, escitalopram 10-20mg). Esperar 4-6 sem para evaluar respuesta\n5\nSin respuesta\nOptimizar dosis â†’ cambiar ISRS â†’ aÃ±adir/cambiar a otro grupo â†’ derivar Salud Mental\nPrimera lÃ­nea (ISRS)\nâ€¢ Sertralina 50-200mg/d\nâ€¢ Escitalopram 10-20mg/d\nâ€¢ Fluoxetina 20-60mg/d\nâ€¢ Paroxetina 20-50mg/d\nSegunda lÃ­nea\nâ€¢ Venlafaxina 75-225mg/d\nâ€¢ Duloxetina 60-120mg/d\nâ€¢ Mirtazapina 15-45mg/d\nâ€¢ Bupropion 150-300mg/d\nInsomnio â€” Abordaje escalonado\n1\nHigiene del sueÃ±o\nHorarios regulares, evitar pantallas, cafeÃ­na, alcohol, ejercicio por la tarde\n2\nTerapia cognitivo-conductual\nRestricciÃ³n de sueÃ±o + control de estÃ­mulos. MÃ¡s eficaz que fÃ¡rmacos a largo plazo\n3\nSi fÃ¡rmaco necesario\nCorto plazo (< 4 sem): zolpidem 5-10mg, lormetazepam 1mg\n4\nCrÃ³nico\nValorar: depresiÃ³n, SAOS, piernas inquietas, dolor crÃ³nico como causa subyacente\nII Evitar benzodiacepinas de vida media larga en ancianos (riesgo caÃ­das, deterioro cognitivo)\nCentro de Salud Cartagena Este Â· Ficha de consulta rÃ¡pida Â· No sustituye juicio clÃ­nico", "7": "Sistema Nervioso\nUnidad 5 Â· Cefalea, vÃ©rtigo, convulsiones, pÃ©rdida de fuerza, memoria\nCefalea â€” DiagnÃ³stico diferencial\nII Red flags: inicio brusco (\"la peor de mi vida\"), focalidad neurolÃ³gica, fiebre + rigidez nuca, > 50 aÃ±os\ninicio nuevo, papiledema\n1\nTensional\nBilateral, opresiva, intensidad leve-moderada, no empeora con actividad â†’ analgesia simple\n2\nMigraÃ±a\nUnilateral, pulsÃ¡til, moderada-intensa, con nÃ¡useas/foto-fonofobia â†’ triptanes en crisis\n3\nEn racimos\nUnilateral periorbital, muy intensa, lagrimeo/rinorrea ipsilateral, 15-180 min â†’ O2 + sumatriptÃ¡n sc\n4\nSecundaria\nSi red flags â†’ TAC/RM urgente. Descartar HSA, meningitis, masa, trombosis venosa\nII Cefalea por abuso de analgÃ©sicos: > 15 dÃ­as/mes con analgÃ©sicos > 3 meses. Tratamiento: retirada\nprogresiva\nMareo y vÃ©rtigo\n1\nDistinguir\nVÃ©rtigo (giro) vs mareo inespecÃ­fico vs presÃ­ncope vs inestabilidad\n2\nPerifÃ©rico\nInicio brusco, nistagmo horizonto-rotatorio, Romberg lateralizado, sin focalidad â†’ VPPB, neuronitis,\nMÃ©niÃ¨re\n3\nCentral\nNistagmo vertical/cambiante, focalidad neurolÃ³gica, ataxia de tronco â†’ derivar urgente (ictus\ncerebeloso)\n4\nVPPB\nEpisodios breves con cambios posturales â†’ maniobra de Dix-Hallpike â†’ maniobra de Epley\nPerifÃ©rico (benigno)\nâ€¢ Inicio sÃºbito\nâ€¢ Nistagmo horizontal\nâ€¢ SÃ­ntomas vegetativos ++\nâ€¢ Mejora con fijaciÃ³n visual\nCentral (urgente)\nâ€¢ Inicio progresivo\nâ€¢ Nistagmo vertical/multidireccional\nâ€¢ Focalidad neurolÃ³gica\nâ€¢ No mejora con fijaciÃ³n\nConvulsiones en el adulto\nII Estatus epilÃ©ptico (> 5 min): emergencia â†’ diazepam 10mg rectal o iv, asegurar vÃ­a aÃ©rea, 112\n1\nEn crisis\nProteger, posiciÃ³n lateral, NO introducir objetos en boca, cronometrar duraciÃ³n\n2\nPost-crisis\nGlucemia capilar, constantes, exploraciÃ³n neurolÃ³gica, buscar traumatismos\n3\nPrimera crisis\nSIEMPRE derivar: analÃ­tica + TAC/RM + EEG para estudio etiolÃ³gico\n4\nEpilepsia conocida\nVerificar adherencia, niveles fÃ¡rmaco, desencadenantes (alcohol, privaciÃ³n sueÃ±o)\nII Crisis provocadas frecuentes: hipoglucemia, alcohol (abstinencia), fÃ¡rmacos, fiebre, TCE reciente\nPÃ©rdida de fuerza â€” Enfoque diagnÃ³stico\nII Derivar urgente si: instalaciÃ³n aguda, asimetrÃ­a, trastorno del habla (cÃ³digo ictus)\n1\nAguda\nIctus/AIT hasta demostrar lo contrario â†’ activar cÃ³digo ictus si < 4.5h\n2\nSubaguda\nGuillain-BarrÃ© (ascendente), miastenia (fluctuante, ocular), mielopatÃ­a compresiva\n3\nCrÃ³nica\nELA (fasciculaciones + atrofia), neuropatÃ­a perifÃ©rica, miopatÃ­as\n4\nLocalizar\nMotoneurona superior (espasticidad, Babinski+) vs inferior (atrofia, fasciculaciones, arreflexia)\nPÃ©rdida de memoria â€” ValoraciÃ³n\n1\nDescartar\nDepresiÃ³n, fÃ¡rmacos (benzodiacepinas, anticolinÃ©rgicos), hipotiroidismo, dÃ©ficit B12\n2\nTest cribado\nMini-Mental (MMSE), test del reloj, MoCA. Valorar funcionalidad (Barthel, Lawton)\n3\nDeterioro cognitivo leve\nQueja subjetiva + test alterado + funcionalidad conservada â†’ seguimiento 6-12 meses\n4\nDemencia\nDeterioro progresivo + pÃ©rdida funcional â†’ analÃ­tica + neuroimagen â†’ derivar NeurologÃ­a\nII AnalÃ­tica: hemograma, TSH, B12, Ã¡cido fÃ³lico, glucosa, funciÃ³n renal y hepÃ¡tica, serologÃ­a lÃºes y VIH si\nindicado\nCentro de Salud Cartagena Este Â· Ficha de consulta rÃ¡pida Â· No sustituye juicio clÃ­nico", "8": "Problemas Digestivos\nUnidad 4 Â· Dolor abdominal, diarrea, hemorragia digestiva, ictericia\nDolor abdominal agudo\nII Derivar urgente: defensa abdominal, signos peritoneales, fiebre alta, hipotensiÃ³n, vÃ³mitos\nfecaloideos\n1\nLocalizaciÃ³n\nEpigÃ¡strico: Ãºlcera, pancreatitis. FID: apendicitis. FII: diverticulitis. Difuso: obstrucciÃ³n, peritonitis\n2\nAnalÃ­tica urgente\nHemograma, PCR, amilasa, lipasa, funciÃ³n hepÃ¡tica, orina\n3\nImagen\nRx abdomen (niveles, neumoperitoneo) + ECO abdominal\n4\nMujer edad fÃ©rtil\nSIEMPRE descartar embarazo ectÃ³pico: test de embarazo\nCausas frecuentes en AP\nâ€¢ Gastroenteritis aguda\nâ€¢ CÃ³lico biliar\nâ€¢ InfecciÃ³n urinaria\nâ€¢ Dolor funcional\nRed flags\nâ€¢ Peritonismo\nâ€¢ Masa pulsÃ¡til (AAA)\nâ€¢ Rectorragia con hipotensiÃ³n\nâ€¢ Dolor + fiebre + ictericia (Charcot)\nDiarrea aguda\n1\nValorar\nDuraciÃ³n, frecuencia, sangre/moco, fiebre, viajes, fÃ¡rmacos (ATB), brotes\n2\nLeve sin alarma\nDieta astringente + hidrataciÃ³n oral (SRO). Autolimitada en 3-5 dÃ­as\n3\nGrave o persistente\nCoprocultivo + parÃ¡sitos en heces. AnalÃ­tica si deshidrataciÃ³n\n4\nAntibiÃ³tico\nSolo si: fiebre alta + sangre en heces, inmunodeprimido, viajero con sospecha bacteriana\nII La causa mÃ¡s frecuente es vÃ­rica (norovirus, rotavirus). No pautar antidiarreicos si fiebre o sangre en heces\nHemorragia digestiva alta (hematemesis)\nII URGENCIA: estabilizar hemodinÃ¡micamente. VÃ­a venosa, sueroterapia, derivar hospital\n1\nConfirmar\nDistinguir hematemesis de hemoptisis y epistaxis deglutida\n2\nEstabilizar\nPA, FC, vÃ­a venosa, analÃ­tica urgente, grupo y reserva\n3\nIBP iv\nOmeprazol 80mg iv en bolo, luego perfusiÃ³n\n4\nEndoscopia\nEn las primeras 24h. DiagnÃ³stica y terapÃ©utica\nCausas principales: Ãºlcera pÃ©ptica (50%), varices esofÃ¡gicas, Mallory-Weiss, esofagitis\nIctericia en el adulto\n1\nAnalÃ­tica\nBilirrubina total y fracciones, GOT, GPT, GGT, FA, hemograma, coagulaciÃ³n\n2\nPrehepÃ¡tica\nBilirrubina indirecta elevada â†’ hemÃ³lisis, Gilbert, eritropoyesis ineficaz\n3\nHepÃ¡tica\nTransaminasas muy elevadas â†’ hepatitis viral, tÃ³xica, alcohÃ³lica, autoinmune\n4\nPosthepÃ¡tica\nGGT y FA elevadas + coluria â†’ ECO abdominal: dilataciÃ³n vÃ­a biliar â†’ CPRE/colangio-RM\nII SÃ­ndrome de Gilbert: bilirrubina indirecta < 3mg/dl, resto normal. Benigno, no requiere tratamiento\nCentro de Salud Cartagena Este Â· Ficha de consulta rÃ¡pida Â· No sustituye juicio clÃ­nico", "9": "Problemas Digestivos\nUnidad 4 Â· Dolor abdominal, diarrea, hemorragia digestiva, ictericia\nDolor abdominal agudo\nII Derivar urgente: defensa abdominal, signos peritoneales, fiebre alta, hipotensiÃ³n, vÃ³mitos\nfecaloideos\n1\nLocalizaciÃ³n\nEpigÃ¡strico: Ãºlcera, pancreatitis. FID: apendicitis. FII: diverticulitis. Difuso: obstrucciÃ³n, peritonitis\n2\nAnalÃ­tica urgente\nHemograma, PCR, amilasa, lipasa, funciÃ³n hepÃ¡tica, orina\n3\nImagen\nRx abdomen (niveles, neumoperitoneo) + ECO abdominal\n4\nMujer edad fÃ©rtil\nSIEMPRE descartar embarazo ectÃ³pico: test de embarazo\nCausas frecuentes en AP\nâ€¢ Gastroenteritis aguda\nâ€¢ CÃ³lico biliar\nâ€¢ InfecciÃ³n urinaria\nâ€¢ Dolor funcional\nRed flags\nâ€¢ Peritonismo\nâ€¢ Masa pulsÃ¡til (AAA)\nâ€¢ Rectorragia con hipotensiÃ³n\nâ€¢ Dolor + fiebre + ictericia (Charcot)\nDiarrea aguda\n1\nValorar\nDuraciÃ³n, frecuencia, sangre/moco, fiebre, viajes, fÃ¡rmacos (ATB), brotes\n2\nLeve sin alarma\nDieta astringente + hidrataciÃ³n oral (SRO). Autolimitada en 3-5 dÃ­as\n3\nGrave o persistente\nCoprocultivo + parÃ¡sitos en heces. AnalÃ­tica si deshidrataciÃ³n\n4\nAntibiÃ³tico\nSolo si: fiebre alta + sangre en heces, inmunodeprimido, viajero con sospecha bacteriana\nII La causa mÃ¡s frecuente es vÃ­rica (norovirus, rotavirus). No pautar antidiarreicos si fiebre o sangre en heces\nHemorragia digestiva alta (hematemesis)\nII URGENCIA: estabilizar hemodinÃ¡micamente. VÃ­a venosa, sueroterapia, derivar hospital\n1\nConfirmar\nDistinguir hematemesis de hemoptisis y epistaxis deglutida\n2\nEstabilizar\nPA, FC, vÃ­a venosa, analÃ­tica urgente, grupo y reserva\n3\nIBP iv\nOmeprazol 80mg iv en bolo, luego perfusiÃ³n\n4\nEndoscopia\nEn las primeras 24h. DiagnÃ³stica y terapÃ©utica\nCausas principales: Ãºlcera pÃ©ptica (50%), varices esofÃ¡gicas, Mallory-Weiss, esofagitis\nIctericia en el adulto\n1\nAnalÃ­tica\nBilirrubina total y fracciones, GOT, GPT, GGT, FA, hemograma, coagulaciÃ³n\n2\nPrehepÃ¡tica\nBilirrubina indirecta elevada â†’ hemÃ³lisis, Gilbert, eritropoyesis ineficaz\n3\nHepÃ¡tica\nTransaminasas muy elevadas â†’ hepatitis viral, tÃ³xica, alcohÃ³lica, autoinmune\n4\nPosthepÃ¡tica\nGGT y FA elevadas + coluria â†’ ECO abdominal: dilataciÃ³n vÃ­a biliar â†’ CPRE/colangio-RM\nII SÃ­ndrome de Gilbert: bilirrubina indirecta < 3mg/dl, resto normal. Benigno, no requiere tratamiento\nCentro de Salud Cartagena Este Â· Ficha de consulta rÃ¡pida Â· No sustituye juicio clÃ­nico", "10": "Respiratorio y Cardiovascular\nUnidad 3 Â· Dolor torÃ¡cico, disnea, tos, palpitaciones, sÃ­ncope\nDolor torÃ¡cico â€” ValoraciÃ³n inicial\nII SCA: derivar 112/urgencias si dolor opresivo + cortejo vegetativo + cambios ECG + troponina elevada\n1\nTriaje\nPA, FC, SatO2, ECG 12 derivaciones en < 10 min\n2\nAnginoso\nOpresivo, retroesternal, irradiado a brazo/mandÃ­bula, con esfuerzo â†’ SCA hasta demostrar lo contrario\n3\nPleurÃ­tico\nPunzante, aumenta con respiraciÃ³n â†’ Rx tÃ³rax: descartar neumotÃ³rax, TEP, neumonÃ­a\n4\nMusculoesquelÃ©tico\nReproducible a la palpaciÃ³n, postural â†’ tranquilizar + analgesia\n5\nOtras causas\nERGE (pirosis), ansiedad (parestesias), herpes zÃ³ster (vesÃ­culas)\nII ECG normal NO descarta SCA. Si alta sospecha clÃ­nica â†’ derivar igualmente\nDisnea â€” Abordaje diagnÃ³stico\n1\nAguda\nSatO2, ECG, Rx tÃ³rax â†’ IC descompensada, TEP, neumotÃ³rax, crisis asmÃ¡tica, neumonÃ­a\n2\nCrÃ³nica\nEspirometrÃ­a + Rx tÃ³rax + hemograma + proBNP â†’ EPOC, ICC, anemia, fibrosis\n3\nFuncional\nSuspiros frecuentes, parestesias, ansiedad â†’ hiperventilaciÃ³n funcional\nRed flags (derivar urgente)\nâ€¢ SatO2 < 90%\nâ€¢ Estridor o tiraje\nâ€¢ Cianosis\nâ€¢ AlteraciÃ³n conciencia\nâ€¢ Dolor torÃ¡cico asociado\nEscalas Ãºtiles\nâ€¢ mMRC para disnea crÃ³nica\nâ€¢ NYHA para IC\nâ€¢ Escala de Borg\nâ€¢ Test de marcha 6 min\nTos â€” Algoritmo diagnÃ³stico\n1\nAguda (< 3 sem)\nLo mÃ¡s frecuente: infecciÃ³n viral vÃ­as altas â†’ tratamiento sintomÃ¡tico\n2\nSubaguda (3-8 sem)\nPost-infecciosa habitual. Si persiste: Rx tÃ³rax\n3\nCrÃ³nica (> 8 sem)\n3 causas mÃ¡s frecuentes: goteo postnasal, asma, ERGE\n4\nEstudio crÃ³nica\nRx tÃ³rax + espirometrÃ­a + test broncodilataciÃ³n + valorar pHmetrÃ­a\nII Revisar siempre fÃ¡rmacos: IECAs causan tos seca en 5-20% de pacientes. Suspender y esperar 4 semanas\nPalpitaciones y pulso rÃ¡pido\n1\nAnamnesis\nInicio/fin brusco vs gradual, duraciÃ³n, sÃ­ntomas asociados, cafeÃ­na, fÃ¡rmacos\n2\nExploraciÃ³n\nPA, FC, ritmo regular/irregular, soplos, signos de IC, tiroides\n3\nECG\nRitmo sinusal, FA, flutter, TPSV, extrasÃ­stoles\n4\nSi paroxÃ­sticas\nHolter 24h. Si muy infrecuentes: registrador de eventos\nBenignas (frecuente)\nâ€¢ ExtrasÃ­stoles aisladas\nâ€¢ Taquicardia sinusal\nâ€¢ Ansiedad/estrÃ©s\nâ€¢ CafeÃ­na/estimulantes\nPotencialmente graves\nâ€¢ FA con respuesta ventricular rÃ¡pida\nâ€¢ TPSV recurrente\nâ€¢ TV (QRS ancho)\nâ€¢ Asociadas a sÃ­ncope/disnea\nSÃ­ncope â€” Protocolo de estudio\nII Derivar urgente si: sÃ­ncope de esfuerzo, dolor torÃ¡cico previo, palpitaciones, soplo, antecedente\nfamiliar de muerte sÃºbita\n1\nValoraciÃ³n inicial\nAnamnesis detallada: prÃ³dromos, posiciÃ³n, desencadenantes, testigos, recuperaciÃ³n\n2\nExploraciÃ³n\nPA en ambos brazos, ortostatismo (3 min), FC, ACR, neurolÃ³gica\n3\nECG\nObligatorio en todo sÃ­ncope. Buscar: bloqueos, preexcitaciÃ³n, QT largo, Brugada\n4\nVasovagal\nPrÃ³dromos claros, desencadenante, recuperaciÃ³n rÃ¡pida â†’ tranquilizar, medidas posturales\n5\nSi duda\nEcocardiograma + Holter + tilt test segÃºn sospecha\nEnfermedad tromboembÃ³lica venosa\nII TEP: derivar urgente si disnea sÃºbita + dolor pleurÃ­tico + taquicardia + factores de riesgo\n1\nTVP sospecha\nEscala de Wells â†’ si probabilidad alta o intermedia: eco-Doppler venoso\n2\nD-dÃ­mero\nSolo Ãºtil para EXCLUIR si probabilidad baja (valor predictivo negativo alto)\n3\nTEP sospecha\nEscala de Wells + angio-TAC pulmonar. GasometrÃ­a: hipoxemia + hipocapnia\n4\nTratamiento\nAnticoagulaciÃ³n: HBPM â†’ luego ACOD o acenocumarol segÃºn perfil\nII Factores de riesgo: inmovilizaciÃ³n, cirugÃ­a reciente, neoplasia, ACO, trombofilia, viajes largos\nCentro de Salud Cartagena Este Â· Ficha de consulta rÃ¡pida Â· No sustituye juicio clÃ­nico"};
var apPreguntas = [];
var apProcessing = false;

function apQuickAsk(q) {
    document.getElementById('apPreguntaInput').value = q;
    apHacerPregunta();
}

async function apHacerPregunta() {
    var input = document.getElementById('apPreguntaInput');
    var q = input.value.trim();
    if (!q || apProcessing) return;
    if (!isReady()) {
        switchProtocolTab('config-protocolos', document.querySelectorAll('.tab-protocols')[2]);
        return;
    }
    apProcessing = true;
    document.getElementById('apBtnPreguntar').disabled = true;
    
    var sel = document.getElementById('apProtoSelect').value;
    var contextText = '';
    if (sel === 'all') {
        for (var k in AP_PROTOCOL_TEXTS) contextText += '\n\n--- PROTOCOLO ' + k + ' ---\n' + AP_PROTOCOL_TEXTS[k];
        var custom = apGetCustomProtocols();
        for (var i = 0; i < custom.length; i++) contextText += '\n\n--- ' + custom[i].name + ' ---\n' + custom[i].content;
    } else if (sel.indexOf('custom_') === 0) {
        var cIdx = parseInt(sel.replace('custom_', ''));
        var cList = apGetCustomProtocols();
        if (cList[cIdx]) contextText = cList[cIdx].content;
    } else {
        contextText = AP_PROTOCOL_TEXTS[sel] || '';
    }
    
    apPreguntas.push({ pregunta: q, respuesta: 'â³ Consultando...', fecha: new Date().toLocaleString('es-ES') });
    input.value = '';
    apRenderPreguntas();
    
    var sys = 'Eres un asistente mÃ©dico experto en AtenciÃ³n Primaria. Responde basÃ¡ndote ÃšNICAMENTE en el contenido de los protocolos proporcionados. Si la informaciÃ³n no estÃ¡ en los protocolos, indÃ­calo. Responde en espaÃ±ol de forma clara y estructurada.\n\nCONTENIDO DE LOS PROTOCOLOS:\n' + contextText;
    
    var r = await llamarIA(q, sys);
    apPreguntas[apPreguntas.length - 1].respuesta = r;
    apRenderPreguntas();
    apProcessing = false;
    document.getElementById('apBtnPreguntar').disabled = false;
}

function apRenderPreguntas() {
    var el = document.getElementById('apPreguntasList');
    if (apPreguntas.length === 0) {
        el.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ©º</div><p>Haz tu primera pregunta sobre los protocolos</p></div>';
        return;
    }
    el.innerHTML = apPreguntas.slice().reverse().map(function(p) {
        return '<div class="question-box"><div class="question-text">' + esc(p.pregunta) + '</div><div class="answer-text">' + esc(p.respuesta) + '</div><div class="note-time">' + p.fecha + '</div></div>';
    }).join('');
}

document.addEventListener('DOMContentLoaded', function() {
    var apInput = document.getElementById('apPreguntaInput');
    if (apInput) apInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') apHacerPregunta(); });
});

// â•â•â• ADMIN - GESTIÃ“N PROTOCOLOS PERSONALIZADOS â•â•â•
function apShowAdminTab(show){
    var btn=document.getElementById('apAdminTabBtn');
    if(btn) btn.style.display=show?'inline-block':'none';
    if(!show){
        // Si estamos en la pestaÃ±a admin y hacemos logout, volver a generales
        var adminContent=document.getElementById('admin-protocolos-content');
        if(adminContent && adminContent.style.display==='block'){
            switchProtocolTab('generales',document.querySelector('.tab-protocols'));
        }
    }
}

function apGetCustomProtocols(){
    try{ return JSON.parse(localStorage.getItem('ap_custom_protocols'))||[]; }catch(e){ return []; }
}

function apSaveCustomProtocols(list){
    localStorage.setItem('ap_custom_protocols',JSON.stringify(list));
}

function apLoadFileContent(){
    var fileInput=document.getElementById('apProtoFile');
    if(!fileInput.files.length)return;
    var file=fileInput.files[0];
    var reader=new FileReader();
    reader.onload=function(e){
        document.getElementById('apNewProtoContent').value=e.target.result;
        // Auto-fill name from filename if empty
        var nameInput=document.getElementById('apNewProtoName');
        if(!nameInput.value.trim()){
            nameInput.value=file.name.replace(/\.txt$/i,'').replace(/[-_]/g,' ');
        }
    };
    reader.readAsText(file);
}

function apAddProtocol(){
    var name=document.getElementById('apNewProtoName').value.trim();
    var content=document.getElementById('apNewProtoContent').value.trim();
    var status=document.getElementById('apAddStatus');
    
    if(!name){
        status.innerHTML='<span style="color:#dc2626">âŒ Escribe un nombre para el protocolo</span>';
        return;
    }
    if(!content || content.length<50){
        status.innerHTML='<span style="color:#dc2626">âŒ El contenido es demasiado corto (mÃ­nimo 50 caracteres)</span>';
        return;
    }
    
    var list=apGetCustomProtocols();
    list.push({
        name: name,
        content: content,
        date: new Date().toLocaleString('es-ES'),
        chars: content.length
    });
    apSaveCustomProtocols(list);
    
    // Clear form
    document.getElementById('apNewProtoName').value='';
    document.getElementById('apNewProtoContent').value='';
    document.getElementById('apProtoFile').value='';
    
    status.innerHTML='<span style="color:var(--primary)">âœ… Protocolo "'+esc(name)+'" aÃ±adido correctamente</span>';
    setTimeout(function(){ status.innerHTML=''; },4000);
    
    apRenderCustomList();
    apUpdateProtoSelector();
}

function apDeleteProtocol(idx){
    var list=apGetCustomProtocols();
    if(idx<0||idx>=list.length)return;
    var name=list[idx].name;
    if(!confirm('Â¿Eliminar el protocolo "'+name+'"?\n\nEsta acciÃ³n no se puede deshacer.'))return;
    list.splice(idx,1);
    apSaveCustomProtocols(list);
    apRenderCustomList();
    apUpdateProtoSelector();
}

function apRenderCustomList(){
    var el=document.getElementById('apCustomProtosList');
    var list=apGetCustomProtocols();
    
    if(list.length===0){
        el.innerHTML='<div class="empty-state" style="padding:24px;"><div class="empty-state-icon">ğŸ“­</div><p>No hay protocolos personalizados aÃºn</p></div>';
        return;
    }
    
    el.innerHTML=list.map(function(p,i){
        return '<div style="background:var(--bg-main);padding:14px 16px;border-radius:8px;margin-bottom:10px;border-left:4px solid var(--primary);display:flex;justify-content:space-between;align-items:center;gap:12px;">'
            +'<div style="flex:1;min-width:0;">'
            +'<div style="font-weight:600;color:var(--text);font-size:.92rem;margin-bottom:3px;">ğŸ“„ '+esc(p.name)+'</div>'
            +'<div style="font-size:.78rem;color:var(--text-muted);">'+p.chars+' caracteres Â· AÃ±adido '+p.date+'</div>'
            +'</div>'
            +'<div style="display:flex;gap:6px;flex-shrink:0;">'
            +'<button onclick="apPreviewProtocol('+i+')" style="padding:6px 10px;background:var(--bg-card);border:1px solid var(--border);border-radius:6px;cursor:pointer;font-size:.82rem;color:var(--primary);font-family:var(--font-body);" title="Vista previa">ğŸ‘ï¸</button>'
            +'<button onclick="apDeleteProtocol('+i+')" style="padding:6px 10px;background:#fee;border:1px solid #fcc;border-radius:6px;cursor:pointer;font-size:.82rem;color:#c00;font-family:var(--font-body);" title="Eliminar">ğŸ—‘ï¸</button>'
            +'</div>'
            +'</div>';
    }).join('');
}

function apPreviewProtocol(idx){
    var list=apGetCustomProtocols();
    if(!list[idx])return;
    var p=list[idx];
    var preview=p.content.length>500?p.content.substring(0,500)+'...\n\n['+p.content.length+' caracteres en total]':p.content;
    alert('ğŸ“„ '+p.name+'\n\n'+preview);
}

function apUpdateProtoSelector(){
    var sel=document.getElementById('apProtoSelect');
    if(!sel)return;
    
    // Remove old custom options
    var opts=sel.querySelectorAll('option[value^="custom_"]');
    for(var i=0;i<opts.length;i++) opts[i].remove();
    
    // Add custom protocols
    var list=apGetCustomProtocols();
    if(list.length>0){
        for(var i=0;i<list.length;i++){
            var opt=document.createElement('option');
            opt.value='custom_'+i;
            opt.textContent='â­ '+list[i].name;
            sel.appendChild(opt);
        }
    }
}

// Initialize custom protocols on page load
document.addEventListener('DOMContentLoaded',function(){
    setTimeout(function(){
        apRenderCustomList();
        apUpdateProtoSelector();
    },100);
});



// â•â•â• PROTOCOLOS URGENCIAS - DATOS Y FUNCIONES â•â•â•
var URG_PROTOCOLS = {"semfyc-fiebre-sin-foco": {"title": "Fiebre sin Focalidad Aparente", "category": "AtenciÃ³n Primaria", "text": "Fiebre sin Focalidad Aparente\n\nAbordaje de fiebre sin foco evidente tras anamnesis y exploraciÃ³n.\n\nIndicaciones: Temperatura â‰¥ 38Â°C sin foco claro.\n\nPasos:\n1. Anamnesis detallada: Viajes, contactos, medicaciÃ³n.\n2. ExploraciÃ³n completa por aparatos.\n3. AnalÃ­tica bÃ¡sica + Sedimento urinario.\n4. Si persiste \\u003e 3 semanas: Fiebre de origen desconocido (FOD).\n\nTratamiento:\nAntitÃ©rmicos sintomÃ¡ticos.\nAntibiÃ³tico solo si foco identificado.\n\nâš ï¸ Alertas:\nFiebre \\u003e 40Â°C, inmunodepresiÃ³n o signos de sepsis: DerivaciÃ³n urgente.", "pdfUrl": "", "summary": "Abordaje de fiebre sin foco evidente tras anamnesis y exploraciÃ³n.", "indications": "Temperatura â‰¥ 38Â°C sin foco claro.", "isTriptico": false}, "semfyc-epistaxis": {"title": "Epistaxis (Hemorragia Nasal)", "category": "OtorrinolaringologÃ­a", "text": "Epistaxis (Hemorragia Nasal)\n\nSangrado nasal. Manejo inicial y criterios de derivaciÃ³n.\n\nIndicaciones: Sangrado por fosas nasales.\n\nPasos:\n1. CompresiÃ³n digital 10-15 min con cabeza hacia delante.\n2. Localizar punto sangrante (Plexo de Kiesselbach).\n3. CauterizaciÃ³n con nitrato de plata si localizado.\n4. Taponamiento anterior si fracaso.\n\nTratamiento:\nÃcido tranexÃ¡mico tÃ³pico.\nControl de HTA si presente.\n\nâš ï¸ Alertas:\nEpistaxis posterior (sangre por faringe): DerivaciÃ³n urgente ORL.", "pdfUrl": "", "summary": "Sangrado nasal. Manejo inicial y criterios de derivaciÃ³n.", "indications": "Sangrado por fosas nasales.", "isTriptico": false}, "semfyc-dolor-toracico-anginoso": {"title": "Dolor TorÃ¡cico Anginoso", "category": "Urgencias CV", "text": "Dolor TorÃ¡cico Anginoso\n\nDolor torÃ¡cico sugestivo de isquemia coronaria.\n\nIndicaciones: Dolor opresivo retroesternal, irradiado a brazo/mandÃ­bula.\n\nPasos:\n1. ECG inmediato (\\u003c 10 min).\n2. Valorar caracterÃ­sticas del dolor.\n3. Si elevaciÃ³n ST: CÃ³digo Infarto.\n4. Si no elevaciÃ³n ST: Troponinas + ObservaciÃ³n.\n\nTratamiento:\nAAS 300mg masticado.\nNitroglicerina sublingual.\n\nâš ï¸ Alertas:\nDolor \\u003e 20 min: Activar CÃ³digo Infarto.", "pdfUrl": "https://drive.google.com/file/d/1G4dH2RytZ36MgXuiMmf6GVc43wO-moCy/preview", "summary": "Dolor torÃ¡cico sugestivo de isquemia coronaria.", "indications": "Dolor opresivo retroesternal, irradiado a brazo/mandÃ­bula.", "isTriptico": true}, "semfyc-disnea-aguda": {"title": "Disnea Aguda", "category": "Urgencias Respiratorio", "text": "Disnea Aguda\n\nDificultad respiratoria de inicio sÃºbito.\n\nIndicaciones: SensaciÃ³n de falta de aire de inicio reciente.\n\nPasos:\n1. Valorar gravedad: SatO2, FR, trabajo respiratorio.\n2. Causas frecuentes: Asma, EPOC, ICC, TEP, neumotÃ³rax.\n3. Rx tÃ³rax + ECG + GasometrÃ­a.\n4. Tratamiento segÃºn etiologÃ­a.\n\nTratamiento:\nO2 si SatO2 \\u003c 92%.\nBroncodilatadores si broncoespasmo.\n\nâš ï¸ Alertas:\nSatO2 \\u003c 90% o trabajo respiratorio intenso: DerivaciÃ³n urgente.", "pdfUrl": "", "summary": "Dificultad respiratoria de inicio sÃºbito.", "indications": "SensaciÃ³n de falta de aire de inicio reciente.", "isTriptico": false}, "semfyc-hemoptisis": {"title": "Hemoptisis", "category": "Urgencias Respiratorio", "text": "Hemoptisis\n\nExpectoraciÃ³n de sangre procedente del tracto respiratorio.\n\nIndicaciones: Esputo con sangre.\n\nPasos:\n1. Cuantificar: Leve (\\u003c 30ml/24h) vs Masiva (\\u003e 200ml/24h).\n2. Descartar pseudohemoptisis (epistaxis, hematemesis).\n3. Rx tÃ³rax.\n4. DerivaciÃ³n segÃºn gravedad.\n\nTratamiento:\nReposo.\nÃcido tranexÃ¡mico.\n\nâš ï¸ Alertas:\nHemoptisis masiva: DerivaciÃ³n urgente.", "pdfUrl": "", "summary": "ExpectoraciÃ³n de sangre procedente del tracto respiratorio.", "indications": "Esputo con sangre.", "isTriptico": false}, "semfyc-sincope": {"title": "SÃ­ncope", "category": "Urgencias CV", "text": "SÃ­ncope\n\nPÃ©rdida transitoria de conciencia con recuperaciÃ³n espontÃ¡nea.\n\nIndicaciones: Episodio de pÃ©rdida de conciencia.\n\nPasos:\n1. Diferenciar de crisis epilÃ©ptica, hipoglucemia.\n2. Causas: Vasovagal, cardiogÃ©nico, ortostÃ¡tico.\n3. ECG + TA tumbado y de pie.\n4. EstratificaciÃ³n de riesgo.\n\nTratamiento:\nSegÃºn etiologÃ­a.\n\nâš ï¸ Alertas:\nSÃ­ncope de esfuerzo o con palpitaciones: ECG urgente.", "pdfUrl": "https://drive.google.com/file/d/159RUw8bx2aAAQisTRcjl5fOGAt79544W/preview", "summary": "PÃ©rdida transitoria de conciencia con recuperaciÃ³n espontÃ¡nea.", "indications": "Episodio de pÃ©rdida de conciencia.", "isTriptico": true}, "semfyc-dolor-abdominal-agudo": {"title": "Dolor Abdominal Agudo", "category": "Urgencias General", "text": "Dolor Abdominal Agudo\n\nAbdomen agudo. Identificar causa quirÃºrgica.\n\nIndicaciones: Dolor abdominal de inicio sÃºbito.\n\nPasos:\n1. LocalizaciÃ³n: Difuso vs Localizado.\n2. Signos de irritaciÃ³n peritoneal.\n3. AnalÃ­tica + Rx abdomen.\n4. EcografÃ­a/TC si sospecha quirÃºrgica.\n\nTratamiento:\nNo analgesia hasta valoraciÃ³n quirÃºrgica (controvertido).\n\nâš ï¸ Alertas:\nDefensa abdominal: DerivaciÃ³n urgente CirugÃ­a.", "pdfUrl": "", "summary": "Abdomen agudo. Identificar causa quirÃºrgica.", "indications": "Dolor abdominal de inicio sÃºbito.", "isTriptico": false}, "semfyc-cefalea": {"title": "Dolor de Cabeza (Cefalea)", "category": "Urgencias Neuro", "text": "Dolor de Cabeza (Cefalea)\n\nCefalea primaria vs secundaria.\n\nIndicaciones: Dolor de cabeza.\n\nPasos:\n1. Signos de alarma: Inicio sÃºbito, fiebre, focalidad.\n2. Primarias: MigraÃ±a, tensional, cluster.\n3. Secundarias: Meningitis, HSA, tumor.\n4. TC craneal si signos de alarma.\n\nTratamiento:\nAINE.\nTriptanes si migraÃ±a.\n\nâš ï¸ Alertas:\nCefalea en trueno: TC craneal urgente (descartar HSA).", "pdfUrl": "https://drive.google.com/file/d/1dyt23QPIRHouWH2Wjh9ttBy6Tqoz71X9/preview", "summary": "Cefalea primaria vs secundaria.", "indications": "Dolor de cabeza.", "isTriptico": true}, "semfyc-paralisis-facial": {"title": "ParÃ¡lisis Facial", "category": "Urgencias Neuro", "text": "ParÃ¡lisis Facial\n\nParÃ¡lisis facial perifÃ©rica (Bell) vs central (ACV).\n\nIndicaciones: Debilidad facial unilateral.\n\nPasos:\n1. PerifÃ©rica: Afecta frente. Central: Respeta frente.\n2. Si central: CÃ³digo Ictus.\n3. Si perifÃ©rica: ParÃ¡lisis de Bell.\n4. Corticoides en primeras 72h.\n\nTratamiento:\nPrednisona 60mg/dÃ­a 7 dÃ­as.\nProtecciÃ³n ocular.\n\nâš ï¸ Alertas:\nParÃ¡lisis facial central: Activar CÃ³digo Ictus.", "pdfUrl": "", "summary": "ParÃ¡lisis facial perifÃ©rica (Bell) vs central (ACV).", "indications": "Debilidad facial unilateral.", "isTriptico": false}, "semfyc-convulsiones": {"title": "Convulsiones en el Adulto", "category": "Urgencias Neuro", "text": "Convulsiones en el Adulto\n\nCrisis epilÃ©ptica. Primera crisis vs epilepsia conocida.\n\nIndicaciones: Episodio convulsivo.\n\nPasos:\n1. Descartar causas: Hipoglucemia, tÃ³xicos, fiebre.\n2. Primera crisis: TC craneal + EEG.\n3. Iniciar antiepilÃ©ptico si indicado.\n4. DerivaciÃ³n a NeurologÃ­a.\n\nTratamiento:\nDiazepam rectal si crisis activa.\n\nâš ï¸ Alertas:\nStatus epilÃ©ptico (\\u003e 5 min): DerivaciÃ³n urgente.", "pdfUrl": "", "summary": "Crisis epilÃ©ptica. Primera crisis vs epilepsia conocida.", "indications": "Episodio convulsivo.", "isTriptico": false}, "semfyc-perdida-fuerza": {"title": "PÃ©rdida de Fuerza", "category": "Urgencias Neuro", "text": "PÃ©rdida de Fuerza\n\nDebilidad muscular. Descartar ACV.\n\nIndicaciones: Debilidad en extremidades.\n\nPasos:\n1. Inicio sÃºbito: CÃ³digo Ictus.\n2. Progresivo: Guillain-BarrÃ©, ELA, miastenia.\n3. ExploraciÃ³n neurolÃ³gica completa.\n4. DerivaciÃ³n segÃºn sospecha.\n\nTratamiento:\nSegÃºn etiologÃ­a.\n\nâš ï¸ Alertas:\nDebilidad sÃºbita: Activar CÃ³digo Ictus.", "pdfUrl": "", "summary": "Debilidad muscular. Descartar ACV.", "indications": "Debilidad en extremidades.", "isTriptico": false}, "semfyc-colico-renal": {"title": "CÃ³lico Renal", "category": "Urgencias General", "text": "CÃ³lico Renal\n\nDolor por litiasis urinaria.\n\nIndicaciones: Dolor lumbar irradiado a genitales.\n\nPasos:\n1. Analgesia potente.\n2. EcografÃ­a renal.\n3. HidrataciÃ³n.\n4. DerivaciÃ³n a UrologÃ­a si complicado.\n\nTratamiento:\nMetamizol 2g IV.\nDiclofenaco 75mg IM.\n\nâš ï¸ Alertas:\nAnuria o fiebre: DerivaciÃ³n urgente.", "pdfUrl": "https://drive.google.com/file/d/1b1oCYwB2kmR7kIOfucRK5UvsSN0hrU3-/preview", "summary": "Dolor por litiasis urinaria.", "indications": "Dolor lumbar irradiado a genitales.", "isTriptico": true}, "semfyc-monoartritis": {"title": "Monoartritis Aguda", "category": "ReumatologÃ­a", "text": "Monoartritis Aguda\n\nArticulaciÃ³n caliente e inflamada. Descartar artritis sÃ©ptica.\n\nIndicaciones: Dolor, rubor, calor en una articulaciÃ³n.\n\nPasos:\n1. Artrocentesis.\n2. AnÃ¡lisis lÃ­quido sinovial.\n3. Descartar: SÃ©ptica, gotosa, pseudogota.\n4. AntibiÃ³tico si sÃ©ptica.\n\nTratamiento:\nColchicina si gota.\nCeftriaxona si sÃ©ptica.\n\nâš ï¸ Alertas:\nFiebre + monoartritis: Artritis sÃ©ptica hasta demostrar lo contrario.", "pdfUrl": "https://drive.google.com/file/d/16r1Ot9_6SbA3D9eodPG-5vRBatjRJFqi/preview", "summary": "ArticulaciÃ³n caliente e inflamada. Descartar artritis sÃ©ptica.", "indications": "Dolor, rubor, calor en una articulaciÃ³n.", "isTriptico": true}, "semfyc-ojo-rojo": {"title": "Ojo Rojo", "category": "OftalmologÃ­a", "text": "Ojo Rojo\n\nHiperemia conjuntival. Descartar glaucoma agudo.\n\nIndicaciones: Enrojecimiento ocular.\n\nPasos:\n1. Con dolor: Glaucoma, queratitis, uveÃ­tis.\n2. Sin dolor: Conjuntivitis, hemorragia subconjuntival.\n3. MediciÃ³n PIO si sospecha glaucoma.\n4. DerivaciÃ³n a OftalmologÃ­a si dudas.\n\nTratamiento:\nColirio antibiÃ³tico si conjuntivitis.\n\nâš ï¸ Alertas:\nOjo rojo + dolor + visiÃ³n borrosa: Glaucoma agudo.", "pdfUrl": "", "summary": "Hiperemia conjuntival. Descartar glaucoma agudo.", "indications": "Enrojecimiento ocular.", "isTriptico": false}, "semfyc-perdida-vision": {"title": "DisminuciÃ³n de la Agudeza Visual", "category": "OftalmologÃ­a", "text": "DisminuciÃ³n de la Agudeza Visual\n\nPÃ©rdida de visiÃ³n. Descartar causa urgente.\n\nIndicaciones: VisiÃ³n borrosa o pÃ©rdida visual.\n\nPasos:\n1. Aguda vs CrÃ³nica.\n2. Aguda: Desprendimiento retina, oclusiÃ³n vascular.\n3. CrÃ³nica: Cataratas, DMAE, glaucoma.\n4. DerivaciÃ³n urgente si aguda.\n\nTratamiento:\nSegÃºn etiologÃ­a.\n\nâš ï¸ Alertas:\nPÃ©rdida visual sÃºbita: DerivaciÃ³n urgente OftalmologÃ­a.", "pdfUrl": "", "summary": "PÃ©rdida de visiÃ³n. Descartar causa urgente.", "indications": "VisiÃ³n borrosa o pÃ©rdida visual.", "isTriptico": false}, "semfyc-fiebre-pediatrica": {"title": "Fiebre en el NiÃ±o", "category": "PediatrÃ­a", "text": "Fiebre en el NiÃ±o\n\nManejo de la fiebre pediÃ¡trica.\n\nIndicaciones: Temperatura â‰¥ 38Â°C.\n\nPasos:\n1. Valorar estado general.\n2. Buscar foco infeccioso.\n3. Signos de alarma: Petequias, decaimiento, rigidez.\n4. AntitÃ©rmicos.\n\nTratamiento:\nParacetamol 15mg/kg/6h.\nIbuprofeno 10mg/kg/8h.\n\nâš ï¸ Alertas:\nFiebre \\u003c 3 meses: ValoraciÃ³n urgente.", "pdfUrl": "", "summary": "Manejo de la fiebre pediÃ¡trica.", "indications": "Temperatura â‰¥ 38Â°C.", "isTriptico": false}, "trip-diverticulitis": {"title": "Diverticulitis Aguda", "category": "Digestivo", "text": "Diverticulitis Aguda\n\nInflamaciÃ³n de los divertÃ­culos del colon. Consulta el trÃ­ptico para detalles.\n\nIndicaciones: Dolor en FII, fiebre, alteraciÃ³n del hÃ¡bito intestinal.", "pdfUrl": "https://drive.google.com/file/d/1sHBEehuuCilWmm-V9cL8jW_G4WxlMr7K/preview", "summary": "InflamaciÃ³n de los divertÃ­culos del colon. Consulta el trÃ­ptico para detalles.", "indications": "Dolor en FII, fiebre, alteraciÃ³n del hÃ¡bito intestinal.", "isTriptico": true}, "trip-hemorragia-digestiva": {"title": "Hemorragia Digestiva", "category": "Digestivo", "text": "Hemorragia Digestiva\n\nProtocolo de manejo de hemorragia digestiva alta y baja.\n\nIndicaciones: Hematemesis, melenas o rectorragia.", "pdfUrl": "https://drive.google.com/file/d/1ps0HHuQYWlsd3ES2nNyeTzBRybGtaEM2/preview", "summary": "Protocolo de manejo de hemorragia digestiva alta y baja.", "indications": "Hematemesis, melenas o rectorragia.", "isTriptico": true}, "trip-patologia-biliar": {"title": "PatologÃ­a Biliar (CÃ³lico/Colecistitis)", "category": "Digestivo", "text": "PatologÃ­a Biliar (CÃ³lico/Colecistitis)\n\nManejo del cÃ³lico biliar, colecistitis y colangitis.\n\nIndicaciones: Dolor en hipocondrio derecho, fiebre, ictericia.", "pdfUrl": "https://drive.google.com/file/d/1gWo3J2GloEENIoO3GpLUFOCdp8GX5-JN/preview", "summary": "Manejo del cÃ³lico biliar, colecistitis y colangitis.", "indications": "Dolor en hipocondrio derecho, fiebre, ictericia.", "isTriptico": true}, "trip-pancreatitis": {"title": "Pancreatitis Aguda", "category": "Digestivo", "text": "Pancreatitis Aguda\n\nInflamaciÃ³n aguda del pÃ¡ncreas. DiagnÃ³stico y manejo inicial.\n\nIndicaciones: Dolor epigÃ¡strico en cinturÃ³n, elevaciÃ³n amilasa/lipasa.", "pdfUrl": "https://drive.google.com/file/d/1gTbT_nvv1Q5CPAXaBpKe9MmOrQGl367f/preview", "summary": "InflamaciÃ³n aguda del pÃ¡ncreas. DiagnÃ³stico y manejo inicial.", "indications": "Dolor epigÃ¡strico en cinturÃ³n, elevaciÃ³n amilasa/lipasa.", "isTriptico": true}, "trip-insuficiencia-cardiaca": {"title": "Insuficiencia CardÃ­aca Aguda", "category": "CardiologÃ­a", "text": "Insuficiencia CardÃ­aca Aguda\n\nManejo de la descompensaciÃ³n de IC y EAP.\n\nIndicaciones: Disnea, ortopnea, edemas, crepitantes.", "pdfUrl": "https://drive.google.com/file/d/1HPv8FG4IRbvQrBtYCjfwuF6e0wp-GSTW/preview", "summary": "Manejo de la descompensaciÃ³n de IC y EAP.", "indications": "Disnea, ortopnea, edemas, crepitantes.", "isTriptico": true}, "trip-fibrilacion-auricular": {"title": "FibrilaciÃ³n Auricular", "category": "CardiologÃ­a", "text": "FibrilaciÃ³n Auricular\n\nManejo de la FA aguda y crÃ³nica en urgencias.\n\nIndicaciones: Palpitaciones, ritmo irregular, disnea.", "pdfUrl": "https://drive.google.com/file/d/1edF_YZy1C-9TjCdc9UOKbxXcbNHWiCCN/preview", "summary": "Manejo de la FA aguda y crÃ³nica en urgencias.", "indications": "Palpitaciones, ritmo irregular, disnea.", "isTriptico": true}, "trip-emergencias-hiperglucemicas": {"title": "Emergencias HiperglucÃ©micas", "category": "EndocrinologÃ­a", "text": "Emergencias HiperglucÃ©micas\n\nCetoacidosis diabÃ©tica y estado hiperosmolar.\n\nIndicaciones: Hiperglucemia severa, deshidrataciÃ³n, alteraciÃ³n del estado mental.", "pdfUrl": "https://drive.google.com/file/d/1IV5hjBoJwitJp8WGsPb3SJpvgDLTQs5a/preview", "summary": "Cetoacidosis diabÃ©tica y estado hiperosmolar.", "indications": "Hiperglucemia severa, deshidrataciÃ³n, alteraciÃ³n del estado mental.", "isTriptico": true}, "trip-insulinizacion": {"title": "InsulinizaciÃ³n en Urgencias", "category": "EndocrinologÃ­a", "text": "InsulinizaciÃ³n en Urgencias\n\nPautas de insulinizaciÃ³n basal y correcciÃ³n en el paciente agudo.\n\nIndicaciones: Hiperglucemia no controlada en medio hospitalario.", "pdfUrl": "https://drive.google.com/file/d/1dManw-ahn89mmmwBGqv8KmxAZ_i8OzlU/preview", "summary": "Pautas de insulinizaciÃ³n basal y correcciÃ³n en el paciente agudo.", "indications": "Hiperglucemia no controlada en medio hospitalario.", "isTriptico": true}, "trip-hiperpotasemia": {"title": "Hiperpotasemia (Hiperkalemia)", "category": "NefrologÃ­a", "text": "Hiperpotasemia (Hiperkalemia)\n\nManejo urgente de la hiperpotasemia grave.\n\nIndicaciones: K > 5.5 mEq/L, cambios ECG.", "pdfUrl": "https://drive.google.com/file/d/1TRokzomeGn62tHafbLL9dS0up64hTbzl/preview", "summary": "Manejo urgente de la hiperpotasemia grave.", "indications": "K > 5.5 mEq/L, cambios ECG.", "isTriptico": true}, "trip-hipopotasemia": {"title": "Hipopotasemia (Hipokalemia)", "category": "NefrologÃ­a", "text": "Hipopotasemia (Hipokalemia)\n\nReposiciÃ³n de potasio en urgencias.\n\nIndicaciones: K < 3.5 mEq/L, debilidad muscular, arritmias.", "pdfUrl": "https://drive.google.com/file/d/1Bc7PNzezC1zrTKzc6PyCl-R41vKwjXMp/preview", "summary": "ReposiciÃ³n de potasio en urgencias.", "indications": "K < 3.5 mEq/L, debilidad muscular, arritmias.", "isTriptico": true}, "trip-insuficiencia-renal": {"title": "Insuficiencia Renal Aguda", "category": "NefrologÃ­a", "text": "Insuficiencia Renal Aguda\n\nAbordaje del fracaso renal agudo (prerrenal, renal, postrenal).\n\nIndicaciones: ElevaciÃ³n de creatinina, oliguria.", "pdfUrl": "https://drive.google.com/file/d/1cyIZiZEuEhqqk9php_9KVceOXD-TKnMd/preview", "summary": "Abordaje del fracaso renal agudo (prerrenal, renal, postrenal).", "indications": "ElevaciÃ³n de creatinina, oliguria.", "isTriptico": true}, "trip-colico-nefritico": {"title": "CÃ³lico NefrÃ­tico", "category": "UrologÃ­a", "text": "CÃ³lico NefrÃ­tico\n\nManejo del dolor y criterios de derivaciÃ³n/ingreso en litiasis renal.\n\nIndicaciones: Dolor en fosa renal irradiado a genitales, nÃ¡useas, cortejo vegetativo.", "pdfUrl": "https://drive.google.com/file/d/1b1oCYwB2kmR7kIOfucRK5UvsSN0hrU3-/preview", "summary": "Manejo del dolor y criterios de derivaciÃ³n/ingreso en litiasis renal.", "indications": "Dolor en fosa renal irradiado a genitales, nÃ¡useas, cortejo vegetativo.", "isTriptico": true}, "trip-rao": {"title": "RetenciÃ³n Aguda de Orina (RAO)", "category": "UrologÃ­a", "text": "RetenciÃ³n Aguda de Orina (RAO)\n\nManejo de la retenciÃ³n urinaria y sondaje vesical.\n\nIndicaciones: Imposibilidad para orinar, dolor suprapÃºbico, globo vesical.", "pdfUrl": "https://drive.google.com/file/d/1yAkV_aRKgJ3vsvFkeB9VhjuNwzc4q84E/preview", "summary": "Manejo de la retenciÃ³n urinaria y sondaje vesical.", "indications": "Imposibilidad para orinar, dolor suprapÃºbico, globo vesical.", "isTriptico": true}, "trip-tep": {"title": "Tromboembolismo Pulmonar (TEP)", "category": "NeumologÃ­a", "text": "Tromboembolismo Pulmonar (TEP)\n\nSospecha diagnÃ³stica (Wells/Ginebra) y tratamiento inicial del TEP.\n\nIndicaciones: Disnea sÃºbita, dolor torÃ¡cico pleurÃ­tico, taquicardia.", "pdfUrl": "https://drive.google.com/file/d/1xlgOWMF_4ECl-yjwi_8f7ZVox4cj0JeC/preview", "summary": "Sospecha diagnÃ³stica (Wells/Ginebra) y tratamiento inicial del TEP.", "indications": "Disnea sÃºbita, dolor torÃ¡cico pleurÃ­tico, taquicardia.", "isTriptico": true}, "trip-neumonia": {"title": "NeumonÃ­a Adquirida en la Comunidad", "category": "NeumologÃ­a", "text": "NeumonÃ­a Adquirida en la Comunidad\n\nEscalas de gravedad (CURB-65) y antibioterapia empÃ­rica.\n\nIndicaciones: Fiebre, tos, expectoraciÃ³n, disnea, infiltrado radiolÃ³gico.", "pdfUrl": "https://drive.google.com/file/d/1CCTy53dKEmvucnWTObPtmbf4Ex3VBPC9/preview", "summary": "Escalas de gravedad (CURB-65) y antibioterapia empÃ­rica.", "indications": "Fiebre, tos, expectoraciÃ³n, disnea, infiltrado radiolÃ³gico.", "isTriptico": true}, "trip-epoc": {"title": "EPOC Agudizado", "category": "NeumologÃ­a", "text": "EPOC Agudizado\n\nManejo de la exacerbaciÃ³n de EPOC (Criterios Anthonisen).\n\nIndicaciones: Aumento de disnea, esputo o purulencia en paciente EPOC.", "pdfUrl": "https://drive.google.com/file/d/1HlTfk4_kIfpwtklCTynDHdbeRlhAi_Mx/preview", "summary": "Manejo de la exacerbaciÃ³n de EPOC (Criterios Anthonisen).", "indications": "Aumento de disnea, esputo o purulencia en paciente EPOC.", "isTriptico": true}, "trip-cefalea": {"title": "Cefalea en Urgencias", "category": "Urgencias Neuro", "text": "Cefalea en Urgencias\n\nCriterios de alarma y manejo sintomÃ¡tico de cefaleas primarias.\n\nIndicaciones: Cefalea intensa o con signos de alarma.", "pdfUrl": "https://drive.google.com/file/d/1dyt23QPIRHouWH2Wjh9ttBy6Tqoz71X9/preview", "summary": "Criterios de alarma y manejo sintomÃ¡tico de cefaleas primarias.", "indications": "Cefalea intensa o con signos de alarma.", "isTriptico": true}, "trip-tvp": {"title": "Trombosis Venosa Profunda (TVP)", "category": "CirugÃ­a Vascular", "text": "Trombosis Venosa Profunda (TVP)\n\nDiagnÃ³stico y tratamiento anticoagulante de la TVP.\n\nIndicaciones: Edema unilateral, dolor en pantorrilla, signo de Homans.", "pdfUrl": "https://drive.google.com/file/d/1SgRJoYfjSYoffcNmKKNnmPMbDyYykl85/preview", "summary": "DiagnÃ³stico y tratamiento anticoagulante de la TVP.", "indications": "Edema unilateral, dolor en pantorrilla, signo de Homans.", "isTriptico": true}, "trip-ulceras": {"title": "Ãšlceras Vasculares y Pie DiabÃ©tico", "category": "CirugÃ­a Vascular", "text": "Ãšlceras Vasculares y Pie DiabÃ©tico\n\nManejo de heridas crÃ³nicas y pie diabÃ©tico.\n\nIndicaciones: Ãšlceras en miembros inferiores, pie de riesgo.", "pdfUrl": "https://drive.google.com/file/d/1ZdlfC5hH5JC-yjaTOk7-GU1XUFVRyu8W/preview", "summary": "Manejo de heridas crÃ³nicas y pie diabÃ©tico.", "indications": "Ãšlceras en miembros inferiores, pie de riesgo.", "isTriptico": true}, "trip-artritis": {"title": "Artritis (Monoartritis Aguda)", "category": "ReumatologÃ­a", "text": "Artritis (Monoartritis Aguda)\n\nAbordaje de la articulaciÃ³n caliente e inflamada (Gota, SÃ©ptica).\n\nIndicaciones: Dolor, rubor, calor y tumefacciÃ³n articular aguda.", "pdfUrl": "https://drive.google.com/file/d/16r1Ot9_6SbA3D9eodPG-5vRBatjRJFqi/preview", "summary": "Abordaje de la articulaciÃ³n caliente e inflamada (Gota, SÃ©ptica).", "indications": "Dolor, rubor, calor y tumefacciÃ³n articular aguda.", "isTriptico": true}, "trip-neutropenia": {"title": "Neutropenia Febril", "category": "Infecciosas", "text": "Neutropenia Febril\n\nUrgencia oncolÃ³gica. Manejo antibiÃ³tico precoz.\n\nIndicaciones: Fiebre en paciente con neutropenia (<500/mm3) o quimioterapia reciente.", "pdfUrl": "https://drive.google.com/file/d/1dawYFPhOqhnD-0pZI0FDy5dsOS9ZCage/preview", "summary": "Urgencia oncolÃ³gica. Manejo antibiÃ³tico precoz.", "indications": "Fiebre en paciente con neutropenia (<500/mm3) o quimioterapia reciente.", "isTriptico": true}, "trip-sedacion": {"title": "SedaciÃ³n Paliativa", "category": "Paliativos", "text": "SedaciÃ³n Paliativa\n\nProtocolo de sedaciÃ³n en agonÃ­a y sÃ­ntomas refractarios.\n\nIndicaciones: SÃ­ntomas refractarios en situaciÃ³n de Ãºltimos dÃ­as.", "pdfUrl": "https://drive.google.com/file/d/1g_3dRWgBP3gmpdXnYY-4DqpbgoPaimTI/preview", "summary": "Protocolo de sedaciÃ³n en agonÃ­a y sÃ­ntomas refractarios.", "indications": "SÃ­ntomas refractarios en situaciÃ³n de Ãºltimos dÃ­as.", "isTriptico": true}, "trip-sincope": {"title": "SÃ­ncope", "category": "CardiologÃ­a", "text": "SÃ­ncope\n\nPÃ©rdida transitoria de conciencia. EvaluaciÃ³n de riesgo en urgencias.\n\nIndicaciones: PÃ©rdida de conciencia con recuperaciÃ³n espontÃ¡nea completa.", "pdfUrl": "https://drive.google.com/file/d/159RUw8bx2aAAQisTRcjl5fOGAt79544W/preview", "summary": "PÃ©rdida transitoria de conciencia. EvaluaciÃ³n de riesgo en urgencias.", "indications": "PÃ©rdida de conciencia con recuperaciÃ³n espontÃ¡nea completa.", "isTriptico": true}, "hosp-sva": {"title": "Soporte Vital Avanzado (SVA)", "category": "ReanimaciÃ³n", "text": "Soporte Vital Avanzado (Adultos)\n\nRCP de alta calidad y manejo de ritmos desfibrilables y no desfibrilables.\n\nPasos:\n1. Confirmar PCR, alertar equipo, iniciar RCP 30:2.\n2. Monitorizar ritmo: Desfibrilable (FV/TVSP) vs No desfibrilable (Asistolia/AESP).\n3. DesfibrilaciÃ³n precoz si FV/TVSP.\n4. Acceso vascular y fÃ¡rmacos.\n5. Buscar causas reversibles (4H/4T).\n\nTratamiento:\nAdrenalina: 1 mg IV cada 3-5 min.\nAmiodarona: 300 mg tras 3Âª descarga, luego 150 mg.\n\nâš ï¸ Alertas:\nCausas reversibles: Hipoxia, Hipovolemia, Hipo/Hiperpotasemia, Hipotermia, NeumotÃ³rax a tensiÃ³n, Taponamiento, TÃ³xicos, TEP.", "pdfUrl": "", "summary": "RCP de alta calidad. Algoritmo universal de SVA.", "indications": "Parada cardiorrespiratoria.", "isTriptico": false}, "hosp-via-aerea": {"title": "Manejo VÃ­a AÃ©rea DifÃ­cil / SRI", "category": "ReanimaciÃ³n", "text": "Manejo VÃ­a AÃ©rea DifÃ­cil / Secuencia RÃ¡pida de IntubaciÃ³n\n\nProtocolo de intubaciÃ³n orotraqueal urgente.\n\nPasos:\n1. PreoxigenaciÃ³n (3-5 min O2 100%).\n2. PosiciÃ³n Ã³ptima (rampa, sniffing position).\n3. Inductor + Relajante.\n4. Laringoscopia directa o videolaringoscopia.\n5. Plan B: Dispositivo supraglÃ³tico. Plan C: CricotiroidotomÃ­a.\n\nTratamiento:\nInductor: Etomidato 0.3 mg/kg o Ketamina 2 mg/kg.\nRelajante: Rocuronio 1 mg/kg o Suxametonio 1.5 mg/kg.\n\nâš ï¸ Alertas:\nFracaso de ventilaciÃ³n/oxigenaciÃ³n, GCS < 8.", "pdfUrl": "", "summary": "Protocolo de intubaciÃ³n orotraqueal urgente (SRI).", "indications": "GCS < 8, insuficiencia respiratoria grave, protecciÃ³n vÃ­a aÃ©rea.", "isTriptico": false}, "hosp-shock": {"title": "Shock (SÃ©ptico, HipovolÃ©mico, CardiogÃ©nico)", "category": "CrÃ­ticos", "text": "Manejo del Shock en Urgencias\n\nIdentificaciÃ³n y tratamiento del estado de shock.\n\nPasos:\n1. O2, monitorizaciÃ³n, 2 accesos venosos gruesos.\n2. Fluidoterapia intensiva con cristaloides.\n3. Si no responde: Vasopresores.\n4. Identificar tipo: SÃ©ptico, hipovolÃ©mico, cardiogÃ©nico, obstructivo, distributivo.\n5. Tratar causa subyacente.\n\nTratamiento:\nFluidos: 30 ml/kg cristaloides (SSF/RL).\nNoradrenalina: 0.05-0.5 Âµg/kg/min si no responde a fluidos.\nDobutamina si componente cardiogÃ©nico.\n\nâš ï¸ Alertas:\nHipotensiÃ³n refractaria, lactato â‰¥ 2 mmol/L, disfunciÃ³n multiorgÃ¡nica â†’ UCI.", "pdfUrl": "", "summary": "IdentificaciÃ³n y manejo inicial del estado de shock.", "indications": "HipotensiÃ³n, taquicardia, signos de hipoperfusiÃ³n.", "isTriptico": false}, "hosp-anafilaxia": {"title": "Anafilaxia", "category": "Urgencias Alergia", "text": "Anafilaxia\n\nReacciÃ³n alÃ©rgica sistÃ©mica grave con riesgo vital.\n\nPasos:\n1. Retirar alÃ©rgeno.\n2. Adrenalina IM INMEDIATA (cara anterolateral muslo).\n3. O2 alto flujo.\n4. PosiciÃ³n Trendelenburg.\n5. Fluidos IV si hipotensiÃ³n.\n\nTratamiento:\nAdrenalina: 0.5 mg IM (1:1000). Repetir cada 5-15 min si precisa.\nHidrocortisona: 200 mg IV.\nDexclorfeniramina: 5 mg IV.\nSalbutamol nebulizado si broncoespasmo.\n\nâš ï¸ Alertas:\nInestabilidad hemodinÃ¡mica, compromiso vÃ­a aÃ©rea, falta de respuesta â†’ UCI.\nObservaciÃ³n mÃ­nima 6-8h por riesgo de reacciÃ³n bifÃ¡sica.", "pdfUrl": "", "summary": "ReacciÃ³n alÃ©rgica sistÃ©mica grave. Adrenalina IM precoz.", "indications": "Urticaria + compromiso respiratorio o hemodinÃ¡mico.", "isTriptico": false}, "hosp-sepsis": {"title": "Sepsis y Shock SÃ©ptico (CÃ³digo Sepsis)", "category": "Infecciosas", "text": "Sepsis y Shock SÃ©ptico\n\nCÃ³digo Sepsis: ActuaciÃ³n en la primera hora.\n\nPasos:\n1. Hemocultivos (x2) ANTES de antibiÃ³tico.\n2. Lactato sÃ©rico.\n3. AntibiÃ³tico empÃ­rico en <1 hora.\n4. Cristaloides 30 ml/kg si hipotensiÃ³n o lactato â‰¥ 4.\n5. Vasopresores si PAM < 65 mmHg tras fluidos.\n\nTratamiento:\nATB EmpÃ­rico: Meropenem 1g o Pip/Tazo 4/0.5g + Amikacina (segÃºn foco/riesgo).\nNoradrenalina si PAM < 65 mmHg.\n\nâš ï¸ Alertas:\nqSOFA â‰¥ 2, Lactato â‰¥ 4 mmol/L, hipotensiÃ³n refractaria â†’ UCI.", "pdfUrl": "", "summary": "CÃ³digo Sepsis. ActuaciÃ³n en la primera hora.", "indications": "qSOFA â‰¥ 2, sospecha infecciÃ³n con disfunciÃ³n orgÃ¡nica.", "isTriptico": false}, "hosp-meningoencefalitis": {"title": "Meningoencefalitis Aguda", "category": "Infecciosas", "text": "Meningoencefalitis Aguda\n\nInfecciÃ³n del SNC con riesgo vital.\n\nPasos:\n1. Hemocultivos.\n2. Dexametasona + ATB INMEDIATO (antes de TAC si no hay focalidad).\n3. TAC craneal si focalidad o inmunodepresiÃ³n.\n4. PunciÃ³n lumbar (si no contraindicada).\n\nTratamiento:\nDexametasona: 0.15 mg/kg/6h (antes o con 1Âª dosis ATB).\nCeftriaxona: 2g/12h IV.\n+ Ampicilina 2g/4h (si >50 aÃ±os, embarazo, inmunodepresiÃ³n).\n+ Aciclovir 10 mg/kg/8h (si sospecha encefalitis herpÃ©tica).\n\nâš ï¸ Alertas:\nIngreso siempre. UCI si Glasgow <10, shock o insuficiencia respiratoria.", "pdfUrl": "", "summary": "InfecciÃ³n del SNC. ATB inmediato sin esperar pruebas.", "indications": "Fiebre + cefalea + rigidez de nuca + alteraciÃ³n de conciencia.", "isTriptico": false}, "hosp-crisis-asmatica": {"title": "Crisis AsmÃ¡tica", "category": "NeumologÃ­a", "text": "Crisis AsmÃ¡tica\n\nBroncoespasmo agudo severo.\n\nPasos:\n1. O2 para SatO2 >93%.\n2. Broncodilatadores de acciÃ³n corta repetidos.\n3. Corticoides sistÃ©micos precoces.\n4. Valorar gravedad (PEF, SatO2, uso de musculatura accesoria).\n\nTratamiento:\nSalbutamol: 4-8 puff (MDI + cÃ¡mara) o 2.5-5 mg nebulizado cada 20 min x3.\nIpratropio: 0.5 mg nebulizado (si grave).\nHidrocortisona: 100-200 mg IV o Prednisona 40 mg VO.\nSulfato de Magnesio: 2g IV en 20 min (si refractaria).\n\nâš ï¸ Alertas:\nPEF < 25%, SatO2 < 92%, silencio auscultatorio, agotamiento â†’ UCI/IOT.", "pdfUrl": "", "summary": "Broncoespasmo agudo. Broncodilatadores + corticoides.", "indications": "Disnea, sibilancias, uso musculatura accesoria en asmÃ¡tico.", "isTriptico": false}, "hosp-sca": {"title": "SÃ­ndrome Coronario Agudo (CÃ³digo Infarto)", "category": "CardiologÃ­a", "text": "SÃ­ndrome Coronario Agudo (SCACEST/SCASEST)\n\nCÃ³digo Infarto Regional.\n\nPasos:\n1. ECG <10 minutos.\n2. MonitorizaciÃ³n continua.\n3. Doble antiagregaciÃ³n.\n4. SCACEST: Activar CÃ³digo Infarto (HemodinÃ¡mica <120 min).\n5. SCASEST: EstratificaciÃ³n TIMI/GRACE.\n\nTratamiento:\nAAS 300 mg VO (masticado).\nTicagrelor 180 mg (o Prasugrel 60 mg / Clopidogrel 600 mg).\nAnticoagulaciÃ³n: Enoxaparina 0.5-1 mg/kg.\nNitroglicerina SL si dolor.\nMorfina 2-4 mg IV si dolor refractario.\n\nâš ï¸ Alertas:\nSCACEST: HemodinÃ¡mica <120 min. Shock cardiogÃ©nico. FV/TV â†’ UCI.", "pdfUrl": "", "summary": "CÃ³digo Infarto Regional. ECG <10 min.", "indications": "Dolor torÃ¡cico sugestivo de isquemia coronaria.", "isTriptico": false}, "hosp-crisis-hta": {"title": "Crisis Hipertensiva", "category": "CardiologÃ­a", "text": "Crisis Hipertensiva\n\nDistinguir urgencia de emergencia hipertensiva.\n\nPasos:\n1. Urgencia HTA: Sin daÃ±o Ã³rgano diana. Bajar TA en 24-48h.\n2. Emergencia HTA: Con daÃ±o Ã³rgano diana. Bajar TA 25% en 1Âª hora.\n3. Buscar: EncefalopatÃ­a, EAP, SCA, disecciÃ³n aÃ³rtica, eclampsia.\n\nTratamiento:\nUrgencia: Captopril 25 mg SL o Labetalol 100 mg VO.\nEmergencia: Labetalol 20 mg IV (repetir) o Urapidil 25 mg IV.\nNitroprusiato si refractario (UCI).\n\nâš ï¸ Alertas:\nEmergencia hipertensiva: Fallo renal, ictus, edema pulmÃ³n, disecciÃ³n â†’ UCI.", "pdfUrl": "", "summary": "Urgencia vs emergencia hipertensiva.", "indications": "TAS > 180 y/o TAD > 120 mmHg.", "isTriptico": false}, "hosp-ictus": {"title": "Ictus IsquÃ©mico (CÃ³digo Ictus)", "category": "Urgencias Neuro", "text": "Ictus IsquÃ©mico Agudo\n\nCÃ³digo Ictus. Tiempo es cerebro.\n\nPasos:\n1. CÃ³digo Ictus: Activar cadena asistencial.\n2. TAC craneal urgente (descartar hemorragia).\n3. Hora de inicio de sÃ­ntomas.\n4. Valorar fibrinolisis IV (<4.5h) y/o trombectomÃ­a mecÃ¡nica (<6-24h).\n5. Control glucemia, TA, temperatura.\n\nTratamiento:\nAlteplasa (rt-PA): 0.9 mg/kg (mÃ¡x 90 mg) IV. 10% bolo, 90% en 1h.\nSi >4.5h o contraindicaciÃ³n: Valorar trombectomÃ­a mecÃ¡nica.\n\nâš ï¸ Alertas:\nCandidato a reperfusiÃ³n â†’ Unidad Ictus/UCI. NIHSS > 6 + oclusiÃ³n proximal â†’ trombectomÃ­a.", "pdfUrl": "", "summary": "CÃ³digo Ictus. Fibrinolisis <4.5h. TrombectomÃ­a si oclusiÃ³n.", "indications": "DÃ©ficit neurolÃ³gico focal de inicio brusco.", "isTriptico": false}, "hosp-hemorragia-cerebral": {"title": "Hemorragia Cerebral / HSA", "category": "Urgencias Neuro", "text": "Hemorragia Cerebral / Hemorragia Subaracnoidea\n\nEmergencia neurovascular.\n\nPasos:\n1. TAC craneal urgente.\n2. Control estricto de TA (PAS <140 mmHg).\n3. Revertir anticoagulaciÃ³n si procede.\n4. ValoraciÃ³n neuroquirÃºrgica.\n5. Si HSA: AngioTC para aneurisma.\n\nTratamiento:\nControl TA: Labetalol o Urapidil IV.\nReversiÃ³n ACO: Vitamina K + CCP. Idarucizumab (DabigatrÃ¡n). Andexanet (anti-Xa).\nNimodipino 60 mg/4h VO (HSA - vasoespasmo).\n\nâš ï¸ Alertas:\nGlasgow < 8 â†’ IntubaciÃ³n. Ingreso NeurocirugÃ­a/UCI.", "pdfUrl": "", "summary": "Hemorragia intracraneal. Control TA y reversiÃ³n anticoagulaciÃ³n.", "indications": "Cefalea en trueno, dÃ©ficit neurolÃ³gico brusco, Glasgow bajo.", "isTriptico": false}, "hosp-status-epileptico": {"title": "Status EpilÃ©ptico", "category": "Urgencias Neuro", "text": "Status EpilÃ©ptico\n\nCrisis epilÃ©ptica >5 min o crisis repetidas sin recuperaciÃ³n.\n\nPasos:\n1. VÃ­a aÃ©rea, O2, monitorizaciÃ³n.\n2. Benzodiacepinas inmediatas (1Âª lÃ­nea).\n3. Si persiste (>10 min): FAE IV (2Âª lÃ­nea).\n4. Si refractario (>30 min): SedaciÃ³n profunda en UCI.\n\nTratamiento:\n1Âª lÃ­nea: Diazepam 10 mg IV (o Midazolam 10 mg IM/bucal).\n2Âª lÃ­nea: Levetiracetam 30-60 mg/kg IV o Ãc. Valproico 40 mg/kg IV.\n3Âª lÃ­nea (refractario): Propofol o Midazolam en perfusiÃ³n (UCI con IOT).\n\nâš ï¸ Alertas:\nCrisis >30 min o refractaria â†’ UCI. Buscar causa: TÃ³xicos, metabÃ³lica, ACV.", "pdfUrl": "", "summary": "Crisis >5 min. BZD inmediatas, FAE si persiste.", "indications": "Crisis epilÃ©ptica prolongada o repetida sin recuperaciÃ³n.", "isTriptico": false}, "hosp-hepatica-aguda": {"title": "Insuficiencia HepÃ¡tica Aguda", "category": "Digestivo", "text": "Insuficiencia HepÃ¡tica Aguda\n\nFallo hepÃ¡tico con riesgo vital.\n\nPasos:\n1. Monitorizar glucemia (hipoglucemia frecuente).\n2. Valorar coagulaciÃ³n (INR).\n3. Grado de encefalopatÃ­a hepÃ¡tica.\n4. Identificar causa: Paracetamol, viral, autoinmune.\n\nTratamiento:\nN-AcetilcisteÃ­na (si paracetamol): 150 mg/kg en 1h, luego 50 mg/kg en 4h.\nLactulosa 30 ml/8h (encefalopatÃ­a).\nVitamina K 10 mg IV.\nGlucosa 10% si hipoglucemia.\n\nâš ï¸ Alertas:\nEncefalopatÃ­a grado III-IV â†’ UCI. Criterios King's College â†’ trasplante.", "pdfUrl": "", "summary": "Fallo hepÃ¡tico agudo. N-AcetilcisteÃ­na si paracetamol.", "indications": "Ictericia + coagulopatÃ­a + encefalopatÃ­a.", "isTriptico": false}, "hosp-hipoglucemia": {"title": "Hipoglucemia", "category": "EndocrinologÃ­a", "text": "Hipoglucemia\n\nGlucemia < 70 mg/dL con sÃ­ntomas.\n\nPasos:\n1. Confirmar glucemia capilar.\n2. Si consciente: Hidratos de carbono VO (15-20g).\n3. Si inconsciente: Glucosa IV o GlucagÃ³n IM.\n4. Revisar glucemia cada 15 min.\n5. Buscar causa: Sulfonilureas, insulina, ayuno.\n\nTratamiento:\nConsciente: 15-20g HC (zumo, azÃºcar).\nInconsciente: Glucosa 50% 2-4 ampollas IV (o Glucosmon R50).\nGlucagÃ³n 1 mg IM/SC (si no hay vÃ­a).\n\nâš ï¸ Alertas:\nRecuperaciÃ³n incompleta. Causa sulfonilureas: ObservaciÃ³n prolongada (riesgo recurrencia).", "pdfUrl": "", "summary": "Glucemia < 70 mg/dL. Glucosa IV si inconsciente.", "indications": "SudoraciÃ³n, temblor, confusiÃ³n, coma en diabÃ©tico.", "isTriptico": false}, "hosp-suprarrenal": {"title": "Insuficiencia Suprarrenal Aguda (Crisis Addisoniana)", "category": "EndocrinologÃ­a", "text": "Insuficiencia Suprarrenal Aguda\n\nCrisis addisoniana con riesgo vital.\n\nPasos:\n1. Sospecha clÃ­nica: HipotensiÃ³n + hiponatremia + hiperpotasemia.\n2. ExtracciÃ³n cortisol basal (NO esperar resultado).\n3. Hidrocortisona IV inmediata.\n4. HidrataciÃ³n enÃ©rgica con SSF.\n\nTratamiento:\nHidrocortisona: 100 mg IV bolo, luego 100 mg/6h (o perfusiÃ³n 200 mg/24h).\nSSF 1000 ml/h inicialmente.\nTratar hipoglucemia si presente.\n\nâš ï¸ Alertas:\nShock refractario, desequilibrio electrolÃ­tico grave â†’ UCI.", "pdfUrl": "", "summary": "Crisis addisoniana. Hidrocortisona IV inmediata.", "indications": "HipotensiÃ³n + hiponatremia en paciente con corticoterapia crÃ³nica.", "isTriptico": false}, "hosp-escroto-agudo": {"title": "Escroto Agudo", "category": "UrologÃ­a", "text": "Escroto Agudo\n\nUrgencia urolÃ³gica. Descartar torsiÃ³n testicular.\n\nPasos:\n1. Eco-Doppler testicular URGENTE.\n2. Descartar torsiÃ³n testicular (<6h para salvamento).\n3. DiagnÃ³stico diferencial: Orquiepididimitis, torsiÃ³n hidÃ¡tide.\n\nTratamiento:\nTorsiÃ³n testicular: CirugÃ­a URGENTE (<6h).\nOrquiepididimitis: AINEs + ATB (Ceftriaxona 250mg + Doxiciclina 100mg/12h).\n\nâš ï¸ Alertas:\nTorsiÃ³n testicular â†’ QuirÃ³fano URGENTE.\nGangrena de Fournier â†’ UCI/CirugÃ­a.", "pdfUrl": "", "summary": "Descartar torsiÃ³n testicular (<6h). Eco-Doppler urgente.", "indications": "Dolor testicular agudo unilateral.", "isTriptico": false}, "hosp-hematuria": {"title": "Hematuria", "category": "UrologÃ­a", "text": "Hematuria\n\nSangrado urinario. Valorar causa y gravedad.\n\nPasos:\n1. Macro vs micro hematuria.\n2. Si coÃ¡gulos: Sonda 3 vÃ­as + lavado vesical continuo.\n3. Descartar: Tumor vesical/renal, litiasis, infecciÃ³n, anticoagulantes.\n4. EcografÃ­a/TAC urolÃ³gico.\n\nTratamiento:\nHidrataciÃ³n abundante.\nSi coÃ¡gulos: Lavado manual y continuo.\nNo antifibrinolÃ­ticos de rutina.\nRevisar anticoagulaciÃ³n.\n\nâš ï¸ Alertas:\nAnemizaciÃ³n, retenciÃ³n por coÃ¡gulos, inestabilidad â†’ Ingreso.", "pdfUrl": "", "summary": "Sangrado urinario. Sonda 3 vÃ­as si coÃ¡gulos.", "indications": "Orina roja o con coÃ¡gulos.", "isTriptico": false}, "hosp-politrauma": {"title": "Politrauma / Trauma Grave", "category": "Trauma", "text": "Politrauma / Traumatismo Grave\n\nAbordaje XABCDE del paciente politraumatizado.\n\nPasos:\n1. X: Control hemorragia exanguinante (torniquete si precisa).\n2. A: VÃ­a aÃ©rea con control cervical.\n3. B: VentilaciÃ³n (descartar neumotÃ³rax a tensiÃ³n).\n4. C: CirculaciÃ³n (2 vÃ­as gruesas, fluidos, sangre).\n5. D: NeurolÃ³gico (Glasgow, pupilas).\n6. E: ExposiciÃ³n completa.\n\nTratamiento:\nÃcido TranexÃ¡mico: 1g en 10 min + 1g en 8h (en 1Âª hora).\nSSF/RL 1000 ml (evitar sobrehidrataciÃ³n).\nProtocolo de transfusiÃ³n masiva si precisa.\n\nâš ï¸ Alertas:\nCÃ³digo Trauma. Inestabilidad. Lesiones penetrantes â†’ Hospital Trauma/UCI.", "pdfUrl": "", "summary": "XABCDE. Ãcido tranexÃ¡mico en 1Âª hora.", "indications": "Traumatismo de alta energÃ­a, inestabilidad hemodinÃ¡mica.", "isTriptico": false}, "hosp-tce": {"title": "TCE (Traumatismo CraneoencefÃ¡lico)", "category": "Trauma", "text": "TCE Adulto\n\nManejo del traumatismo craneoencefÃ¡lico.\n\nPasos:\n1. ABCDE con inmovilizaciÃ³n cervical.\n2. Glasgow y pupilas.\n3. TAC craneal si criterios (Canadian CT Head Rule).\n4. Control de HTIC si precisa.\n\nTratamiento:\nSuero HipertÃ³nico al 7.5% o Manitol 20% (0.5-1 g/kg) si HTIC.\nSedaciÃ³n: Propofol/Midazolam si IOT.\nAntiepilÃ©pticos profilÃ¡cticos si fractura deprimida.\n\nâš ï¸ Alertas:\nGCS â‰¤ 13, focalidad, hallazgos en TAC, coagulopatÃ­a â†’ NeurocirugÃ­a/UCI.", "pdfUrl": "", "summary": "Manejo TCE. Canadian CT Rule. Control HTIC.", "indications": "Traumatismo craneal con alteraciÃ³n de conciencia o focalidad.", "isTriptico": false}, "hosp-quemaduras": {"title": "Quemaduras", "category": "Trauma", "text": "Quemaduras\n\nManejo del paciente quemado.\n\nPasos:\n1. Retirar de la fuente de calor, enfriar con agua 20Â°C.\n2. Regla de los 9 (superficie corporal quemada).\n3. FÃ³rmula de Parkland para fluidoterapia.\n4. Analgesia potente.\n5. Valorar vÃ­a aÃ©rea (inhalaciÃ³n de humos).\n\nTratamiento:\nFluidos: Ringer Lactato â†’ Parkland: 2-4 ml x kg x %SCQ (50% en 1as 8h).\nMorfina/Fentanilo IV para dolor.\nProfilaxis antitetÃ¡nica.\n\nâš ï¸ Alertas:\nGran quemado (>20% SCQ), quemadura elÃ©ctrica/quÃ­mica, inhalaciÃ³n, zonas especiales (cara, manos, genitales) â†’ Unidad de Quemados.", "pdfUrl": "", "summary": "Regla de los 9. Parkland. Analgesia potente.", "indications": "Quemaduras tÃ©rmicas, quÃ­micas o elÃ©ctricas.", "isTriptico": false}, "hosp-isquemia-arterial": {"title": "Isquemia Arterial Aguda", "category": "CirugÃ­a Vascular", "text": "Isquemia Arterial Aguda\n\nEmergencia vascular. Regla de las 6 P.\n\nPasos:\n1. Pain, Pallor, Pulselessness, Paresthesia, Paralysis, Poikilothermia.\n2. HeparinizaciÃ³n precoz.\n3. Analgesia potente.\n4. Valorar viabilidad de la extremidad (Rutherford).\n\nTratamiento:\nHeparina SÃ³dica: 5000 UI bolo IV + perfusiÃ³n 1000 UI/h.\nMorfina/Fentanilo para dolor.\nNo elevar la extremidad.\n\nâš ï¸ Alertas:\nExtremidad amenazada (IIa/IIb) â†’ RevascularizaciÃ³n urgente (CirugÃ­a Vascular).", "pdfUrl": "", "summary": "Regla 6P. HeparinizaciÃ³n precoz. RevascularizaciÃ³n urgente.", "indications": "Dolor agudo + palidez + ausencia de pulso en extremidad.", "isTriptico": false}, "hosp-aorta": {"title": "PatologÃ­a AÃ³rtica Aguda (DisecciÃ³n)", "category": "CirugÃ­a Vascular", "text": "PatologÃ­a AÃ³rtica Aguda\n\nDisecciÃ³n aÃ³rtica y aneurisma roto.\n\nPasos:\n1. Control estricto TA y FC.\n2. TAC con contraste urgente (AngioTC).\n3. ClasificaciÃ³n Stanford: Tipo A (ascendente) vs Tipo B (descendente).\n4. ValoraciÃ³n por CirugÃ­a Cardiovascular.\n\nTratamiento:\nLabetalol IV o Esmolol IV: Objetivo TAS <120 mmHg, FC <60 lpm.\nMorfina IV para dolor.\nEvitar Nitroprusiato solo (taquicardia refleja).\n\nâš ï¸ Alertas:\nDisecciÃ³n Tipo A â†’ CirugÃ­a URGENTE.\nTipo B complicada (isquemia, rotura) â†’ UCI/CirugÃ­a Vascular.", "pdfUrl": "", "summary": "DisecciÃ³n aÃ³rtica. Control TA estricto. Tipo A = cirugÃ­a urgente.", "indications": "Dolor torÃ¡cico desgarrante irradiado a espalda, asimetrÃ­a de pulsos.", "isTriptico": false}, "hosp-piel-blandas": {"title": "InfecciÃ³n Piel y Partes Blandas", "category": "Infecciosas", "text": "InfecciÃ³n de Piel y Partes Blandas\n\nCelulitis, absceso, fascitis necrotizante.\n\nPasos:\n1. Marcar bordes de la lesiÃ³n.\n2. Valorar crepitaciÃ³n (gas en tejidos = necrotizante).\n3. Si absceso: Drenaje quirÃºrgico.\n4. AnalÃ­tica + hemocultivos si signos sistÃ©micos.\n\nTratamiento:\nCelulitis leve: Amoxicilina-clavulÃ¡nico 875/125 mg/8h.\nGrave: Cefazolina 2g/8h IV o Clindamicina 600mg/8h IV.\nSospecha SARM: Vancomicina o Linezolid.\nFascitis necrotizante: Meropenem + Clindamicina + CirugÃ­a urgente.\n\nâš ï¸ Alertas:\nCrepitaciÃ³n, necrosis, sepsis â†’ Fascitis necrotizante â†’ CirugÃ­a URGENTE.", "pdfUrl": "", "summary": "Celulitis, absceso, fascitis necrotizante.", "indications": "Eritema, calor, dolor e induraciÃ³n cutÃ¡nea progresivos.", "isTriptico": false}, "hosp-urticaria-angioedema": {"title": "Urticaria y Angioedema", "category": "Urgencias Alergia", "text": "Urticaria y Angioedema\n\nReacciÃ³n alÃ©rgica cutÃ¡nea +/- compromiso vÃ­a aÃ©rea.\n\nPasos:\n1. Valorar vÃ­a aÃ©rea (angioedema lingual/larÃ­ngeo).\n2. Diferenciar: AlÃ©rgica vs Hereditaria (bradicinina).\n3. AntihistamÃ­nicos + Corticoides.\n\nTratamiento:\nDexclorfeniramina 5mg IM/IV.\nMetilprednisolona 40-80mg IV.\nSi compromiso vÃ­a aÃ©rea: Adrenalina 0.5mg IM.\nAngioedema hereditario: Icatibant 30mg SC o C1 inhibidor.\n\nâš ï¸ Alertas:\nCompromiso vÃ­a aÃ©rea â†’ Adrenalina IM inmediata. ObservaciÃ³n por riesgo de anafilaxia.", "pdfUrl": "", "summary": "Urticaria + angioedema. Valorar siempre vÃ­a aÃ©rea.", "indications": "Habones, edema labial/lingual, dificultad para tragar.", "isTriptico": false}, "hosp-intoxicacion-etilica": {"title": "IntoxicaciÃ³n EtÃ­lica", "category": "ToxicologÃ­a", "text": "IntoxicaciÃ³n EtÃ­lica Aguda\n\nManejo de la embriaguez y complicaciones.\n\nPasos:\n1. Descartar traumatismo craneal (TAC si Glasgow bajo o focalidad).\n2. Glucemia capilar.\n3. Tiamina ANTES de glucosa.\n4. PosiciÃ³n lateral de seguridad si coma.\n\nTratamiento:\nTiamina: 100 mg IM/IV (prevenciÃ³n Wernicke).\nGlucosa IV si hipoglucemia (Glucosmon R50).\nHidrataciÃ³n con SSF.\n\nâš ï¸ Alertas:\nComa, broncoaspiraciÃ³n, traumatismo asociado, hipoglucemia persistente.", "pdfUrl": "", "summary": "Tiamina antes de glucosa. Descartar TCE.", "indications": "DisminuciÃ³n de conciencia en contexto de ingesta etÃ­lica.", "isTriptico": false}, "hosp-intoxicacion-farmacos": {"title": "IntoxicaciÃ³n por FÃ¡rmacos/Drogas", "category": "ToxicologÃ­a", "text": "IntoxicaciÃ³n por FÃ¡rmacos/Drogas\n\nManejo general de intoxicaciones.\n\nPasos:\n1. ABCDE, estabilizaciÃ³n.\n2. Identificar tÃ³xico y tiempo.\n3. DescontaminaciÃ³n: CarbÃ³n activado (si <2h y consciente).\n4. AntÃ­doto especÃ­fico si existe.\n5. ValoraciÃ³n psiquiÃ¡trica si intencional.\n\nTratamiento:\nCarbÃ³n activado: 1 g/kg VO (mÃ¡x 50g) si <2h.\nNaloxona 0.4-2 mg IV (intoxicaciÃ³n opiÃ¡cea).\nFlumazenilo 0.2 mg IV (benzodiacepinas - con precauciÃ³n).\nN-AcetilcisteÃ­na (intoxicaciÃ³n paracetamol - Nomograma Rumack-Matthew).\n\nâš ï¸ Alertas:\nDisminuciÃ³n de conciencia, necesidad soporte vital. Riesgo suicida â†’ PsiquiatrÃ­a.", "pdfUrl": "", "summary": "CarbÃ³n activado, antÃ­dotos especÃ­ficos. Valorar suicidabilidad.", "indications": "Sospecha de ingesta tÃ³xica voluntaria o accidental.", "isTriptico": false}, "hosp-agitacion": {"title": "AgitaciÃ³n Psicomotriz", "category": "PsiquiatrÃ­a", "text": "AgitaciÃ³n Psicomotriz\n\nPaciente agitado en urgencias.\n\nPasos:\n1. Seguridad: No enfrentar, espacio amplio.\n2. ContenciÃ³n verbal (desescalada).\n3. Si falla: ContenciÃ³n mecÃ¡nica con protocolo.\n4. SedaciÃ³n farmacolÃ³gica.\n5. Descartar causa orgÃ¡nica (glucemia, tÃ³xicos, infecciÃ³n, TCE).\n\nTratamiento:\nMidazolam 5 mg IM/IV + Haloperidol 5 mg IM.\nAlternativa: Olanzapina 10 mg IM o Aripiprazol 9.75 mg IM.\n\nâš ï¸ Alertas:\nCausa orgÃ¡nica â†’ UCI/Medicina Interna.\nRiesgo de autolisis o heteragresiÃ³n â†’ PsiquiatrÃ­a.", "pdfUrl": "", "summary": "Desescalada verbal. SedaciÃ³n si falla. Descartar causa orgÃ¡nica.", "indications": "Paciente violento, agitado o con conducta desorganizada.", "isTriptico": false}, "hosp-suicida": {"title": "Paciente con Conducta Suicida", "category": "PsiquiatrÃ­a", "text": "Paciente con Conducta Suicida\n\nValoraciÃ³n del riesgo autolÃ­tico.\n\nPasos:\n1. Seguridad del entorno (retirar objetos peligrosos).\n2. ContenciÃ³n si precisa.\n3. Entrevista empÃ¡tica y valoraciÃ³n de riesgo.\n4. Escala SAD PERSONS.\n5. Tratar lesiones fÃ­sicas/intoxicaciÃ³n asociada.\n\nTratamiento:\nSedaciÃ³n si agitaciÃ³n.\nTratar lesiones/intoxicaciÃ³n.\nAcompaÃ±amiento continuo.\n\nâš ï¸ Alertas:\nRiesgo autolÃ­tico alto, falta de soporte familiar, patologÃ­a psiquiÃ¡trica grave â†’ Ingreso PsiquiatrÃ­a.", "pdfUrl": "", "summary": "ValoraciÃ³n riesgo autolÃ­tico. Entorno seguro.", "indications": "IdeaciÃ³n suicida, intento autolÃ­tico o autolesiones.", "isTriptico": false}, "hosp-eii": {"title": "Enfermedad Inflamatoria Intestinal (EII)", "category": "Digestivo", "text": "Brote de EII en Urgencias\n\nCrohn y Colitis Ulcerosa.\n\nPasos:\n1. Valorar gravedad: Truelove-Witts (CU) / Harvey-Bradshaw (Crohn).\n2. Descartar infecciÃ³n sobreaÃ±adida (Clostridioides, CMV).\n3. Coprocultivos y toxina C. difficile.\n4. Rx abdomen (descartar megacolon tÃ³xico).\n\nTratamiento:\nBrote leve-moderado: Mesalazina.\nBrote grave: Corticoides IV (Metilprednisolona 1 mg/kg/dÃ­a, mÃ¡x 60 mg).\nMegacolon tÃ³xico: Dieta absoluta + ATB + valorar cirugÃ­a.\n\nâš ï¸ Alertas:\nBrote grave, megacolon tÃ³xico, absceso, deshidrataciÃ³n â†’ Ingreso.", "pdfUrl": "", "summary": "Brote grave de Crohn/CU. Escalas Truelove-Witts.", "indications": "Diarrea sanguinolenta, dolor abdominal en paciente con EII.", "isTriptico": false}, "hosp-ped-meningitis": {"title": "Meningitis PediÃ¡trica", "category": "PediatrÃ­a", "text": "Meningitis PediÃ¡trica\n\nInfecciÃ³n menÃ­ngea en el niÃ±o.\n\nPasos:\n1. Hemocultivos.\n2. Dexametasona IV (antes o con 1Âª dosis ATB).\n3. ATB empÃ­rico precoz.\n4. PunciÃ³n lumbar (si no contraindicada).\n\nTratamiento:\n<3 meses: Ampicilina 75 mg/kg/6h + Cefotaxima 50 mg/kg/6h.\n>3 meses: Cefotaxima 75 mg/kg/6h + Vancomicina 15 mg/kg/6h.\nDexametasona: 0.15 mg/kg/6h x 4 dÃ­as.\n\nâš ï¸ Alertas:\nIngreso en UCIP si inestabilidad, shock, pÃºrpura, Glasgow bajo.", "pdfUrl": "", "summary": "ATB empÃ­rico precoz segÃºn edad. Dexametasona IV.", "indications": "Fiebre + irritabilidad/vÃ³mitos + rigidez nuca en niÃ±o.", "isTriptico": false}, "hosp-ped-convulsion-febril": {"title": "ConvulsiÃ³n Febril PediÃ¡trica", "category": "PediatrÃ­a", "text": "ConvulsiÃ³n Febril\n\nCrisis asociada a fiebre en niÃ±os de 6 meses a 5 aÃ±os.\n\nPasos:\n1. ABC, proteger de lesiones.\n2. AntipirÃ©ticos.\n3. BZD si crisis >5 min.\n4. Diferenciar simple vs compleja.\n5. Buscar foco febril.\n\nTratamiento:\nDiazepam rectal 0.5 mg/kg (mÃ¡x 10 mg).\nMidazolam bucal/nasal 0.2-0.3 mg/kg.\nParacetamol 15 mg/kg o Ibuprofeno 10 mg/kg.\n\nâš ï¸ Alertas:\nStatus febril, crisis complejas (focal, >15 min, recurrente en 24h), recuperaciÃ³n lenta â†’ ObservaciÃ³n/Ingreso.", "pdfUrl": "", "summary": "BZD si >5 min. Diferenciar simple vs compleja.", "indications": "Crisis convulsiva en niÃ±o febril 6m-5a.", "isTriptico": false}, "hosp-ped-bronquiolitis": {"title": "Bronquiolitis PediÃ¡trica", "category": "PediatrÃ­a", "text": "Bronquiolitis Aguda\n\nInfecciÃ³n viral de vÃ­as bajas en lactantes (VRS).\n\nPasos:\n1. Valorar gravedad (escala Wood-Downes).\n2. Soporte respiratorio.\n3. Lavados nasales frecuentes.\n4. AlimentaciÃ³n fraccionada.\n\nTratamiento:\nO2 si SatO2 <92-94%.\nOAF/CPAP si grave.\nSalbutamol NO recomendado de rutina.\nSuero hipertÃ³nico 3% nebulizado (opcional en ingresados).\n\nâš ï¸ Alertas:\nDificultad respiratoria moderada-grave, apneas, intolerancia oral, <6 semanas â†’ Ingreso.", "pdfUrl": "", "summary": "VRS en lactantes. Soporte. No salbutamol de rutina.", "indications": "Lactante con rinorrea, tos, sibilancias, dificultad respiratoria.", "isTriptico": false}, "hosp-ped-laringitis": {"title": "Laringitis / Crup PediÃ¡trico", "category": "PediatrÃ­a", "text": "Laringitis / Crup\n\nObstrucciÃ³n de vÃ­a aÃ©rea superior en niÃ±os.\n\nPasos:\n1. Score de Westley (estridor, tiraje, ventilaciÃ³n, cianosis, conciencia).\n2. Dexametasona oral/IM.\n3. Adrenalina nebulizada si grave.\n4. ObservaciÃ³n mÃ­nima 3-4h tras adrenalina.\n\nTratamiento:\nDexametasona: 0.15-0.6 mg/kg VO/IM (mÃ¡x 10 mg). Dosis Ãºnica.\nAdrenalina nebulizada: 0.5 ml/kg (mÃ¡x 5 ml) de 1:1000 (si grave).\n\nâš ï¸ Alertas:\nEstridor en reposo, dificultad respiratoria grave, hipoxia â†’ ObservaciÃ³n/Ingreso.", "pdfUrl": "", "summary": "Dexametasona oral. Adrenalina neb si grave.", "indications": "Estridor inspiratorio, tos perruna, disfonÃ­a en niÃ±o.", "isTriptico": false}, "hosp-ped-sepsis": {"title": "Sepsis PediÃ¡trica", "category": "PediatrÃ­a", "text": "Sepsis PediÃ¡trica\n\nCÃ³digo Sepsis PediÃ¡trico. ActuaciÃ³n urgente.\n\nPasos:\n1. TriÃ¡ngulo de EvaluaciÃ³n PediÃ¡trica (TEP).\n2. Acceso vascular <5 min (IO si falla IV).\n3. Fluidos <15 min: SSF 20 ml/kg en bolo.\n4. ATB <60 min.\n5. Reevaluar tras cada bolo.\n\nTratamiento:\nFluidos: SSF 20 ml/kg (repetir hasta 60 ml/kg).\nATB: Ceftriaxona 80 mg/kg.\nShock frÃ­o (extremidades frÃ­as): Adrenalina 0.05-0.3 Âµg/kg/min.\nShock caliente (vasodilatado): Noradrenalina.\n\nâš ï¸ Alertas:\nShock refractario a fluidos, fallo multiorgÃ¡nico â†’ UCIP.", "pdfUrl": "", "summary": "CÃ³digo Sepsis Ped. VÃ­a <5 min, fluidos <15 min, ATB <60 min.", "indications": "TEP alterado + sospecha infecciÃ³n en niÃ±o.", "isTriptico": false}, "hosp-obs-gripe": {"title": "Gripe y GestaciÃ³n", "category": "Obstetricia", "text": "Gripe en la Embarazada\n\nManejo de la infecciÃ³n gripal en gestantes.\n\nPasos:\n1. Valorar criterios de gravedad.\n2. Oseltamivir precoz (dentro de las 1as 48h).\n3. MonitorizaciÃ³n fetal si >24 semanas.\n\nTratamiento:\nOseltamivir: 75 mg/12h x 5 dÃ­as.\nParacetamol para fiebre (evitar AINEs).\nHidrataciÃ³n.\n\nâš ï¸ Alertas:\nNeumonÃ­a, distrÃ©s respiratorio, SatO2 <95%, deshidrataciÃ³n â†’ Ingreso en aislamiento.", "pdfUrl": "", "summary": "Oseltamivir precoz en embarazada con gripe.", "indications": "Gestante con sÃ­ndrome gripal.", "isTriptico": false}, "hosp-obs-migrana": {"title": "MigraÃ±a y GestaciÃ³n", "category": "Obstetricia", "text": "MigraÃ±a en la Embarazada\n\nManejo seguro de cefalea en gestaciÃ³n.\n\nPasos:\n1. Descartar preeclampsia (>20 semanas): TA, proteinuria.\n2. Descartar trombosis venosa cerebral.\n3. Analgesia segura.\n\nTratamiento:\nParacetamol 1g/6-8h.\nMetoclopramida 10 mg IV (antiemÃ©tico).\n2Âª lÃ­nea: SumatriptÃ¡n 50 mg VO (valorar riesgo/beneficio).\nEvitar AINEs en 3er trimestre.\nEvitar ergotamÃ­nicos (contraindicados).\n\nâš ï¸ Alertas:\nStatus migraÃ±oso, signos de alarma, cefalea con HTA â†’ NeurologÃ­a/Obstetricia.", "pdfUrl": "", "summary": "Paracetamol + Metoclopramida. Descartar preeclampsia.", "indications": "Cefalea intensa en gestante.", "isTriptico": false}, "hosp-obs-parto": {"title": "Amenaza de Parto Prematuro / Parto Inminente", "category": "Obstetricia", "text": "Amenaza de Parto Prematuro / Parto en Urgencias\n\nManejo del parto prematuro y parto no hospitalario.\n\nPasos:\n1. Valorar dinÃ¡mica uterina y cÃ©rvix.\n2. Corticoides si prematuridad (24-34+6 semanas).\n3. Profilaxis EGB si indicada.\n4. Si parto inminente: No impedir la salida del bebÃ©.\n\nTratamiento:\nBetametasona 12 mg IM x2 dosis (separadas 24h) - maduraciÃ³n pulmonar.\nProfilaxis EGB: Penicilina G 5M UI + 2.5M/4h IV o Ampicilina.\nAtosibÃ¡n IV (tocolisis si <48h para completar corticoides).\n\nâš ï¸ Alertas:\nParto en curso o amenaza de parto prematuro â†’ Ingreso Paritorio.", "pdfUrl": "", "summary": "Corticoides si <34+6 sem. Profilaxis EGB.", "indications": "DinÃ¡mica uterina regular con modificaciÃ³n cervical.", "isTriptico": false}, "hosp-disnea": {"title": "Disnea Aguda / Insuficiencia Respiratoria", "category": "NeumologÃ­a", "text": "Disnea Aguda / Insuficiencia Respiratoria\n\nDificultad respiratoria de inicio sÃºbito.\n\nPasos:\n1. Valorar gravedad: SatO2, FR, trabajo respiratorio.\n2. O2 para SatO2 >90-92%.\n3. Causas frecuentes: Asma, EPOC, ICC, TEP, neumotÃ³rax, neumonÃ­a.\n4. Rx tÃ³rax + ECG + GasometrÃ­a.\n5. VMNI si precisa (CPAP/BiPAP).\n\nTratamiento:\nO2 alto flujo si hipoxemia.\nBroncodilatadores si broncoespasmo.\nDiurÃ©ticos si ICC.\nVMNI si acidosis respiratoria o EAP.\n\nâš ï¸ Alertas:\nHipoxemia refractaria, agotamiento muscular, acidosis respiratoria â†’ UCI.", "pdfUrl": "", "summary": "Dificultad respiratoria de inicio sÃºbito. VMNI si precisa.", "indications": "SatO2 baja, taquipnea, uso musculatura accesoria.", "isTriptico": false}};
var urgPreguntas = [];
var urgProcessing = false;

function switchUrgTab(tabName, btnEl) {
    document.querySelectorAll('.urg-tab-content').forEach(function(el){ el.style.display='none'; });
    document.getElementById(tabName+'-content').style.display='block';
    document.querySelectorAll('.tab-urg').forEach(function(b){ b.classList.remove('active'); b.style.color='rgba(255,255,255,.6)'; });
    btnEl.classList.add('active');
    btnEl.style.color='#fff';
    if(tabName==='urg-pacientes')gpRender('Urg');
}

function urgViewProtocol(id) {
    var p = URG_PROTOCOLS[id];
    if (!p) return;
    document.getElementById('urgProtoModalCat').textContent = p.category + (p.isTriptico ? ' Â· TrÃ­ptico' : ' Â· SEMFyC');
    document.getElementById('urgProtoModalTitle').textContent = p.title;
    document.getElementById('urgProtoModalSummary').textContent = p.summary || '';
    
    var bodyHtml = '';
    if (p.indications) bodyHtml += '<div style="background:#fff3e0;padding:12px;border-radius:8px;margin-bottom:12px;border-left:4px solid #f57c00;"><strong style="color:#e65100;">ğŸ“Œ Indicaciones</strong><br>' + p.indications + '</div>';
    
    var textLines = p.text.split('\n');
    var formattedText = '';
    for (var i = 0; i < textLines.length; i++) {
        var line = textLines[i];
        if (line.indexOf('âš ï¸') === 0 || line.indexOf('Alertas') !== -1) {
            formattedText += '<div style="background:#ffebee;padding:10px;border-radius:6px;margin:8px 0;border-left:3px solid #d32f2f;color:#c62828;">' + line + '</div>';
        } else if (line.match(/^\d+\./)) {
            formattedText += '<div style="margin:6px 0;padding-left:8px;border-left:2px solid #1a6b4a;">' + line + '</div>';
        } else if (line.indexOf('Pasos:') === 0 || line.indexOf('Tratamiento:') === 0) {
            formattedText += '<h4 style="color:#1a6b4a;margin:14px 0 6px;font-size:.95rem;">' + line + '</h4>';
        } else {
            formattedText += '<p style="margin:4px 0;">' + line + '</p>';
        }
    }
    bodyHtml += formattedText;
    
    document.getElementById('urgProtoModalBody').innerHTML = bodyHtml;
    
    var pdfDiv = document.getElementById('urgProtoModalPdf');
    if (p.pdfUrl) {
        pdfDiv.style.display = 'block';
        document.getElementById('urgProtoModalPdfLink').href = p.pdfUrl.replace('/preview', '/view');
    } else {
        pdfDiv.style.display = 'none';
    }
    
    document.getElementById('urgProtoModal').style.display = 'block';
    document.body.style.overflow = 'hidden';
}

function urgCloseModal() {
    document.getElementById('urgProtoModal').style.display = 'none';
    document.body.style.overflow = '';
}

function urgQuickAsk(q) {
    document.getElementById('urgPreguntaInput').value = q;
    urgHacerPregunta();
}

async function urgHacerPregunta() {
    var input = document.getElementById('urgPreguntaInput');
    var q = input.value.trim();
    if (!q || urgProcessing) return;
    if (!isReady()) {
        alert('âš™ï¸ Configura tu API Key primero en Protocolos de AtenciÃ³n Primaria > Config IA');
        return;
    }
    urgProcessing = true;
    document.getElementById('urgBtnPreguntar').disabled = true;
    
    var sel = document.getElementById('urgProtoSelect').value;
    var contextText = '';
    if (sel === 'all') {
        for (var k in URG_PROTOCOLS) contextText += '\n\n--- ' + URG_PROTOCOLS[k].title + ' (' + URG_PROTOCOLS[k].category + ') ---\n' + URG_PROTOCOLS[k].text;
    } else if (URG_PROTOCOLS[sel]) {
        contextText = URG_PROTOCOLS[sel].text;
    }
    
    urgPreguntas.push({ pregunta: q, respuesta: 'â³ Consultando...', fecha: new Date().toLocaleString('es-ES') });
    input.value = '';
    urgRenderPreguntas();
    
    var sys = 'Eres un mÃ©dico de urgencias experto. Responde basÃ¡ndote ÃšNICAMENTE en los protocolos de urgencias proporcionados. SÃ© conciso, clÃ­nico y prÃ¡ctico. Usa viÃ±etas cuando ayude a la claridad. Responde en espaÃ±ol.\n\nPROTOCOLOS:\n' + contextText;
    
    var r = await llamarIA(q, sys);
    urgPreguntas[urgPreguntas.length - 1].respuesta = r;
    urgRenderPreguntas();
    urgProcessing = false;
    document.getElementById('urgBtnPreguntar').disabled = false;
}

function urgRenderPreguntas() {
    var el = document.getElementById('urgPreguntasList');
    if (urgPreguntas.length === 0) {
        el.innerHTML = '<div style="text-align:center;padding:30px;opacity:.5;"><div style="font-size:2rem;margin-bottom:8px;">ğŸ©º</div><p>Haz tu primera pregunta sobre urgencias</p></div>';
        return;
    }
    el.innerHTML = urgPreguntas.slice().reverse().map(function(p) {
        return '<div style="background:rgba(255,255,255,.08);padding:14px;border-radius:8px;margin-bottom:10px;border-left:3px solid #d32f2f;"><div style="font-weight:600;margin-bottom:8px;font-size:.9rem;">â“ '+esc(p.pregunta)+'</div><div style="font-size:.88rem;opacity:.9;line-height:1.6;white-space:pre-wrap;">'+esc(p.respuesta)+'</div><div style="font-size:.75rem;opacity:.4;margin-top:8px;">'+p.fecha+'</div></div>';
    }).join('');
}

document.addEventListener('DOMContentLoaded', function() {
    var urgInput = document.getElementById('urgPreguntaInput');
    if (urgInput) urgInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') urgHacerPregunta(); });
    var urgModal = document.getElementById('urgProtoModal');
    if (urgModal) urgModal.addEventListener('click', function(e) { if (e.target === this) urgCloseModal(); });
});


// â•â•â• PAGE NAVIGATION â•â•â•
var PAGES_REQUIRE_LOGIN=["pageTelefonos","pageProtocolosAP"];
function showPage(id){
    if(PAGES_REQUIRE_LOGIN.indexOf(id)!==-1){
        var user=firebase.auth().currentUser;
        if(!user){
            pendingPageAfterLogin=id;
            try{
                document.getElementById("scanLoginModal").style.display="flex";
                document.getElementById("scanLoginError").style.display="none";
            }catch(e){console.error(e);}
            return;
        }
        logPageAccess(id,user);
    }
    document.querySelectorAll(".page").forEach(function(p){p.classList.remove("active")});
    document.getElementById(id).classList.add("active");
    if(id==="pageProfessionals")initProfessionals();
}
var pendingPageAfterLogin=null;
function logPageAccess(pageId,user){
    try{
        db.collection("accesos_profesionales").add({
            pagina:pageId,
            email:user.email||"",
            nombre:user.displayName||"",
            uid:user.uid,
            fecha:new Date(),
            timestamp:Date.now()
        });
    }catch(e){console.error("Log access error:",e);}
}

// â•â•â• PROFESSIONALS LOGIC (all existing code) â•â•â•
var categories={"CardiologÃ­a":"â¤ï¸","DermatologÃ­a":"ğŸ©¹","Digestivo":"ğŸ«","EndocrinologÃ­a":"ğŸ§¬","GeriatrÃ­a":"ğŸ‘´","GinecologÃ­a":"ğŸ¤°","NeurologÃ­a":"ğŸ§ ","NeumologÃ­a":"ğŸ’¨","PediatrÃ­a":"ğŸ‘¶","TraumatologÃ­a":"ğŸ¦´","Protocolos MÃ©dicos":"ğŸ“‹"};
var currentCategory="CardiologÃ­a",documents={},preguntas={},notas={},isProcessing=false,profInitialized=false;
var CONFIG={provider:"groq",groqKey:"",groqModel:"qwen/qwen3-32b",qwenKey:"",qwenModel:"qwen-turbo"};
try{var s=localStorage.getItem("notebook_ai_cfg_v3");if(s)Object.assign(CONFIG,JSON.parse(s));}catch(e){}
var ENDPOINTS={groq:{url:"https://api.groq.com/openai/v1/chat/completions",getKey:function(){return CONFIG.groqKey},getModel:function(){return CONFIG.groqModel},prefix:"gsk_"},qwen:{url:"https://dashscope-intl.aliyuncs.com/compatible-mode/v1/chat/completions",getKey:function(){return CONFIG.qwenKey},getModel:function(){return CONFIG.qwenModel},prefix:"sk-"}};
function ep(){return ENDPOINTS[CONFIG.provider]||ENDPOINTS.groq}
function isReady(){var e=ep();var k=e.getKey();return k&&k.startsWith(e.prefix)}
function updateStatus(){var el=document.getElementById("statusBadge"),b=document.getElementById("modelBadge"),i=document.getElementById("modelInfo");if(!el)return;if(isReady()){el.className="nav-status ok";el.textContent="âœ… IA Conectada";b.textContent=ep().getModel().split("/").pop();i.textContent=CONFIG.provider==="groq"?"Groq Â· Gratuito":"Qwen Â· Alibaba";}else{el.className="nav-status wait";el.textContent="âš™ï¸ Config";b.textContent="--";i.textContent="Configura API Key";}}
function cambiarProvider(){var v=document.getElementById("cfgProvider").value;document.getElementById("groqConfig").style.display=v==="groq"?"block":"none";document.getElementById("qwenConfig").style.display=v==="qwen"?"block":"none";}
async function fetchWithCorsProxy(url,options){try{var r=await fetch(url,options);return r;}catch(e){console.log("Direct failed, trying proxy...");} var proxies=["https://corsproxy.io/?url=","https://api.allorigins.win/raw?url="];for(var i=0;i<proxies.length;i++){try{return await fetch(proxies[i]+encodeURIComponent(url),options);}catch(e){}}throw new Error("No se pudo conectar.");}
async function llamarIA(up,sp){if(!isReady())return"âš ï¸ Configura API Key en âš™ï¸ Config";var e=ep();try{var r=await fetchWithCorsProxy(e.url,{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+e.getKey()},body:JSON.stringify({model:e.getModel(),messages:[{role:"system",content:sp||"Eres un asistente mÃ©dico. Responde en espaÃ±ol."},{role:"user",content:up}],temperature:.7,max_tokens:2048})});if(!r.ok){var err=await r.json().catch(function(){return{}});if(r.status===401)return"âŒ API Key invÃ¡lida";if(r.status===429)return"â³ LÃ­mite. Espera.";return"âŒ Error "+r.status+": "+(err.error&&err.error.message?err.error.message:"");}var d=await r.json();var c=(d.choices&&d.choices[0]&&d.choices[0].message)?d.choices[0].message.content:"Sin respuesta";return c.replace(/<think>[\s\S]*?<\/think>/g,"").trim()||"Sin respuesta";}catch(e){return"âŒ "+e.message}}
async function hacerPregunta(){var input=document.getElementById("preguntaInput"),q=input.value.trim();if(!q||isProcessing)return;if(!isReady()){switchTab("config",document.querySelectorAll(".tab-btn")[4]);return;}isProcessing=true;document.getElementById("btnPreguntar").disabled=true;if(!preguntas[currentCategory])preguntas[currentCategory]=[];var idx=preguntas[currentCategory].length;preguntas[currentCategory].push({pregunta:q,respuesta:"â³ Consultando...",fecha:new Date().toLocaleString("es-ES")});input.value="";actualizarUI();var docs=documents[currentCategory]||[];var dc=docs.map(function(d){return"- "+d.name}).join("\n");var sys="Eres un asistente mÃ©dico especializado en "+currentCategory+". Responde en espaÃ±ol."+(dc?"\nDocs:\n"+dc:"");var r=await llamarIA(q,sys);preguntas[currentCategory][idx].respuesta=r;guardarDatos();actualizarUI();isProcessing=false;document.getElementById("btnPreguntar").disabled=false;}
var studioPrompts={resumen:{title:"ğŸ“‹ Resumen â€” ",prompt:"Resumen ejecutivo sobre {cat}: patologÃ­as, diagnÃ³sticos, tratamientos."},faq:{title:"â“ FAQ â€” ",prompt:"8 preguntas frecuentes sobre {cat} con respuestas."},guia:{title:"ğŸ“– GuÃ­a â€” ",prompt:"GuÃ­a de estudio {cat}: conceptos, clasificaciones, fÃ¡rmacos, dosis."},diagnostico:{title:"ğŸ©º Dx â€” ",prompt:"DiagnÃ³stico diferencial de {cat}: sÃ­ntomas, pruebas, red flags."},farmacologia:{title:"ğŸ’Š Farma â€” ",prompt:"FarmacologÃ­a {cat}: grupos, mecanismo, dosis, efectos adversos."},emergencia:{title:"ğŸš¨ Urgencia â€” ",prompt:"Protocolos emergencia {cat}: reconocimiento, tratamiento, dosis."}};
var lastSC="",lastST="";
async function studioAction(t){if(!isReady()||isProcessing)return;var c=studioPrompts[t];if(!c)return;isProcessing=true;document.querySelectorAll(".studio-card").forEach(function(x){x.disabled=true});var rd=document.getElementById("studioResult"),cd=document.getElementById("studioResultContent");lastST=c.title+currentCategory;document.getElementById("studioResultTitle").textContent=lastST;cd.textContent="â³ Generando...";rd.style.display="block";lastSC=await llamarIA(c.prompt.replace(/\{cat\}/g,currentCategory),"Experto mÃ©dico. Responde en espaÃ±ol.");cd.textContent=lastSC;isProcessing=false;document.querySelectorAll(".studio-card").forEach(function(x){x.disabled=false});}
function guardarStudioComoNota(){if(!lastSC)return;if(!notas[currentCategory])notas[currentCategory]=[];notas[currentCategory].push({texto:lastST+"\n\n"+lastSC,fecha:new Date().toLocaleString("es-ES")});guardarDatos();actualizarUI();alert("âœ… Guardado")}
function agregarNota(){var t=document.getElementById("noteInput").value.trim();if(!t)return;if(!notas[currentCategory])notas[currentCategory]=[];notas[currentCategory].push({texto:t,fecha:new Date().toLocaleString("es-ES")});document.getElementById("noteInput").value="";guardarDatos();actualizarUI();}
function eliminarNota(i){if(!confirm("Â¿Eliminar?"))return;notas[currentCategory].splice(i,1);guardarDatos();actualizarUI();}
function switchTab(n,b){document.querySelectorAll(".tab-content").forEach(function(t){t.classList.remove("active")});document.querySelectorAll(".tab-btn").forEach(function(x){x.classList.remove("active")});document.getElementById(n).classList.add("active");if(b)b.classList.add("active");if(n==="guardiaPacientes")gpRender("");}
function cambiarCategoria(c,b){currentCategory=c;document.querySelectorAll(".category-btn").forEach(function(x){x.classList.remove("active")});if(b)b.classList.add("active");document.getElementById("categoryTitle").textContent=c;var sc=document.getElementById("studioCategory");if(sc)sc.textContent=c;switchTab("preguntas",document.querySelector(".tab-btn"));actualizarUI();}
function esc(t){if(!t)return"";return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}
function actualizarUI(){var docs=documents[currentCategory]||[];document.getElementById("documentosList").innerHTML=docs.length===0?'<div class="empty-state"><div class="empty-state-icon">ğŸ“„</div><p>No hay documentos</p></div>':docs.map(function(d){return'<div class="doc-item"><div><div class="doc-name">'+d.name+'</div><div class="doc-size">'+d.size_mb+' MB Â· '+d.type+'</div></div><a href="'+d.url+'" target="_blank" class="doc-btn">Abrir</a></div>'}).join("");document.getElementById("docsCount").textContent=docs.length;document.getElementById("preguntasCount").textContent=(preguntas[currentCategory]||[]).length;document.getElementById("notasCount").textContent=(notas[currentCategory]||[]).length;var pa=preguntas[currentCategory]||[],pl=document.getElementById("preguntasList");pl.innerHTML=pa.length===0?'<div class="empty-state"><div class="empty-state-icon">ğŸ©º</div><p>Haz tu primera pregunta</p></div>':pa.map(function(p){return'<div class="question-box"><div class="question-text">'+esc(p.pregunta)+'</div><div class="answer-text">'+esc(p.respuesta)+'</div><div class="note-time">'+p.fecha+'</div></div>'}).join("");var na=notas[currentCategory]||[],nl=document.getElementById("notasList");nl.innerHTML=na.length===0?'<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><p>Sin notas</p></div>':na.map(function(n,i){return'<div class="question-box" style="border-left-color:var(--accent)"><div style="font-size:.92rem;white-space:pre-wrap;padding-right:30px;font-weight:300;line-height:1.6">'+esc(n.texto)+'</div><div class="note-time">'+n.fecha+'</div><button onclick="eliminarNota('+i+')" style="position:absolute;top:12px;right:12px;background:none;border:none;cursor:pointer;opacity:.35">ğŸ—‘ï¸</button></div>'}).join("");}
function guardarConfig(){CONFIG.provider=document.getElementById("cfgProvider").value;CONFIG.groqKey=document.getElementById("cfgGroqKey").value.trim();CONFIG.groqModel=document.getElementById("cfgGroqModel").value;CONFIG.qwenKey=document.getElementById("cfgQwenKey").value.trim();CONFIG.qwenModel=document.getElementById("cfgQwenModel").value;localStorage.setItem("notebook_ai_cfg_v3",JSON.stringify(CONFIG));updateStatus();document.getElementById("cfgStatus").innerHTML='<span style="color:var(--primary)">âœ… Guardado</span>';}
async function testApiKey(){guardarConfig();if(!isReady()){document.getElementById("cfgStatus").innerHTML='<span style="color:#dc2626">âŒ Key invÃ¡lida</span>';return;}var st=document.getElementById("cfgStatus");st.innerHTML='<span style="color:var(--accent)">â³ Probando...</span>';var e=ep();try{var r=await fetchWithCorsProxy(e.url,{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+e.getKey()},body:JSON.stringify({model:e.getModel(),messages:[{role:"user",content:"Di: OK"}],max_tokens:10})});if(r.ok)st.innerHTML='<span style="color:var(--primary)">âœ… Â¡ConexiÃ³n exitosa!</span>';else if(r.status===401)st.innerHTML='<span style="color:#dc2626">âŒ Key invÃ¡lida</span>';else{var err=await r.json().catch(function(){return{}});st.innerHTML='<span style="color:#dc2626">âŒ Error '+r.status+"</span>";}}catch(err){st.innerHTML='<span style="color:#dc2626">âŒ '+err.message+"</span>";}}
function guardarDatos(){localStorage.setItem("cartagena_preguntas",JSON.stringify(preguntas));localStorage.setItem("cartagena_notas",JSON.stringify(notas));}
function cargarDatos(){try{preguntas=JSON.parse(localStorage.getItem("cartagena_preguntas"))||{};}catch(e){preguntas={};}try{notas=JSON.parse(localStorage.getItem("cartagena_notas"))||{};}catch(e){notas={};}}

function initProfessionals(){
    if(profInitialized)return;profInitialized=true;
    var p=new URLSearchParams(window.location.search),c=p.get("category");if(c&&categories[c])currentCategory=c;
    var list=document.getElementById("categoriesList");
    Object.keys(categories).forEach(function(cat){var btn=document.createElement("button");btn.className="category-btn"+(cat===currentCategory?" active":"");btn.innerHTML='<span class="cat-emoji">'+categories[cat]+'</span>'+cat;btn.onclick=function(){cambiarCategoria(cat,btn)};list.appendChild(btn);});
    document.getElementById("categoryTitle").textContent=currentCategory;
    document.getElementById("cfgProvider").value=CONFIG.provider;cambiarProvider();
    document.getElementById("cfgGroqKey").value=CONFIG.groqKey||"";document.getElementById("cfgGroqModel").value=CONFIG.groqModel;
    document.getElementById("cfgQwenKey").value=CONFIG.qwenKey||"";document.getElementById("cfgQwenModel").value=CONFIG.qwenModel;
    cargarDatos();updateStatus();actualizarUI();
    fetch("documents.json").then(function(r){return r.json()}).then(function(d){documents=d.categories;actualizarUI();}).catch(function(){});
    document.getElementById("preguntaInput").addEventListener("keypress",function(e){if(e.key==="Enter")hacerPregunta()});
    if(!isReady())setTimeout(function(){switchTab("config",document.querySelectorAll(".tab-btn")[4])},500);
}

// â•â•â• SCAN IA MODULE â•â•â•
var SCAN_PWD="gmail";
var scanType="derma";
var scanB64=null;
var scanHist=JSON.parse(localStorage.getItem("scan_hist_v2")||"[]");
var SCAN_GROQ_KEY_DEFAULT="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";
var SCAN_GROQ_MODEL_DEFAULT="meta-llama/llama-4-scout-17b-16e-instruct";
function getScanGroqKey(){return CONFIG.groqKey||SCAN_GROQ_KEY_DEFAULT;}
function getScanGroqModel(){return SCAN_GROQ_MODEL_DEFAULT;}
var SCAN_GROQ_KEY=getScanGroqKey();
var SCAN_GROQ_MODEL=SCAN_GROQ_MODEL_DEFAULT;
var SCAN_PROMPTS={
derma:"Eres un dermatÃ³logo experto realizando una evaluaciÃ³n docente de una imagen clÃ­nica de piel.\n\nDataset de referencia: ISIC Archive (International Skin Imaging Collaboration).\nArquitectura de IA sugerida: Vision Transformers (ViT).\n\nAnaliza siguiendo esta estructura:\n1. **DescripciÃ³n de la lesiÃ³n**: MorfologÃ­a, color, bordes, distribuciÃ³n\n2. **DiagnÃ³stico diferencial**: 3-5 diagnÃ³sticos mÃ¡s probables\n3. **Hallazgos clave**: Elementos que apoyan cada diagnÃ³stico\n4. **Signos de alarma**: Criterios ABCDE de melanoma\n5. **ClasificaciÃ³n ISIC**: Tipo de lesiÃ³n segÃºn taxonomÃ­a ISIC\n6. **RecomendaciÃ³n**: Siguiente paso clÃ­nico\n\nIMPORTANTE: Herramienta DOCENTE. El diagnÃ³stico definitivo requiere valoraciÃ³n presencial.",
torax:"Eres un radiÃ³logo torÃ¡cico subespecializado con experiencia en detecciÃ³n de nÃ³dulos pulmonares y lectura sistemÃ¡tica de radiografÃ­a de tÃ³rax.\n\nDatasets de referencia: CheXpert (Stanford), MIMIC-CXR (MIT), NIH ChestX-ray14, LIDC-IDRI (Lung Nodule Analysis), LUNA16.\nArquitectura de IA sugerida: DenseNet-121, ResNet-50, modelos de detecciÃ³n tipo RetinaNet/YOLO para nÃ³dulos.\nEquivalente comercial: Siemens AI-Rad Companion Chest CT, Lunit INSIGHT CXR.\n\nINSTRUCCIONES CRÃTICAS:\n- Examina CADA zona del pulmÃ³n meticulosamente buscando opacidades focales, nÃ³dulos, masas o densidades anÃ³malas.\n- Divide cada pulmÃ³n en 3 zonas (superior, media, inferior) y 2 regiones (central/perifÃ©rica) = 12 zonas a examinar.\n- Presta especial atenciÃ³n a zonas donde los nÃ³dulos se ocultan: detrÃ¡s del corazÃ³n, hilios, detrÃ¡s de costillas, Ã¡pices, Ã¡ngulos costofrÃ©nicos, regiÃ³n retrocardÃ­aca.\n- Si detectas CUALQUIER opacidad redondeada o nodular, descrÃ­bela con mÃ¡ximo detalle.\n\nANÃLISIS SISTEMÃTICO:\n\n1. **CALIDAD TÃ‰CNICA**: ProyecciÃ³n (PA/AP), rotaciÃ³n (apÃ³fisis espinosas centradas), grado de inspiraciÃ³n (>6 arcos costales anteriores), penetraciÃ³n adecuada.\n\n2. **BÃšSQUEDA ACTIVA DE NÃ“DULOS Y MASAS** (SECCIÃ“N PRIORITARIA):\n   - Recorre cada una de las 12 zonas pulmonares.\n   - Para CADA nÃ³dulo u opacidad focal detectada, reporta:\n     a) LOCALIZACIÃ“N: Campo pulmonar (derecho/izquierdo), zona (superior/media/inferior), regiÃ³n (central/perifÃ©rica/subpleural). Usa coordenadas relativas en la imagen.\n     b) TAMAÃ‘O estimado en mm (comparar con estructuras conocidas: cuerpo vertebral ~25mm, costilla ~10mm grosor).\n     c) FORMA: Redondeada, ovalada, irregular, lobulada, espiculada.\n     d) DENSIDAD: SÃ³lido, parcialmente sÃ³lido (vidrio deslustrado con componente sÃ³lido), vidrio deslustrado puro.\n     e) BORDES: Bien definidos, mal definidos, espiculados, lobulados, corona radiata.\n     f) CALCIFICACIÃ“N: Central, laminada, popcorn, difusa, excÃ©ntrica (las excÃ©ntricas son sospechosas).\n     g) CAVITACIÃ“N: Presente/ausente, grosor de pared (fina <4mm sugiere benigno, gruesa >15mm sospechosa).\n     h) SIGNO DE BRONCOGRAMA AÃ‰REO.\n     i) RELACIÃ“N con estructuras: Cisuras, vasos, bronquios, pared torÃ¡cica, mediastino.\n   - CLASIFICACIÃ“N del nÃ³dulo segÃºn tamaÃ±o:\n     â€¢ MicronÃ³dulo: <3mm\n     â€¢ NÃ³dulo pequeÃ±o: 3-6mm\n     â€¢ NÃ³dulo intermedio: 6-8mm\n     â€¢ NÃ³dulo grande: 8-30mm\n     â€¢ Masa: >30mm\n   - RIESGO segÃºn Fleischner Society Guidelines 2017:\n     â€¢ <6mm en bajo riesgo: No seguimiento\n     â€¢ 6-8mm: TC control a 6-12 meses\n     â€¢ >8mm: TC, PET-TC o biopsia\n   - LUNG-RADS (si aplica): CategorÃ­a 1-4.\n\n3. **MEDIASTINO**: Silueta cardÃ­aca (ICT normal <0.5), hilios (tamaÃ±o, densidad, adenopatÃ­as), trÃ¡quea (centrada/desviada), botÃ³n aÃ³rtico, ventana aortopulmonar, lÃ­neas mediastÃ­nicas.\n\n4. **CAMPOS PULMONARES**: Transparencia global, patrÃ³n intersticial vs alveolar, consolidaciones, atelectasias, signos de hiperinsuflaciÃ³n, marcas vasculares.\n\n5. **PLEURA**: Derrame (menisco, borramiento de senos), neumotÃ³rax (lÃ­nea pleural visible, signo del surco profundo), engrosamiento pleural, placas pleurales.\n\n6. **ESTRUCTURAS Ã“SEAS**: Lesiones lÃ­ticas/blÃ¡sticas en costillas, clavÃ­culas, hÃºmeros, columna. Fracturas patolÃ³gicas.\n\n7. **DIAFRAGMA Y ABDOMEN SUPERIOR**: Ãngulos costofrÃ©nicos, aire subdiafragmÃ¡tico, cÃ¡mara gÃ¡strica.\n\n8. **DISPOSITIVOS**: CVC, marcapasos, tubos endotraqueales, drenajes, suturas.\n\n9. **PROBABILIDADES CheXpert**: Estima probabilidad (0-100%) de las 14 patologÃ­as: Atelectasia, Cardiomegalia, ConsolidaciÃ³n, Edema, Derrame, Enfisema, Fibrosis, Hernia, InfiltraciÃ³n, Masa, NÃ³dulo, Engrosamiento pleural, NeumonÃ­a, NeumotÃ³rax. MARCA en negrita las >20%.\n\n10. **IMPRESIÃ“N DIAGNÃ“STICA**: \n    - Hallazgo principal con nivel de sospecha (baja/intermedia/alta).\n    - DiagnÃ³stico diferencial ordenado por probabilidad.\n    - Para nÃ³dulos: clasificaciÃ³n Brock Model / riesgo de malignidad estimado.\n\n11. **RECOMENDACIÃ“N SEGÃšN HALLAZGOS**:\n    - GuÃ­as Fleischner Society para nÃ³dulos incidentales.\n    - Lung-RADS para screening.\n    - Necesidad de TC, PET-TC, broncoscopia, biopsia guiada.\n\nâš ï¸ RECUERDA: HERRAMIENTA DOCENTE. No sustituye diagnÃ³stico mÃ©dico profesional. Toda imagen sospechosa requiere confirmaciÃ³n con TC de alta resoluciÃ³n.",
osea:"Eres un radiÃ³logo especializado en musculoesquelÃ©tico realizando una lectura docente de una radiografÃ­a Ã³sea.\n\nDatasets de referencia: MURA (Stanford - Fracturas musculoesquelÃ©ticas), RSNA Bone Age.\nArquitectura de IA sugerida: EfficientNet-B4 o Inception-v3.\nEquivalente comercial: Siemens AI-Rad Companion Bone Age.\n\nAnaliza siguiendo esta estructura:\n1. **Tipo de estudio**: RegiÃ³n anatÃ³mica, proyecciÃ³n, calidad\n2. **AlineaciÃ³n Ã³sea**: Congruencia articular, luxaciones, subluxaciones\n3. **Densidad Ã³sea**: Osteopenia, osteoporosis, lesiones lÃ­ticas/blÃ¡sticas\n4. **Cortical**: Integridad, lÃ­neas de fractura, reacciÃ³n periÃ³stica\n5. **Partes blandas**: TumefacciÃ³n, calcificaciones, derrame articular\n6. **ClasificaciÃ³n MURA**: Normal vs Anormal con probabilidad estimada\n7. **Si fractura**: Tipo (transversa, oblicua, espiral, conminuta), desplazamiento\n8. **Edad Ã³sea**: Si aplica, estimaciÃ³n segÃºn Greulich-Pyle\n9. **RecomendaciÃ³n**: Siguiente paso clÃ­nico\n\nHerramienta DOCENTE.",
abdomen:"Eres un radiÃ³logo experto realizando una lectura docente de una imagen abdominal (Rx o TC).\n\nDatasets de referencia: DeepLesion (NIH), AbdomenCT-1K.\nArquitectura de IA sugerida: U-Net (segmentaciÃ³n), ResNet-50 (clasificaciÃ³n).\nEquivalente comercial: Siemens Syngo.via Segmentation.\n\nAnaliza siguiendo esta estructura:\n1. **Tipo de estudio**: Rx simple, TC con/sin contraste, proyecciÃ³n\n2. **PatrÃ³n de gas**: DistribuciÃ³n intestinal, niveles hidroaÃ©reos, neumoperitoneo\n3. **VÃ­sceras sÃ³lidas**: HÃ­gado, bazo, riÃ±ones (tamaÃ±o, contorno, calcificaciones)\n4. **Calcificaciones**: Vesiculares, renales, pancreÃ¡ticas, vasculares, apendiculito\n5. **Estructuras Ã³seas**: Columna lumbar, pelvis, caderas\n6. **Partes blandas**: LÃ­neas grasas, psoas, masas\n7. **SegmentaciÃ³n DeepLesion**: IdentificaciÃ³n y localizaciÃ³n de lesiones\n8. **ImpresiÃ³n diagnÃ³stica**: Hallazgos principales y diagnÃ³stico diferencial\n9. **RecomendaciÃ³n**: Siguiente paso\n\nHerramienta DOCENTE.",
ecg:"Eres un cardiÃ³logo experto interpretando un ECG de forma docente.\n\nDatasets de referencia: PTB-XL (Physikalisch-Technische Bundesanstalt), PhysioNet Challenge.\nArquitectura de IA sugerida: 1D-CNN o Transformers temporales.\nEquivalente comercial: Siemens CardioDay / Sensis.\n\nAnaliza sistemÃ¡ticamente:\n1. **Frecuencia cardÃ­aca**: CÃ¡lculo por mÃ©todo RR\n2. **Ritmo**: Sinusal o no, regularidad\n3. **Eje elÃ©ctrico**: Normal, izquierdo, derecho, extremo\n4. **Onda P**: MorfologÃ­a, duraciÃ³n, amplitud, P mitrale/pulmonale\n5. **Intervalo PR**: Normal, BAV grado\n6. **Complejo QRS**: DuraciÃ³n, morfologÃ­a, bloqueos de rama, hemibloqueos\n7. **Segmento ST**: ElevaciÃ³n/depresiÃ³n, localizaciÃ³n, patrÃ³n\n8. **Onda T**: InversiÃ³n, hiperagudas, aplanamiento\n9. **QT/QTc**: CÃ¡lculo y valoraciÃ³n\n10. **ClasificaciÃ³n PTB-XL**: CategorÃ­a diagnÃ³stica segÃºn dataset\n11. **ImpresiÃ³n diagnÃ³stica**: Hallazgos y correlaciÃ³n clÃ­nica\n\nHerramienta DOCENTE.",
eco:"Eres un especialista en imagen cardÃ­aca interpretando una ecografÃ­a de forma docente.\n\nDatasets de referencia: EchoNet-Dynamic (Stanford).\nArquitectura de IA sugerida: R-CNN (segmentaciÃ³n dinÃ¡mica), 3D-CNN.\nEquivalente comercial: Siemens ACUSON (eSie Measure / eSie Left).\n\nAnaliza siguiendo esta estructura:\n1. **Plano ecogrÃ¡fico**: Paraesternal largo/corto, apical 4C/2C, subcostal\n2. **VentrÃ­culo izquierdo**: TamaÃ±o, grosor parietal, contractilidad segmentaria\n3. **FunciÃ³n sistÃ³lica**: FEVI estimada (EchoNet-Dynamic: predicciÃ³n automatizada)\n4. **VÃ¡lvulas**: MorfologÃ­a, regurgitaciÃ³n, estenosis (aÃ³rtica, mitral, tricÃºspide)\n5. **AurÃ­cula izquierda**: TamaÃ±o, volumen indexado\n6. **VentrÃ­culo derecho**: TamaÃ±o, TAPSE, funciÃ³n\n7. **Pericardio**: Derrame, engrosamiento\n8. **Aorta**: RaÃ­z aÃ³rtica, dilataciÃ³n\n9. **EstimaciÃ³n EchoNet**: FEVI y clasificaciÃ³n funcional\n10. **ImpresiÃ³n diagnÃ³stica**: Hallazgos principales\n11. **RecomendaciÃ³n**: Siguiente paso\n\nHerramienta DOCENTE."
};
var SCAN_LABELS={derma:"ğŸ©¹ DermatologÃ­a",torax:"ğŸ« Rx TÃ³rax",osea:"ğŸ¦´ Rx Ã“sea",abdomen:"ğŸ”¬ Rx Abdomen",ecg:"ğŸ’“ ECG",eco:"ğŸ«€ EcografÃ­a"};
var SCAN_MODELS={
    derma:{model:"Vision Transformers (ViT)",dataset:"ISIC Archive (International Skin Imaging Collaboration)",arch:"ViT",commercial:"â€”"},
    torax:{model:"DenseNet-121 / RetinaNet (nÃ³dulos)",dataset:"CheXpert + MIMIC-CXR + NIH ChestX-ray14 + LIDC-IDRI + LUNA16",arch:"DenseNet-121 + RetinaNet",commercial:"Siemens AI-Rad Companion + Lunit INSIGHT CXR"},
    osea:{model:"EfficientNet-B4 / Inception-v3",dataset:"MURA (Stanford) + RSNA Bone Age",arch:"EfficientNet-B4",commercial:"Siemens AI-Rad Companion Bone Age"},
    abdomen:{model:"U-Net + ResNet-50",dataset:"DeepLesion (NIH) + AbdomenCT-1K",arch:"U-Net",commercial:"Siemens Syngo.via"},
    ecg:{model:"1D-CNN / Transformers",dataset:"PTB-XL + PhysioNet Challenge",arch:"1D-CNN",commercial:"Siemens CardioDay / Sensis"},
    eco:{model:"R-CNN / 3D-CNN",dataset:"EchoNet-Dynamic (Stanford)",arch:"R-CNN",commercial:"Siemens ACUSON (eSie Measure)"}
};

// Emails autorizados para Scan IA (aÃ±ade los que quieras)
var SCAN_ALLOWED_EMAILS=["ramongalera22@gmail.com"];

function showScanLogin(){
    console.log("showScanLogin called");
    try{
        var user=firebase.auth().currentUser;
        if(user){
            console.log("User already logged in:",user.email);
            showPage("pageScanIA");scanRenderHist();return;
        }
        var m=document.getElementById("scanLoginModal");
        console.log("Showing modal",m);
        m.style.display="flex";
        document.getElementById("scanLoginError").style.display="none";
    }catch(e){console.error("showScanLogin error:",e);alert("Error: "+e.message);}
}

function scanGoogleLogin(){
    console.log("scanGoogleLogin called");
    var provider=new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider).then(function(result){
        console.log("Login success:",result.user.email);
        document.getElementById("scanLoginModal").style.display="none";
        if(pendingPageAfterLogin){
            var pg=pendingPageAfterLogin;pendingPageAfterLogin=null;
            logPageAccess(pg,result.user);
            showPage(pg);
        }else{
            showPage("pageScanIA");scanRenderHist();
        }
    }).catch(function(error){
        console.error("Google login error:",error);
        if(error.code==="auth/popup-blocked"||error.code==="auth/popup-closed-by-browser"){
            console.log("Popup blocked, trying redirect...");
            firebase.auth().signInWithRedirect(provider);
        }else{
            document.getElementById("scanLoginError").innerHTML="âŒ "+error.message;
            document.getElementById("scanLoginError").style.display="block";
        }
    });
}

function scanSetType(t,btn){scanType=t;document.querySelectorAll(".scan-mode-btn").forEach(function(b){b.style.borderColor="var(--border)";b.style.background="var(--bg-card)";b.style.color="var(--text)";});if(btn){btn.style.borderColor="#0066cc";btn.style.background="linear-gradient(135deg,#0066cc,#004499)";btn.style.color="#fff";}var m=SCAN_MODELS[t];if(m){document.getElementById("scanModelRef").innerHTML="Modelo: <strong>"+m.model+"</strong> Â· Dataset: <strong>"+m.dataset+"</strong>"+(m.commercial!=="â€”"?" Â· Equiv. comercial: <strong>"+m.commercial+"</strong>":"")+" Â· AnÃ¡lisis por Llama 4 Scout (Groq)";}}
function scanHandleFile(e){var f=e.target.files[0];if(f)scanProcessFile(f);}
function scanProcessFile(f){if(!f.type.startsWith("image/")){alert("Selecciona una imagen");return;}var r=new FileReader();r.onload=function(e){var d=e.target.result;scanB64=d.split(",")[1];document.getElementById("scanImgPreview").src=d;document.getElementById("scanImgPreview").style.display="block";document.getElementById("scanDropContent").style.display="none";document.getElementById("scanDropZone").style.borderStyle="solid";document.getElementById("scanDropZone").style.borderColor="#0066cc";document.getElementById("scanBtnGo").disabled=false;};r.readAsDataURL(f);}
(function(){var z=document.getElementById("scanDropZone");if(z){z.addEventListener("dragover",function(e){e.preventDefault();z.style.borderColor="#0066cc";z.style.background="rgba(0,102,204,.04)";});z.addEventListener("dragleave",function(){z.style.borderColor="var(--border)";z.style.background="var(--bg-card)";});z.addEventListener("drop",function(e){e.preventDefault();z.style.borderColor="var(--border)";z.style.background="var(--bg-card)";if(e.dataTransfer.files.length)scanProcessFile(e.dataTransfer.files[0]);});}})();

function scanClear(){scanB64=null;document.getElementById("scanImgPreview").style.display="none";document.getElementById("scanImgPreview").src="";document.getElementById("scanDropContent").style.display="block";document.getElementById("scanDropZone").style.borderStyle="dashed";document.getElementById("scanDropZone").style.borderColor="var(--border)";document.getElementById("scanFileIn").value="";document.getElementById("scanCtx").value="";document.getElementById("scanBtnGo").disabled=true;document.getElementById("scanResult").innerHTML="";}

async function scanAnalyze(){
    if(!scanB64){alert("Sube una imagen primero");return;}
    var btn=document.getElementById("scanBtnGo"),res=document.getElementById("scanResult"),ctx=document.getElementById("scanCtx").value.trim();
    btn.disabled=true;btn.innerHTML="â³ Analizando...";
    res.innerHTML='<div style="background:var(--bg-card);border:1px solid var(--border);border-left:4px solid #0066cc;border-radius:var(--radius);padding:20px;"><div style="color:#0066cc;font-weight:700;margin-bottom:8px;">ğŸ”¬ Analizando imagen...</div><div style="color:var(--text-muted);font-size:.9rem;">El modelo estÃ¡ procesando. Puede tardar unos segundos...</div></div>';
    var sys=SCAN_PROMPTS[scanType];if(ctx)sys+="\n\nContexto clÃ­nico: "+ctx;
    var mt="image/jpeg";var ps=document.getElementById("scanImgPreview").src;if(ps.indexOf("image/png")>-1)mt="image/png";
    try{
        var r=await fetch("https://api.groq.com/openai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json","Authorization":"Bearer "+getScanGroqKey()},body:JSON.stringify({model:SCAN_GROQ_MODEL,messages:[{role:"system",content:sys},{role:"user",content:[{type:"image_url",image_url:{url:"data:"+mt+";base64,"+scanB64}},{type:"text",text:ctx?"Analiza esta imagen. Contexto: "+ctx:"Analiza esta imagen mÃ©dica de forma sistemÃ¡tica."}]}],max_tokens:2000,temperature:0.3})});
        if(!r.ok){var ed=await r.json().catch(function(){return{}});throw new Error(ed.error?.message||"Error HTTP "+r.status);}
        var d=await r.json(),txt=d.choices?.[0]?.message?.content||"Sin respuesta";
        var fmt=txt.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br>");
        res.innerHTML='<div style="background:var(--bg-card);border:1px solid var(--border);border-left:4px solid #0066cc;border-radius:var(--radius);padding:20px;"><div style="color:#0066cc;font-weight:700;font-family:var(--font-display);margin-bottom:12px;">ğŸ”¬ '+SCAN_LABELS[scanType]+" â€” "+SCAN_GROQ_MODEL+'</div><div style="color:var(--text);line-height:1.7;font-size:.92rem;font-weight:300;">'+fmt+"</div></div>";
        scanHist.unshift({type:scanType,label:SCAN_LABELS[scanType],model:SCAN_GROQ_MODEL,ctx:ctx,result:txt,date:new Date().toLocaleString("es-ES")});
        if(scanHist.length>30)scanHist=scanHist.slice(0,30);
        localStorage.setItem("scan_hist_v2",JSON.stringify(scanHist));scanRenderHist();
    }catch(e){res.innerHTML='<div style="background:var(--bg-card);border:1px solid #dc2626;border-left:4px solid #dc2626;border-radius:var(--radius);padding:20px;"><div style="color:#dc2626;font-weight:700;margin-bottom:8px;">âŒ Error</div><div style="color:var(--text);font-size:.9rem;">'+e.message+"<br><br>Posibles causas: API key incorrecta, modelo no soporta imÃ¡genes, o lÃ­mite de rate.</div></div>";}
    btn.disabled=false;btn.innerHTML="ğŸ”¬ Analizar con IA";
}

function scanRenderHist(){
    var l=document.getElementById("scanHistList");if(!l)return;
    if(scanHist.length===0){l.innerHTML='<div style="text-align:center;padding:30px;color:var(--text-muted);"><div style="font-size:2.5rem;margin-bottom:10px;opacity:.5;">ğŸ”¬</div><p style="font-size:.92rem;">AÃºn no hay anÃ¡lisis</p></div>';return;}
    l.innerHTML=scanHist.map(function(h,i){return'<div onclick="scanViewHist('+i+')" style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px;margin-bottom:8px;cursor:pointer;transition:.2s;" onmouseover="this.style.borderColor=\'#0066cc\'" onmouseout="this.style.borderColor=\'var(--border)\'"><div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="font-weight:600;font-size:.85rem;color:#0066cc;">'+h.label+'</span><span style="font-size:.78rem;color:var(--text-muted);">'+h.date+'</span></div><div style="font-size:.85rem;color:var(--text-light);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;">'+h.result.substring(0,140)+"...</div></div>";}).join("");
}
function scanViewHist(i){var h=scanHist[i];if(!h)return;var fmt=h.result.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br>");document.getElementById("scanResult").innerHTML='<div style="background:var(--bg-card);border:1px solid var(--border);border-left:4px solid #0066cc;border-radius:var(--radius);padding:20px;"><div style="color:#0066cc;font-weight:700;font-family:var(--font-display);margin-bottom:12px;">ğŸ“‹ '+h.label+" â€” "+h.model+" â€” "+h.date+"</div>"+(h.ctx?'<div style="font-size:.85rem;color:var(--text-muted);margin-bottom:10px;font-style:italic;">Contexto: '+h.ctx+"</div>":"")+'<div style="color:var(--text);line-height:1.7;font-size:.92rem;font-weight:300;">'+fmt+"</div></div>";}

// â•â•â• TAB SWITCHING â•â•â•
function switchScanTab(tab){
    document.getElementById("panelScanIA").style.display=tab==="scanIA"?"block":"none";
    document.getElementById("panelNIHQuiz").style.display=tab==="nihQuiz"?"block":"none";
    document.getElementById("tabScanIA").style.background=tab==="scanIA"?"linear-gradient(135deg,#0066cc,#004499)":"var(--bg-subtle)";
    document.getElementById("tabScanIA").style.color=tab==="scanIA"?"#fff":"var(--text)";
    document.getElementById("tabNIHQuiz").style.background=tab==="nihQuiz"?"linear-gradient(135deg,#4caf50,#2e7d32)":"var(--bg-subtle)";
    document.getElementById("tabNIHQuiz").style.color=tab==="nihQuiz"?"#fff":"var(--text)";
}

// â•â•â• NIH CHEST X-RAY QUIZ MODULE â•â•â•
var NIH_CASES=[
{id:"00000001_000",label:"Cardiomegaly",age:58,sex:"M",desc:"Silueta cardÃ­aca aumentada de tamaÃ±o con Ã­ndice cardiotorÃ¡cico >0.5. Campos pulmonares sin consolidaciones."},
{id:"00000003_000",label:"No Finding",age:45,sex:"F",desc:"RadiografÃ­a de tÃ³rax PA normal. Silueta cardÃ­aca normal. Campos pulmonares limpios. Sin alteraciones pleurales."},
{id:"00000013_004",label:"Effusion",age:62,sex:"M",desc:"OpacificaciÃ³n del Ã¡ngulo costofrÃ©nico derecho compatible con derrame pleural. PulmÃ³n izquierdo sin hallazgos."},
{id:"00000032_001",label:"Infiltration",age:55,sex:"M",desc:"Infiltrados alveolares bilaterales de predominio perihiliar. PatrÃ³n intersticial difuso."},
{id:"00000040_000",label:"Atelectasis",age:71,sex:"F",desc:"PÃ©rdida de volumen del lÃ³bulo inferior izquierdo con elevaciÃ³n del hemidiafragma y desplazamiento mediastÃ­nico ipsilateral."},
{id:"00000055_001",label:"Pneumothorax",age:32,sex:"M",desc:"LÃ­nea pleural visible en hemitÃ³rax derecho con ausencia de trama vascular perifÃ©rica. Compatible con neumotÃ³rax."},
{id:"00000071_003",label:"Consolidation",age:67,sex:"F",desc:"ConsolidaciÃ³n en lÃ³bulo inferior derecho con broncograma aÃ©reo. Sugestivo de neumonÃ­a lobar."},
{id:"00000082_000",label:"Emphysema",age:74,sex:"M",desc:"HiperinsuflaciÃ³n pulmonar bilateral. Aplanamiento diafragmÃ¡tico. Aumento del espacio retroesternal. PatrÃ³n compatible con enfisema."},
{id:"00000098_002",label:"Nodule",age:53,sex:"F",desc:"NÃ³dulo pulmonar solitario de ~2cm en lÃ³bulo superior derecho. Bordes lisos. Requiere seguimiento."},
{id:"00000120_005",label:"Mass",age:66,sex:"M",desc:"Masa pulmonar de >3cm en lÃ³bulo superior izquierdo con bordes irregulares. Sospechoso de malignidad."},
{id:"00000145_001",label:"Edema",age:78,sex:"F",desc:"Edema pulmonar bilateral con patrÃ³n en alas de mariposa. RedistribuciÃ³n vascular. LÃ­neas B de Kerley. Derrame pleural bilateral."},
{id:"00000160_000",label:"Fibrosis",age:69,sex:"M",desc:"PatrÃ³n reticular bilateral de predominio basal. PanalizaciÃ³n subpleural. Compatible con fibrosis pulmonar."},
{id:"00000175_002",label:"Pleural_Thickening",age:63,sex:"M",desc:"Engrosamiento pleural bilateral con calcificaciones. Antecedentes de exposiciÃ³n a asbesto."},
{id:"00000190_000",label:"Hernia",age:72,sex:"F",desc:"Gran hernia hiatal con imagen aÃ©rea retrocardiaca. Silueta cardÃ­aca parcialmente borrada."},
{id:"00000210_001",label:"Pneumonia",age:48,sex:"M",desc:"ConsolidaciÃ³n alveolar en lÃ³bulo medio derecho con broncograma aÃ©reo. Fiebre y tos productiva."},
{id:"00000005_000",label:"Cardiomegaly",age:81,sex:"F",desc:"Cardiomegalia severa con redistribuciÃ³n vascular pulmonar. Derrame pleural bilateral leve."},
{id:"00000018_001",label:"No Finding",age:34,sex:"M",desc:"TÃ³rax PA sin hallazgos patolÃ³gicos significativos. CorazÃ³n y grandes vasos normales."},
{id:"00000050_003",label:"Effusion",age:73,sex:"F",desc:"Derrame pleural masivo izquierdo con desplazamiento mediastÃ­nico contralateral. OpacificaciÃ³n completa del hemitÃ³rax izquierdo."},
{id:"00000088_000",label:"Atelectasis",age:61,sex:"M",desc:"Atelectasia laminar en base derecha. Tractos fibrosos bilaterales. Paciente postquirÃºrgico."},
{id:"00000110_002",label:"Pneumothorax",age:25,sex:"M",desc:"NeumotÃ³rax espontÃ¡neo izquierdo con colapso pulmonar del 30%. Paciente joven, astÃ©nico."},
{id:"00000135_001",label:"Consolidation",age:59,sex:"F",desc:"ConsolidaciÃ³n multilobar bilateral. AfectaciÃ³n de lÃ³bulos inferiores. Broncograma aÃ©reo bilateral."},
{id:"00000158_000",label:"Emphysema",age:70,sex:"M",desc:"Signos de EPOC avanzado. Bullas apicales bilaterales. Aplanamiento diafragmÃ¡tico severo."},
{id:"00000180_003",label:"Nodule",age:47,sex:"M",desc:"MÃºltiples nÃ³dulos pulmonares bilaterales de tamaÃ±o variable (5-15mm). PatrÃ³n sugestivo de metÃ¡stasis."},
{id:"00000200_001",label:"Mass",age:71,sex:"F",desc:"Masa hiliar izquierda con ensanchamiento mediastÃ­nico. AdenopatÃ­as mediastÃ­nicas."},
{id:"00000225_000",label:"Edema",age:82,sex:"M",desc:"Edema pulmonar agudo. PatrÃ³n alveolar bilateral difuso. Cardiomegalia. RedistribuciÃ³n vascular cefÃ¡lica."},
{id:"00000240_002",label:"Fibrosis",age:65,sex:"F",desc:"Fibrosis pulmonar idiopÃ¡tica con patrÃ³n UIP. PanalizaciÃ³n basal bilateral. Bronquiectasias de tracciÃ³n."},
{id:"00000260_001",label:"Infiltration",age:50,sex:"M",desc:"Infiltrados intersticiales bilaterales difusos. PatrÃ³n reticulonodular. Contexto de inmunosupresiÃ³n."},
{id:"00000280_000",label:"Pneumonia",age:39,sex:"F",desc:"NeumonÃ­a de lÃ³bulo inferior izquierdo. ConsolidaciÃ³n homogÃ©nea con borde nÃ­tido (signo de la silueta)."},
{id:"00000300_003",label:"Pleural_Thickening",age:68,sex:"M",desc:"Engrosamiento pleural apical bilateral. CalcificaciÃ³n pleural izquierda."},
{id:"00000320_001",label:"Hernia",age:76,sex:"M",desc:"Hernia de Morgagni. Imagen de densidad tisular en Ã¡ngulo cardiofrÃ©nico derecho."},
{id:"00000340_000",label:"No Finding",age:29,sex:"F",desc:"RadiografÃ­a de tÃ³rax normal en mujer joven. Estructuras mediastÃ­nicas y pulmonares sin alteraciones."}
];

var NIH_LABELS_ES={"No Finding":"Normal","Atelectasis":"Atelectasia","Cardiomegaly":"Cardiomegalia","Consolidation":"ConsolidaciÃ³n","Edema":"Edema pulmonar","Effusion":"Derrame pleural","Emphysema":"Enfisema","Fibrosis":"Fibrosis","Hernia":"Hernia","Infiltration":"Infiltrado","Mass":"Masa","Nodule":"NÃ³dulo","Pleural_Thickening":"Engrosamiento pleural","Pneumonia":"NeumonÃ­a","Pneumothorax":"NeumotÃ³rax"};
var ALL_LABELS=Object.keys(NIH_LABELS_ES);
var nihMode="quiz",nihCurrentCase=null,nihScore={correct:0,wrong:0,total:0},nihUsed=[];
var nihFiltered=NIH_CASES.slice();

function nihSetMode(m){
    nihMode=m;
    document.getElementById("nihModeQuiz").style.borderColor=m==="quiz"?"#4caf50":"var(--border)";
    document.getElementById("nihModeQuiz").style.background=m==="quiz"?"#e8f5e9":"var(--bg-card)";
    document.getElementById("nihModeQuiz").style.color=m==="quiz"?"#2e7d32":"var(--text)";
    document.getElementById("nihModeCompare").style.borderColor=m==="compare"?"#0066cc":"var(--border)";
    document.getElementById("nihModeCompare").style.background=m==="compare"?"#e3f2fd":"var(--bg-card)";
    document.getElementById("nihModeCompare").style.color=m==="compare"?"#0066cc":"var(--text)";
    if(nihCurrentCase)nihShowCase(nihCurrentCase);
}

function nihFilterCases(){
    var f=document.getElementById("nihFilterPath").value;
    nihFiltered=f==="all"?NIH_CASES.slice():NIH_CASES.filter(function(c){return c.label===f;});
    nihUsed=[];
    document.getElementById("nihTotalCases").textContent=nihFiltered.length;
}

function nihReset(){
    nihScore={correct:0,wrong:0,total:0};nihUsed=[];
    document.getElementById("nihCorrect").textContent="0";
    document.getElementById("nihWrong").textContent="0";
    document.getElementById("nihTotal").textContent="0";
    document.getElementById("nihCaseImage").innerHTML='<div style="color:#fff;opacity:.5;font-size:1.1rem;">Pulsa "Siguiente caso" para empezar</div>';
    document.getElementById("nihCaseInfo").innerHTML="";
    document.getElementById("nihQuizOptions").style.display="none";
    document.getElementById("nihCompareArea").style.display="none";
    document.getElementById("nihFeedback").style.display="none";
}

function nihNextCase(){
    var avail=nihFiltered.filter(function(c){return nihUsed.indexOf(c.id)===-1;});
    if(avail.length===0){nihUsed=[];avail=nihFiltered.slice();}
    var c=avail[Math.floor(Math.random()*avail.length)];
    nihUsed.push(c.id);
    nihCurrentCase=c;
    nihShowCase(c);
}

function nihShowCase(c){
    // Generate a representative chest X-ray SVG placeholder
    var svg=nihGenerateXraySVG(c.label);
    document.getElementById("nihCaseImage").innerHTML='<div style="position:relative;width:100%;max-width:400px;margin:0 auto;">'+svg+'<div style="position:absolute;bottom:10px;left:10px;background:rgba(0,0,0,.7);color:#fff;padding:4px 10px;border-radius:4px;font-size:.75rem;">ID: '+c.id+'</div></div>';
    document.getElementById("nihCaseInfo").innerHTML='<span style="background:var(--bg-subtle);padding:4px 10px;border-radius:4px;font-size:.82rem;margin-right:8px;">ğŸ‘¤ '+c.sex+', '+c.age+' aÃ±os</span><span style="background:var(--bg-subtle);padding:4px 10px;border-radius:4px;font-size:.82rem;">ğŸ“‹ Caso #'+c.id+'</span>';
    document.getElementById("nihFeedback").style.display="none";

    if(nihMode==="quiz"){
        document.getElementById("nihQuizOptions").style.display="block";
        document.getElementById("nihCompareArea").style.display="none";
        nihRenderOptions(c);
    }else{
        document.getElementById("nihQuizOptions").style.display="none";
        document.getElementById("nihCompareArea").style.display="block";
        document.getElementById("nihGroundTruth").innerHTML='<span style="display:inline-block;background:#2e7d32;color:#fff;padding:6px 14px;border-radius:20px;font-weight:700;font-size:.9rem;">'+NIH_LABELS_ES[c.label]+'</span><p style="margin-top:10px;font-size:.85rem;color:var(--text-light);">'+c.desc+'</p>';
        document.getElementById("nihAIDiagnosis").innerHTML='<button id="nihRunIA" onclick="nihAnalyzeWithIA()" style="padding:10px 20px;background:linear-gradient(135deg,#0066cc,#004499);color:#fff;border:none;border-radius:var(--radius-sm);cursor:pointer;font-weight:700;font-family:var(--font-body);font-size:.88rem;">ğŸ”¬ Analizar con IA</button>';
    }
}

function nihRenderOptions(c){
    var opts=[c.label];
    var pool=ALL_LABELS.filter(function(l){return l!==c.label;});
    while(opts.length<4){var r=pool[Math.floor(Math.random()*pool.length)];if(opts.indexOf(r)===-1)opts.push(r);}
    // Shuffle
    for(var i=opts.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var t=opts[i];opts[i]=opts[j];opts[j]=t;}
    var html=opts.map(function(o){
        return'<button onclick="nihAnswer(\''+o+'\')" class="nih-opt-btn" style="padding:14px;border:2px solid var(--border);border-radius:var(--radius-sm);background:var(--bg-card);cursor:pointer;font-family:var(--font-body);font-size:.9rem;font-weight:600;transition:.25s;text-align:center;" onmouseover="this.style.borderColor=\'#0066cc\';this.style.background=\'#f0f7ff\'" onmouseout="this.style.borderColor=\'var(--border)\';this.style.background=\'var(--bg-card)\'">'+NIH_LABELS_ES[o]+'</button>';
    }).join("");
    document.getElementById("nihOptions").innerHTML=html;
}

function nihAnswer(ans){
    var c=nihCurrentCase;if(!c)return;
    var correct=ans===c.label;
    nihScore.total++;
    if(correct)nihScore.correct++;else nihScore.wrong++;
    document.getElementById("nihCorrect").textContent=nihScore.correct;
    document.getElementById("nihWrong").textContent=nihScore.wrong;
    document.getElementById("nihTotal").textContent=nihScore.total;

    // Disable all buttons
    document.querySelectorAll(".nih-opt-btn").forEach(function(b){
        b.onclick=null;b.style.cursor="default";
        if(b.textContent===NIH_LABELS_ES[c.label]){b.style.borderColor="#4caf50";b.style.background="#e8f5e9";b.style.color="#2e7d32";}
        if(b.textContent===NIH_LABELS_ES[ans]&&!correct){b.style.borderColor="#dc2626";b.style.background="#fef2f2";b.style.color="#dc2626";}
    });

    var fb=document.getElementById("nihFeedback");
    fb.style.display="block";
    fb.style.background=correct?"#e8f5e9":"#fef2f2";
    fb.style.borderLeft=correct?"4px solid #4caf50":"4px solid #dc2626";
    fb.innerHTML=(correct?'<strong style="color:#2e7d32;">âœ… Â¡Correcto!</strong>':'<strong style="color:#dc2626;">âŒ Incorrecto.</strong> La respuesta era: <strong>'+NIH_LABELS_ES[c.label]+'</strong>')+'<p style="margin-top:8px;font-size:.88rem;color:var(--text-light);">'+c.desc+'</p>';
}

function nihAnalyzeWithIA(){
    var c=nihCurrentCase;if(!c)return;
    var el=document.getElementById("nihAIDiagnosis");
    el.innerHTML='<div style="text-align:center;padding:20px;"><div class="scan-spinner" style="margin:0 auto 10px;width:30px;height:30px;border:3px solid var(--border);border-top-color:#0066cc;border-radius:50%;animation:spin 1s linear infinite;"></div><div style="font-size:.85rem;color:var(--text-muted);">Analizando con Llama 4 Scout...</div></div>';

    // Check if there's a real image loaded
    var imgEl=document.querySelector("#nihCaseImage img");
    var hasRealImage=imgEl&&imgEl.src&&imgEl.src.startsWith("http");

    if(hasRealImage){
        // Convert real image to base64 and send to Groq vision
        var canvas=document.createElement("canvas");
        var ctx2d=canvas.getContext("2d");
        var img=new Image();img.crossOrigin="anonymous";
        img.onload=function(){
            canvas.width=img.width;canvas.height=img.height;
            ctx2d.drawImage(img,0,0);
            try{
                var b64=canvas.toDataURL("image/jpeg",0.85);
                nihSendToGroqVision(c,b64,el);
            }catch(e){
                console.log("CORS blocked, using text-only analysis");
                nihSendTextAnalysis(c,el);
            }
        };
        img.onerror=function(){nihSendTextAnalysis(c,el);};
        img.src=imgEl.src;
    }else{
        nihSendTextAnalysis(c,el);
    }
}

function nihSendToGroqVision(c,b64,el){
    var sysPrompt="Eres un radiÃ³logo experto realizando una lectura docente de una radiografÃ­a de tÃ³rax real. Responde en espaÃ±ol de forma estructurada.";
    var userPrompt="Analiza esta radiografÃ­a de tÃ³rax real de un paciente de "+c.age+" aÃ±os ("+c.sex+").\n\n1. Hallazgos principales\n2. DiagnÃ³stico mÃ¡s probable\n3. DiagnÃ³sticos diferenciales\n4. RecomendaciÃ³n\n\nIMPORTANTE: Solo uso DOCENTE.";

    fetch("https://api.groq.com/openai/v1/chat/completions",{
        method:"POST",
        headers:{"Content-Type":"application/json","Authorization":"Bearer "+getScanGroqKey()},
        body:JSON.stringify({
            model:SCAN_GROQ_MODEL,
            messages:[{role:"system",content:sysPrompt},{role:"user",content:[{type:"image_url",image_url:{url:b64}},{type:"text",text:userPrompt}]}],
            max_tokens:1500,temperature:0.3
        })
    }).then(function(r){return r.json();}).then(function(d){
        nihDisplayIAResult(c,d,el);
    }).catch(function(e){
        console.log("Vision API failed, falling back to text:",e);
        nihSendTextAnalysis(c,el);
    });
}

function nihSendTextAnalysis(c,el){
    var prompt="Eres un radiÃ³logo experto. Analiza esta radiografÃ­a de tÃ³rax de un paciente de "+c.age+" aÃ±os ("+c.sex+").\n\nDa tu diagnÃ³stico principal y describe los hallazgos radiolÃ³gicos que observas.\nResponde en espaÃ±ol de forma estructurada:\n1. Hallazgos principales\n2. DiagnÃ³stico mÃ¡s probable\n3. DiagnÃ³sticos diferenciales\n4. RecomendaciÃ³n\n\nLos hallazgos de esta radiografÃ­a son: "+c.desc+"\n\nIMPORTANTE: Solo uso DOCENTE.";

    fetch("https://api.groq.com/openai/v1/chat/completions",{
        method:"POST",
        headers:{"Content-Type":"application/json","Authorization":"Bearer "+getScanGroqKey()},
        body:JSON.stringify({
            model:SCAN_GROQ_MODEL,
            messages:[{role:"system",content:"Eres un radiÃ³logo experto realizando una lectura docente de una radiografÃ­a de tÃ³rax."},{role:"user",content:prompt}],
            max_tokens:1500,temperature:0.3
        })
    }).then(function(r){return r.json();}).then(function(d){
        nihDisplayIAResult(c,d,el);
    }).catch(function(e){el.innerHTML='<div style="color:#dc2626;">âŒ Error de conexiÃ³n: '+e.message+'</div>';});
}

function nihDisplayIAResult(c,d,el){
    if(d.error){el.innerHTML='<div style="color:#dc2626;">âŒ Error: '+d.error.message+'</div>';return;}
    var txt=d.choices[0].message.content;
    var fmt=txt.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br>");
    el.innerHTML='<div style="line-height:1.7;font-size:.88rem;">'+fmt+'</div>';

    var fb=document.getElementById("nihFeedback");
    var iaLower=txt.toLowerCase();
    var match=iaLower.indexOf(c.label.toLowerCase().replace("_"," "))!==-1||iaLower.indexOf(NIH_LABELS_ES[c.label].toLowerCase())!==-1;
    fb.style.display="block";
    fb.style.background=match?"#e8f5e9":"#fff3cd";
    fb.style.borderLeft=match?"4px solid #4caf50":"4px solid #ffc107";
    fb.innerHTML=match?'<strong style="color:#2e7d32;">âœ… La IA coincide con el diagnÃ³stico NIH:</strong> '+NIH_LABELS_ES[c.label]:'<strong style="color:#856404;">âš ï¸ La IA puede diferir del diagnÃ³stico NIH:</strong> '+NIH_LABELS_ES[c.label]+'<p style="margin-top:6px;font-size:.85rem;color:var(--text-light);">Recuerda que las etiquetas NIH fueron extraÃ­das por NLP y tienen ~90% de precisiÃ³n.</p>';
}

function nihGenerateXraySVG(label){
    // Real chest X-ray images from Wikimedia Commons (public domain / CC)
    var realImages={
        "No Finding":"https://upload.wikimedia.org/wikipedia/commons/thumb/c/cb/Chest_Xray_PA_3-8-2010.png/400px-Chest_Xray_PA_3-8-2010.png",
        "Pneumonia":"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Chest_X-ray_in_influenza_and_Haemophilus_influenzae.jpg/400px-Chest_X-ray_in_influenza_and_Haemophilus_influenzae.jpg",
        "Cardiomegaly":"https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/Chest_radiograph_of_a_person_with_congestive_heart_failure.png/400px-Chest_radiograph_of_a_person_with_congestive_heart_failure.png",
        "Effusion":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/Pleural_effusion.jpg/400px-Pleural_effusion.jpg",
        "Pneumothorax":"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Rt_sided_pneumothorax.jpg/400px-Rt_sided_pneumothorax.jpg",
        "Edema":"https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Pulmonary_edema.jpg/400px-Pulmonary_edema.jpg",
        "Atelectasis":"https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Atelectasia2.jpg/400px-Atelectasia2.jpg",
        "Consolidation":"https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Pneumonia_x-ray.jpg/400px-Pneumonia_x-ray.jpg",
        "Emphysema":"https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Centrilobular_emphysema_865_lores.jpg/400px-Centrilobular_emphysema_865_lores.jpg"
    };
    var url=realImages[label];
    if(url){
        return '<img src="'+url+'" alt="Chest X-ray: '+label+'" style="width:100%;max-width:400px;border-radius:8px;background:#000;" onerror="this.outerHTML=nihFallbackSVG(\''+label+'\');" crossorigin="anonymous"/>';
    }
    return nihFallbackSVG(label);
}

function nihFallbackSVG(label){
    var w=400,h=480;
    var extras="",heartRx="50",heartRy="55";
    var noise="";
    // Add realistic noise/texture
    for(var i=0;i<40;i++){
        var nx=60+Math.random()*280,ny=130+Math.random()*230,nr=1+Math.random()*3,no=.03+Math.random()*.08;
        noise+='<circle cx="'+nx+'" cy="'+ny+'" r="'+nr+'" fill="rgba(200,200,200,'+no+')"/>';
    }
    // Vascular markings
    var vasc='<g stroke="rgba(180,180,180,.08)" stroke-width="1" fill="none">'+
    '<path d="M165 180 Q150 200 140 230 Q130 260 125 290"/><path d="M165 180 Q155 210 160 250"/>'+
    '<path d="M235 180 Q250 200 260 230 Q270 260 275 290"/><path d="M235 180 Q245 210 240 250"/>'+
    '<path d="M160 190 Q140 210 130 240"/><path d="M240 190 Q260 210 270 240"/>'+
    '</g>';

    if(label==="Cardiomegaly"){heartRx="90";heartRy="80";extras='<ellipse cx="195" cy="280" rx="90" ry="80" fill="rgba(160,160,160,.45)" stroke="rgba(200,200,200,.2)" stroke-width="1"/>';}
    else if(label==="Effusion")extras='<path d="M65 350 Q130 325 200 335 Q260 325 335 350 L335 450 Q200 430 65 450Z" fill="rgba(180,180,180,.55)"/><path d="M65 360 Q200 340 335 360" stroke="rgba(200,200,200,.3)" stroke-width="1" fill="none"/>';
    else if(label==="Pneumothorax")extras='<path d="M260 140 Q310 150 315 220 Q315 300 280 360" stroke="rgba(255,255,200,.4)" stroke-width="2" fill="none"/><rect x="265" y="160" width="45" height="170" fill="rgba(0,0,0,.3)" rx="4"/><text x="272" y="250" fill="rgba(255,255,200,.35)" font-size="9" font-family="sans-serif">sin trama</text>';
    else if(label==="Consolidation")extras='<ellipse cx="145" cy="320" rx="55" ry="45" fill="rgba(190,190,190,.5)"/><path d="M120 310 L130 315 M135 305 L140 320 M150 300 L145 315" stroke="rgba(220,220,220,.3)" stroke-width="1"/>';
    else if(label==="Pneumonia")extras='<ellipse cx="260" cy="300" rx="50" ry="45" fill="rgba(190,190,190,.5)"/><g stroke="rgba(220,220,220,.25)" stroke-width="1"><line x1="240" y1="290" x2="250" y2="310"/><line x1="255" y1="285" x2="260" y2="305"/><line x1="270" y1="290" x2="265" y2="310"/></g>';
    else if(label==="Nodule")extras='<circle cx="260" cy="200" r="14" fill="rgba(190,190,190,.55)" stroke="rgba(220,220,220,.3)" stroke-width="1"/><circle cx="260" cy="200" r="8" fill="rgba(200,200,200,.3)"/>';
    else if(label==="Mass")extras='<ellipse cx="145" cy="210" rx="35" ry="30" fill="rgba(190,190,190,.5)" stroke="rgba(220,220,220,.25)" stroke-width="1"/><ellipse cx="145" cy="210" rx="20" ry="18" fill="rgba(200,200,200,.25)"/>';
    else if(label==="Edema")extras='<ellipse cx="200" cy="250" rx="90" ry="70" fill="rgba(180,180,180,.25)"/><ellipse cx="200" cy="250" rx="60" ry="45" fill="rgba(190,190,190,.2)"/><g stroke="rgba(200,200,200,.15)" stroke-width="1"><line x1="95" y1="340" x2="105" y2="340"/><line x1="100" y1="345" x2="110" y2="345"/><line x1="290" y1="340" x2="300" y2="340"/><line x1="295" y1="345" x2="305" y2="345"/></g>';
    else if(label==="Emphysema")extras='<ellipse cx="130" cy="250" rx="90" ry="115" fill="none" stroke="rgba(255,255,255,.1)" stroke-width="1"/><ellipse cx="270" cy="250" rx="90" ry="115" fill="none" stroke="rgba(255,255,255,.1)" stroke-width="1"/><path d="M65 380 L335 380" stroke="rgba(200,200,200,.2)" stroke-width="1" stroke-dasharray="3,2"/><text x="150" y="395" fill="rgba(255,255,255,.2)" font-size="8" font-family="sans-serif">diafragma aplanado</text>';
    else if(label==="Fibrosis")extras='<g opacity=".35" stroke="#aaa" stroke-width="1"><path d="M110 310 Q120 320 115 335"/><path d="M140 315 Q150 325 145 340"/><path d="M170 310 Q180 320 175 335"/><path d="M230 310 Q240 320 235 335"/><path d="M260 315 Q270 325 265 340"/><path d="M290 310 Q300 320 295 335"/></g><g opacity=".2"><circle cx="130" cy="340" r="5" fill="#aaa"/><circle cx="160" cy="345" r="4" fill="#aaa"/><circle cx="240" cy="340" r="5" fill="#aaa"/><circle cx="270" cy="345" r="4" fill="#aaa"/></g>';
    else if(label==="Hernia")extras='<ellipse cx="200" cy="380" rx="50" ry="40" fill="rgba(180,180,180,.4)"/><ellipse cx="200" cy="380" rx="30" ry="20" fill="rgba(50,50,50,.3)"/><text x="175" y="405" fill="rgba(255,255,255,.2)" font-size="8" font-family="sans-serif">aire retrocardiaco</text>';
    else if(label==="Atelectasis")extras='<path d="M100 310 Q140 340 100 370" stroke="rgba(200,200,200,.4)" stroke-width="2" fill="rgba(200,200,200,.25)"/><path d="M65 355 Q130 340 200 350" stroke="rgba(200,200,200,.25)" stroke-width="1.5" fill="none" stroke-dasharray="2,2"/><text x="70" y="345" fill="rgba(255,255,255,.25)" font-size="8" font-family="sans-serif">â†‘ hemidiafragma</text>';
    else if(label==="Pleural_Thickening")extras='<path d="M65 150 Q58 260 65 370" stroke="rgba(200,200,200,.4)" stroke-width="5"/><path d="M335 150 Q342 260 335 370" stroke="rgba(200,200,200,.4)" stroke-width="5"/><path d="M68 150 Q62 260 68 370" stroke="rgba(180,180,180,.2)" stroke-width="3"/><path d="M332 150 Q338 260 332 370" stroke="rgba(180,180,180,.2)" stroke-width="3"/>';
    else if(label==="Infiltration")extras='<g opacity=".35"><circle cx="150" cy="230" r="10" fill="#bbb"/><circle cx="170" cy="255" r="8" fill="#bbb"/><circle cx="225" cy="225" r="9" fill="#bbb"/><circle cx="245" cy="250" r="7" fill="#bbb"/><circle cx="200" cy="275" r="11" fill="#bbb"/><circle cx="135" cy="260" r="6" fill="#bbb"/><circle cx="260" cy="235" r="8" fill="#bbb"/></g>';

    return '<svg viewBox="0 0 '+w+' '+h+'" style="width:100%;max-width:400px;background:#0a0a0a;border-radius:8px;" xmlns="http://www.w3.org/2000/svg">'+
    '<defs>'+
    '<radialGradient id="lgL" cx="35%" cy="50%" r="45%"><stop offset="0%" stop-color="#2a2a2a"/><stop offset="70%" stop-color="#181818"/><stop offset="100%" stop-color="#0a0a0a"/></radialGradient>'+
    '<radialGradient id="lgR" cx="65%" cy="50%" r="45%"><stop offset="0%" stop-color="#2a2a2a"/><stop offset="70%" stop-color="#181818"/><stop offset="100%" stop-color="#0a0a0a"/></radialGradient>'+
    '<radialGradient id="hrt" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#555"/><stop offset="100%" stop-color="#333"/></radialGradient>'+
    '</defs>'+
    '<rect width="'+w+'" height="'+h+'" fill="#0a0a0a"/>'+
    // Soft tissue outline
    '<ellipse cx="200" cy="260" rx="150" ry="190" fill="none" stroke="rgba(200,200,200,.06)" stroke-width="2"/>'+
    // Lungs
    '<path d="M80 150 Q70 260 80 370 Q140 380 185 360 Q190 260 185 160 Q140 140 80 150Z" fill="url(#lgL)" stroke="rgba(200,200,200,.1)" stroke-width=".5"/>'+
    '<path d="M320 150 Q330 260 320 370 Q260 380 215 360 Q210 260 215 160 Q260 140 320 150Z" fill="url(#lgR)" stroke="rgba(200,200,200,.1)" stroke-width=".5"/>'+
    // Mediastinum
    '<rect x="185" y="130" width="30" height="250" fill="rgba(100,100,100,.2)" rx="5"/>'+
    // Trachea
    '<rect x="195" y="90" width="10" height="50" fill="rgba(40,40,40,.5)" rx="3" stroke="rgba(200,200,200,.08)" stroke-width="1"/>'+
    // Hilum
    '<ellipse cx="185" cy="210" rx="18" ry="25" fill="rgba(130,130,130,.25)"/>'+
    '<ellipse cx="215" cy="210" rx="18" ry="25" fill="rgba(130,130,130,.25)"/>'+
    // Heart
    '<ellipse cx="195" cy="290" rx="'+heartRx+'" ry="'+heartRy+'" fill="url(#hrt)" stroke="rgba(200,200,200,.1)" stroke-width=".5"/>'+
    // Aortic knob
    '<path d="M175 155 Q155 145 165 170" fill="rgba(130,130,130,.3)" stroke="rgba(200,200,200,.08)" stroke-width="1"/>'+
    // Spine
    '<line x1="200" y1="100" x2="200" y2="460" stroke="rgba(200,200,200,.05)" stroke-width="4"/>'+
    // Ribs
    '<g stroke="rgba(200,200,200,.08)" stroke-width="1.5" fill="none">'+
    '<path d="M85 165 Q140 155 200 160 Q260 155 315 165"/><path d="M80 200 Q140 188 200 193 Q260 188 320 200"/>'+
    '<path d="M78 235 Q140 220 200 225 Q260 220 322 235"/><path d="M80 270 Q140 255 200 260 Q260 255 320 270"/>'+
    '<path d="M83 305 Q140 290 200 295 Q260 290 317 305"/><path d="M88 340 Q140 325 200 330 Q260 325 312 340"/>'+
    '</g>'+
    // Clavicles
    '<path d="M85 130 Q130 120 190 125" stroke="rgba(200,200,200,.12)" stroke-width="2.5" fill="none"/>'+
    '<path d="M315 130 Q270 120 210 125" stroke="rgba(200,200,200,.12)" stroke-width="2.5" fill="none"/>'+
    // Scapulae hints
    '<path d="M65 160 Q55 220 65 300" stroke="rgba(200,200,200,.06)" stroke-width="3" fill="none"/>'+
    '<path d="M335 160 Q345 220 335 300" stroke="rgba(200,200,200,.06)" stroke-width="3" fill="none"/>'+
    // Diaphragm
    '<path d="M80 370 Q130 350 185 360 Q195 365 215 360 Q270 350 320 370" stroke="rgba(200,200,200,.12)" stroke-width="1.5" fill="none"/>'+
    // Costophrenic angles
    '<path d="M80 370 Q75 390 80 410" stroke="rgba(200,200,200,.08)" stroke-width="1" fill="none"/>'+
    '<path d="M320 370 Q325 390 320 410" stroke="rgba(200,200,200,.08)" stroke-width="1" fill="none"/>'+
    // Vascular markings
    vasc+
    // Random noise for realism
    noise+
    // Pathology overlay
    extras+
    // Labels
    '<text x="10" y="18" fill="rgba(255,255,255,.4)" font-size="11" font-family="monospace">NIH CXR-14</text>'+
    '<text x="10" y="32" fill="rgba(255,255,255,.25)" font-size="9" font-family="monospace">Esquema docente</text>'+
    '<text x="'+( w-55)+'" y="18" fill="rgba(255,255,255,.3)" font-size="10" font-family="monospace">PA</text>'+
    '<rect x="8" y="'+( h-28)+'" width="6" height="16" fill="rgba(255,255,255,.3)" rx="1"/>'+
    '<text x="20" y="'+( h-15)+'" fill="rgba(255,255,255,.25)" font-size="8" font-family="monospace">L</text>'+
    '</svg>';
}

// â•â•â• TELÃ‰FONOS BUSCAS â•â•â•
var TEL_DATA=[];

// â•â•â• PACIENTES GUARDIA â•â•â•
var GP_DATA={prof:[],urg:[]};
try{var gd=localStorage.getItem("guardia_pacientes_v1");if(gd)GP_DATA=JSON.parse(gd);}catch(e){}

function gpSave(){
    localStorage.setItem("guardia_pacientes_v1",JSON.stringify(GP_DATA));
    try{
        var user=firebase.auth().currentUser;
        if(user){
            db.collection("guardia_cambios").add({
                email:user.email||"",
                nombre:user.displayName||"",
                uid:user.uid,
                pacientes_prof:GP_DATA.prof.length,
                pacientes_urg:GP_DATA.urg.length,
                fecha:new Date(),
                timestamp:Date.now()
            });
        }
    }catch(e){console.error("Firestore gpSave log error:",e);}
}

function gpAdd(suffix){
    suffix=suffix||"";
    var cama=document.getElementById("gpCama"+suffix).value.trim();
    var id=document.getElementById("gpId"+suffix).value.trim();
    var edad=document.getElementById("gpEdad"+suffix).value.trim();
    var prioridad=document.getElementById("gpPrioridad"+suffix).value;
    var motivo=document.getElementById("gpMotivo"+suffix).value.trim();
    var notas=document.getElementById("gpNotas"+suffix).value.trim();
    if(!cama&&!id&&!motivo){alert("Rellena al menos cama, ID o motivo.");return;}
    var p={cama:cama,id:id,edad:edad,prioridad:prioridad,motivo:motivo,notas:notas,hora:new Date().toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),ts:Date.now()};
    var key=suffix==="Urg"?"urg":"prof";
    GP_DATA[key].push(p);
    gpSave();gpRender(suffix);gpClearForm(suffix);
}

function gpClearForm(suffix){
    suffix=suffix||"";
    ["gpCama","gpId","gpEdad","gpMotivo","gpNotas"].forEach(function(f){var el=document.getElementById(f+suffix);if(el)el.value="";});
    var sel=document.getElementById("gpPrioridad"+suffix);if(sel)sel.value="normal";
}

function gpDelete(key,idx){
    GP_DATA[key].splice(idx,1);gpSave();
    gpRender(key==="urg"?"Urg":"");
}

function gpToggleDone(key,idx){
    GP_DATA[key][idx].done=!GP_DATA[key][idx].done;gpSave();
    gpRender(key==="urg"?"Urg":"");
}

function gpRender(suffix){
    suffix=suffix||"";
    var key=suffix==="Urg"?"urg":"prof";
    var list=GP_DATA[key]||[];
    var el=document.getElementById("gpList"+suffix);
    if(!list.length){
        el.innerHTML='<div style="text-align:center;padding:30px;color:var(--text-muted);opacity:.6;"><div style="font-size:2rem;margin-bottom:8px;">ğŸ›ï¸</div><p style="font-size:.9rem;">No hay pacientes registrados en esta guardia</p></div>';
        return;
    }
    var prioOrder={urgente:0,atento:1,normal:2};
    var sorted=list.map(function(p,i){return{p:p,i:i};}).sort(function(a,b){return(prioOrder[a.p.prioridad]||2)-(prioOrder[b.p.prioridad]||2);});
    var prioColors={urgente:{bg:"#fef2f2",border:"#dc2626",dot:"ğŸ”´"},atento:{bg:"#fffbeb",border:"#f59e0b",dot:"ğŸŸ¡"},normal:{bg:suffix?"rgba(255,255,255,.06)":"var(--bg-card)",border:suffix?"rgba(255,255,255,.12)":"var(--border)",dot:"ğŸŸ¢"}};
    var isDark=suffix==="Urg";
    var html=sorted.map(function(item){
        var p=item.p,i=item.i;
        var pc=prioColors[p.prioridad]||prioColors.normal;
        var doneStyle=p.done?"opacity:.5;text-decoration:line-through;":"";
        return '<div style="background:'+(isDark?"rgba(255,255,255,.04)":pc.bg)+';border:1px solid '+(isDark?"rgba(255,255,255,.1)":pc.border)+';border-left:4px solid '+(p.prioridad==="urgente"?"#dc2626":p.prioridad==="atento"?"#f59e0b":"#4caf50")+';border-radius:var(--radius-sm);padding:14px;margin-bottom:8px;'+doneStyle+'">'+
        '<div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px;">'+
        '<div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">'+
        '<span style="font-size:.85rem;">'+pc.dot+'</span>'+
        (p.cama?'<span style="background:'+(isDark?"rgba(255,255,255,.12)":"var(--bg-subtle)")+';padding:3px 8px;border-radius:4px;font-weight:700;font-size:.85rem;">'+p.cama+'</span>':'')+
        (p.id?'<span style="font-weight:600;font-size:.9rem;">'+p.id+'</span>':'')+
        (p.edad?'<span style="font-size:.82rem;color:'+(isDark?"rgba(255,255,255,.5)":"var(--text-muted)")+';">'+p.edad+'</span>':'')+
        '<span style="font-size:.78rem;color:'+(isDark?"rgba(255,255,255,.35)":"var(--text-muted)")+';">â° '+p.hora+'</span>'+
        '</div>'+
        '<div style="display:flex;gap:4px;">'+
        '<button onclick="gpToggleDone(\''+key+'\','+i+')" style="background:none;border:none;cursor:pointer;font-size:1rem;padding:2px;" title="'+(p.done?"Desmarcar":"Marcar como hecho")+'">'+(p.done?"â†©ï¸":"âœ…")+'</button>'+
        '<button onclick="if(confirm(\'Â¿Eliminar?\'))gpDelete(\''+key+'\','+i+')" style="background:none;border:none;cursor:pointer;font-size:1rem;padding:2px;" title="Eliminar">ğŸ—‘ï¸</button>'+
        '</div></div>'+
        (p.motivo?'<div style="font-size:.88rem;font-weight:600;margin-bottom:4px;'+(isDark?"color:#fff;":"")+'">'+p.motivo+'</div>':'')+
        (p.notas?'<div style="font-size:.84rem;color:'+(isDark?"rgba(255,255,255,.65)":"var(--text-light)")+';line-height:1.5;">'+p.notas.replace(/\n/g,"<br>")+'</div>':'')+
        '</div>';
    }).join("");
    el.innerHTML=html;
}

function gpExport(suffix){
    suffix=suffix||"";
    var key=suffix==="Urg"?"urg":"prof";
    var list=GP_DATA[key]||[];
    if(!list.length){alert("No hay pacientes para copiar.");return;}
    var txt="PACIENTES GUARDIA â€” "+new Date().toLocaleDateString("es-ES")+"\n"+("=").repeat(40)+"\n\n";
    list.forEach(function(p,i){
        txt+=(i+1)+". "+(p.cama||"")+" | "+(p.id||"")+" | "+(p.edad||"")+" | "+({urgente:"ğŸ”´ URGENTE",atento:"ğŸŸ¡ ATENTO",normal:"ğŸŸ¢ Normal"}[p.prioridad]||"")+"\n";
        if(p.motivo)txt+="   Motivo: "+p.motivo+"\n";
        if(p.notas)txt+="   Notas: "+p.notas+"\n";
        txt+="   Hora: "+p.hora+(p.done?" âœ… HECHO":"")+"\n\n";
    });
    navigator.clipboard.writeText(txt).then(function(){alert("ğŸ“‹ Lista copiada al portapapeles");}).catch(function(){
        var ta=document.createElement("textarea");ta.value=txt;document.body.appendChild(ta);ta.select();document.execCommand("copy");document.body.removeChild(ta);alert("ğŸ“‹ Lista copiada");
    });
}

function gpClearAll(suffix){
    suffix=suffix||"";
    var key=suffix==="Urg"?"urg":"prof";
    GP_DATA[key]=[];gpSave();gpRender(suffix);
}// Will be populated when admin uploads data
try{var td=localStorage.getItem("tel_buscas_v1");if(td)TEL_DATA=JSON.parse(td);}catch(e){}

function renderTelefonos(data){
    var list=data||TEL_DATA;
    var el=document.getElementById("telDirectory");
    if(!list||list.length===0){
        el.innerHTML='<div style="text-align:center;padding:50px 20px;color:var(--text-muted);"><div style="font-size:3rem;margin-bottom:16px;opacity:.4;">ğŸ“‹</div><p style="font-size:1rem;font-weight:600;margin-bottom:8px;">Directorio en preparaciÃ³n</p><p style="font-size:.9rem;">Los nÃºmeros de buscas del Hospital Santa LucÃ­a se aÃ±adirÃ¡n prÃ³ximamente.</p></div>';
        return;
    }
    // Group by category/service
    var groups={};
    list.forEach(function(t){var cat=t.categoria||t.servicio||"General";if(!groups[cat])groups[cat]=[];groups[cat].push(t);});
    var html="";
    Object.keys(groups).sort().forEach(function(cat){
        html+='<div style="margin-bottom:20px;"><h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--primary-dark);margin-bottom:10px;padding-bottom:8px;border-bottom:2px solid var(--border);">'+cat+'</h3>';
        html+='<div style="display:grid;gap:8px;">';
        groups[cat].forEach(function(t){
            html+='<div class="tel-row" style="background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 16px;display:flex;justify-content:space-between;align-items:center;transition:.2s;" onmouseover="this.style.borderColor=\'#d4a853\'" onmouseout="this.style.borderColor=\'var(--border)\'">';
            html+='<div><span style="font-weight:600;font-size:.92rem;">'+( t.nombre||t.servicio||"")+'</span>';
            if(t.descripcion)html+='<span style="font-size:.82rem;color:var(--text-muted);margin-left:8px;">'+t.descripcion+'</span>';
            html+='</div>';
            html+='<a href="tel:'+( t.numero||t.busca||"")+'" style="background:linear-gradient(135deg,#d4a853,#b8912e);color:#fff;padding:6px 14px;border-radius:20px;font-weight:700;font-size:.88rem;text-decoration:none;white-space:nowrap;">ğŸ“ '+( t.numero||t.busca||"")+'</a>';
            html+='</div>';
        });
        html+='</div></div>';
    });
    el.innerHTML=html;
}

function filterTelefonos(){
    var q=document.getElementById("telSearch").value.toLowerCase().trim();
    if(!q){renderTelefonos();return;}
    var filtered=TEL_DATA.filter(function(t){
        return(t.nombre&&t.nombre.toLowerCase().indexOf(q)!==-1)||
              (t.servicio&&t.servicio.toLowerCase().indexOf(q)!==-1)||
              (t.categoria&&t.categoria.toLowerCase().indexOf(q)!==-1)||
              (t.descripcion&&t.descripcion.toLowerCase().indexOf(q)!==-1)||
              (t.numero&&t.numero.indexOf(q)!==-1)||
              (t.busca&&t.busca.indexOf(q)!==-1);
    });
    renderTelefonos(filtered);
}

function loadTelData(jsonArray){
    TEL_DATA=jsonArray;
    localStorage.setItem("tel_buscas_v1",JSON.stringify(TEL_DATA));
    renderTelefonos();
}

// â•â•â• FIREBASE INITIALIZATION â•â•â•
const firebaseConfig={
    apiKey:"AIzaSyAvdYi6BVdltgeFH4KLHD_5iFZrSRgoykc",
    authDomain:"docenciacartagenaeste.firebaseapp.com",
    projectId:"docenciacartagenaeste",
    storageBucket:"docenciacartagenaeste.firebasestorage.app",
    messagingSenderId:"1056320755107",
    appId:"1:1056320755107:web:126637bf63c13bbb297616"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

// Handle redirect result (for mobile where popup is blocked)
firebase.auth().getRedirectResult().then(function(result){
    if(result.user){
        console.log("Redirect login success:",result.user.email);
        if(pendingPageAfterLogin){
            var pg=pendingPageAfterLogin;pendingPageAfterLogin=null;
            logPageAccess(pg,result.user);
            showPage(pg);
        }else{
            showPage("pageScanIA");scanRenderHist();
        }
    }
}).catch(function(e){console.log("No redirect result:",e);});

// â•â•â• INIT â•â•â•
document.addEventListener("keydown",function(e){if(e.key==="Escape"){var ap=document.getElementById("adminPanel");if(ap&&ap.style.display!=="none"){ap.style.display="none";return;}var sl=document.getElementById("scanLoginModal");if(sl&&sl.style.display==="flex"){sl.style.display="none";return;}}});
document.addEventListener("DOMContentLoaded",function(){
    initLoginSession();
    renderPatients();
    var p=new URLSearchParams(window.location.search);
    if(p.get("view")==="professionals"||p.get("category"))showPage("pageProfessionals");
    else if(p.get("view")==="patients")showPage("pagePatients");
    
    // Enter key en login
    document.getElementById("loginPassword").addEventListener("keypress",function(e){
        if(e.key==="Enter")loginAdmin();
    });
    document.getElementById("loginUsername").addEventListener("keypress",function(e){
        if(e.key==="Enter")document.getElementById("loginPassword").focus();
    });
});
</script>
</body>
</html>
